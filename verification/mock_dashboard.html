<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mock Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#002e6d',
                        'brand-white': '#ffffff',
                        'brand-light-gray': '#d9e0e7',
                        'brand-dark-gray': '#242424',
                        'veritas-navy': '#12385d',
                        'veritas-gold': '#c5a05a',
                    }
                }
            }
        }
    </script>
    <style>
        /* Add any custom styles from Common_Styles.html if needed, simplified here */
        body { font-family: 'Lexend', sans-serif; }
    </style>
</head>
<body class="bg-gray-100">

<!-- Mock Dashboard Container -->
<div id="dashboard" class="p-8 max-w-7xl mx-auto">
    <div class="bg-white rounded-xl shadow-sm p-6">
        <h2 class="text-2xl font-bold text-veritas-navy mb-6">Poll Library</h2>

        <!-- Table View Container -->
        <div id="polls-table-view" class="overflow-visible rounded-lg border border-gray-200">
            <table class="min-w-full divide-y divide-gray-200 text-sm">
                <thead class="bg-gray-50 text-gray-600">
                    <tr>
                        <th class="px-4 py-3 text-left font-semibold">Poll</th>
                        <th class="px-4 py-3 text-left font-semibold">Class</th>
                        <th class="px-4 py-3 text-left font-semibold">Questions</th>
                        <th class="px-4 py-3 text-left font-semibold">Mode</th>
                        <th class="px-4 py-3 text-left font-semibold">Last Edited</th>
                        <th class="px-4 py-3 text-right font-semibold">Actions</th>
                    </tr>
                </thead>
                <tbody id="polls-table-body" class="divide-y divide-gray-100 bg-white"></tbody>
            </table>
        </div>
    </div>
</div>

<!-- Mock Scripts -->
<script>
    // Mock Data
    var ALL_POLLS = [
        {
            pollId: 'poll-1',
            pollName: 'Unit 1 Review',
            className: 'AP Biology',
            questions: [1, 2, 3],
            sessionType: 'LIVE_POLL',
            updatedAt: new Date().toISOString()
        },
        {
            pollId: 'poll-2',
            pollName: 'Chapter 5 Quiz',
            className: 'Chemistry',
            questions: [1, 2, 3, 4, 5],
            sessionType: 'SECURE_ASSESSMENT',
            updatedAt: new Date(Date.now() - 86400000).toISOString()
        }
    ];

    var pollSortMode = 'updated_desc';
    var pollClassFilter = 'all';
    var pollSearchQuery = '';

    // Mocks for Google Apps Script
    var google = {
        script: {
            run: {
                withSuccessHandler: function(cb) {
                    return {
                        withFailureHandler: function(errCb) {
                            return {
                                getTeacherDashboardData: function() {
                                    cb({ polls: ALL_POLLS, classes: ['AP Biology', 'Chemistry'] });
                                },
                                copyPoll: function() {
                                    setTimeout(() => { cb({success: true, message: 'Poll copied', polls: ALL_POLLS}); }, 500);
                                },
                                deletePoll: function() {
                                    setTimeout(() => { cb(ALL_POLLS); }, 500);
                                }
                            }
                        }
                    }
                }
            }
        }
    };

    // Mock Helper Functions
    function formatDateTime(iso) { return new Date(iso).toLocaleString(); }
    function escapeHtml(text) { return text; }
    function getFilteredSortedPolls() { return ALL_POLLS; }
    function buildSessionModeCellHtml(poll) { return poll.sessionType === 'SECURE_ASSESSMENT' ? 'Secure' : 'Live'; }

    // Mock Modal Functions
    function veritasPrompt() { return Promise.resolve('Copy of Poll'); }
    function veritasConfirm() { return Promise.resolve(true); }
    function veritasAlert(msg) { console.log('Alert:', msg); }

    // Mock Actions
    function startEditPoll(id) { console.log('Edit Poll:', id); }
    function openPollPreview(id) { console.log('Preview Poll:', id); }
    function onPollSelectChange() {}
    function showDashboard() {}

    // --- The Dropped Down Code Logic (pasted from Teacher_Scripts.html changes) ---
    var pollsTableBody = document.getElementById('polls-table-body');

    // Dropdown Management
    var activeDropdown = null;

    function closeActiveDropdown() {
        if (activeDropdown) {
            activeDropdown.remove();
            activeDropdown = null;
            document.removeEventListener('click', handleGlobalDropdownClick);
        }
    }

    function handleGlobalDropdownClick(e) {
        if (activeDropdown && activeDropdown.contains(e.target)) {
            return;
        }
        closeActiveDropdown();
    }

    function togglePollDropdown(btn, pollId) {
        var existing = activeDropdown;
        closeActiveDropdown();

        if (existing && existing.dataset.triggerId === pollId) {
            return;
        }

        var rect = btn.getBoundingClientRect();
        var menu = document.createElement('div');
        menu.className = 'fixed z-[9999] w-52 rounded-xl border border-white/5 bg-gray-800 p-1 text-sm text-white shadow-lg transition duration-100 ease-out origin-top-right';
        menu.style.top = (rect.bottom + 5) + 'px';

        var menuWidth = 208;
        var leftPos = rect.right - menuWidth;

        if (leftPos < 10) {
            leftPos = rect.left;
        }

        menu.style.left = leftPos + 'px';
        menu.dataset.triggerId = pollId;

        var items = [
            { label: 'Edit', icon: 'edit', action: 'edit', kbd: '⌘E' },
            { label: 'Duplicate', icon: 'content_copy', action: 'duplicate', kbd: '⌘D' },
            { label: 'Preview', icon: 'visibility', action: 'preview', kbd: '⌘P' },
            { type: 'divider' },
            { label: 'Delete', icon: 'delete', action: 'delete', kbd: '⌘Del', danger: true }
        ];

        items.forEach(function(item) {
            if (item.type === 'divider') {
                var div = document.createElement('div');
                div.className = 'my-1 h-px bg-white/5';
                menu.appendChild(div);
                return;
            }

            var btnItem = document.createElement('button');
            btnItem.className = 'group flex w-full items-center gap-2 rounded-lg px-3 py-1.5 hover:bg-white/10 text-left transition-colors ' + (item.danger ? 'text-red-400 hover:text-red-300' : 'text-white');

            var iconColorClass = item.danger ? 'text-red-400 group-hover:text-red-300' : 'text-white/60 group-hover:text-white';

            btnItem.innerHTML = `
                <span class="material-symbols-outlined text-base ${iconColorClass}">${item.icon}</span>
                <span>${item.label}</span>
                ${item.kbd ? `<kbd class="ml-auto hidden font-sans text-xs text-white/50 group-hover:inline">${item.kbd}</kbd>` : ''}
            `;

            btnItem.onclick = function(e) {
                e.stopPropagation();
                handleDropdownAction(item.action, pollId);
                closeActiveDropdown();
            };
            menu.appendChild(btnItem);
        });

        document.body.appendChild(menu);
        activeDropdown = menu;

        requestAnimationFrame(function() {
            document.addEventListener('click', handleGlobalDropdownClick);
        });
    }

    function handleDropdownAction(action, pollId) {
        console.log('Action triggered:', action, pollId);
        if (action === 'edit') startEditPoll(pollId);
        else if (action === 'duplicate') handleCopyPoll(pollId);
        else if (action === 'preview') openPollPreview(pollId);
        else if (action === 'delete') handleDeletePoll(pollId);
    }

    function renderPollTable(polls){
        polls=polls||ALL_POLLS;
        pollsTableBody.innerHTML='';

        if(polls.length===0){
            return;
        }

        polls.forEach(function(poll){
            var row=document.createElement('tr');
            row.className='hover:bg-brand-light-gray/40 dark:hover:bg-brand-dark-gray/40 transition-colors border-b';
            var lastEdited=formatDateTime(poll.updatedAt);
            var createdLabel='—';
            var htmlParts=[];
            htmlParts.push('<td class="px-4 py-3 align-top">');
            htmlParts.push('<div class="font-semibold text-brand-dark-gray"><span class="poll-name-link cursor-pointer hover:text-primary transition-colors" data-poll-id="'+poll.pollId+'">'+escapeHtml(poll.pollName)+'</span></div>');
            htmlParts.push('<div class="text-xs text-brand-dark-gray/60">Created '+createdLabel+'</div>');
            htmlParts.push('</td>');
            htmlParts.push('<td class="px-4 py-3 align-top text-brand-dark-gray/80">'+escapeHtml(poll.className)+'</td>');
            htmlParts.push('<td class="px-4 py-3 align-top text-brand-dark-gray/80">'+(poll.questions.length)+'</td>');
            htmlParts.push('<td class="px-4 py-3 align-top text-brand-dark-gray/80">'+buildSessionModeCellHtml(poll)+'</td>');
            htmlParts.push('<td class="px-4 py-3 align-top text-brand-dark-gray/80">'+lastEdited+'</td>');

            // Actions Column
            htmlParts.push('<td class="px-4 py-3 align-top text-right">');
            htmlParts.push('<div class="flex justify-end items-center gap-2">');

            // Primary Action: Select
            htmlParts.push('<button class="poll-select-btn h-8 px-3 rounded-md bg-primary/10 text-primary text-xs font-semibold hover:bg-primary/20 transition-colors" data-poll-id="'+poll.pollId+'">Select</button>');

            // Options Dropdown Trigger
            htmlParts.push('<div class="relative inline-block text-left">');
            htmlParts.push('<button type="button" class="poll-options-btn inline-flex items-center gap-2 rounded-md bg-gray-800 px-3 py-1.5 text-xs font-semibold text-white shadow-inner shadow-white/10 hover:bg-gray-700 focus:outline-none transition-colors" data-poll-id="'+poll.pollId+'" aria-expanded="false" aria-haspopup="true">');
            htmlParts.push('Options');
            htmlParts.push('<span class="material-symbols-outlined text-base text-white/60">keyboard_arrow_down</span>');
            htmlParts.push('</button>');
            htmlParts.push('</div>');

            htmlParts.push('</div>');
            htmlParts.push('</td>');
            row.innerHTML=htmlParts.join('');
            pollsTableBody.appendChild(row);
        });

        attachPollActionHandlers(pollsTableBody);
    }

    function attachPollActionHandlers(root){
        root.querySelectorAll('.poll-options-btn').forEach(function(btn){
            btn.onclick=function(e){
                e.stopPropagation();
                var id=this.dataset.pollId;
                togglePollDropdown(this, id);
            };
        });
    }

    async function handleCopyPoll(pollId) { console.log('Copy Poll', pollId); }
    async function handleDeletePoll(pollId) { console.log('Delete Poll', pollId); }

    // Initialize
    renderPollTable(ALL_POLLS);

</script>

</body>
</html>