<!DOCTYPE html>
<html class="light" lang="en">

<head>
  <?!= include('Common_Head'); ?>
  <title>Veritas Live Poll - Student</title>

  <?!= include('Common_TailwindConfig'); ?>
  <?!= include('Proctoring_Shared'); ?>

  <!-- Firebase SDKs (compat) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>

  <script>
    window.SESSION_TOKEN = '<?= sessionToken ?>';
    // CRITICAL: Store student email for violation reporting fallback
    // This ensures violations can be attributed even if SESSION_TOKEN is lost/invalid
    window.STUDENT_EMAIL = '<?= studentEmail ?>';
    var FIREBASE_CONFIG = <?!= JSON.stringify(firebaseConfig) ?>;
    if (!FIREBASE_CONFIG) {
      console.warn('FIREBASE_CONFIG missing, using default fallback.');
      FIREBASE_CONFIG = {
        apiKey: "AIzaSyAv0bCe5KIuQx_sou8toBy5DG2PYaB_pBM",
        authDomain: "classroomproctor.firebaseapp.com",
        databaseURL: "https://classroomproctor-default-rtdb.firebaseio.com",
        projectId: "classroomproctor",
        storageBucket: "classroomproctor.firebasestorage.app",
        messagingSenderId: "600627073908",
        appId: "1:600627073908:web:935970f5849b28f6ad5221"
      };
    }
    var Veritas = Veritas || {};
    Veritas.Config = Veritas.Config || {};
    Veritas.Config.DEBUG_FIREBASE = <?!= Veritas.Config.DEBUG_FIREBASE ? 'true' : 'false' ?>;

    // Store student email in sessionStorage for persistence across page refreshes
    if (window.STUDENT_EMAIL) {
      try {
        sessionStorage.setItem('veritas_student_email', window.STUDENT_EMAIL);
      } catch (e) { /* Storage may be unavailable */ }
    }
  </script>

  <?!= include('Common_Styles'); ?>
  <?!= include('Student_Styles'); ?>
</head>

<body class="light">
  <?!= include('Student_Body'); ?>
  <?!= include('Login_Components'); ?>
  <?!= include('Common_Scripts'); ?>
  <?!= include('Student_Scripts'); ?>
  <?!= include('Theme_Manager'); ?>
</body>

</html>