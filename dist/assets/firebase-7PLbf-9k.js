(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();const lS=()=>{};var u_={};const Ew={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};const V=function(n,e){if(!n)throw Xi(e)},Xi=function(n){return new Error("Firebase Database ("+Ew.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};const Tw=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},uS=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],l=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},Lf={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,l=s+2<n.length,u=l?n[s+2]:0,h=i>>2,f=(i&3)<<4|a>>4;let m=(a&15)<<2|u>>6,_=u&63;l||(_=64,o||(m=64)),r.push(t[h],t[f],t[m],t[_])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Tw(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):uS(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const u=s<n.length?t[n.charAt(s)]:64;++s;const f=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||u==null||f==null)throw new hS;const m=i<<2|a>>4;if(r.push(m),u!==64){const _=a<<4&240|u>>2;if(r.push(_),f!==64){const A=u<<6&192|f;r.push(A)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class hS extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const vw=function(n){const e=Tw(n);return Lf.encodeByteArray(e,!0)},Cl=function(n){return vw(n).replace(/\./g,"")},va=function(n){try{return Lf.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function dS(n){return Aa(void 0,n)}function Aa(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!fS(t)||(n[t]=Aa(n[t],e[t]));return n}function fS(n){return n!=="__proto__"}function Mf(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const pS=()=>Mf().__FIREBASE_DEFAULTS__,mS=()=>{if(typeof process>"u"||typeof u_>"u")return;const n=u_.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},gS=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&va(n[1]);return e&&JSON.parse(e)},Ff=()=>{try{return lS()||pS()||mS()||gS()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Uf=()=>Ff()?.config,_S=n=>Ff()?.[`_${n}`];class Rt{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}function Yt(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function sc(n){return(await fetch(n,{credentials:"include"})).ok}function Bf(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Cl(JSON.stringify(t)),Cl(JSON.stringify(o)),""].join(".")}const ra={};function yS(){const n={prod:[],emulator:[]};for(const e of Object.keys(ra))ra[e]?n.emulator.push(e):n.prod.push(e);return n}function IS(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let h_=!1;function ic(n,e){if(typeof window>"u"||typeof document>"u"||!Yt(window.location.host)||ra[n]===e||ra[n]||h_)return;ra[n]=e;function t(m){return`__firebase__banner__${m}`}const r="__firebase__banner",i=yS().prod.length>0;function o(){const m=document.getElementById(r);m&&m.remove()}function a(m){m.style.display="flex",m.style.background="#7faaf0",m.style.position="fixed",m.style.bottom="5px",m.style.left="5px",m.style.padding=".5em",m.style.borderRadius="5px",m.style.alignItems="center"}function l(m,_){m.setAttribute("width","24"),m.setAttribute("id",_),m.setAttribute("height","24"),m.setAttribute("viewBox","0 0 24 24"),m.setAttribute("fill","none"),m.style.marginLeft="-6px"}function u(){const m=document.createElement("span");return m.style.cursor="pointer",m.style.marginLeft="16px",m.style.fontSize="24px",m.innerHTML=" &times;",m.onclick=()=>{h_=!0,o()},m}function h(m,_){m.setAttribute("id",_),m.innerText="Learn more",m.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",m.setAttribute("target","__blank"),m.style.paddingLeft="5px",m.style.textDecoration="underline"}function f(){const m=IS(r),_=t("text"),A=document.getElementById(_)||document.createElement("span"),k=t("learnmore"),N=document.getElementById(k)||document.createElement("a"),W=t("preprendIcon"),z=document.getElementById(W)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(m.created){const q=m.element;a(q),h(N,k);const K=u();l(z,W),q.append(z,A,N,K),document.body.appendChild(q)}i?(A.innerText="Preview backend disconnected.",z.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(z.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,A.innerText="Preview backend running in this workspace."),A.setAttribute("id",_)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",f):f()}function Ce(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function qf(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ce())}function _u(){const n=Ff()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function wS(){return typeof window<"u"||Aw()}function Aw(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function ES(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function bw(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function yu(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Rw(){const n=Ce();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function TS(){return Ew.NODE_ADMIN===!0}function Sw(){return!_u()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Cw(){return!_u()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function ba(){try{return typeof indexedDB=="object"}catch{return!1}}function vS(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{e(s.error?.message||"")}}catch(t){e(t)}})}const AS="FirebaseError";class $e extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=AS,Object.setPrototypeOf(this,$e.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Fs.prototype.create)}}class Fs{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?bS(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new $e(s,a,r)}}function bS(n,e){return n.replace(RS,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const RS=/\{\$([^}]+)}/g;function Ra(n){return JSON.parse(n)}function We(n){return JSON.stringify(n)}const Pw=function(n){let e={},t={},r={},s="";try{const i=n.split(".");e=Ra(va(i[0])||""),t=Ra(va(i[1])||""),s=i[2],r=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:r,signature:s}},SS=function(n){const e=Pw(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},CS=function(n){const e=Pw(n).claims;return typeof e=="object"&&e.admin===!0};function Ut(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Is(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function Pl(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function kl(n,e,t){const r={};for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&(r[s]=e.call(t,n[s],s,n));return r}function Bn(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if(d_(i)&&d_(o)){if(!Bn(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function d_(n){return n!==null&&typeof n=="object"}function Us(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function di(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function Ko(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}class PS{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const r=this.W_;if(typeof e=="string")for(let f=0;f<16;f++)r[f]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let f=0;f<16;f++)r[f]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let f=16;f<80;f++){const m=r[f-3]^r[f-8]^r[f-14]^r[f-16];r[f]=(m<<1|m>>>31)&4294967295}let s=this.chain_[0],i=this.chain_[1],o=this.chain_[2],a=this.chain_[3],l=this.chain_[4],u,h;for(let f=0;f<80;f++){f<40?f<20?(u=a^i&(o^a),h=1518500249):(u=i^o^a,h=1859775393):f<60?(u=i&o|a&(i|o),h=2400959708):(u=i^o^a,h=3395469782);const m=(s<<5|s>>>27)+u+l+h+r[f]&4294967295;l=a,a=o,o=(i<<30|i>>>2)&4294967295,i=s,s=m}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+i&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const r=t-this.blockSize;let s=0;const i=this.buf_;let o=this.inbuf_;for(;s<t;){if(o===0)for(;s<=r;)this.compress_(e,s),s+=this.blockSize;if(typeof e=="string"){for(;s<t;)if(i[o]=e.charCodeAt(s),++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}else for(;s<t;)if(i[o]=e[s],++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let s=this.blockSize-1;s>=56;s--)this.buf_[s]=t&255,t/=256;this.compress_(this.buf_);let r=0;for(let s=0;s<5;s++)for(let i=24;i>=0;i-=8)e[r]=this.chain_[s]>>i&255,++r;return e}}function kw(n,e){const t=new kS(n,e);return t.subscribe.bind(t)}class kS{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");NS(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=Yh),s.error===void 0&&(s.error=Yh),s.complete===void 0&&(s.complete=Yh);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function NS(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Yh(){}const H=function(n,e,t,r){let s;if(r<e?s="at least "+e:r>t&&(s=t===0?"none":"no more than "+t),s){const i=n+" failed: Was called with "+r+(r===1?" argument.":" arguments.")+" Expects "+s+".";throw new Error(i)}};function Nt(n,e){return`${n} failed: ${e} argument `}function Qe(n,e,t,r){if(!(r&&!t)&&typeof t!="function")throw new Error(Nt(n,e)+"must be a valid function.")}function f_(n,e,t,r){if(t&&(typeof t!="object"||t===null))throw new Error(Nt(n,e)+"must be a valid context object.")}const DS=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);if(s>=55296&&s<=56319){const i=s-55296;r++,V(r<n.length,"Surrogate pair missing trail surrogate.");const o=n.charCodeAt(r)-56320;s=65536+(i<<10)+o}s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):s<65536?(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},Iu=function(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,t++):e+=3}return e};function U(n){return n&&n._delegate?n._delegate:n}class Ze{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Zr="[DEFAULT]";class Rd{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new Rt;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(OS(e))try{this.getOrInitializeService({instanceIdentifier:Zr})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=Zr){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Zr){return this.instances.has(e)}getOptions(e=Zr){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:xS(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Zr){return this.component?this.component.multipleInstances?e:Zr:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function xS(n){return n===Zr?void 0:n}function OS(n){return n.instantiationMode==="EAGER"}class Wf{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Rd(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const $f=[];var te;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(te||(te={}));const Nw={debug:te.DEBUG,verbose:te.VERBOSE,info:te.INFO,warn:te.WARN,error:te.ERROR,silent:te.SILENT},VS=te.INFO,LS={[te.DEBUG]:"log",[te.VERBOSE]:"log",[te.INFO]:"info",[te.WARN]:"warn",[te.ERROR]:"error"},MS=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=LS[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Zi{constructor(e){this.name=e,this._logLevel=VS,this._logHandler=MS,this._userLogHandler=null,$f.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in te))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Nw[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,te.DEBUG,...e),this._logHandler(this,te.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,te.VERBOSE,...e),this._logHandler(this,te.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,te.INFO,...e),this._logHandler(this,te.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,te.WARN,...e),this._logHandler(this,te.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,te.ERROR,...e),this._logHandler(this,te.ERROR,...e)}}function FS(n){$f.forEach(e=>{e.setLogLevel(n)})}function US(n,e){for(const t of $f){let r=null;e&&e.level&&(r=Nw[e.level]),n===null?t.userLogHandler=null:t.userLogHandler=(s,i,...o)=>{const a=o.map(l=>{if(l==null)return null;if(typeof l=="string")return l;if(typeof l=="number"||typeof l=="boolean")return l.toString();if(l instanceof Error)return l.message;try{return JSON.stringify(l)}catch{return null}}).filter(l=>l).join(" ");i>=(r??s.logLevel)&&n({level:te[i].toLowerCase(),message:a,args:o,type:s.name})}}}const BS=(n,e)=>e.some(t=>n instanceof t);let p_,m_;function qS(){return p_||(p_=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function WS(){return m_||(m_=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Dw=new WeakMap,Sd=new WeakMap,xw=new WeakMap,Jh=new WeakMap,zf=new WeakMap;function $S(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(gr(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&Dw.set(t,n)}).catch(()=>{}),zf.set(e,n),e}function zS(n){if(Sd.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});Sd.set(n,e)}let Cd={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Sd.get(n);if(e==="objectStoreNames")return n.objectStoreNames||xw.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return gr(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function GS(n){Cd=n(Cd)}function jS(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Xh(this),e,...t);return xw.set(r,e.sort?e.sort():[e]),gr(r)}:WS().includes(n)?function(...e){return n.apply(Xh(this),e),gr(Dw.get(this))}:function(...e){return gr(n.apply(Xh(this),e))}}function HS(n){return typeof n=="function"?jS(n):(n instanceof IDBTransaction&&zS(n),BS(n,qS())?new Proxy(n,Cd):n)}function gr(n){if(n instanceof IDBRequest)return $S(n);if(Jh.has(n))return Jh.get(n);const e=HS(n);return e!==n&&(Jh.set(n,e),zf.set(e,n)),e}const Xh=n=>zf.get(n);function KS(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=gr(o);return r&&o.addEventListener("upgradeneeded",l=>{r(gr(o.result),l.oldVersion,l.newVersion,gr(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",u=>s(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}const QS=["get","getKey","getAll","getAllKeys","count"],YS=["put","add","delete","clear"],Zh=new Map;function g_(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Zh.get(e))return Zh.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=YS.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||QS.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let u=l.store;return r&&(u=u.index(a.shift())),(await Promise.all([u[t](...a),s&&l.done]))[0]};return Zh.set(e,i),i}GS(n=>({...n,get:(e,t,r)=>g_(e,t)||n.get(e,t,r),has:(e,t)=>!!g_(e,t)||n.has(e,t)}));class JS{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(XS(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function XS(n){return n.getComponent()?.type==="VERSION"}const Nl="@firebase/app",Pd="0.14.7";const qn=new Zi("@firebase/app"),ZS="@firebase/app-compat",eC="@firebase/analytics-compat",tC="@firebase/analytics",nC="@firebase/app-check-compat",rC="@firebase/app-check",sC="@firebase/auth",iC="@firebase/auth-compat",oC="@firebase/database",aC="@firebase/data-connect",cC="@firebase/database-compat",lC="@firebase/functions",uC="@firebase/functions-compat",hC="@firebase/installations",dC="@firebase/installations-compat",fC="@firebase/messaging",pC="@firebase/messaging-compat",mC="@firebase/performance",gC="@firebase/performance-compat",_C="@firebase/remote-config",yC="@firebase/remote-config-compat",IC="@firebase/storage",wC="@firebase/storage-compat",EC="@firebase/firestore",TC="@firebase/ai",vC="@firebase/firestore-compat",AC="firebase",bC="12.8.0";const Ar="[DEFAULT]",RC={[Nl]:"fire-core",[ZS]:"fire-core-compat",[tC]:"fire-analytics",[eC]:"fire-analytics-compat",[rC]:"fire-app-check",[nC]:"fire-app-check-compat",[sC]:"fire-auth",[iC]:"fire-auth-compat",[oC]:"fire-rtdb",[aC]:"fire-data-connect",[cC]:"fire-rtdb-compat",[lC]:"fire-fn",[uC]:"fire-fn-compat",[hC]:"fire-iid",[dC]:"fire-iid-compat",[fC]:"fire-fcm",[pC]:"fire-fcm-compat",[mC]:"fire-perf",[gC]:"fire-perf-compat",[_C]:"fire-rc",[yC]:"fire-rc-compat",[IC]:"fire-gcs",[wC]:"fire-gcs-compat",[EC]:"fire-fst",[vC]:"fire-fst-compat",[TC]:"fire-vertex","fire-js":"fire-js",[AC]:"fire-js-all"};const br=new Map,vi=new Map,Ai=new Map;function Sa(n,e){try{n.container.addComponent(e)}catch(t){qn.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Ow(n,e){n.container.addOrOverwriteComponent(e)}function an(n){const e=n.name;if(Ai.has(e))return qn.debug(`There were multiple attempts to register component ${e}.`),!1;Ai.set(e,n);for(const t of br.values())Sa(t,n);for(const t of vi.values())Sa(t,n);return!0}function Vw(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function SC(n,e,t=Ar){Vw(n,e).clearInstance(t)}function Gf(n){return n.options!==void 0}function Lw(n){return Gf(n)?!1:"authIdToken"in n||"appCheckToken"in n||"releaseOnDeref"in n||"automaticDataCollectionEnabled"in n}function me(n){return n==null?!1:n.settings!==void 0}function CC(){Ai.clear()}const PC={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ft=new Fs("app","Firebase",PC);let Mw=class{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Ze("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ft.create("app-deleted",{appName:this._name})}};function __(n,e){const t=va(n.split(".")[1]);if(t===null){console.error(`FirebaseServerApp ${e} is invalid: second part could not be parsed.`);return}if(JSON.parse(t).exp===void 0){console.error(`FirebaseServerApp ${e} is invalid: expiration claim could not be parsed`);return}const s=JSON.parse(t).exp*1e3,i=new Date().getTime();s-i<=0&&console.error(`FirebaseServerApp ${e} is invalid: the token has expired.`)}class kC extends Mw{constructor(e,t,r,s){const i=t.automaticDataCollectionEnabled!==void 0?t.automaticDataCollectionEnabled:!0,o={name:r,automaticDataCollectionEnabled:i};if(e.apiKey!==void 0)super(e,o,s);else{const a=e;super(a.options,o,s)}this._serverConfig={automaticDataCollectionEnabled:i,...t},this._serverConfig.authIdToken&&__(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&__(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,typeof FinalizationRegistry<"u"&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,t.releaseOnDeref=void 0,rt(Nl,Pd,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(e){this.isDeleted||(this._refCount++,e!==void 0&&this._finalizationRegistry!==null&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){Hf(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw Ft.create("server-app-deleted")}}const Dn=bC;function jf(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:Ar,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw Ft.create("bad-app-name",{appName:String(s)});if(t||(t=Uf()),!t)throw Ft.create("no-options");const i=br.get(s);if(i){if(Bn(t,i.options)&&Bn(r,i.config))return i;throw Ft.create("duplicate-app",{appName:s})}const o=new Wf(s);for(const l of Ai.values())o.addComponent(l);const a=new Mw(t,r,o);return br.set(s,a),a}function NC(n,e={}){if(wS()&&!Aw())throw Ft.create("invalid-server-app-environment");let t,r=e||{};if(n&&(Gf(n)?t=n.options:Lw(n)?r=n:t=n),r.automaticDataCollectionEnabled===void 0&&(r.automaticDataCollectionEnabled=!0),t||(t=Uf()),!t)throw Ft.create("no-options");const s={...r,...t};s.releaseOnDeref!==void 0&&delete s.releaseOnDeref;const i=h=>[...h].reduce((f,m)=>Math.imul(31,f)+m.charCodeAt(0)|0,0);if(r.releaseOnDeref!==void 0&&typeof FinalizationRegistry>"u")throw Ft.create("finalization-registry-not-supported",{});const o=""+i(JSON.stringify(s)),a=vi.get(o);if(a)return a.incRefCount(r.releaseOnDeref),a;const l=new Wf(o);for(const h of Ai.values())l.addComponent(h);const u=new kC(t,r,o,l);return vi.set(o,u),u}function DC(n=Ar){const e=br.get(n);if(!e&&n===Ar&&Uf())return jf();if(!e)throw Ft.create("no-app",{appName:n});return e}function xC(){return Array.from(br.values())}async function Hf(n){let e=!1;const t=n.name;br.has(t)?(e=!0,br.delete(t)):vi.has(t)&&n.decRefCount()<=0&&(vi.delete(t),e=!0),e&&(await Promise.all(n.container.getProviders().map(r=>r.delete())),n.isDeleted=!0)}function rt(n,e,t){let r=RC[n]??n;t&&(r+=`-${t}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const o=[`Unable to register library "${r}" with version "${e}":`];s&&o.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&o.push("and"),i&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),qn.warn(o.join(" "));return}an(new Ze(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}function Fw(n,e){if(n!==null&&typeof n!="function")throw Ft.create("invalid-log-argument");US(n,e)}function Uw(n){FS(n)}const OC="firebase-heartbeat-database",VC=1,Ca="firebase-heartbeat-store";let ed=null;function Bw(){return ed||(ed=KS(OC,VC,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Ca)}catch(t){console.warn(t)}}}}).catch(n=>{throw Ft.create("idb-open",{originalErrorMessage:n.message})})),ed}async function LC(n){try{const t=(await Bw()).transaction(Ca),r=await t.objectStore(Ca).get(qw(n));return await t.done,r}catch(e){if(e instanceof $e)qn.warn(e.message);else{const t=Ft.create("idb-get",{originalErrorMessage:e?.message});qn.warn(t.message)}}}async function y_(n,e){try{const r=(await Bw()).transaction(Ca,"readwrite");await r.objectStore(Ca).put(e,qw(n)),await r.done}catch(t){if(t instanceof $e)qn.warn(t.message);else{const r=Ft.create("idb-set",{originalErrorMessage:t?.message});qn.warn(r.message)}}}function qw(n){return`${n.name}!${n.options.appId}`}const MC=1024,FC=30;class UC{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new qC(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=I_();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(s=>s.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:t}),this._heartbeatsCache.heartbeats.length>FC){const s=WC(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){qn.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=I_(),{heartbeatsToSend:t,unsentEntries:r}=BC(this._heartbeatsCache.heartbeats),s=Cl(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(e){return qn.warn(e),""}}}function I_(){return new Date().toISOString().substring(0,10)}function BC(n,e=MC){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),w_(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),w_(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class qC{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return ba()?vS().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await LC(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return y_(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return y_(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function w_(n){return Cl(JSON.stringify({version:2,heartbeats:n})).length}function WC(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function $C(n){an(new Ze("platform-logger",e=>new JS(e),"PRIVATE")),an(new Ze("heartbeat",e=>new UC(e),"PRIVATE")),rt(Nl,Pd,n),rt(Nl,Pd,"esm2020"),rt("fire-js","")}$C("");const zC=Object.freeze(Object.defineProperty({__proto__:null,FirebaseError:$e,SDK_VERSION:Dn,_DEFAULT_ENTRY_NAME:Ar,_addComponent:Sa,_addOrOverwriteComponent:Ow,_apps:br,_clearComponents:CC,_components:Ai,_getProvider:Vw,_isFirebaseApp:Gf,_isFirebaseServerApp:me,_isFirebaseServerAppSettings:Lw,_registerComponent:an,_removeServiceInstance:SC,_serverApps:vi,deleteApp:Hf,getApp:DC,getApps:xC,initializeApp:jf,initializeServerApp:NC,onLog:Fw,registerVersion:rt,setLogLevel:Uw},Symbol.toStringTag,{value:"Module"}));class GC{constructor(e,t){this._delegate=e,this.firebase=t,Sa(e,new Ze("app-compat",()=>this,"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise(e=>{this._delegate.checkDestroyed(),e()}).then(()=>(this.firebase.INTERNAL.removeApp(this.name),Hf(this._delegate)))}_getService(e,t=Ar){this._delegate.checkDestroyed();const r=this._delegate.container.getProvider(e);return!r.isInitialized()&&r.getComponent()?.instantiationMode==="EXPLICIT"&&r.initialize(),r.getImmediate({identifier:t})}_removeServiceInstance(e,t=Ar){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){Sa(this._delegate,e)}_addOrOverwriteComponent(e){Ow(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const jC={"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."},E_=new Fs("app-compat","Firebase",jC);function HC(n){const e={},t={__esModule:!0,initializeApp:i,app:s,registerVersion:rt,setLogLevel:Uw,onLog:Fw,apps:null,SDK_VERSION:Dn,INTERNAL:{registerComponent:a,removeApp:r,useAsService:l,modularAPIs:zC}};t.default=t,Object.defineProperty(t,"apps",{get:o});function r(u){delete e[u]}function s(u){if(u=u||Ar,!Ut(e,u))throw E_.create("no-app",{appName:u});return e[u]}s.App=n;function i(u,h={}){const f=jf(u,h);if(Ut(e,f.name))return e[f.name];const m=new n(f,t);return e[f.name]=m,m}function o(){return Object.keys(e).map(u=>e[u])}function a(u){const h=u.name,f=h.replace("-compat","");if(an(u)&&u.type==="PUBLIC"){const m=(_=s())=>{if(typeof _[f]!="function")throw E_.create("invalid-app-argument",{appName:h});return _[f]()};u.serviceProps!==void 0&&Aa(m,u.serviceProps),t[f]=m,n.prototype[f]=function(..._){return this._getService.bind(this,h).apply(this,u.multipleInstances?_:[])}}return u.type==="PUBLIC"?t[f]:null}function l(u,h){return h==="serverAuth"?null:h}return t}function Ww(){const n=HC(GC);n.INTERNAL={...n.INTERNAL,createFirebaseNamespace:Ww,extendNamespace:e,createSubscribe:kw,ErrorFactory:Fs,deepExtend:Aa};function e(t){Aa(n,t)}return n}const KC=Ww();const T_=new Zi("@firebase/app-compat"),QC="@firebase/app-compat",YC="0.5.7";function JC(n){rt(QC,YC,n)}try{const n=Mf();if(n.firebase!==void 0){T_.warn(`
      Warning: Firebase is already defined in the global scope. Please make sure
      Firebase library is only loaded once.
    `);const e=n.firebase.SDK_VERSION;e&&e.indexOf("LITE")>=0&&T_.warn(`
        Warning: You are trying to load Firebase while using Firebase Performance standalone script.
        You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
        `)}}catch{}const Kt=KC;JC();var XC="firebase",ZC="12.8.0";Kt.registerVersion(XC,ZC,"app-compat");const xo={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",TWITTER:"twitter.com"},Js={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};function eP(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements.","invalid-hosting-link-domain":"The provided Hosting link domain is not configured in Firebase Hosting or is not owned by the current project. This cannot be a default Hosting domain (`web.app` or `firebaseapp.com`)."}}function $w(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const tP=eP,nP=$w,zw=new Fs("auth","Firebase",$w());const Dl=new Zi("@firebase/auth");function rP(n,...e){Dl.logLevel<=te.WARN&&Dl.warn(`Auth (${Dn}): ${n}`,...e)}function dl(n,...e){Dl.logLevel<=te.ERROR&&Dl.error(`Auth (${Dn}): ${n}`,...e)}function it(n,...e){throw Qf(n,...e)}function ze(n,...e){return Qf(n,...e)}function Kf(n,e,t){const r={...nP(),[e]:t};return new Fs("auth","Firebase",r).create(e,{appName:n.name})}function Xe(n){return Kf(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function eo(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&it(n,"argument-error"),Kf(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Qf(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return zw.create(n,...e)}function O(n,e,...t){if(!n)throw Qf(e,...t)}function In(n){const e="INTERNAL ASSERTION FAILED: "+n;throw dl(e),new Error(e)}function cn(n,e){n||In(e)}function Pa(){return typeof self<"u"&&self.location?.href||""}function Yf(){return v_()==="http:"||v_()==="https:"}function v_(){return typeof self<"u"&&self.location?.protocol||null}function sP(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Yf()||bw()||"connection"in navigator)?navigator.onLine:!0}function iP(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}class oc{constructor(e,t){this.shortDelay=e,this.longDelay=t,cn(t>e,"Short delay should be less than long delay!"),this.isMobile=qf()||yu()}get(){return sP()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Jf(n,e){cn(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}class Gw{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;In("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;In("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;In("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const oP={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const aP=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],cP=new oc(3e4,6e4);function xe(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function Oe(n,e,t,r,s={}){return jw(n,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=Us({key:n.config.apiKey,...o}).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const u={method:e,headers:l,...i};return ES()||(u.referrerPolicy="no-referrer"),n.emulatorConfig&&Yt(n.emulatorConfig.host)&&(u.credentials="include"),Gw.fetch()(await Hw(n,n.config.apiHost,t,a),u)})}async function jw(n,e,t){n._canInitEmulator=!1;const r={...oP,...e};try{const s=new uP(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw Qo(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,u]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw Qo(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw Qo(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw Qo(n,"user-disabled",o);const h=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw Kf(n,h,u);it(n,h)}}catch(s){if(s instanceof $e)throw s;it(n,"network-request-failed",{message:String(s)})}}async function jn(n,e,t,r,s={}){const i=await Oe(n,e,t,r,s);return"mfaPendingCredential"in i&&it(n,"multi-factor-auth-required",{_serverResponse:i}),i}async function Hw(n,e,t,r){const s=`${e}${t}?${r}`,i=n,o=i.config.emulator?Jf(n.config,s):`${n.config.apiScheme}://${s}`;return aP.includes(t)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(o).toString():o}function lP(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class uP{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(ze(this.auth,"network-request-failed")),cP.get())})}}function Qo(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=ze(n,e,r);return s.customData._tokenResponse=t,s}function A_(n){return n!==void 0&&n.getResponse!==void 0}function b_(n){return n!==void 0&&n.enterprise!==void 0}class Kw{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return lP(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function hP(n){return(await Oe(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function Qw(n,e){return Oe(n,"GET","/v2/recaptchaConfig",xe(n,e))}async function dP(n,e){return Oe(n,"POST","/v1/accounts:delete",e)}async function fP(n,e){return Oe(n,"POST","/v1/accounts:update",e)}async function xl(n,e){return Oe(n,"POST","/v1/accounts:lookup",e)}function sa(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function pP(n,e=!1){const t=U(n),r=await t.getIdToken(e),s=wu(r);O(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i?.sign_in_provider;return{claims:s,token:r,authTime:sa(td(s.auth_time)),issuedAtTime:sa(td(s.iat)),expirationTime:sa(td(s.exp)),signInProvider:o||null,signInSecondFactor:i?.sign_in_second_factor||null}}function td(n){return Number(n)*1e3}function wu(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return dl("JWT malformed, contained fewer than 3 sections"),null;try{const s=va(t);return s?JSON.parse(s):(dl("Failed to decode base64 JWT payload"),null)}catch(s){return dl("Caught error parsing JWT payload as JSON",s?.toString()),null}}function R_(n){const e=wu(n);return O(e,"internal-error"),O(typeof e.exp<"u","internal-error"),O(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function Wn(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof $e&&mP(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function mP({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}class gP{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class kd{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=sa(this.lastLoginAt),this.creationTime=sa(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function ka(n){const e=n.auth,t=await n.getIdToken(),r=await Wn(n,xl(e,{idToken:t}));O(r?.users.length,e,"internal-error");const s=r.users[0];n._notifyReloadListener(s);const i=s.providerUserInfo?.length?Yw(s.providerUserInfo):[],o=yP(n.providerData,i),a=n.isAnonymous,l=!(n.email&&s.passwordHash)&&!o?.length,u=a?l:!1,h={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new kd(s.createdAt,s.lastLoginAt),isAnonymous:u};Object.assign(n,h)}async function _P(n){const e=U(n);await ka(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function yP(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function Yw(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function IP(n,e){const t=await jw(n,{},async()=>{const r=Us({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,o=await Hw(n,s,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:a,body:r};return n.emulatorConfig&&Yt(n.emulatorConfig.host)&&(l.credentials="include"),Gw.fetch()(o,l)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function wP(n,e){return Oe(n,"POST","/v2/accounts:revokeToken",xe(n,e))}class fi{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){O(e.idToken,"internal-error"),O(typeof e.idToken<"u","internal-error"),O(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):R_(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){O(e.length!==0,"internal-error");const t=R_(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(O(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await IP(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,o=new fi;return r&&(O(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(O(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(O(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new fi,this.toJSON())}_performRefresh(){return In("not implemented")}}function ir(n,e){O(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class en{constructor({uid:e,auth:t,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new gP(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new kd(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await Wn(this,this.stsTokenManager.getToken(this.auth,e));return O(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return pP(this,e)}reload(){return _P(this)}_assign(e){this!==e&&(O(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new en({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){O(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await ka(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(me(this.auth.app))return Promise.reject(Xe(this.auth));const e=await this.getIdToken();return await Wn(this,dP(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const r=t.displayName??void 0,s=t.email??void 0,i=t.phoneNumber??void 0,o=t.photoURL??void 0,a=t.tenantId??void 0,l=t._redirectEventId??void 0,u=t.createdAt??void 0,h=t.lastLoginAt??void 0,{uid:f,emailVerified:m,isAnonymous:_,providerData:A,stsTokenManager:k}=t;O(f&&k,e,"internal-error");const N=fi.fromJSON(this.name,k);O(typeof f=="string",e,"internal-error"),ir(r,e.name),ir(s,e.name),O(typeof m=="boolean",e,"internal-error"),O(typeof _=="boolean",e,"internal-error"),ir(i,e.name),ir(o,e.name),ir(a,e.name),ir(l,e.name),ir(u,e.name),ir(h,e.name);const W=new en({uid:f,auth:e,email:s,emailVerified:m,displayName:r,isAnonymous:_,photoURL:o,phoneNumber:i,tenantId:a,stsTokenManager:N,createdAt:u,lastLoginAt:h});return A&&Array.isArray(A)&&(W.providerData=A.map(z=>({...z}))),l&&(W._redirectEventId=l),W}static async _fromIdTokenResponse(e,t,r=!1){const s=new fi;s.updateFromServerResponse(t);const i=new en({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await ka(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];O(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?Yw(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!i?.length,a=new fi;a.updateFromIdToken(r);const l=new en({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),u={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new kd(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!i?.length};return Object.assign(l,u),l}}const S_=new Map;function Mt(n){cn(n instanceof Function,"Expected a class definition");let e=S_.get(n);return e?(cn(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,S_.set(n,e),e)}class Jw{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Jw.type="NONE";const bi=Jw;function ps(n,e,t){return`firebase:${n}:${e}:${t}`}class pi{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=ps(this.userKey,s.apiKey,i),this.fullPersistenceKey=ps("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await xl(this.auth,{idToken:e}).catch(()=>{});return t?en._fromGetAccountInfoResponse(this.auth,t,e):null}return en._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new pi(Mt(bi),e,r);const s=(await Promise.all(t.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let i=s[0]||Mt(bi);const o=ps(r,e.config.apiKey,e.name);let a=null;for(const u of t)try{const h=await u._get(o);if(h){let f;if(typeof h=="string"){const m=await xl(e,{idToken:h}).catch(()=>{});if(!m)break;f=await en._fromGetAccountInfoResponse(e,m,h)}else f=en._fromJSON(e,h);u!==i&&(a=f),i=u;break}}catch{}const l=s.filter(u=>u._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new pi(i,e,r):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async u=>{if(u!==i)try{await u._remove(o)}catch{}})),new pi(i,e,r))}}function C_(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(tE(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Xw(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(nE(e))return"Blackberry";if(rE(e))return"Webos";if(Zw(e))return"Safari";if((e.includes("chrome/")||eE(e))&&!e.includes("edge/"))return"Chrome";if(ac(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function Xw(n=Ce()){return/firefox\//i.test(n)}function Zw(n=Ce()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function eE(n=Ce()){return/crios\//i.test(n)}function tE(n=Ce()){return/iemobile/i.test(n)}function ac(n=Ce()){return/android/i.test(n)}function nE(n=Ce()){return/blackberry/i.test(n)}function rE(n=Ce()){return/webos/i.test(n)}function cc(n=Ce()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function EP(n=Ce()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(n)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(n)}function TP(n=Ce()){return cc(n)&&!!window.navigator?.standalone}function vP(){return Rw()&&document.documentMode===10}function sE(n=Ce()){return cc(n)||ac(n)||rE(n)||nE(n)||/windows phone/i.test(n)||tE(n)}function iE(n,e=[]){let t;switch(n){case"Browser":t=C_(Ce());break;case"Worker":t=`${C_(Ce())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Dn}/${r}`}class AP{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}async function bP(n,e={}){return Oe(n,"GET","/v2/passwordPolicy",xe(n,e))}const RP=6;class SP{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??RP,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class CP{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new P_(this),this.idTokenSubscription=new P_(this),this.beforeStateQueue=new AP(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=zw,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Mt(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await pi.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await xl(this,{idToken:e}),r=await en._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(me(this.app)){const i=this.app.settings.authIdToken;return i?new Promise(o=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(i).then(o,o))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let r=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const i=this.redirectUser?._redirectEventId,o=r?._redirectEventId,a=await this.tryRedirectSignIn(e);(!i||i===o)&&a?.user&&(r=a.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(i){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(i))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return O(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await ka(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=iP()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(me(this.app))return Promise.reject(Xe(this));const t=e?U(e):null;return t&&O(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&O(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return me(this.app)?Promise.reject(Xe(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return me(this.app)?Promise.reject(Xe(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Mt(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await bP(this),t=new SP(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Fs("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await wP(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Mt(e)||this._popupRedirectResolver;O(t,this,"argument-error"),this.redirectPersistenceManager=await pi.create(this,[Mt(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(O(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,r,s);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return O(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=iE(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(me(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&rP(`Error while retrieving App Check token: ${e.error}`),e?.token}}function Pe(n){return U(n)}class P_{constructor(e){this.auth=e,this.observer=null,this.addObserver=kw(t=>this.observer=t)}get next(){return O(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let lc={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function PP(n){lc=n}function Xf(n){return lc.loadJS(n)}function kP(){return lc.recaptchaV2Script}function NP(){return lc.recaptchaEnterpriseScript}function DP(){return lc.gapiScript}function oE(n){return`__${n}${Math.floor(Math.random()*1e6)}`}const xP=500,OP=6e4,Zc=1e12;class VP{constructor(e){this.auth=e,this.counter=Zc,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new FP(e,this.auth.name,t||{})),this.counter++,r}reset(e){const t=e||Zc;this._widgets.get(t)?.delete(),this._widgets.delete(t)}getResponse(e){const t=e||Zc;return this._widgets.get(t)?.getResponse()||""}async execute(e){const t=e||Zc;return this._widgets.get(t)?.execute(),""}}class LP{constructor(){this.enterprise=new MP}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class MP{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class FP{constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const s=typeof e=="string"?document.getElementById(e):e;O(s,"argument-error",{appName:t}),this.container=s,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=UP(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},OP)},xP))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function UP(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}const BP="recaptcha-enterprise",ia="NO_RECAPTCHA";class aE{constructor(e){this.type=BP,this.auth=Pe(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{Qw(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const u=new Kw(l);return i.tenantId==null?i._agentRecaptchaConfig=u:i._tenantRecaptchaConfigs[i.tenantId]=u,o(u.siteKey)}}).catch(l=>{a(l)})})}function s(i,o,a){const l=window.grecaptcha;b_(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(u=>{o(u)}).catch(()=>{o(ia)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new LP().execute("siteKey",{action:"verify"}):new Promise((i,o)=>{r(this.auth).then(a=>{if(!t&&b_(window.grecaptcha))s(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=NP();l.length!==0&&(l+=a),Xf(l).then(()=>{s(a,i,o)}).catch(u=>{o(u)})}}).catch(a=>{o(a)})})}}async function Oo(n,e,t,r=!1,s=!1){const i=new aE(n);let o;if(s)o=ia;else try{o=await i.verify(t)}catch{o=await i.verify(t,!0)}const a={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in a){const l=a.phoneEnrollmentInfo.phoneNumber,u=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:l,recaptchaToken:u,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const l=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:l,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return r?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function _r(n,e,t,r,s){if(s==="EMAIL_PASSWORD_PROVIDER")if(n._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await Oo(n,e,t,t==="getOobCode");return r(n,i)}else return r(n,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await Oo(n,e,t,t==="getOobCode");return r(n,o)}else return Promise.reject(i)});else if(s==="PHONE_PROVIDER")if(n._getRecaptchaConfig()?.isProviderEnabled("PHONE_PROVIDER")){const i=await Oo(n,e,t);return r(n,i).catch(async o=>{if(n._getRecaptchaConfig()?.getProviderEnforcementState("PHONE_PROVIDER")==="AUDIT"&&(o.code==="auth/missing-recaptcha-token"||o.code==="auth/invalid-app-credential")){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${t} flow.`);const a=await Oo(n,e,t,!1,!0);return r(n,a)}return Promise.reject(o)})}else{const i=await Oo(n,e,t,!1,!0);return r(n,i)}else return Promise.reject(s+" provider is not supported.")}async function qP(n){const e=Pe(n),t=await Qw(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new Kw(t);e.tenantId==null?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isAnyProviderEnabled()&&new aE(e).verify()}function WP(n,e){const t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(Mt);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function $P(n,e,t){const r=Pe(n);O(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!t?.disableWarnings,i=cE(e),{host:o,port:a}=zP(e),l=a===null?"":`:${a}`,u={url:`${i}//${o}${l}/`},h=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){O(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),O(Bn(u,r.config.emulator)&&Bn(h,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=u,r.emulatorConfig=h,r.settings.appVerificationDisabledForTesting=!0,Yt(o)?(sc(`${i}//${o}${l}`),ic("Auth",!0)):s||GP()}function cE(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function zP(n){const e=cE(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:k_(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:k_(o)}}}function k_(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function GP(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}class to{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return In("not implemented")}_getIdTokenResponse(e){return In("not implemented")}_linkToIdToken(e,t){return In("not implemented")}_getReauthenticationResolver(e){return In("not implemented")}}async function lE(n,e){return Oe(n,"POST","/v1/accounts:resetPassword",xe(n,e))}async function jP(n,e){return Oe(n,"POST","/v1/accounts:update",e)}async function HP(n,e){return Oe(n,"POST","/v1/accounts:signUp",e)}async function KP(n,e){return Oe(n,"POST","/v1/accounts:update",xe(n,e))}async function QP(n,e){return jn(n,"POST","/v1/accounts:signInWithPassword",xe(n,e))}async function Eu(n,e){return Oe(n,"POST","/v1/accounts:sendOobCode",xe(n,e))}async function YP(n,e){return Eu(n,e)}async function JP(n,e){return Eu(n,e)}async function XP(n,e){return Eu(n,e)}async function ZP(n,e){return Eu(n,e)}async function ek(n,e){return jn(n,"POST","/v1/accounts:signInWithEmailLink",xe(n,e))}async function tk(n,e){return jn(n,"POST","/v1/accounts:signInWithEmailLink",xe(n,e))}class Na extends to{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new Na(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new Na(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return _r(e,t,"signInWithPassword",QP,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return ek(e,{email:this._email,oobCode:this._password});default:it(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return _r(e,r,"signUpPassword",HP,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return tk(e,{idToken:t,email:this._email,oobCode:this._password});default:it(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Mn(n,e){return jn(n,"POST","/v1/accounts:signInWithIdp",xe(n,e))}const nk="http://localhost";class Sn extends to{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Sn(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):it("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...i}=t;if(!r||!s)return null;const o=new Sn(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return Mn(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Mn(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Mn(e,t)}buildRequest(){const e={requestUri:nk,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Us(t)}return e}}async function N_(n,e){return Oe(n,"POST","/v1/accounts:sendVerificationCode",xe(n,e))}async function rk(n,e){return jn(n,"POST","/v1/accounts:signInWithPhoneNumber",xe(n,e))}async function sk(n,e){const t=await jn(n,"POST","/v1/accounts:signInWithPhoneNumber",xe(n,e));if(t.temporaryProof)throw Qo(n,"account-exists-with-different-credential",t);return t}const ik={USER_NOT_FOUND:"user-not-found"};async function ok(n,e){const t={...e,operation:"REAUTH"};return jn(n,"POST","/v1/accounts:signInWithPhoneNumber",xe(n,t),ik)}class ms extends to{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new ms({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new ms({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return rk(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return sk(e,{idToken:t,...this._makeVerificationRequest()})}_getReauthenticationResolver(e){return ok(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i}=e;return!r&&!t&&!s&&!i?null:new ms({verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i})}}function ak(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function ck(n){const e=di(Ko(n)).link,t=e?di(Ko(e)).deep_link_id:null,r=di(Ko(n)).deep_link_id;return(r?di(Ko(r)).link:null)||r||t||e||n}class Tu{constructor(e){const t=di(Ko(e)),r=t.apiKey??null,s=t.oobCode??null,i=ak(t.mode??null);O(r&&s&&i,"argument-error"),this.apiKey=r,this.operation=i,this.code=s,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=ck(e);try{return new Tu(t)}catch{return null}}}class Fr{constructor(){this.providerId=Fr.PROVIDER_ID}static credential(e,t){return Na._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=Tu.parseLink(t);return O(r,"argument-error"),Na._fromEmailAndCode(e,r.code,r.tenantId)}}Fr.PROVIDER_ID="password";Fr.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Fr.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Hn{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class no extends Hn{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class mi extends no{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return O("providerId"in t&&"signInMethod"in t,"argument-error"),Sn._fromParams(t)}credential(e){return this._credential({...e,nonce:e.rawNonce})}_credential(e){return O(e.idToken||e.accessToken,"argument-error"),Sn._fromParams({...e,providerId:this.providerId,signInMethod:this.providerId})}static credentialFromResult(e){return mi.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return mi.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:s,pendingToken:i,nonce:o,providerId:a}=e;if(!r&&!s&&!t&&!i||!a)return null;try{return new mi(a)._credential({idToken:t,accessToken:r,nonce:o,pendingToken:i})}catch{return null}}}class pn extends no{constructor(){super("facebook.com")}static credential(e){return Sn._fromParams({providerId:pn.PROVIDER_ID,signInMethod:pn.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return pn.credentialFromTaggedObject(e)}static credentialFromError(e){return pn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return pn.credential(e.oauthAccessToken)}catch{return null}}}pn.FACEBOOK_SIGN_IN_METHOD="facebook.com";pn.PROVIDER_ID="facebook.com";class mn extends no{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Sn._fromParams({providerId:mn.PROVIDER_ID,signInMethod:mn.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return mn.credentialFromTaggedObject(e)}static credentialFromError(e){return mn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return mn.credential(t,r)}catch{return null}}}mn.GOOGLE_SIGN_IN_METHOD="google.com";mn.PROVIDER_ID="google.com";class gn extends no{constructor(){super("github.com")}static credential(e){return Sn._fromParams({providerId:gn.PROVIDER_ID,signInMethod:gn.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return gn.credentialFromTaggedObject(e)}static credentialFromError(e){return gn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return gn.credential(e.oauthAccessToken)}catch{return null}}}gn.GITHUB_SIGN_IN_METHOD="github.com";gn.PROVIDER_ID="github.com";const lk="http://localhost";class Ri extends to{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return Mn(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Mn(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Mn(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,pendingToken:i}=t;return!r||!s||!i||r!==s?null:new Ri(r,i)}static _create(e,t){return new Ri(e,t)}buildRequest(){return{requestUri:lk,returnSecureToken:!0,pendingToken:this.pendingToken}}}const uk="saml.";class Ol extends Hn{constructor(e){O(e.startsWith(uk),"argument-error"),super(e)}static credentialFromResult(e){return Ol.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return Ol.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=Ri.fromJSON(e);return O(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return Ri._create(r,t)}catch{return null}}}class _n extends no{constructor(){super("twitter.com")}static credential(e,t){return Sn._fromParams({providerId:_n.PROVIDER_ID,signInMethod:_n.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return _n.credentialFromTaggedObject(e)}static credentialFromError(e){return _n.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return _n.credential(t,r)}catch{return null}}}_n.TWITTER_SIGN_IN_METHOD="twitter.com";_n.PROVIDER_ID="twitter.com";async function uE(n,e){return jn(n,"POST","/v1/accounts:signUp",xe(n,e))}class Qt{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await en._fromIdTokenResponse(e,r,s),o=D_(r);return new Qt({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=D_(r);return new Qt({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function D_(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}async function hk(n){if(me(n.app))return Promise.reject(Xe(n));const e=Pe(n);if(await e._initializationPromise,e.currentUser?.isAnonymous)return new Qt({user:e.currentUser,providerId:null,operationType:"signIn"});const t=await uE(e,{returnSecureToken:!0}),r=await Qt._fromIdTokenResponse(e,"signIn",t,!0);return await e._updateCurrentUser(r.user),r}class Vl extends $e{constructor(e,t,r,s){super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,Vl.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new Vl(e,t,r,s)}}function hE(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Vl._fromErrorAndOperation(n,i,e,r):i})}function dE(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}async function dk(n,e){const t=U(n);await vu(!0,t,e);const{providerUserInfo:r}=await fP(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),s=dE(r||[]);return t.providerData=t.providerData.filter(i=>s.has(i.providerId)),s.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function Zf(n,e,t=!1){const r=await Wn(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Qt._forOperation(n,"link",r)}async function vu(n,e,t){await ka(e);const r=dE(e.providerData),s=n===!1?"provider-already-linked":"no-such-provider";O(r.has(t)===n,e.auth,s)}async function fE(n,e,t=!1){const{auth:r}=n;if(me(r.app))return Promise.reject(Xe(r));const s="reauthenticate";try{const i=await Wn(n,hE(r,s,e,n),t);O(i.idToken,r,"internal-error");const o=wu(i.idToken);O(o,r,"internal-error");const{sub:a}=o;return O(n.uid===a,r,"user-mismatch"),Qt._forOperation(n,s,i)}catch(i){throw i?.code==="auth/user-not-found"&&it(r,"user-mismatch"),i}}async function pE(n,e,t=!1){if(me(n.app))return Promise.reject(Xe(n));const r="signIn",s=await hE(n,r,e),i=await Qt._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function Au(n,e){return pE(Pe(n),e)}async function mE(n,e){const t=U(n);return await vu(!1,t,e.providerId),Zf(t,e)}async function gE(n,e){return fE(U(n),e)}async function fk(n,e){return jn(n,"POST","/v1/accounts:signInWithCustomToken",xe(n,e))}async function pk(n,e){if(me(n.app))return Promise.reject(Xe(n));const t=Pe(n),r=await fk(t,{token:e,returnSecureToken:!0}),s=await Qt._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(s.user),s}class uc{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?ep._fromServerResponse(e,t):"totpInfo"in t?tp._fromServerResponse(e,t):it(e,"internal-error")}}class ep extends uc{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new ep(t)}}class tp extends uc{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new tp(t)}}function bu(n,e,t){O(t.url?.length>0,n,"invalid-continue-uri"),O(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),O(typeof t.linkDomain>"u"||t.linkDomain.length>0,n,"invalid-hosting-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.linkDomain=t.linkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(O(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(O(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}async function np(n){const e=Pe(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function mk(n,e,t){const r=Pe(n),s={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&bu(r,s,t),await _r(r,s,"getOobCode",JP,"EMAIL_PASSWORD_PROVIDER")}async function gk(n,e,t){await lE(U(n),{oobCode:e,newPassword:t}).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&np(n),r})}async function _k(n,e){await KP(U(n),{oobCode:e})}async function _E(n,e){const t=U(n),r=await lE(t,{oobCode:e}),s=r.requestType;switch(O(s,t,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":O(r.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":O(r.mfaInfo,t,"internal-error");default:O(r.email,t,"internal-error")}let i=null;return r.mfaInfo&&(i=uc._fromServerResponse(Pe(t),r.mfaInfo)),{data:{email:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.newEmail:r.email)||null,previousEmail:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.email:r.newEmail)||null,multiFactorInfo:i},operation:s}}async function yk(n,e){const{data:t}=await _E(U(n),e);return t.email}async function Ik(n,e,t){if(me(n.app))return Promise.reject(Xe(n));const r=Pe(n),o=await _r(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",uE,"EMAIL_PASSWORD_PROVIDER").catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&np(n),l}),a=await Qt._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function wk(n,e,t){return me(n.app)?Promise.reject(Xe(n)):Au(U(n),Fr.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&np(n),r})}async function Ek(n,e,t){const r=Pe(n),s={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function i(o,a){O(a.handleCodeInApp,r,"argument-error"),a&&bu(r,o,a)}i(s,t),await _r(r,s,"getOobCode",XP,"EMAIL_PASSWORD_PROVIDER")}function Tk(n,e){return Tu.parseLink(e)?.operation==="EMAIL_SIGNIN"}async function vk(n,e,t){if(me(n.app))return Promise.reject(Xe(n));const r=U(n),s=Fr.credentialWithLink(e,t||Pa());return O(s._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),Au(r,s)}async function Ak(n,e){return Oe(n,"POST","/v1/accounts:createAuthUri",xe(n,e))}async function bk(n,e){const t=Yf()?Pa():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:s}=await Ak(U(n),r);return s||[]}async function Rk(n,e){const t=U(n),s={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&bu(t.auth,s,e);const{email:i}=await YP(t.auth,s);i!==n.email&&await n.reload()}async function Sk(n,e,t){const r=U(n),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await n.getIdToken(),newEmail:e};t&&bu(r.auth,i,t);const{email:o}=await ZP(r.auth,i);o!==n.email&&await n.reload()}async function Ck(n,e){return Oe(n,"POST","/v1/accounts:update",e)}async function Pk(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=U(n),i={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await Wn(r,Ck(r.auth,i));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:l})=>l==="password");a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function kk(n,e){const t=U(n);return me(t.auth.app)?Promise.reject(Xe(t.auth)):yE(t,e,null)}function Nk(n,e){return yE(U(n),null,e)}async function yE(n,e,t){const{auth:r}=n,i={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(i.email=e),t&&(i.password=t);const o=await Wn(n,jP(r,i));await n._updateTokensIfNecessary(o,!0)}function Dk(n){if(!n)return null;const{providerId:e}=n,t=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},r=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!e&&n?.idToken){const s=wu(n.idToken)?.firebase?.sign_in_provider;if(s){const i=s!=="anonymous"&&s!=="custom"?s:null;return new gi(r,i)}}if(!e)return null;switch(e){case"facebook.com":return new xk(r,t);case"github.com":return new Ok(r,t);case"google.com":return new Vk(r,t);case"twitter.com":return new Lk(r,t,n.screenName||null);case"custom":case"anonymous":return new gi(r,null);default:return new gi(r,e,t)}}class gi{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class IE extends gi{constructor(e,t,r,s){super(e,t,r),this.username=s}}class xk extends gi{constructor(e,t){super(e,"facebook.com",t)}}class Ok extends IE{constructor(e,t){super(e,"github.com",t,typeof t?.login=="string"?t?.login:null)}}class Vk extends gi{constructor(e,t){super(e,"google.com",t)}}class Lk extends IE{constructor(e,t,r){super(e,"twitter.com",t,r)}}function Mk(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:Dk(t)}class cs{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new cs("enroll",e,t)}static _fromMfaPendingCredential(e){return new cs("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){if(e?.multiFactorSession){if(e.multiFactorSession?.pendingCredential)return cs._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(e.multiFactorSession?.idToken)return cs._fromIdtoken(e.multiFactorSession.idToken)}return null}}class rp{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){const r=Pe(e),s=t.customData._serverResponse,i=(s.mfaInfo||[]).map(a=>uc._fromServerResponse(r,a));O(s.mfaPendingCredential,r,"internal-error");const o=cs._fromMfaPendingCredential(s.mfaPendingCredential);return new rp(o,i,async a=>{const l=await a._process(r,o);delete s.mfaInfo,delete s.mfaPendingCredential;const u={...s,idToken:l.idToken,refreshToken:l.refreshToken};switch(t.operationType){case"signIn":const h=await Qt._fromIdTokenResponse(r,t.operationType,u);return await r._updateCurrentUser(h.user),h;case"reauthenticate":return O(t.user,r,"internal-error"),Qt._forOperation(t.user,t.operationType,u);default:it(r,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function Fk(n,e){const t=U(n),r=e;return O(e.customData.operationType,t,"argument-error"),O(r.customData._serverResponse?.mfaPendingCredential,t,"argument-error"),rp._fromError(t,r)}function x_(n,e){return Oe(n,"POST","/v2/accounts/mfaEnrollment:start",xe(n,e))}function Uk(n,e){return Oe(n,"POST","/v2/accounts/mfaEnrollment:finalize",xe(n,e))}function Bk(n,e){return Oe(n,"POST","/v2/accounts/mfaEnrollment:withdraw",xe(n,e))}class sp{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(r=>uc._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new sp(e)}async getSession(){return cs._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const r=e,s=await this.getSession(),i=await Wn(this.user,r._process(this.user.auth,s,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,r=await this.user.getIdToken();try{const s=await Wn(this.user,Bk(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:i})=>i!==t),await this.user._updateTokensIfNecessary(s),await this.user.reload()}catch(s){throw s}}}const nd=new WeakMap;function qk(n){const e=U(n);return nd.has(e)||nd.set(e,sp._fromUser(e)),nd.get(e)}const Ll="__sak";class wE{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Ll,"1"),this.storage.removeItem(Ll),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const Wk=1e3,$k=10;class EE extends wE{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=sE(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);vP()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,$k):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},Wk)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}EE.type="LOCAL";const ip=EE;class TE extends wE{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}TE.type="SESSION";const ws=TE;function zk(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}class Ru{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new Ru(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!o?.size)return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async u=>u(t.origin,i)),l=await zk(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Ru.receivers=[];function hc(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}class Gk{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const u=hc("",20);s.port1.start();const h=setTimeout(()=>{l(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(f){const m=f;if(m.data.eventId===u)switch(m.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(m.data.response);break;default:clearTimeout(h),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}function Ue(){return window}function jk(n){Ue().location.href=n}function op(){return typeof Ue().WorkerGlobalScope<"u"&&typeof Ue().importScripts=="function"}async function Hk(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Kk(){return navigator?.serviceWorker?.controller||null}function Qk(){return op()?self:null}const vE="firebaseLocalStorageDb",Yk=1,Ml="firebaseLocalStorage",AE="fbase_key";class dc{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Su(n,e){return n.transaction([Ml],e?"readwrite":"readonly").objectStore(Ml)}function Jk(){const n=indexedDB.deleteDatabase(vE);return new dc(n).toPromise()}function Nd(){const n=indexedDB.open(vE,Yk);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(Ml,{keyPath:AE})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(Ml)?e(r):(r.close(),await Jk(),e(await Nd()))})})}async function O_(n,e,t){const r=Su(n,!0).put({[AE]:e,value:t});return new dc(r).toPromise()}async function Xk(n,e){const t=Su(n,!1).get(e),r=await new dc(t).toPromise();return r===void 0?null:r.value}function V_(n,e){const t=Su(n,!0).delete(e);return new dc(t).toPromise()}const Zk=800,eN=3;class bE{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Nd(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>eN)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return op()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Ru._getInstance(Qk()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await Hk(),!this.activeServiceWorker)return;this.sender=new Gk(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Kk()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Nd();return await O_(e,Ll,"1"),await V_(e,Ll),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>O_(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>Xk(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>V_(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=Su(s,!1).getAll();return new dc(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Zk)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}bE.type="LOCAL";const Da=bE;function L_(n,e){return Oe(n,"POST","/v2/accounts/mfaSignIn:start",xe(n,e))}function tN(n,e){return Oe(n,"POST","/v2/accounts/mfaSignIn:finalize",xe(n,e))}const rd=oE("rcb"),nN=new oc(3e4,6e4);class rN{constructor(){this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!Ue().grecaptcha?.render}load(e,t=""){return O(sN(t),e,"argument-error"),this.shouldResolveImmediately(t)&&A_(Ue().grecaptcha)?Promise.resolve(Ue().grecaptcha):new Promise((r,s)=>{const i=Ue().setTimeout(()=>{s(ze(e,"network-request-failed"))},nN.get());Ue()[rd]=()=>{Ue().clearTimeout(i),delete Ue()[rd];const a=Ue().grecaptcha;if(!a||!A_(a)){s(ze(e,"internal-error"));return}const l=a.render;a.render=(u,h)=>{const f=l(u,h);return this.counter++,f},this.hostLanguage=t,r(a)};const o=`${kP()}?${Us({onload:rd,render:"explicit",hl:t})}`;Xf(o).catch(()=>{clearTimeout(i),s(ze(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){return!!Ue().grecaptcha?.render&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function sN(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class iN{async load(e){return new VP(e)}clearedOneInstance(){}}const oa="recaptcha",oN={theme:"light",type:"image"};let aN=class{constructor(e,t,r={...oN}){this.parameters=r,this.type=oa,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Pe(e),this.isInvisible=this.parameters.size==="invisible",O(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const s=typeof t=="string"?document.getElementById(t):t;O(s,this.auth,"argument-error"),this.container=s,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new iN:new rN,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(s=>{const i=o=>{o&&(this.tokenChangeListeners.delete(i),s(o))};this.tokenChangeListeners.add(i),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){O(!this.parameters.sitekey,this.auth,"argument-error"),O(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),O(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=Ue()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){O(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){O(Yf()&&!op(),this.auth,"internal-error"),await cN(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await hP(this.auth);O(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return O(this.recaptcha,this.auth,"internal-error"),this.recaptcha}};function cN(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}class ap{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=ms._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function lN(n,e,t){if(me(n.app))return Promise.reject(Xe(n));const r=Pe(n),s=await Cu(r,e,U(t));return new ap(s,i=>Au(r,i))}async function uN(n,e,t){const r=U(n);await vu(!1,r,"phone");const s=await Cu(r.auth,e,U(t));return new ap(s,i=>mE(r,i))}async function hN(n,e,t){const r=U(n);if(me(r.auth.app))return Promise.reject(Xe(r.auth));const s=await Cu(r.auth,e,U(t));return new ap(s,i=>gE(r,i))}async function Cu(n,e,t){if(!n._getRecaptchaConfig())try{await qP(n)}catch{console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let r;if(typeof e=="string"?r={phoneNumber:e}:r=e,"session"in r){const s=r.session;if("phoneNumber"in r){O(s.type==="enroll",n,"internal-error");const i={idToken:s.credential,phoneEnrollmentInfo:{phoneNumber:r.phoneNumber,clientType:"CLIENT_TYPE_WEB"}};return(await _r(n,i,"mfaSmsEnrollment",async(u,h)=>{if(h.phoneEnrollmentInfo.captchaResponse===ia){O(t?.type===oa,u,"argument-error");const f=await sd(u,h,t);return x_(u,f)}return x_(u,h)},"PHONE_PROVIDER").catch(u=>Promise.reject(u))).phoneSessionInfo.sessionInfo}else{O(s.type==="signin",n,"internal-error");const i=r.multiFactorHint?.uid||r.multiFactorUid;O(i,n,"missing-multi-factor-info");const o={mfaPendingCredential:s.credential,mfaEnrollmentId:i,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}};return(await _r(n,o,"mfaSmsSignIn",async(h,f)=>{if(f.phoneSignInInfo.captchaResponse===ia){O(t?.type===oa,h,"argument-error");const m=await sd(h,f,t);return L_(h,m)}return L_(h,f)},"PHONE_PROVIDER").catch(h=>Promise.reject(h))).phoneResponseInfo.sessionInfo}}else{const s={phoneNumber:r.phoneNumber,clientType:"CLIENT_TYPE_WEB"};return(await _r(n,s,"sendVerificationCode",async(l,u)=>{if(u.captchaResponse===ia){O(t?.type===oa,l,"argument-error");const h=await sd(l,u,t);return N_(l,h)}return N_(l,u)},"PHONE_PROVIDER").catch(l=>Promise.reject(l))).sessionInfo}}finally{t?._reset()}}async function dN(n,e){const t=U(n);if(me(t.auth.app))return Promise.reject(Xe(t.auth));await Zf(t,e)}async function sd(n,e,t){O(t.type===oa,n,"argument-error");const r=await t.verify();O(typeof r=="string",n,"argument-error");const s={...e};if("phoneEnrollmentInfo"in s){const i=s.phoneEnrollmentInfo.phoneNumber,o=s.phoneEnrollmentInfo.captchaResponse,a=s.phoneEnrollmentInfo.clientType,l=s.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(s,{phoneEnrollmentInfo:{phoneNumber:i,recaptchaToken:r,captchaResponse:o,clientType:a,recaptchaVersion:l}}),s}else if("phoneSignInInfo"in s){const i=s.phoneSignInInfo.captchaResponse,o=s.phoneSignInInfo.clientType,a=s.phoneSignInInfo.recaptchaVersion;return Object.assign(s,{phoneSignInInfo:{recaptchaToken:r,captchaResponse:i,clientType:o,recaptchaVersion:a}}),s}else return Object.assign(s,{recaptchaToken:r}),s}let Es=class fl{constructor(e){this.providerId=fl.PROVIDER_ID,this.auth=Pe(e)}verifyPhoneNumber(e,t){return Cu(this.auth,e,U(t))}static credential(e,t){return ms._fromVerification(e,t)}static credentialFromResult(e){const t=e;return fl.credentialFromTaggedObject(t)}static credentialFromError(e){return fl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?ms._fromTokenResponse(t,r):null}};Es.PROVIDER_ID="phone";Es.PHONE_SIGN_IN_METHOD="phone";function Bs(n,e){return e?Mt(e):(O(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}class cp extends to{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Mn(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Mn(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Mn(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function fN(n){return pE(n.auth,new cp(n),n.bypassAuthState)}function pN(n){const{auth:e,user:t}=n;return O(t,e,"internal-error"),fE(t,new cp(n),n.bypassAuthState)}async function mN(n){const{auth:e,user:t}=n;return O(t,e,"internal-error"),Zf(t,new cp(n),n.bypassAuthState)}class RE{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return fN;case"linkViaPopup":case"linkViaRedirect":return mN;case"reauthViaPopup":case"reauthViaRedirect":return pN;default:it(this.auth,"internal-error")}}resolve(e){cn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){cn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const gN=new oc(2e3,1e4);async function _N(n,e,t){if(me(n.app))return Promise.reject(ze(n,"operation-not-supported-in-this-environment"));const r=Pe(n);eo(n,e,Hn);const s=Bs(r,t);return new On(r,"signInViaPopup",e,s).executeNotNull()}async function yN(n,e,t){const r=U(n);if(me(r.auth.app))return Promise.reject(ze(r.auth,"operation-not-supported-in-this-environment"));eo(r.auth,e,Hn);const s=Bs(r.auth,t);return new On(r.auth,"reauthViaPopup",e,s,r).executeNotNull()}async function IN(n,e,t){const r=U(n);eo(r.auth,e,Hn);const s=Bs(r.auth,t);return new On(r.auth,"linkViaPopup",e,s,r).executeNotNull()}class On extends RE{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,On.currentPopupAction&&On.currentPopupAction.cancel(),On.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return O(e,this.auth,"internal-error"),e}async onExecution(){cn(this.filter.length===1,"Popup operations only handle one event");const e=hc();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(ze(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(ze(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,On.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(ze(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,gN.get())};e()}}On.currentPopupAction=null;const wN="pendingRedirect",aa=new Map;class EN extends RE{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=aa.get(this.auth._key());if(!e){try{const r=await TN(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}aa.set(this.auth._key(),e)}return this.bypassAuthState||aa.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function TN(n,e){const t=CE(e),r=SE(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}async function lp(n,e){return SE(n)._set(CE(e),"true")}function vN(){aa.clear()}function up(n,e){aa.set(n._key(),e)}function SE(n){return Mt(n._redirectPersistence)}function CE(n){return ps(wN,n.config.apiKey,n.name)}function AN(n,e,t){return bN(n,e,t)}async function bN(n,e,t){if(me(n.app))return Promise.reject(Xe(n));const r=Pe(n);eo(n,e,Hn),await r._initializationPromise;const s=Bs(r,t);return await lp(s,r),s._openRedirect(r,e,"signInViaRedirect")}function RN(n,e,t){return SN(n,e,t)}async function SN(n,e,t){const r=U(n);if(eo(r.auth,e,Hn),me(r.auth.app))return Promise.reject(Xe(r.auth));await r.auth._initializationPromise;const s=Bs(r.auth,t);await lp(s,r.auth);const i=await PE(r);return s._openRedirect(r.auth,e,"reauthViaRedirect",i)}function CN(n,e,t){return PN(n,e,t)}async function PN(n,e,t){const r=U(n);eo(r.auth,e,Hn),await r.auth._initializationPromise;const s=Bs(r.auth,t);await vu(!1,r,e.providerId),await lp(s,r.auth);const i=await PE(r);return s._openRedirect(r.auth,e,"linkViaRedirect",i)}async function kN(n,e){return await Pe(n)._initializationPromise,Pu(n,e,!1)}async function Pu(n,e,t=!1){if(me(n.app))return Promise.reject(Xe(n));const r=Pe(n),s=Bs(r,e),o=await new EN(r,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}async function PE(n){const e=hc(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}const NN=600*1e3;class kE{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!DN(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!NE(e)){const r=e.error.code?.split("auth/")[1]||"internal-error";t.onError(ze(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=NN&&this.cachedEventUids.clear(),this.cachedEventUids.has(M_(e))}saveEventToCache(e){this.cachedEventUids.add(M_(e)),this.lastProcessedEventTime=Date.now()}}function M_(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function NE({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function DN(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return NE(n);default:return!1}}async function DE(n,e={}){return Oe(n,"GET","/v1/projects",e)}const xN=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,ON=/^https?/;async function VN(n){if(n.config.emulator)return;const{authorizedDomains:e}=await DE(n);for(const t of e)try{if(LN(t))return}catch{}it(n,"unauthorized-domain")}function LN(n){const e=Pa(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!ON.test(t))return!1;if(xN.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}const MN=new oc(3e4,6e4);function F_(){const n=Ue().___jsl;if(n?.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function FN(n){return new Promise((e,t)=>{function r(){F_(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{F_(),t(ze(n,"network-request-failed"))},timeout:MN.get()})}if(Ue().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(Ue().gapi?.load)r();else{const s=oE("iframefcb");return Ue()[s]=()=>{gapi.load?r():t(ze(n,"network-request-failed"))},Xf(`${DP()}?onload=${s}`).catch(i=>t(i))}}).catch(e=>{throw pl=null,e})}let pl=null;function UN(n){return pl=pl||FN(n),pl}const BN=new oc(5e3,15e3),qN="__/auth/iframe",WN="emulator/auth/iframe",$N={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},zN=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function GN(n){const e=n.config;O(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Jf(e,WN):`https://${n.config.authDomain}/${qN}`,r={apiKey:e.apiKey,appName:n.name,v:Dn},s=zN.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${Us(r).slice(1)}`}async function jN(n){const e=await UN(n),t=Ue().gapi;return O(t,n,"internal-error"),e.open({where:document.body,url:GN(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:$N,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=ze(n,"network-request-failed"),a=Ue().setTimeout(()=>{i(o)},BN.get());function l(){Ue().clearTimeout(a),s(r)}r.ping(l).then(l,()=>{i(o)})}))}const HN={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},KN=500,QN=600,YN="_blank",JN="http://localhost";class U_{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function XN(n,e,t,r=KN,s=QN){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l={...HN,width:r.toString(),height:s.toString(),top:i,left:o},u=Ce().toLowerCase();t&&(a=eE(u)?YN:t),Xw(u)&&(e=e||JN,l.scrollbars="yes");const h=Object.entries(l).reduce((m,[_,A])=>`${m}${_}=${A},`,"");if(TP(u)&&a!=="_self")return ZN(e||"",a),new U_(null);const f=window.open(e||"",a,h);O(f,n,"popup-blocked");try{f.focus()}catch{}return new U_(f)}function ZN(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}const eD="__/auth/handler",tD="emulator/auth/handler",nD=encodeURIComponent("fac");async function Dd(n,e,t,r,s,i){O(n.config.authDomain,n,"auth-domain-config-required"),O(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:Dn,eventId:s};if(e instanceof Hn){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",Pl(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,f]of Object.entries(i||{}))o[h]=f}if(e instanceof no){const h=e.getScopes().filter(f=>f!=="");h.length>0&&(o.scopes=h.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const h of Object.keys(a))a[h]===void 0&&delete a[h];const l=await n._getAppCheckToken(),u=l?`#${nD}=${encodeURIComponent(l)}`:"";return`${rD(n)}?${Us(a).slice(1)}${u}`}function rD({config:n}){return n.emulator?Jf(n,tD):`https://${n.authDomain}/${eD}`}const id="webStorageSupport";class sD{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=ws,this._completeRedirectFn=Pu,this._overrideRedirectResult=up}async _openPopup(e,t,r,s){cn(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const i=await Dd(e,t,r,Pa(),s);return XN(e,i,hc())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await Dd(e,t,r,Pa(),s);return jk(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(cn(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await jN(e),r=new kE(e);return t.register("authEvent",s=>(O(s?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(id,{type:id},s=>{const i=s?.[0]?.[id];i!==void 0&&t(!!i),it(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=VN(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return sE()||Zw()||cc()}}const iD=sD;class oD{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return In("unexpected MultiFactorSessionType")}}}class hp extends oD{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new hp(e)}_finalizeEnroll(e,t,r){return Uk(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return tN(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class xE{constructor(){}static assertion(e){return hp._fromCredential(e)}}xE.FACTOR_ID="phone";var B_="@firebase/auth",q_="1.12.0";class aD{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){O(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function cD(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function lD(n){an(new Ze("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;O(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:iE(n)},u=new CP(r,s,i,l);return WP(u,t),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),an(new Ze("auth-internal",e=>{const t=Pe(e.getProvider("auth").getImmediate());return(r=>new aD(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),rt(B_,q_,cD(n)),rt(B_,q_,"esm2020")}const uD=300;_S("authIdTokenMaxAge");function hD(){return document.getElementsByTagName("head")?.[0]??document}PP({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=ze("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",hD().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});lD("Browser");function Ts(){return window}const dD=2e3;async function fD(n,e,t){const{BuildInfo:r}=Ts();cn(e.sessionId,"AuthEvent did not contain a session ID");const s=await yD(e.sessionId),i={};return cc()?i.ibi=r.packageName:ac()?i.apn=r.packageName:it(n,"operation-not-supported-in-this-environment"),r.displayName&&(i.appDisplayName=r.displayName),i.sessionId=s,Dd(n,t,e.type,void 0,e.eventId??void 0,i)}async function pD(n){const{BuildInfo:e}=Ts(),t={};cc()?t.iosBundleId=e.packageName:ac()?t.androidPackageName=e.packageName:it(n,"operation-not-supported-in-this-environment"),await DE(n,t)}function mD(n){const{cordova:e}=Ts();return new Promise(t=>{e.plugins.browsertab.isAvailable(r=>{let s=null;r?e.plugins.browsertab.openUrl(n):s=e.InAppBrowser.open(n,EP()?"_blank":"_system","location=yes"),t(s)})})}async function gD(n,e,t){const{cordova:r}=Ts();let s=()=>{};try{await new Promise((i,o)=>{let a=null;function l(){i();const f=r.plugins.browsertab?.close;typeof f=="function"&&f(),typeof t?.close=="function"&&t.close()}function u(){a||(a=window.setTimeout(()=>{o(ze(n,"redirect-cancelled-by-user"))},dD))}function h(){document?.visibilityState==="visible"&&u()}e.addPassiveListener(l),document.addEventListener("resume",u,!1),ac()&&document.addEventListener("visibilitychange",h,!1),s=()=>{e.removePassiveListener(l),document.removeEventListener("resume",u,!1),document.removeEventListener("visibilitychange",h,!1),a&&window.clearTimeout(a)}})}finally{s()}}function _D(n){const e=Ts();O(typeof e?.universalLinks?.subscribe=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),O(typeof e?.BuildInfo?.packageName<"u",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),O(typeof e?.cordova?.plugins?.browsertab?.openUrl=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),O(typeof e?.cordova?.plugins?.browsertab?.isAvailable=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),O(typeof e?.cordova?.InAppBrowser?.open=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}async function yD(n){const e=ID(n),t=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(t)).map(s=>s.toString(16).padStart(2,"0")).join("")}function ID(n){if(cn(/[0-9a-zA-Z]+/.test(n),"Can only convert alpha-numeric strings"),typeof TextEncoder<"u")return new TextEncoder().encode(n);const e=new ArrayBuffer(n.length),t=new Uint8Array(e);for(let r=0;r<n.length;r++)t[r]=n.charCodeAt(r);return t}const wD=20;class ED extends kE{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(e=>{this.resolveInitialized=e})}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(e){return this.resolveInitialized(),this.passiveListeners.forEach(t=>t(e)),super.onEvent(e)}async initialized(){await this.initPromise}}function TD(n,e,t=null){return{type:e,eventId:t,urlResponse:null,sessionId:bD(),postBody:null,tenantId:n.tenantId,error:ze(n,"no-auth-event")}}function vD(n,e){return xd()._set(Od(n),e)}async function W_(n){const e=await xd()._get(Od(n));return e&&await xd()._remove(Od(n)),e}function AD(n,e){const t=SD(e);if(t.includes("/__/auth/callback")){const r=ml(t),i=(r.firebaseError?RD(decodeURIComponent(r.firebaseError)):null)?.code?.split("auth/")?.[1],o=i?ze(i):null;return o?{type:n.type,eventId:n.eventId,tenantId:n.tenantId,error:o,urlResponse:null,sessionId:null,postBody:null}:{type:n.type,eventId:n.eventId,tenantId:n.tenantId,sessionId:n.sessionId,urlResponse:t,postBody:null}}return null}function bD(){const n=[],e="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let t=0;t<wD;t++){const r=Math.floor(Math.random()*e.length);n.push(e.charAt(r))}return n.join("")}function xd(){return Mt(ip)}function Od(n){return ps("authEvent",n.config.apiKey,n.name)}function RD(n){try{return JSON.parse(n)}catch{return null}}function SD(n){const e=ml(n),t=e.link?decodeURIComponent(e.link):void 0,r=ml(t).link,s=e.deep_link_id?decodeURIComponent(e.deep_link_id):void 0;return ml(s).link||s||r||t||n}function ml(n){if(!n?.includes("?"))return{};const[e,...t]=n.split("?");return di(t.join("?"))}const CD=500;class PD{constructor(){this._redirectPersistence=ws,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=Pu,this._overrideRedirectResult=up}async _initialize(e){const t=e._key();let r=this.eventManagers.get(t);return r||(r=new ED(e),this.eventManagers.set(t,r),this.attachCallbackListeners(e,r)),r}_openPopup(e){it(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,r,s){_D(e);const i=await this._initialize(e);await i.initialized(),i.resetRedirect(),vN(),await this._originValidation(e);const o=TD(e,r,s);await vD(e,o);const a=await fD(e,o,t),l=await mD(a);return gD(e,i,l)}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=pD(e)),this.originValidationPromises[t]}attachCallbackListeners(e,t){const{universalLinks:r,handleOpenURL:s,BuildInfo:i}=Ts(),o=setTimeout(async()=>{await W_(e),t.onEvent($_())},CD),a=async h=>{clearTimeout(o);const f=await W_(e);let m=null;f&&h?.url&&(m=AD(f,h.url)),t.onEvent(m||$_())};typeof r<"u"&&typeof r.subscribe=="function"&&r.subscribe(null,a);const l=s,u=`${i.packageName.toLowerCase()}://`;Ts().handleOpenURL=async h=>{if(h.toLowerCase().startsWith(u)&&a({url:h}),typeof l=="function")try{l(h)}catch(f){console.error(f)}}}}const kD=PD;function $_(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:ze("no-auth-event")}}function ND(n,e){Pe(n)._logFramework(e)}var DD="@firebase/auth-compat",xD="0.6.2";const OD=1e3;function ca(){return self?.location?.protocol||null}function VD(){return ca()==="http:"||ca()==="https:"}function OE(n=Ce()){return!!((ca()==="file:"||ca()==="ionic:"||ca()==="capacitor:")&&n.toLowerCase().match(/iphone|ipad|ipod|android/))}function LD(){return yu()||_u()}function MD(){return Rw()&&document?.documentMode===11}function FD(n=Ce()){return/Edge\/\d+/.test(n)}function UD(n=Ce()){return MD()||FD(n)}function VE(){try{const n=self.localStorage,e=hc();if(n)return n.setItem(e,"1"),n.removeItem(e),UD()?ba():!0}catch{return dp()&&ba()}return!1}function dp(){return typeof global<"u"&&"WorkerGlobalScope"in global&&"importScripts"in global}function od(){return(VD()||bw()||OE())&&!LD()&&VE()&&!dp()}function LE(){return OE()&&typeof document<"u"}async function BD(){return LE()?new Promise(n=>{const e=setTimeout(()=>{n(!1)},OD);document.addEventListener("deviceready",()=>{clearTimeout(e),n(!0)})}):!1}function qD(){return typeof window<"u"?window:null}const Lt={LOCAL:"local",NONE:"none",SESSION:"session"},Vo=O,ME="persistence";function WD(n,e){if(Vo(Object.values(Lt).includes(e),n,"invalid-persistence-type"),yu()){Vo(e!==Lt.SESSION,n,"unsupported-persistence-type");return}if(_u()){Vo(e===Lt.NONE,n,"unsupported-persistence-type");return}if(dp()){Vo(e===Lt.NONE||e===Lt.LOCAL&&ba(),n,"unsupported-persistence-type");return}Vo(e===Lt.NONE||VE(),n,"unsupported-persistence-type")}async function Vd(n){await n._initializationPromise;const e=FE(),t=ps(ME,n.config.apiKey,n.name);e&&e.setItem(t,n._getPersistenceType())}function $D(n,e){const t=FE();if(!t)return[];const r=ps(ME,n,e);switch(t.getItem(r)){case Lt.NONE:return[bi];case Lt.LOCAL:return[Da,ws];case Lt.SESSION:return[ws];default:return[]}}function FE(){try{return qD()?.sessionStorage||null}catch{return null}}const zD=O;class hr{constructor(){this.browserResolver=Mt(iD),this.cordovaResolver=Mt(kD),this.underlyingResolver=null,this._redirectPersistence=ws,this._completeRedirectFn=Pu,this._overrideRedirectResult=up}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,r,s){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,r,s)}async _openRedirect(e,t,r,s){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,r,s)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return LE()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return zD(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){if(this.underlyingResolver)return;const e=await BD();this.underlyingResolver=e?this.cordovaResolver:this.browserResolver}}function UE(n){return n.unwrap()}function GD(n){return n.wrapped()}function jD(n){return BE(n)}function HD(n,e){const t=e.customData?._tokenResponse;if(e?.code==="auth/multi-factor-auth-required"){const r=e;r.resolver=new KD(n,Fk(n,e))}else if(t){const r=BE(e),s=e;r&&(s.credential=r,s.tenantId=t.tenantId||void 0,s.email=t.email||void 0,s.phoneNumber=t.phoneNumber||void 0)}}function BE(n){const{_tokenResponse:e}=n instanceof $e?n.customData:n;if(!e)return null;if(!(n instanceof $e)&&"temporaryProof"in e&&"phoneNumber"in e)return Es.credentialFromResult(n);const t=e.providerId;if(!t||t===xo.PASSWORD)return null;let r;switch(t){case xo.GOOGLE:r=mn;break;case xo.FACEBOOK:r=pn;break;case xo.GITHUB:r=gn;break;case xo.TWITTER:r=_n;break;default:const{oauthIdToken:s,oauthAccessToken:i,oauthTokenSecret:o,pendingToken:a,nonce:l}=e;return!i&&!o&&!s&&!a?null:a?t.startsWith("saml.")?Ri._create(t,a):Sn._fromParams({providerId:t,signInMethod:t,pendingToken:a,idToken:s,accessToken:i}):new mi(t).credential({idToken:s,accessToken:i,rawNonce:l})}return n instanceof $e?r.credentialFromError(n):r.credentialFromResult(n)}function bt(n,e){return e.catch(t=>{throw t instanceof $e&&HD(n,t),t}).then(t=>{const r=t.operationType,s=t.user;return{operationType:r,credential:jD(t),additionalUserInfo:Mk(t),user:ku.getOrCreate(s)}})}async function Ld(n,e){const t=await e;return{verificationId:t.verificationId,confirm:r=>bt(n,t.confirm(r))}}class KD{constructor(e,t){this.resolver=t,this.auth=GD(e)}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return bt(UE(this.auth),this.resolver.resolveSignIn(e))}}let ku=class Yo{constructor(e){this._delegate=e,this.multiFactor=qk(e)}static getOrCreate(e){return Yo.USER_MAP.has(e)||Yo.USER_MAP.set(e,new Yo(e)),Yo.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return bt(this.auth,mE(this._delegate,e))}async linkWithPhoneNumber(e,t){return Ld(this.auth,uN(this._delegate,e,t))}async linkWithPopup(e){return bt(this.auth,IN(this._delegate,e,hr))}async linkWithRedirect(e){return await Vd(Pe(this.auth)),CN(this._delegate,e,hr)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return bt(this.auth,gE(this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return Ld(this.auth,hN(this._delegate,e,t))}reauthenticateWithPopup(e){return bt(this.auth,yN(this._delegate,e,hr))}async reauthenticateWithRedirect(e){return await Vd(Pe(this.auth)),RN(this._delegate,e,hr)}sendEmailVerification(e){return Rk(this._delegate,e)}async unlink(e){return await dk(this._delegate,e),this}updateEmail(e){return kk(this._delegate,e)}updatePassword(e){return Nk(this._delegate,e)}updatePhoneNumber(e){return dN(this._delegate,e)}updateProfile(e){return Pk(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return Sk(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}};ku.USER_MAP=new WeakMap;const Lo=O;class Md{constructor(e,t){if(this.app=e,t.isInitialized()){this._delegate=t.getImmediate(),this.linkUnderlyingAuth();return}const{apiKey:r}=e.options;Lo(r,"invalid-api-key",{appName:e.name}),Lo(r,"invalid-api-key",{appName:e.name});const s=typeof window<"u"?hr:void 0;this._delegate=t.initialize({options:{persistence:QD(r,e.name),popupRedirectResolver:s}}),this._delegate._updateErrorMap(tP),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?ku.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){$P(this._delegate,e,t)}applyActionCode(e){return _k(this._delegate,e)}checkActionCode(e){return _E(this._delegate,e)}confirmPasswordReset(e,t){return gk(this._delegate,e,t)}async createUserWithEmailAndPassword(e,t){return bt(this._delegate,Ik(this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return bk(this._delegate,e)}isSignInWithEmailLink(e){return Tk(this._delegate,e)}async getRedirectResult(){Lo(od(),this._delegate,"operation-not-supported-in-this-environment");const e=await kN(this._delegate,hr);return e?bt(this._delegate,Promise.resolve(e)):{credential:null,user:null}}addFrameworkForLogging(e){ND(this._delegate,e)}onAuthStateChanged(e,t,r){const{next:s,error:i,complete:o}=z_(e,t,r);return this._delegate.onAuthStateChanged(s,i,o)}onIdTokenChanged(e,t,r){const{next:s,error:i,complete:o}=z_(e,t,r);return this._delegate.onIdTokenChanged(s,i,o)}sendSignInLinkToEmail(e,t){return Ek(this._delegate,e,t)}sendPasswordResetEmail(e,t){return mk(this._delegate,e,t||void 0)}async setPersistence(e){WD(this._delegate,e);let t;switch(e){case Lt.SESSION:t=ws;break;case Lt.LOCAL:t=await Mt(Da)._isAvailable()?Da:ip;break;case Lt.NONE:t=bi;break;default:return it("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(t)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return bt(this._delegate,hk(this._delegate))}signInWithCredential(e){return bt(this._delegate,Au(this._delegate,e))}signInWithCustomToken(e){return bt(this._delegate,pk(this._delegate,e))}signInWithEmailAndPassword(e,t){return bt(this._delegate,wk(this._delegate,e,t))}signInWithEmailLink(e,t){return bt(this._delegate,vk(this._delegate,e,t))}signInWithPhoneNumber(e,t){return Ld(this._delegate,lN(this._delegate,e,t))}async signInWithPopup(e){return Lo(od(),this._delegate,"operation-not-supported-in-this-environment"),bt(this._delegate,_N(this._delegate,e,hr))}async signInWithRedirect(e){return Lo(od(),this._delegate,"operation-not-supported-in-this-environment"),await Vd(this._delegate),AN(this._delegate,e,hr)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return yk(this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}Md.Persistence=Lt;function z_(n,e,t){let r=n;typeof n!="function"&&({next:r,error:e,complete:t}=n);const s=r;return{next:o=>s(o&&ku.getOrCreate(o)),error:e,complete:t}}function QD(n,e){const t=$D(n,e);if(typeof self<"u"&&!t.includes(Da)&&t.push(Da),typeof window<"u")for(const r of[ip,ws])t.includes(r)||t.push(r);return t.includes(bi)||t.push(bi),t}class fp{static credential(e,t){return Es.credential(e,t)}constructor(){this.providerId="phone",this._delegate=new Es(UE(Kt.auth()))}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}fp.PHONE_SIGN_IN_METHOD=Es.PHONE_SIGN_IN_METHOD;fp.PROVIDER_ID=Es.PROVIDER_ID;const YD=O;class JD{constructor(e,t,r=Kt.app()){YD(r.options?.apiKey,"invalid-api-key",{appName:r.name}),this._delegate=new aN(r.auth(),e,t),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}const XD="auth-compat";function ZD(n){n.INTERNAL.registerComponent(new Ze(XD,e=>{const t=e.getProvider("app-compat").getImmediate(),r=e.getProvider("auth");return new Md(t,r)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:Js.EMAIL_SIGNIN,PASSWORD_RESET:Js.PASSWORD_RESET,RECOVER_EMAIL:Js.RECOVER_EMAIL,REVERT_SECOND_FACTOR_ADDITION:Js.REVERT_SECOND_FACTOR_ADDITION,VERIFY_AND_CHANGE_EMAIL:Js.VERIFY_AND_CHANGE_EMAIL,VERIFY_EMAIL:Js.VERIFY_EMAIL}},EmailAuthProvider:Fr,FacebookAuthProvider:pn,GithubAuthProvider:gn,GoogleAuthProvider:mn,OAuthProvider:mi,SAMLAuthProvider:Ol,PhoneAuthProvider:fp,PhoneMultiFactorGenerator:xE,RecaptchaVerifier:JD,TwitterAuthProvider:_n,Auth:Md,AuthCredential:to,Error:$e}).setInstantiationMode("LAZY").setMultipleInstances(!1)),n.registerVersion(DD,xD)}ZD(Kt);var G_={};const j_="@firebase/database",H_="1.1.0";let qE="";function WE(n){qE=n}class e0{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),We(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:Ra(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class t0{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return Ut(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const $E=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new e0(e)}}catch{}return new t0},ls=$E("localStorage"),Fd=$E("sessionStorage");const _i=new Zi("@firebase/database"),zE=(function(){let n=1;return function(){return n++}})(),GE=function(n){const e=DS(n),t=new PS;t.update(e);const r=t.digest();return Lf.encodeByteArray(r)},fc=function(...n){let e="";for(let t=0;t<n.length;t++){const r=n[t];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=fc.apply(null,r):typeof r=="object"?e+=We(r):e+=r,e+=" "}return e};let gs=null,K_=!0;const jE=function(n,e){V(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(_i.logLevel=te.VERBOSE,gs=_i.log.bind(_i),e&&Fd.set("logging_enabled",!0)):typeof n=="function"?gs=n:(gs=null,Fd.remove("logging_enabled"))},Je=function(...n){if(K_===!0&&(K_=!1,gs===null&&Fd.get("logging_enabled")===!0&&jE(!0)),gs){const e=fc.apply(null,n);gs(e)}},pc=function(n){return function(...e){Je(n,...e)}},Ud=function(...n){const e="FIREBASE INTERNAL ERROR: "+fc(...n);_i.error(e)},Cn=function(...n){const e=`FIREBASE FATAL ERROR: ${fc(...n)}`;throw _i.error(e),new Error(e)},ht=function(...n){const e="FIREBASE WARNING: "+fc(...n);_i.warn(e)},n0=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&ht("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Nu=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},r0=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Rr="[MIN_NAME]",$n="[MAX_NAME]",qs=function(n,e){if(n===e)return 0;if(n===Rr||e===$n)return-1;if(e===Rr||n===$n)return 1;{const t=Q_(n),r=Q_(e);return t!==null?r!==null?t-r===0?n.length-e.length:t-r:-1:r!==null?1:n<e?-1:1}},s0=function(n,e){return n===e?0:n<e?-1:1},Mo=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+We(e))},pp=function(n){if(typeof n!="object"||n===null)return We(n);const e=[];for(const r in n)e.push(r);e.sort();let t="{";for(let r=0;r<e.length;r++)r!==0&&(t+=","),t+=We(e[r]),t+=":",t+=pp(n[e[r]]);return t+="}",t},HE=function(n,e){const t=n.length;if(t<=e)return[n];const r=[];for(let s=0;s<t;s+=e)s+e>t?r.push(n.substring(s,t)):r.push(n.substring(s,s+e));return r};function et(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const KE=function(n){V(!Nu(n),"Invalid JSON number");const e=11,t=52,r=(1<<e-1)-1;let s,i,o,a,l;n===0?(i=0,o=0,s=1/n===-1/0?1:0):(s=n<0,n=Math.abs(n),n>=Math.pow(2,1-r)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),r),i=a+r,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(i=0,o=Math.round(n/Math.pow(2,1-r-t))));const u=[];for(l=t;l;l-=1)u.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)u.push(i%2?1:0),i=Math.floor(i/2);u.push(s?1:0),u.reverse();const h=u.join("");let f="";for(l=0;l<64;l+=8){let m=parseInt(h.substr(l,8),2).toString(16);m.length===1&&(m="0"+m),f=f+m}return f.toLowerCase()},i0=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},o0=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function a0(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");const r=new Error(n+" at "+e._path.toString()+": "+t);return r.code=n.toUpperCase(),r}const c0=new RegExp("^-?(0*)\\d{1,10}$"),l0=-2147483648,u0=2147483647,Q_=function(n){if(c0.test(n)){const e=Number(n);if(e>=l0&&e<=u0)return e}return null},ro=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw ht("Exception was thrown by user callback.",t),e},Math.floor(0))}},h0=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},la=function(n,e){const t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};class d0{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,me(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(r=>this.appCheck=r)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){this.appCheckProvider?.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){ht(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class f0{constructor(e,t,r){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(Je("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',ht(e)}}class yi{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}yi.OWNER="owner";const mp="5",QE="v",YE="s",JE="r",XE="f",ZE=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,eT="ls",tT="p",Bd="ac",nT="websocket",rT="long_polling";class sT{constructor(e,t,r,s,i=!1,o="",a=!1,l=!1,u=null){this.secure=t,this.namespace=r,this.webSocketOnly=s,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this.emulatorOptions=u,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=ls.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&ls.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function p0(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function iT(n,e,t){V(typeof e=="string","typeof type must == string"),V(typeof t=="object","typeof params must == object");let r;if(e===nT)r=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===rT)r=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);p0(n)&&(t.ns=n.namespace);const s=[];return et(t,(i,o)=>{s.push(i+"="+o)}),r+s.join("&")}class m0{constructor(){this.counters_={}}incrementCounter(e,t=1){Ut(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return dS(this.counters_)}}const ad={},cd={};function gp(n){const e=n.toString();return ad[e]||(ad[e]=new m0),ad[e]}function g0(n,e){const t=n.toString();return cd[t]||(cd[t]=e()),cd[t]}class _0{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<r.length;++s)r[s]&&ro(()=>{this.onMessage_(r[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const Y_="start",y0="close",I0="pLPCommand",w0="pRTLPCB",oT="id",aT="pw",cT="ser",E0="cb",T0="seg",v0="ts",A0="d",b0="dframe",lT=1870,uT=30,R0=lT-uT,S0=25e3,C0=3e4;class dr{constructor(e,t,r,s,i,o,a){this.connId=e,this.repoInfo=t,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=pc(e),this.stats_=gp(t),this.urlFn=l=>(this.appCheckToken&&(l[Bd]=this.appCheckToken),iT(t,rT,l))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new _0(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(C0)),r0(()=>{if(this.isClosed_)return;this.scriptTagHolder=new _p((...i)=>{const[o,a,l,u,h]=i;if(this.incrementIncomingBytes_(i),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===Y_)this.id=a,this.password=l;else if(o===y0)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...i)=>{const[o,a]=i;this.incrementIncomingBytes_(i),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const r={};r[Y_]="t",r[cT]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[E0]=this.scriptTagHolder.uniqueCallbackIdentifier),r[QE]=mp,this.transportSessionId&&(r[YE]=this.transportSessionId),this.lastSessionId&&(r[eT]=this.lastSessionId),this.applicationId&&(r[tT]=this.applicationId),this.appCheckToken&&(r[Bd]=this.appCheckToken),typeof location<"u"&&location.hostname&&ZE.test(location.hostname)&&(r[JE]=XE);const s=this.urlFn(r);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){dr.forceAllow_=!0}static forceDisallow(){dr.forceDisallow_=!0}static isAvailable(){return dr.forceAllow_?!0:!dr.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!i0()&&!o0()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=We(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const r=vw(t),s=HE(r,R0);for(let i=0;i<s.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[i]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const r={};r[b0]="t",r[oT]=e,r[aT]=t,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=We(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class _p{constructor(e,t,r,s){this.onDisconnect=r,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=zE(),window[I0+this.uniqueCallbackIdentifier]=e,window[w0+this.uniqueCallbackIdentifier]=t,this.myIFrame=_p.createIFrame_();let i="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(i='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){Je("frame writing exception"),a.stack&&Je(a.stack),Je(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Je("No IE domain setting required")}catch{const r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[oT]=this.myID,e[aT]=this.myPW,e[cT]=this.currentSerial;let t=this.urlFn(e),r="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+uT+r.length<=lT;){const o=this.pendingSegs.shift();r=r+"&"+T0+s+"="+o.seg+"&"+v0+s+"="+o.ts+"&"+A0+s+"="+o.d,s++}return t=t+r,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,r){this.pendingSegs.push({seg:e,ts:t,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const r=()=>{this.outstandingRequests.delete(t),this.newRequest_()},s=setTimeout(r,Math.floor(S0)),i=()=>{clearTimeout(s),r()};this.addTag(e,i)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){const s=r.readyState;(!s||s==="loaded"||s==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=()=>{Je("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}}const P0=16384,k0=45e3;let Fl=null;typeof MozWebSocket<"u"?Fl=MozWebSocket:typeof WebSocket<"u"&&(Fl=WebSocket);class Wt{constructor(e,t,r,s,i,o,a){this.connId=e,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=pc(this.connId),this.stats_=gp(t),this.connURL=Wt.connectionURL_(t,o,a,s,r),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,r,s,i){const o={};return o[QE]=mp,typeof location<"u"&&location.hostname&&ZE.test(location.hostname)&&(o[JE]=XE),t&&(o[YE]=t),r&&(o[eT]=r),s&&(o[Bd]=s),i&&(o[tT]=i),iT(e,nT,o)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,ls.set("previous_websocket_failure",!0);try{let r;TS(),this.mySock=new Fl(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){Wt.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(t);r&&r.length>1&&parseFloat(r[1])<4.4&&(e=!0)}return!e&&Fl!==null&&!Wt.forceDisallow_}static previouslyFailed(){return ls.isInMemoryStorage||ls.get("previous_websocket_failure")===!0}markConnectionHealthy(){ls.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const r=Ra(t);this.onMessage(r)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(V(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const r=this.extractFrameCount_(t);r!==null&&this.appendFrame_(r)}}send(e){this.resetKeepAlive();const t=We(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const r=HE(t,P0);r.length>1&&this.sendString_(String(r.length));for(let s=0;s<r.length;s++)this.sendString_(r[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(k0))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Wt.responsesRequiredToBeHealthy=2;Wt.healthyTimeout=3e4;class Si{static get ALL_TRANSPORTS(){return[dr,Wt]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=Wt&&Wt.isAvailable();let r=t&&!Wt.previouslyFailed();if(e.webSocketOnly&&(t||ht("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[Wt];else{const s=this.transports_=[];for(const i of Si.ALL_TRANSPORTS)i&&i.isAvailable()&&s.push(i);Si.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Si.globalTransportInitialized_=!1;const N0=6e4,D0=5e3,x0=10*1024,O0=100*1024,ld="t",J_="d",V0="s",X_="r",L0="e",Z_="o",ey="a",ty="n",ny="p",M0="h";class F0{constructor(e,t,r,s,i,o,a,l,u,h){this.id=e,this.repoInfo_=t,this.applicationId_=r,this.appCheckToken_=s,this.authToken_=i,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=u,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=pc("c:"+this.id+":"),this.transportManager_=new Si(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,r)},Math.floor(0));const s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=la(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>O0?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>x0?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(ld in e){const t=e[ld];t===ey?this.upgradeIfSecondaryHealthy_():t===X_?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===Z_&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=Mo("t",e),r=Mo("d",e);if(t==="c")this.onSecondaryControl_(r);else if(t==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:ny,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:ey,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:ty,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=Mo("t",e),r=Mo("d",e);t==="c"?this.onControl_(r):t==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=Mo(ld,e);if(J_ in e){const r=e[J_];if(t===M0){const s={...r};this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(t===ty){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===V0?this.onConnectionShutdown_(r):t===X_?this.onReset_(r):t===L0?Ud("Server Error: "+r):t===Z_?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Ud("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,r=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),mp!==r&&ht("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,r),la(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(N0))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):la(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(D0))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:ny,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(ls.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class hT{put(e,t,r,s){}merge(e,t,r,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,r){}onDisconnectMerge(e,t,r){}onDisconnectCancel(e,t){}reportStats(e){}}class dT{constructor(e){this.allowedEvents_=e,this.listeners_={},V(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const r=[...this.listeners_[e]];for(let s=0;s<r.length;s++)r[s].callback.apply(r[s].context,t)}}on(e,t,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:r});const s=this.getInitialEvent(e);s&&t.apply(r,s)}off(e,t,r){this.validateEventType_(e);const s=this.listeners_[e]||[];for(let i=0;i<s.length;i++)if(s[i].callback===t&&(!r||r===s[i].context)){s.splice(i,1);return}}validateEventType_(e){V(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class Ul extends dT{static getInstance(){return new Ul}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!qf()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return V(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}const ry=32,sy=768;class ue{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let r=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[r]=this.pieces_[s],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function ae(){return new ue("")}function Z(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function Sr(n){return n.pieces_.length-n.pieceNum_}function pe(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new ue(n.pieces_,e)}function yp(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function U0(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function xa(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function fT(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new ue(e,0)}function Ae(n,e){const t=[];for(let r=n.pieceNum_;r<n.pieces_.length;r++)t.push(n.pieces_[r]);if(e instanceof ue)for(let r=e.pieceNum_;r<e.pieces_.length;r++)t.push(e.pieces_[r]);else{const r=e.split("/");for(let s=0;s<r.length;s++)r[s].length>0&&t.push(r[s])}return new ue(t,0)}function ee(n){return n.pieceNum_>=n.pieces_.length}function Et(n,e){const t=Z(n),r=Z(e);if(t===null)return e;if(t===r)return Et(pe(n),pe(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function B0(n,e){const t=xa(n,0),r=xa(e,0);for(let s=0;s<t.length&&s<r.length;s++){const i=qs(t[s],r[s]);if(i!==0)return i}return t.length===r.length?0:t.length<r.length?-1:1}function Ip(n,e){if(Sr(n)!==Sr(e))return!1;for(let t=n.pieceNum_,r=e.pieceNum_;t<=n.pieces_.length;t++,r++)if(n.pieces_[t]!==e.pieces_[r])return!1;return!0}function $t(n,e){let t=n.pieceNum_,r=e.pieceNum_;if(Sr(n)>Sr(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[r])return!1;++t,++r}return!0}class q0{constructor(e,t){this.errorPrefix_=t,this.parts_=xa(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=Iu(this.parts_[r]);pT(this)}}function W0(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Iu(e),pT(n)}function $0(n){const e=n.parts_.pop();n.byteLength_-=Iu(e),n.parts_.length>0&&(n.byteLength_-=1)}function pT(n){if(n.byteLength_>sy)throw new Error(n.errorPrefix_+"has a key path longer than "+sy+" bytes ("+n.byteLength_+").");if(n.parts_.length>ry)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+ry+") or object contains a cycle "+es(n))}function es(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}class wp extends dT{static getInstance(){return new wp}constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}getInitialEvent(e){return V(e==="visible","Unknown event type: "+e),[this.visible_]}}const Fo=1e3,z0=300*1e3,iy=30*1e3,G0=1.3,j0=3e4,H0="server_kill",oy=3;class Fn extends hT{constructor(e,t,r,s,i,o,a,l){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=r,this.onConnectStatus_=s,this.onServerInfoUpdate_=i,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=l,this.id=Fn.nextPersistentConnectionId_++,this.log_=pc("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Fo,this.maxReconnectDelay_=z0,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");wp.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&Ul.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,r){const s=++this.requestNumber_,i={r:s,a:e,b:t};this.log_(We(i)),V(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),r&&(this.requestCBHash_[s]=r)}get(e){this.initConnection_();const t=new Rt,s={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const a=o.d;o.s==="ok"?t.resolve(a):t.reject(a)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,t,r,s){this.initConnection_();const i=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),V(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),V(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");const a={onComplete:s,hashFn:t,query:e,tag:r};this.listens.get(o).set(i,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,r=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(r)})}sendListen_(e){const t=e.query,r=t._path.toString(),s=t._queryIdentifier;this.log_("Listen on "+r+" for "+s);const i={p:r},o="q";e.tag&&(i.q=t._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest(o,i,a=>{const l=a.d,u=a.s;Fn.warnOnListenWarnings_(l,t),(this.listens.get(r)&&this.listens.get(r).get(s))===e&&(this.log_("listen response",a),u!=="ok"&&this.removeListen_(r,s),e.onComplete&&e.onComplete(u,l))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&Ut(e,"w")){const r=Is(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){const s='".indexOn": "'+t._queryParams.getIndex().toString()+'"',i=t._path.toString();ht(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${i} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||CS(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=iy)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=SS(e)?"auth":"gauth",r={cred:e};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(t,r,s=>{const i=s.s,o=s.d||"error";this.authToken_===e&&(i==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(i,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,r=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,r)})}unlisten(e,t){const r=e._path.toString(),s=e._queryIdentifier;this.log_("Unlisten called for "+r+" "+s),V(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,s)&&this.connected_&&this.sendUnlisten_(r,s,e._queryObject,t)}sendUnlisten_(e,t,r,s){this.log_("Unlisten on "+e+" for "+t);const i={p:e},o="n";s&&(i.q=r,i.t=s),this.sendRequest(o,i)}onDisconnectPut(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:r})}onDisconnectMerge(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:r})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,r,s){const i={p:t,d:r};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,o=>{s&&setTimeout(()=>{s(o.s,o.d)},Math.floor(0))})}put(e,t,r,s){this.putInternal("p",e,t,r,s)}merge(e,t,r,s){this.putInternal("m",e,t,r,s)}putInternal(e,t,r,s,i){this.initConnection_();const o={p:t,d:r};i!==void 0&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:s}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,s=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,r,i=>{this.log_(t+" response",i),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(i.s,i.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,r=>{if(r.s!=="ok"){const i=r.d;this.log_("reportStats","Error sending stats: "+i)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+We(e));const t=e.r,r=this.requestCBHash_[t];r&&(delete this.requestCBHash_[t],r(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):Ud("Unrecognized action received from server: "+We(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){V(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Fo,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Fo,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>j0&&(this.reconnectDelay_=Fo),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*G0)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+Fn.nextConnectionId_++,i=this.lastSessionId;let o=!1,a=null;const l=function(){a?a.close():(o=!0,r())},u=function(f){V(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(f)};this.realtime_={close:l,sendRequest:u};const h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[f,m]=await Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);o?Je("getToken() completed but was canceled"):(Je("getToken() completed. Creating connection."),this.authToken_=f&&f.accessToken,this.appCheckToken_=m&&m.token,a=new F0(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,r,_=>{ht(_+" ("+this.repoInfo_.toString()+")"),this.interrupt(H0)},i))}catch(f){this.log_("Failed to get token: "+f),o||(this.repoInfo_.nodeAdmin&&ht(f),l())}}}interrupt(e){Je("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Je("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Pl(this.interruptReasons_)&&(this.reconnectDelay_=Fo,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let r;t?r=t.map(i=>pp(i)).join("$"):r="default";const s=this.removeListen_(e,r);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(e,t){const r=new ue(e).toString();let s;if(this.listens.has(r)){const i=this.listens.get(r);s=i.get(t),i.delete(t),i.size===0&&this.listens.delete(r)}else s=void 0;return s}onAuthRevoked_(e,t){Je("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=oy&&(this.reconnectDelay_=iy,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){Je("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=oy&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+qE.replace(/\./g,"-")]=1,qf()?e["framework.cordova"]=1:yu()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Ul.getInstance().currentlyOnline();return Pl(this.interruptReasons_)&&e}}Fn.nextPersistentConnectionId_=0;Fn.nextConnectionId_=0;class ne{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new ne(e,t)}}class Du{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const r=new ne(Rr,e),s=new ne(Rr,t);return this.compare(r,s)!==0}minPost(){return ne.MIN}}let el;class mT extends Du{static get __EMPTY_NODE(){return el}static set __EMPTY_NODE(e){el=e}compare(e,t){return qs(e.name,t.name)}isDefinedOn(e){throw Xi("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return ne.MIN}maxPost(){return new ne($n,el)}makePost(e,t){return V(typeof e=="string","KeyIndex indexValue must always be a string."),new ne(e,el)}toString(){return".key"}}const vn=new mT;let tl=class{constructor(e,t,r,s,i=null){this.isReverse_=s,this.resultGenerator_=i,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?r(e.key,t):1,s&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},Ot=class Jo{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??Jo.RED,this.left=s??wn.EMPTY_NODE,this.right=i??wn.EMPTY_NODE}copy(e,t,r,s,i){return new Jo(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return i<0?s=s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s=s.copy(null,t,null,null,null):s=s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return wn.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let r,s;if(r=this,t(e,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),t(e,r.key)===0){if(r.right.isEmpty())return wn.EMPTY_NODE;s=r.right.min_(),r=r.copy(s.key,s.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Jo.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Jo.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}};Ot.RED=!0;Ot.BLACK=!1;class K0{copy(e,t,r,s,i){return this}insert(e,t,r){return new Ot(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}let wn=class gl{constructor(e,t=gl.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new gl(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Ot.BLACK,null,null))}remove(e){return new gl(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Ot.BLACK,null,null))}get(e){let t,r=this.root_;for(;!r.isEmpty();){if(t=this.comparator_(e,r.key),t===0)return r.value;t<0?r=r.left:t>0&&(r=r.right)}return null}getPredecessorKey(e){let t,r=this.root_,s=null;for(;!r.isEmpty();)if(t=this.comparator_(e,r.key),t===0){if(r.left.isEmpty())return s?s.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else t<0?r=r.left:t>0&&(s=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new tl(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new tl(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new tl(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new tl(this.root_,null,this.comparator_,!0,e)}};wn.EMPTY_NODE=new K0;function Q0(n,e){return qs(n.name,e.name)}function Ep(n,e){return qs(n,e)}let qd;function Y0(n){qd=n}const gT=function(n){return typeof n=="number"?"number:"+KE(n):"string:"+n},_T=function(n){if(n.isLeafNode()){const e=n.val();V(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Ut(e,".sv"),"Priority must be a string or number.")}else V(n===qd||n.isEmpty(),"priority of unexpected type.");V(n===qd||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let ay;class He{static set __childrenNodeConstructor(e){ay=e}static get __childrenNodeConstructor(){return ay}constructor(e,t=He.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,V(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),_T(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new He(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:He.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return ee(e)?this:Z(e)===".priority"?this.priorityNode_:He.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:He.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const r=Z(e);return r===null?t:t.isEmpty()&&r!==".priority"?this:(V(r!==".priority"||Sr(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,He.__childrenNodeConstructor.EMPTY_NODE.updateChild(pe(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+gT(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=KE(this.value_):e+=this.value_,this.lazyHash_=GE(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===He.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof He.__childrenNodeConstructor?-1:(V(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,r=typeof this.value_,s=He.VALUE_TYPE_ORDER.indexOf(t),i=He.VALUE_TYPE_ORDER.indexOf(r);return V(s>=0,"Unknown leaf type: "+t),V(i>=0,"Unknown leaf type: "+r),s===i?r==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-s}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}He.VALUE_TYPE_ORDER=["object","boolean","number","string"];let yT,IT;function J0(n){yT=n}function X0(n){IT=n}class Z0 extends Du{compare(e,t){const r=e.node.getPriority(),s=t.node.getPriority(),i=r.compareTo(s);return i===0?qs(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return ne.MIN}maxPost(){return new ne($n,new He("[PRIORITY-POST]",IT))}makePost(e,t){const r=yT(e);return new ne(t,new He("[PRIORITY-POST]",r))}toString(){return".priority"}}const _e=new Z0;const ex=Math.log(2);class tx{constructor(e){const t=i=>parseInt(Math.log(i)/ex,10),r=i=>parseInt(Array(i+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const s=r(this.count);this.bits_=e+1&s}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Bl=function(n,e,t,r){n.sort(e);const s=function(l,u){const h=u-l;let f,m;if(h===0)return null;if(h===1)return f=n[l],m=t?t(f):f,new Ot(m,f.node,Ot.BLACK,null,null);{const _=parseInt(h/2,10)+l,A=s(l,_),k=s(_+1,u);return f=n[_],m=t?t(f):f,new Ot(m,f.node,Ot.BLACK,A,k)}},i=function(l){let u=null,h=null,f=n.length;const m=function(A,k){const N=f-A,W=f;f-=A;const z=s(N+1,W),q=n[N],K=t?t(q):q;_(new Ot(K,q.node,k,null,z))},_=function(A){u?(u.left=A,u=A):(h=A,u=A)};for(let A=0;A<l.count;++A){const k=l.nextBitIsOne(),N=Math.pow(2,l.count-(A+1));k?m(N,Ot.BLACK):(m(N,Ot.BLACK),m(N,Ot.RED))}return h},o=new tx(n.length),a=i(o);return new wn(r||e,a)};let ud;const Xs={};class Vn{static get Default(){return V(Xs&&_e,"ChildrenNode.ts has not been loaded"),ud=ud||new Vn({".priority":Xs},{".priority":_e}),ud}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=Is(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof wn?t:null}hasIndex(e){return Ut(this.indexSet_,e.toString())}addIndex(e,t){V(e!==vn,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const r=[];let s=!1;const i=t.getIterator(ne.Wrap);let o=i.getNext();for(;o;)s=s||e.isDefinedOn(o.node),r.push(o),o=i.getNext();let a;s?a=Bl(r,e.getCompare()):a=Xs;const l=e.toString(),u={...this.indexSet_};u[l]=e;const h={...this.indexes_};return h[l]=a,new Vn(h,u)}addToIndexes(e,t){const r=kl(this.indexes_,(s,i)=>{const o=Is(this.indexSet_,i);if(V(o,"Missing index implementation for "+i),s===Xs)if(o.isDefinedOn(e.node)){const a=[],l=t.getIterator(ne.Wrap);let u=l.getNext();for(;u;)u.name!==e.name&&a.push(u),u=l.getNext();return a.push(e),Bl(a,o.getCompare())}else return Xs;else{const a=t.get(e.name);let l=s;return a&&(l=l.remove(new ne(e.name,a))),l.insert(e,e.node)}});return new Vn(r,this.indexSet_)}removeFromIndexes(e,t){const r=kl(this.indexes_,s=>{if(s===Xs)return s;{const i=t.get(e.name);return i?s.remove(new ne(e.name,i)):s}});return new Vn(r,this.indexSet_)}}let Uo;class j{static get EMPTY_NODE(){return Uo||(Uo=new j(new wn(Ep),null,Vn.Default))}constructor(e,t,r){this.children_=e,this.priorityNode_=t,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&_T(this.priorityNode_),this.children_.isEmpty()&&V(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Uo}updatePriority(e){return this.children_.isEmpty()?this:new j(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?Uo:t}}getChild(e){const t=Z(e);return t===null?this:this.getImmediateChild(t).getChild(pe(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(V(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const r=new ne(e,t);let s,i;t.isEmpty()?(s=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(r,this.children_)):(s=this.children_.insert(e,t),i=this.indexMap_.addToIndexes(r,this.children_));const o=s.isEmpty()?Uo:this.priorityNode_;return new j(s,o,i)}}updateChild(e,t){const r=Z(e);if(r===null)return t;{V(Z(e)!==".priority"||Sr(e)===1,".priority must be the last token in a path");const s=this.getImmediateChild(r).updateChild(pe(e),t);return this.updateImmediateChild(r,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let r=0,s=0,i=!0;if(this.forEachChild(_e,(o,a)=>{t[o]=a.val(e),r++,i&&j.INTEGER_REGEXP_.test(o)?s=Math.max(s,Number(o)):i=!1}),!e&&i&&s<2*r){const o=[];for(const a in t)o[a]=t[a];return o}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+gT(this.getPriority().val())+":"),this.forEachChild(_e,(t,r)=>{const s=r.hash();s!==""&&(e+=":"+t+":"+s)}),this.lazyHash_=e===""?"":GE(e)}return this.lazyHash_}getPredecessorChildName(e,t,r){const s=this.resolveIndex_(r);if(s){const i=s.getPredecessorKey(new ne(e,t));return i?i.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const r=t.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new ne(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const r=t.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new ne(t,this.children_.get(t)):null}forEachChild(e,t){const r=this.resolveIndex_(e);return r?r.inorderTraversal(s=>t(s.name,s.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const r=this.resolveIndex_(t);if(r)return r.getIteratorFrom(e,s=>s);{const s=this.children_.getIteratorFrom(e.name,ne.Wrap);let i=s.peek();for(;i!=null&&t.compare(i,e)<0;)s.getNext(),i=s.peek();return s}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const r=this.resolveIndex_(t);if(r)return r.getReverseIteratorFrom(e,s=>s);{const s=this.children_.getReverseIteratorFrom(e.name,ne.Wrap);let i=s.peek();for(;i!=null&&t.compare(i,e)>0;)s.getNext(),i=s.peek();return s}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===mc?-1:0}withIndex(e){if(e===vn||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new j(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===vn||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const r=this.getIterator(_e),s=t.getIterator(_e);let i=r.getNext(),o=s.getNext();for(;i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=r.getNext(),o=s.getNext()}return i===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===vn?null:this.indexMap_.get(e.toString())}}j.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class nx extends j{constructor(){super(new wn(Ep),j.EMPTY_NODE,Vn.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return j.EMPTY_NODE}isEmpty(){return!1}}const mc=new nx;Object.defineProperties(ne,{MIN:{value:new ne(Rr,j.EMPTY_NODE)},MAX:{value:new ne($n,mc)}});mT.__EMPTY_NODE=j.EMPTY_NODE;He.__childrenNodeConstructor=j;Y0(mc);X0(mc);const rx=!0;function Se(n,e=null){if(n===null)return j.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),V(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new He(t,Se(e))}if(!(n instanceof Array)&&rx){const t=[];let r=!1;if(et(n,(o,a)=>{if(o.substring(0,1)!=="."){const l=Se(a);l.isEmpty()||(r=r||!l.getPriority().isEmpty(),t.push(new ne(o,l)))}}),t.length===0)return j.EMPTY_NODE;const i=Bl(t,Q0,o=>o.name,Ep);if(r){const o=Bl(t,_e.getCompare());return new j(i,Se(e),new Vn({".priority":o},{".priority":_e}))}else return new j(i,Se(e),Vn.Default)}else{let t=j.EMPTY_NODE;return et(n,(r,s)=>{if(Ut(n,r)&&r.substring(0,1)!=="."){const i=Se(s);(i.isLeafNode()||!i.isEmpty())&&(t=t.updateImmediateChild(r,i))}}),t.updatePriority(Se(e))}}J0(Se);class Tp extends Du{constructor(e){super(),this.indexPath_=e,V(!ee(e)&&Z(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const r=this.extractChild(e.node),s=this.extractChild(t.node),i=r.compareTo(s);return i===0?qs(e.name,t.name):i}makePost(e,t){const r=Se(e),s=j.EMPTY_NODE.updateChild(this.indexPath_,r);return new ne(t,s)}maxPost(){const e=j.EMPTY_NODE.updateChild(this.indexPath_,mc);return new ne($n,e)}toString(){return xa(this.indexPath_,0).join("/")}}class sx extends Du{compare(e,t){const r=e.node.compareTo(t.node);return r===0?qs(e.name,t.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return ne.MIN}maxPost(){return ne.MAX}makePost(e,t){const r=Se(e);return new ne(t,r)}toString(){return".value"}}const vp=new sx;function wT(n){return{type:"value",snapshotNode:n}}function Ci(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function Oa(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function Va(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function ix(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}class Ap{constructor(e){this.index_=e}updateChild(e,t,r,s,i,o){V(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(s).equals(r.getChild(s))&&a.isEmpty()===r.isEmpty()||(o!=null&&(r.isEmpty()?e.hasChild(t)?o.trackChildChange(Oa(t,a)):V(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Ci(t,r)):o.trackChildChange(Va(t,r,a))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(t,r).withIndex(this.index_)}updateFullNode(e,t,r){return r!=null&&(e.isLeafNode()||e.forEachChild(_e,(s,i)=>{t.hasChild(s)||r.trackChildChange(Oa(s,i))}),t.isLeafNode()||t.forEachChild(_e,(s,i)=>{if(e.hasChild(s)){const o=e.getImmediateChild(s);o.equals(i)||r.trackChildChange(Va(s,i,o))}else r.trackChildChange(Ci(s,i))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?j.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class La{constructor(e){this.indexedFilter_=new Ap(e.getIndex()),this.index_=e.getIndex(),this.startPost_=La.getStartPost_(e),this.endPost_=La.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&r}updateChild(e,t,r,s,i,o){return this.matches(new ne(t,r))||(r=j.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,r,s,i,o)}updateFullNode(e,t,r){t.isLeafNode()&&(t=j.EMPTY_NODE);let s=t.withIndex(this.index_);s=s.updatePriority(j.EMPTY_NODE);const i=this;return t.forEachChild(_e,(o,a)=>{i.matches(new ne(o,a))||(s=s.updateImmediateChild(o,j.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}}class ox{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const r=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=t=>{const r=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new La(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,r,s,i,o){return this.rangedFilter_.matches(new ne(t,r))||(r=j.EMPTY_NODE),e.getImmediateChild(t).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,r,s,i,o):this.fullLimitUpdateChild_(e,t,r,i,o)}updateFullNode(e,t,r){let s;if(t.isLeafNode()||t.isEmpty())s=j.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){s=j.EMPTY_NODE.withIndex(this.index_);let i;this.reverse_?i=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):i=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;i.hasNext()&&o<this.limit_;){const a=i.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))s=s.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{s=t.withIndex(this.index_),s=s.updatePriority(j.EMPTY_NODE);let i;this.reverse_?i=s.getReverseIterator(this.index_):i=s.getIterator(this.index_);let o=0;for(;i.hasNext();){const a=i.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:s=s.updateImmediateChild(a.name,j.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,r,s,i){let o;if(this.reverse_){const f=this.index_.getCompare();o=(m,_)=>f(_,m)}else o=this.index_.getCompare();const a=e;V(a.numChildren()===this.limit_,"");const l=new ne(t,r),u=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(l);if(a.hasChild(t)){const f=a.getImmediateChild(t);let m=s.getChildAfterChild(this.index_,u,this.reverse_);for(;m!=null&&(m.name===t||a.hasChild(m.name));)m=s.getChildAfterChild(this.index_,m,this.reverse_);const _=m==null?1:o(m,l);if(h&&!r.isEmpty()&&_>=0)return i?.trackChildChange(Va(t,r,f)),a.updateImmediateChild(t,r);{i?.trackChildChange(Oa(t,f));const k=a.updateImmediateChild(t,j.EMPTY_NODE);return m!=null&&this.rangedFilter_.matches(m)?(i?.trackChildChange(Ci(m.name,m.node)),k.updateImmediateChild(m.name,m.node)):k}}else return r.isEmpty()?e:h&&o(u,l)>=0?(i!=null&&(i.trackChildChange(Oa(u.name,u.node)),i.trackChildChange(Ci(t,r))),a.updateImmediateChild(t,r).updateImmediateChild(u.name,j.EMPTY_NODE)):e}}class xu{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=_e}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return V(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return V(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Rr}hasEnd(){return this.endSet_}getIndexEndValue(){return V(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return V(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:$n}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return V(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===_e}copy(){const e=new xu;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function ax(n){return n.loadsAllData()?new Ap(n.getIndex()):n.hasLimit()?new ox(n):new La(n)}function cx(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function lx(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function Wd(n,e,t){const r=n.copy();return r.startSet_=!0,e===void 0&&(e=null),r.indexStartValue_=e,t!=null?(r.startNameSet_=!0,r.indexStartName_=t):(r.startNameSet_=!1,r.indexStartName_=""),r}function ux(n,e,t){let r;return n.index_===vn||t?r=Wd(n,e,t):r=Wd(n,e,$n),r.startAfterSet_=!0,r}function $d(n,e,t){const r=n.copy();return r.endSet_=!0,e===void 0&&(e=null),r.indexEndValue_=e,t!==void 0?(r.endNameSet_=!0,r.indexEndName_=t):(r.endNameSet_=!1,r.indexEndName_=""),r}function hx(n,e,t){let r;return n.index_===vn||t?r=$d(n,e,t):r=$d(n,e,Rr),r.endBeforeSet_=!0,r}function Ou(n,e){const t=n.copy();return t.index_=e,t}function cy(n){const e={};if(n.isDefault())return e;let t;if(n.index_===_e?t="$priority":n.index_===vp?t="$value":n.index_===vn?t="$key":(V(n.index_ instanceof Tp,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=We(t),n.startSet_){const r=n.startAfterSet_?"startAfter":"startAt";e[r]=We(n.indexStartValue_),n.startNameSet_&&(e[r]+=","+We(n.indexStartName_))}if(n.endSet_){const r=n.endBeforeSet_?"endBefore":"endAt";e[r]=We(n.indexEndValue_),n.endNameSet_&&(e[r]+=","+We(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function ly(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==_e&&(e.i=n.index_.toString()),e}class ql extends hT{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(V(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,r,s){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=r,this.appCheckTokenProvider_=s,this.log_=pc("p:rest:"),this.listens_={}}listen(e,t,r,s){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const o=ql.getListenId_(e,r),a={};this.listens_[o]=a;const l=cy(e._queryParams);this.restRequest_(i+".json",l,(u,h)=>{let f=h;if(u===404&&(f=null,u=null),u===null&&this.onDataUpdate_(i,f,!1,r),Is(this.listens_,o)===a){let m;u?u===401?m="permission_denied":m="rest_error:"+u:m="ok",s(m,null)}})}unlisten(e,t){const r=ql.getListenId_(e,t);delete this.listens_[r]}get(e){const t=cy(e._queryParams),r=e._path.toString(),s=new Rt;return this.restRequest_(r+".json",t,(i,o)=>{let a=o;i===404&&(a=null,i=null),i===null?(this.onDataUpdate_(r,a,!1,null),s.resolve(a)):s.reject(new Error(a))}),s.promise}refreshAuthToken(e){}restRequest_(e,t={},r){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,i])=>{s&&s.accessToken&&(t.auth=s.accessToken),i&&i.token&&(t.ac=i.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Us(t);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(r&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=Ra(a.responseText)}catch{ht("Failed to parse JSON response for "+o+": "+a.responseText)}r(null,l)}else a.status!==401&&a.status!==404&&ht("Got unsuccessful REST response for "+o+" Status: "+a.status),r(a.status);r=null}},a.open("GET",o,!0),a.send()})}}class dx{constructor(){this.rootNode_=j.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function Wl(){return{value:null,children:new Map}}function so(n,e,t){if(ee(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const r=Z(e);n.children.has(r)||n.children.set(r,Wl());const s=n.children.get(r);e=pe(e),so(s,e,t)}}function zd(n,e){if(ee(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{const t=n.value;return n.value=null,t.forEachChild(_e,(r,s)=>{so(n,new ue(r),s)}),zd(n,e)}}else if(n.children.size>0){const t=Z(e);return e=pe(e),n.children.has(t)&&zd(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function Gd(n,e,t){n.value!==null?t(e,n.value):fx(n,(r,s)=>{const i=new ue(e.toString()+"/"+r);Gd(s,i,t)})}function fx(n,e){n.children.forEach((t,r)=>{e(r,t)})}class px{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t={...e};return this.last_&&et(this.last_,(r,s)=>{t[r]=t[r]-s}),this.last_=e,t}}const uy=10*1e3,mx=30*1e3,gx=300*1e3;class _x{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new px(e);const r=uy+(mx-uy)*Math.random();la(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){const e=this.statsListener_.get(),t={};let r=!1;et(e,(s,i)=>{i>0&&Ut(this.statsToReport_,s)&&(t[s]=i,r=!0)}),r&&this.server_.reportStats(t),la(this.reportStats_.bind(this),Math.floor(Math.random()*2*gx))}}var tn;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(tn||(tn={}));function bp(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Rp(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Sp(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}class $l{constructor(e,t,r){this.path=e,this.affectedTree=t,this.revert=r,this.type=tn.ACK_USER_WRITE,this.source=bp()}operationForChild(e){if(ee(this.path)){if(this.affectedTree.value!=null)return V(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new ue(e));return new $l(ae(),t,this.revert)}}else return V(Z(this.path)===e,"operationForChild called for unrelated child."),new $l(pe(this.path),this.affectedTree,this.revert)}}class Ma{constructor(e,t){this.source=e,this.path=t,this.type=tn.LISTEN_COMPLETE}operationForChild(e){return ee(this.path)?new Ma(this.source,ae()):new Ma(this.source,pe(this.path))}}class vs{constructor(e,t,r){this.source=e,this.path=t,this.snap=r,this.type=tn.OVERWRITE}operationForChild(e){return ee(this.path)?new vs(this.source,ae(),this.snap.getImmediateChild(e)):new vs(this.source,pe(this.path),this.snap)}}class Pi{constructor(e,t,r){this.source=e,this.path=t,this.children=r,this.type=tn.MERGE}operationForChild(e){if(ee(this.path)){const t=this.children.subtree(new ue(e));return t.isEmpty()?null:t.value?new vs(this.source,ae(),t.value):new Pi(this.source,ae(),t)}else return V(Z(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Pi(this.source,pe(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class Cr{constructor(e,t,r){this.node_=e,this.fullyInitialized_=t,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(ee(e))return this.isFullyInitialized()&&!this.filtered_;const t=Z(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class yx{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function Ix(n,e,t,r){const s=[],i=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&i.push(ix(o.childName,o.snapshotNode))}),Bo(n,s,"child_removed",e,r,t),Bo(n,s,"child_added",e,r,t),Bo(n,s,"child_moved",i,r,t),Bo(n,s,"child_changed",e,r,t),Bo(n,s,"value",e,r,t),s}function Bo(n,e,t,r,s,i){const o=r.filter(a=>a.type===t);o.sort((a,l)=>Ex(n,a,l)),o.forEach(a=>{const l=wx(n,a,i);s.forEach(u=>{u.respondsTo(a.type)&&e.push(u.createEvent(l,n.query_))})})}function wx(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function Ex(n,e,t){if(e.childName==null||t.childName==null)throw Xi("Should only compare child_ events.");const r=new ne(e.childName,e.snapshotNode),s=new ne(t.childName,t.snapshotNode);return n.index_.compare(r,s)}function Vu(n,e){return{eventCache:n,serverCache:e}}function ua(n,e,t,r){return Vu(new Cr(e,t,r),n.serverCache)}function ET(n,e,t,r){return Vu(n.eventCache,new Cr(e,t,r))}function zl(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function As(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}let hd;const Tx=()=>(hd||(hd=new wn(s0)),hd);class ge{static fromObject(e){let t=new ge(null);return et(e,(r,s)=>{t=t.set(new ue(r),s)}),t}constructor(e,t=Tx()){this.value=e,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:ae(),value:this.value};if(ee(e))return null;{const r=Z(e),s=this.children.get(r);if(s!==null){const i=s.findRootMostMatchingPathAndValue(pe(e),t);return i!=null?{path:Ae(new ue(r),i.path),value:i.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(ee(e))return this;{const t=Z(e),r=this.children.get(t);return r!==null?r.subtree(pe(e)):new ge(null)}}set(e,t){if(ee(e))return new ge(t,this.children);{const r=Z(e),i=(this.children.get(r)||new ge(null)).set(pe(e),t),o=this.children.insert(r,i);return new ge(this.value,o)}}remove(e){if(ee(e))return this.children.isEmpty()?new ge(null):new ge(null,this.children);{const t=Z(e),r=this.children.get(t);if(r){const s=r.remove(pe(e));let i;return s.isEmpty()?i=this.children.remove(t):i=this.children.insert(t,s),this.value===null&&i.isEmpty()?new ge(null):new ge(this.value,i)}else return this}}get(e){if(ee(e))return this.value;{const t=Z(e),r=this.children.get(t);return r?r.get(pe(e)):null}}setTree(e,t){if(ee(e))return t;{const r=Z(e),i=(this.children.get(r)||new ge(null)).setTree(pe(e),t);let o;return i.isEmpty()?o=this.children.remove(r):o=this.children.insert(r,i),new ge(this.value,o)}}fold(e){return this.fold_(ae(),e)}fold_(e,t){const r={};return this.children.inorderTraversal((s,i)=>{r[s]=i.fold_(Ae(e,s),t)}),t(e,this.value,r)}findOnPath(e,t){return this.findOnPath_(e,ae(),t)}findOnPath_(e,t,r){const s=this.value?r(t,this.value):!1;if(s)return s;if(ee(e))return null;{const i=Z(e),o=this.children.get(i);return o?o.findOnPath_(pe(e),Ae(t,i),r):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,ae(),t)}foreachOnPath_(e,t,r){if(ee(e))return this;{this.value&&r(t,this.value);const s=Z(e),i=this.children.get(s);return i?i.foreachOnPath_(pe(e),Ae(t,s),r):new ge(null)}}foreach(e){this.foreach_(ae(),e)}foreach_(e,t){this.children.inorderTraversal((r,s)=>{s.foreach_(Ae(e,r),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,r)=>{r.value&&e(t,r.value)})}}class nn{constructor(e){this.writeTree_=e}static empty(){return new nn(new ge(null))}}function ha(n,e,t){if(ee(e))return new nn(new ge(t));{const r=n.writeTree_.findRootMostValueAndPath(e);if(r!=null){const s=r.path;let i=r.value;const o=Et(s,e);return i=i.updateChild(o,t),new nn(n.writeTree_.set(s,i))}else{const s=new ge(t),i=n.writeTree_.setTree(e,s);return new nn(i)}}}function jd(n,e,t){let r=n;return et(t,(s,i)=>{r=ha(r,Ae(e,s),i)}),r}function hy(n,e){if(ee(e))return nn.empty();{const t=n.writeTree_.setTree(e,new ge(null));return new nn(t)}}function Hd(n,e){return Ws(n,e)!=null}function Ws(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(Et(t.path,e)):null}function dy(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(_e,(r,s)=>{e.push(new ne(r,s))}):n.writeTree_.children.inorderTraversal((r,s)=>{s.value!=null&&e.push(new ne(r,s.value))}),e}function yr(n,e){if(ee(e))return n;{const t=Ws(n,e);return t!=null?new nn(new ge(t)):new nn(n.writeTree_.subtree(e))}}function Kd(n){return n.writeTree_.isEmpty()}function ki(n,e){return TT(ae(),n.writeTree_,e)}function TT(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let r=null;return e.children.inorderTraversal((s,i)=>{s===".priority"?(V(i.value!==null,"Priority writes must always be leaf nodes"),r=i.value):t=TT(Ae(n,s),i,t)}),!t.getChild(n).isEmpty()&&r!==null&&(t=t.updateChild(Ae(n,".priority"),r)),t}}function Lu(n,e){return RT(e,n)}function vx(n,e,t,r,s){V(r>n.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),n.allWrites.push({path:e,snap:t,writeId:r,visible:s}),s&&(n.visibleWrites=ha(n.visibleWrites,e,t)),n.lastWriteId=r}function Ax(n,e,t,r){V(r>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:r,visible:!0}),n.visibleWrites=jd(n.visibleWrites,e,t),n.lastWriteId=r}function bx(n,e){for(let t=0;t<n.allWrites.length;t++){const r=n.allWrites[t];if(r.writeId===e)return r}return null}function Rx(n,e){const t=n.allWrites.findIndex(a=>a.writeId===e);V(t>=0,"removeWrite called with nonexistent writeId.");const r=n.allWrites[t];n.allWrites.splice(t,1);let s=r.visible,i=!1,o=n.allWrites.length-1;for(;s&&o>=0;){const a=n.allWrites[o];a.visible&&(o>=t&&Sx(a,r.path)?s=!1:$t(r.path,a.path)&&(i=!0)),o--}if(s){if(i)return Cx(n),!0;if(r.snap)n.visibleWrites=hy(n.visibleWrites,r.path);else{const a=r.children;et(a,l=>{n.visibleWrites=hy(n.visibleWrites,Ae(r.path,l))})}return!0}else return!1}function Sx(n,e){if(n.snap)return $t(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&$t(Ae(n.path,t),e))return!0;return!1}function Cx(n){n.visibleWrites=vT(n.allWrites,Px,ae()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function Px(n){return n.visible}function vT(n,e,t){let r=nn.empty();for(let s=0;s<n.length;++s){const i=n[s];if(e(i)){const o=i.path;let a;if(i.snap)$t(t,o)?(a=Et(t,o),r=ha(r,a,i.snap)):$t(o,t)&&(a=Et(o,t),r=ha(r,ae(),i.snap.getChild(a)));else if(i.children){if($t(t,o))a=Et(t,o),r=jd(r,a,i.children);else if($t(o,t))if(a=Et(o,t),ee(a))r=jd(r,ae(),i.children);else{const l=Is(i.children,Z(a));if(l){const u=l.getChild(pe(a));r=ha(r,ae(),u)}}}else throw Xi("WriteRecord should have .snap or .children")}}return r}function AT(n,e,t,r,s){if(!r&&!s){const i=Ws(n.visibleWrites,e);if(i!=null)return i;{const o=yr(n.visibleWrites,e);if(Kd(o))return t;if(t==null&&!Hd(o,ae()))return null;{const a=t||j.EMPTY_NODE;return ki(o,a)}}}else{const i=yr(n.visibleWrites,e);if(!s&&Kd(i))return t;if(!s&&t==null&&!Hd(i,ae()))return null;{const o=function(u){return(u.visible||s)&&(!r||!~r.indexOf(u.writeId))&&($t(u.path,e)||$t(e,u.path))},a=vT(n.allWrites,o,e),l=t||j.EMPTY_NODE;return ki(a,l)}}}function kx(n,e,t){let r=j.EMPTY_NODE;const s=Ws(n.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(_e,(i,o)=>{r=r.updateImmediateChild(i,o)}),r;if(t){const i=yr(n.visibleWrites,e);return t.forEachChild(_e,(o,a)=>{const l=ki(yr(i,new ue(o)),a);r=r.updateImmediateChild(o,l)}),dy(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{const i=yr(n.visibleWrites,e);return dy(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function Nx(n,e,t,r,s){V(r||s,"Either existingEventSnap or existingServerSnap must exist");const i=Ae(e,t);if(Hd(n.visibleWrites,i))return null;{const o=yr(n.visibleWrites,i);return Kd(o)?s.getChild(t):ki(o,s.getChild(t))}}function Dx(n,e,t,r){const s=Ae(e,t),i=Ws(n.visibleWrites,s);if(i!=null)return i;if(r.isCompleteForChild(t)){const o=yr(n.visibleWrites,s);return ki(o,r.getNode().getImmediateChild(t))}else return null}function xx(n,e){return Ws(n.visibleWrites,e)}function Ox(n,e,t,r,s,i,o){let a;const l=yr(n.visibleWrites,e),u=Ws(l,ae());if(u!=null)a=u;else if(t!=null)a=ki(l,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const h=[],f=o.getCompare(),m=i?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o);let _=m.getNext();for(;_&&h.length<s;)f(_,r)!==0&&h.push(_),_=m.getNext();return h}else return[]}function Vx(){return{visibleWrites:nn.empty(),allWrites:[],lastWriteId:-1}}function Gl(n,e,t,r){return AT(n.writeTree,n.treePath,e,t,r)}function Cp(n,e){return kx(n.writeTree,n.treePath,e)}function fy(n,e,t,r){return Nx(n.writeTree,n.treePath,e,t,r)}function jl(n,e){return xx(n.writeTree,Ae(n.treePath,e))}function Lx(n,e,t,r,s,i){return Ox(n.writeTree,n.treePath,e,t,r,s,i)}function Pp(n,e,t){return Dx(n.writeTree,n.treePath,e,t)}function bT(n,e){return RT(Ae(n.treePath,e),n.writeTree)}function RT(n,e){return{treePath:n,writeTree:e}}class Mx{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,r=e.childName;V(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),V(r!==".priority","Only non-priority child changes can be tracked.");const s=this.changeMap.get(r);if(s){const i=s.type;if(t==="child_added"&&i==="child_removed")this.changeMap.set(r,Va(r,e.snapshotNode,s.snapshotNode));else if(t==="child_removed"&&i==="child_added")this.changeMap.delete(r);else if(t==="child_removed"&&i==="child_changed")this.changeMap.set(r,Oa(r,s.oldSnap));else if(t==="child_changed"&&i==="child_added")this.changeMap.set(r,Ci(r,e.snapshotNode));else if(t==="child_changed"&&i==="child_changed")this.changeMap.set(r,Va(r,e.snapshotNode,s.oldSnap));else throw Xi("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}class Fx{getCompleteChild(e){return null}getChildAfterChild(e,t,r){return null}}const ST=new Fx;class kp{constructor(e,t,r=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=r}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const r=this.optCompleteServerCache_!=null?new Cr(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Pp(this.writes_,e,r)}}getChildAfterChild(e,t,r){const s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:As(this.viewCache_),i=Lx(this.writes_,s,t,1,r,e);return i.length===0?null:i[0]}}function Ux(n){return{filter:n}}function Bx(n,e){V(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),V(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function qx(n,e,t,r,s){const i=new Mx;let o,a;if(t.type===tn.OVERWRITE){const u=t;u.source.fromUser?o=Qd(n,e,u.path,u.snap,r,s,i):(V(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered()&&!ee(u.path),o=Hl(n,e,u.path,u.snap,r,s,a,i))}else if(t.type===tn.MERGE){const u=t;u.source.fromUser?o=$x(n,e,u.path,u.children,r,s,i):(V(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered(),o=Yd(n,e,u.path,u.children,r,s,a,i))}else if(t.type===tn.ACK_USER_WRITE){const u=t;u.revert?o=jx(n,e,u.path,r,s,i):o=zx(n,e,u.path,u.affectedTree,r,s,i)}else if(t.type===tn.LISTEN_COMPLETE)o=Gx(n,e,t.path,r,i);else throw Xi("Unknown operation type: "+t.type);const l=i.getChanges();return Wx(e,o,l),{viewCache:o,changes:l}}function Wx(n,e,t){const r=e.eventCache;if(r.isFullyInitialized()){const s=r.getNode().isLeafNode()||r.getNode().isEmpty(),i=zl(n);(t.length>0||!n.eventCache.isFullyInitialized()||s&&!r.getNode().equals(i)||!r.getNode().getPriority().equals(i.getPriority()))&&t.push(wT(zl(e)))}}function CT(n,e,t,r,s,i){const o=e.eventCache;if(jl(r,t)!=null)return e;{let a,l;if(ee(t))if(V(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const u=As(e),h=u instanceof j?u:j.EMPTY_NODE,f=Cp(r,h);a=n.filter.updateFullNode(e.eventCache.getNode(),f,i)}else{const u=Gl(r,As(e));a=n.filter.updateFullNode(e.eventCache.getNode(),u,i)}else{const u=Z(t);if(u===".priority"){V(Sr(t)===1,"Can't have a priority with additional path components");const h=o.getNode();l=e.serverCache.getNode();const f=fy(r,t,h,l);f!=null?a=n.filter.updatePriority(h,f):a=o.getNode()}else{const h=pe(t);let f;if(o.isCompleteForChild(u)){l=e.serverCache.getNode();const m=fy(r,t,o.getNode(),l);m!=null?f=o.getNode().getImmediateChild(u).updateChild(h,m):f=o.getNode().getImmediateChild(u)}else f=Pp(r,u,e.serverCache);f!=null?a=n.filter.updateChild(o.getNode(),u,f,h,s,i):a=o.getNode()}}return ua(e,a,o.isFullyInitialized()||ee(t),n.filter.filtersNodes())}}function Hl(n,e,t,r,s,i,o,a){const l=e.serverCache;let u;const h=o?n.filter:n.filter.getIndexedFilter();if(ee(t))u=h.updateFullNode(l.getNode(),r,null);else if(h.filtersNodes()&&!l.isFiltered()){const _=l.getNode().updateChild(t,r);u=h.updateFullNode(l.getNode(),_,null)}else{const _=Z(t);if(!l.isCompleteForPath(t)&&Sr(t)>1)return e;const A=pe(t),N=l.getNode().getImmediateChild(_).updateChild(A,r);_===".priority"?u=h.updatePriority(l.getNode(),N):u=h.updateChild(l.getNode(),_,N,A,ST,null)}const f=ET(e,u,l.isFullyInitialized()||ee(t),h.filtersNodes()),m=new kp(s,f,i);return CT(n,f,t,s,m,a)}function Qd(n,e,t,r,s,i,o){const a=e.eventCache;let l,u;const h=new kp(s,e,i);if(ee(t))u=n.filter.updateFullNode(e.eventCache.getNode(),r,o),l=ua(e,u,!0,n.filter.filtersNodes());else{const f=Z(t);if(f===".priority")u=n.filter.updatePriority(e.eventCache.getNode(),r),l=ua(e,u,a.isFullyInitialized(),a.isFiltered());else{const m=pe(t),_=a.getNode().getImmediateChild(f);let A;if(ee(m))A=r;else{const k=h.getCompleteChild(f);k!=null?yp(m)===".priority"&&k.getChild(fT(m)).isEmpty()?A=k:A=k.updateChild(m,r):A=j.EMPTY_NODE}if(_.equals(A))l=e;else{const k=n.filter.updateChild(a.getNode(),f,A,m,h,o);l=ua(e,k,a.isFullyInitialized(),n.filter.filtersNodes())}}}return l}function py(n,e){return n.eventCache.isCompleteForChild(e)}function $x(n,e,t,r,s,i,o){let a=e;return r.foreach((l,u)=>{const h=Ae(t,l);py(e,Z(h))&&(a=Qd(n,a,h,u,s,i,o))}),r.foreach((l,u)=>{const h=Ae(t,l);py(e,Z(h))||(a=Qd(n,a,h,u,s,i,o))}),a}function my(n,e,t){return t.foreach((r,s)=>{e=e.updateChild(r,s)}),e}function Yd(n,e,t,r,s,i,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,u;ee(t)?u=r:u=new ge(null).setTree(t,r);const h=e.serverCache.getNode();return u.children.inorderTraversal((f,m)=>{if(h.hasChild(f)){const _=e.serverCache.getNode().getImmediateChild(f),A=my(n,_,m);l=Hl(n,l,new ue(f),A,s,i,o,a)}}),u.children.inorderTraversal((f,m)=>{const _=!e.serverCache.isCompleteForChild(f)&&m.value===null;if(!h.hasChild(f)&&!_){const A=e.serverCache.getNode().getImmediateChild(f),k=my(n,A,m);l=Hl(n,l,new ue(f),k,s,i,o,a)}}),l}function zx(n,e,t,r,s,i,o){if(jl(s,t)!=null)return e;const a=e.serverCache.isFiltered(),l=e.serverCache;if(r.value!=null){if(ee(t)&&l.isFullyInitialized()||l.isCompleteForPath(t))return Hl(n,e,t,l.getNode().getChild(t),s,i,a,o);if(ee(t)){let u=new ge(null);return l.getNode().forEachChild(vn,(h,f)=>{u=u.set(new ue(h),f)}),Yd(n,e,t,u,s,i,a,o)}else return e}else{let u=new ge(null);return r.foreach((h,f)=>{const m=Ae(t,h);l.isCompleteForPath(m)&&(u=u.set(h,l.getNode().getChild(m)))}),Yd(n,e,t,u,s,i,a,o)}}function Gx(n,e,t,r,s){const i=e.serverCache,o=ET(e,i.getNode(),i.isFullyInitialized()||ee(t),i.isFiltered());return CT(n,o,t,r,ST,s)}function jx(n,e,t,r,s,i){let o;if(jl(r,t)!=null)return e;{const a=new kp(r,e,s),l=e.eventCache.getNode();let u;if(ee(t)||Z(t)===".priority"){let h;if(e.serverCache.isFullyInitialized())h=Gl(r,As(e));else{const f=e.serverCache.getNode();V(f instanceof j,"serverChildren would be complete if leaf node"),h=Cp(r,f)}h=h,u=n.filter.updateFullNode(l,h,i)}else{const h=Z(t);let f=Pp(r,h,e.serverCache);f==null&&e.serverCache.isCompleteForChild(h)&&(f=l.getImmediateChild(h)),f!=null?u=n.filter.updateChild(l,h,f,pe(t),a,i):e.eventCache.getNode().hasChild(h)?u=n.filter.updateChild(l,h,j.EMPTY_NODE,pe(t),a,i):u=l,u.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Gl(r,As(e)),o.isLeafNode()&&(u=n.filter.updateFullNode(u,o,i)))}return o=e.serverCache.isFullyInitialized()||jl(r,ae())!=null,ua(e,u,o,n.filter.filtersNodes())}}class Hx{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const r=this.query_._queryParams,s=new Ap(r.getIndex()),i=ax(r);this.processor_=Ux(i);const o=t.serverCache,a=t.eventCache,l=s.updateFullNode(j.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(j.EMPTY_NODE,a.getNode(),null),h=new Cr(l,o.isFullyInitialized(),s.filtersNodes()),f=new Cr(u,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=Vu(f,h),this.eventGenerator_=new yx(this.query_)}get query(){return this.query_}}function Kx(n){return n.viewCache_.serverCache.getNode()}function Qx(n){return zl(n.viewCache_)}function Yx(n,e){const t=As(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!ee(e)&&!t.getImmediateChild(Z(e)).isEmpty())?t.getChild(e):null}function gy(n){return n.eventRegistrations_.length===0}function Jx(n,e){n.eventRegistrations_.push(e)}function _y(n,e,t){const r=[];if(t){V(e==null,"A cancel should cancel all event registrations.");const s=n.query._path;n.eventRegistrations_.forEach(i=>{const o=i.createCancelEvent(t,s);o&&r.push(o)})}if(e){let s=[];for(let i=0;i<n.eventRegistrations_.length;++i){const o=n.eventRegistrations_[i];if(!o.matches(e))s.push(o);else if(e.hasAnyCallback()){s=s.concat(n.eventRegistrations_.slice(i+1));break}}n.eventRegistrations_=s}else n.eventRegistrations_=[];return r}function yy(n,e,t,r){e.type===tn.MERGE&&e.source.queryId!==null&&(V(As(n.viewCache_),"We should always have a full cache before handling merges"),V(zl(n.viewCache_),"Missing event cache, even though we have a server cache"));const s=n.viewCache_,i=qx(n.processor_,s,e,t,r);return Bx(n.processor_,i.viewCache),V(i.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=i.viewCache,PT(n,i.changes,i.viewCache.eventCache.getNode(),null)}function Xx(n,e){const t=n.viewCache_.eventCache,r=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(_e,(i,o)=>{r.push(Ci(i,o))}),t.isFullyInitialized()&&r.push(wT(t.getNode())),PT(n,r,t.getNode(),e)}function PT(n,e,t,r){const s=r?[r]:n.eventRegistrations_;return Ix(n.eventGenerator_,e,t,s)}let Kl;class kT{constructor(){this.views=new Map}}function Zx(n){V(!Kl,"__referenceConstructor has already been defined"),Kl=n}function eO(){return V(Kl,"Reference.ts has not been loaded"),Kl}function tO(n){return n.views.size===0}function Np(n,e,t,r){const s=e.source.queryId;if(s!==null){const i=n.views.get(s);return V(i!=null,"SyncTree gave us an op for an invalid query."),yy(i,e,t,r)}else{let i=[];for(const o of n.views.values())i=i.concat(yy(o,e,t,r));return i}}function NT(n,e,t,r,s){const i=e._queryIdentifier,o=n.views.get(i);if(!o){let a=Gl(t,s?r:null),l=!1;a?l=!0:r instanceof j?(a=Cp(t,r),l=!1):(a=j.EMPTY_NODE,l=!1);const u=Vu(new Cr(a,l,!1),new Cr(r,s,!1));return new Hx(e,u)}return o}function nO(n,e,t,r,s,i){const o=NT(n,e,r,s,i);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),Jx(o,t),Xx(o,t)}function rO(n,e,t,r){const s=e._queryIdentifier,i=[];let o=[];const a=Pr(n);if(s==="default")for(const[l,u]of n.views.entries())o=o.concat(_y(u,t,r)),gy(u)&&(n.views.delete(l),u.query._queryParams.loadsAllData()||i.push(u.query));else{const l=n.views.get(s);l&&(o=o.concat(_y(l,t,r)),gy(l)&&(n.views.delete(s),l.query._queryParams.loadsAllData()||i.push(l.query)))}return a&&!Pr(n)&&i.push(new(eO())(e._repo,e._path)),{removed:i,events:o}}function DT(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function Ir(n,e){let t=null;for(const r of n.views.values())t=t||Yx(r,e);return t}function xT(n,e){if(e._queryParams.loadsAllData())return Mu(n);{const r=e._queryIdentifier;return n.views.get(r)}}function OT(n,e){return xT(n,e)!=null}function Pr(n){return Mu(n)!=null}function Mu(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}let Ql;function sO(n){V(!Ql,"__referenceConstructor has already been defined"),Ql=n}function iO(){return V(Ql,"Reference.ts has not been loaded"),Ql}let oO=1;class Iy{constructor(e){this.listenProvider_=e,this.syncPointTree_=new ge(null),this.pendingWriteTree_=Vx(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Dp(n,e,t,r,s){return vx(n.pendingWriteTree_,e,t,r,s),s?io(n,new vs(bp(),e,t)):[]}function aO(n,e,t,r){Ax(n.pendingWriteTree_,e,t,r);const s=ge.fromObject(t);return io(n,new Pi(bp(),e,s))}function fr(n,e,t=!1){const r=bx(n.pendingWriteTree_,e);if(Rx(n.pendingWriteTree_,e)){let i=new ge(null);return r.snap!=null?i=i.set(ae(),!0):et(r.children,o=>{i=i.set(new ue(o),!0)}),io(n,new $l(r.path,i,t))}else return[]}function gc(n,e,t){return io(n,new vs(Rp(),e,t))}function cO(n,e,t){const r=ge.fromObject(t);return io(n,new Pi(Rp(),e,r))}function lO(n,e){return io(n,new Ma(Rp(),e))}function uO(n,e,t){const r=xp(n,t);if(r){const s=Op(r),i=s.path,o=s.queryId,a=Et(i,e),l=new Ma(Sp(o),a);return Vp(n,i,l)}else return[]}function Yl(n,e,t,r,s=!1){const i=e._path,o=n.syncPointTree_.get(i);let a=[];if(o&&(e._queryIdentifier==="default"||OT(o,e))){const l=rO(o,e,t,r);tO(o)&&(n.syncPointTree_=n.syncPointTree_.remove(i));const u=l.removed;if(a=l.events,!s){const h=u.findIndex(m=>m._queryParams.loadsAllData())!==-1,f=n.syncPointTree_.findOnPath(i,(m,_)=>Pr(_));if(h&&!f){const m=n.syncPointTree_.subtree(i);if(!m.isEmpty()){const _=fO(m);for(let A=0;A<_.length;++A){const k=_[A],N=k.query,W=FT(n,k);n.listenProvider_.startListening(da(N),Fa(n,N),W.hashFn,W.onComplete)}}}!f&&u.length>0&&!r&&(h?n.listenProvider_.stopListening(da(e),null):u.forEach(m=>{const _=n.queryToTagMap.get(Uu(m));n.listenProvider_.stopListening(da(m),_)}))}pO(n,u)}return a}function VT(n,e,t,r){const s=xp(n,r);if(s!=null){const i=Op(s),o=i.path,a=i.queryId,l=Et(o,e),u=new vs(Sp(a),l,t);return Vp(n,o,u)}else return[]}function hO(n,e,t,r){const s=xp(n,r);if(s){const i=Op(s),o=i.path,a=i.queryId,l=Et(o,e),u=ge.fromObject(t),h=new Pi(Sp(a),l,u);return Vp(n,o,h)}else return[]}function Jd(n,e,t,r=!1){const s=e._path;let i=null,o=!1;n.syncPointTree_.foreachOnPath(s,(m,_)=>{const A=Et(m,s);i=i||Ir(_,A),o=o||Pr(_)});let a=n.syncPointTree_.get(s);a?(o=o||Pr(a),i=i||Ir(a,ae())):(a=new kT,n.syncPointTree_=n.syncPointTree_.set(s,a));let l;i!=null?l=!0:(l=!1,i=j.EMPTY_NODE,n.syncPointTree_.subtree(s).foreachChild((_,A)=>{const k=Ir(A,ae());k&&(i=i.updateImmediateChild(_,k))}));const u=OT(a,e);if(!u&&!e._queryParams.loadsAllData()){const m=Uu(e);V(!n.queryToTagMap.has(m),"View does not exist, but we have a tag");const _=mO();n.queryToTagMap.set(m,_),n.tagToQueryMap.set(_,m)}const h=Lu(n.pendingWriteTree_,s);let f=nO(a,e,t,h,i,l);if(!u&&!o&&!r){const m=xT(a,e);f=f.concat(gO(n,e,m))}return f}function Fu(n,e,t){const s=n.pendingWriteTree_,i=n.syncPointTree_.findOnPath(e,(o,a)=>{const l=Et(o,e),u=Ir(a,l);if(u)return u});return AT(s,e,i,t,!0)}function dO(n,e){const t=e._path;let r=null;n.syncPointTree_.foreachOnPath(t,(u,h)=>{const f=Et(u,t);r=r||Ir(h,f)});let s=n.syncPointTree_.get(t);s?r=r||Ir(s,ae()):(s=new kT,n.syncPointTree_=n.syncPointTree_.set(t,s));const i=r!=null,o=i?new Cr(r,!0,!1):null,a=Lu(n.pendingWriteTree_,e._path),l=NT(s,e,a,i?o.getNode():j.EMPTY_NODE,i);return Qx(l)}function io(n,e){return LT(e,n.syncPointTree_,null,Lu(n.pendingWriteTree_,ae()))}function LT(n,e,t,r){if(ee(n.path))return MT(n,e,t,r);{const s=e.get(ae());t==null&&s!=null&&(t=Ir(s,ae()));let i=[];const o=Z(n.path),a=n.operationForChild(o),l=e.children.get(o);if(l&&a){const u=t?t.getImmediateChild(o):null,h=bT(r,o);i=i.concat(LT(a,l,u,h))}return s&&(i=i.concat(Np(s,n,r,t))),i}}function MT(n,e,t,r){const s=e.get(ae());t==null&&s!=null&&(t=Ir(s,ae()));let i=[];return e.children.inorderTraversal((o,a)=>{const l=t?t.getImmediateChild(o):null,u=bT(r,o),h=n.operationForChild(o);h&&(i=i.concat(MT(h,a,l,u)))}),s&&(i=i.concat(Np(s,n,r,t))),i}function FT(n,e){const t=e.query,r=Fa(n,t);return{hashFn:()=>(Kx(e)||j.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return r?uO(n,t._path,r):lO(n,t._path);{const i=a0(s,t);return Yl(n,t,null,i)}}}}function Fa(n,e){const t=Uu(e);return n.queryToTagMap.get(t)}function Uu(n){return n._path.toString()+"$"+n._queryIdentifier}function xp(n,e){return n.tagToQueryMap.get(e)}function Op(n){const e=n.indexOf("$");return V(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new ue(n.substr(0,e))}}function Vp(n,e,t){const r=n.syncPointTree_.get(e);V(r,"Missing sync point for query tag that we're tracking");const s=Lu(n.pendingWriteTree_,e);return Np(r,t,s,null)}function fO(n){return n.fold((e,t,r)=>{if(t&&Pr(t))return[Mu(t)];{let s=[];return t&&(s=DT(t)),et(r,(i,o)=>{s=s.concat(o)}),s}})}function da(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(iO())(n._repo,n._path):n}function pO(n,e){for(let t=0;t<e.length;++t){const r=e[t];if(!r._queryParams.loadsAllData()){const s=Uu(r),i=n.queryToTagMap.get(s);n.queryToTagMap.delete(s),n.tagToQueryMap.delete(i)}}}function mO(){return oO++}function gO(n,e,t){const r=e._path,s=Fa(n,e),i=FT(n,t),o=n.listenProvider_.startListening(da(e),s,i.hashFn,i.onComplete),a=n.syncPointTree_.subtree(r);if(s)V(!Pr(a.value),"If we're adding a query, it shouldn't be shadowed");else{const l=a.fold((u,h,f)=>{if(!ee(u)&&h&&Pr(h))return[Mu(h).query];{let m=[];return h&&(m=m.concat(DT(h).map(_=>_.query))),et(f,(_,A)=>{m=m.concat(A)}),m}});for(let u=0;u<l.length;++u){const h=l[u];n.listenProvider_.stopListening(da(h),Fa(n,h))}}return o}class Lp{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new Lp(t)}node(){return this.node_}}class Mp{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=Ae(this.path_,e);return new Mp(this.syncTree_,t)}node(){return Fu(this.syncTree_,this.path_)}}const _O=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},wy=function(n,e,t){if(!n||typeof n!="object")return n;if(V(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return yO(n[".sv"],e,t);if(typeof n[".sv"]=="object")return IO(n[".sv"],e);V(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},yO=function(n,e,t){if(n==="timestamp")return t.timestamp;V(!1,"Unexpected server value: "+n)},IO=function(n,e,t){n.hasOwnProperty("increment")||V(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const r=n.increment;typeof r!="number"&&V(!1,"Unexpected increment value: "+r);const s=e.node();if(V(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return r;const o=s.getValue();return typeof o!="number"?r:o+r},UT=function(n,e,t,r){return Up(e,new Mp(t,n),r)},Fp=function(n,e,t){return Up(n,new Lp(e),t)};function Up(n,e,t){const r=n.getPriority().val(),s=wy(r,e.getImmediateChild(".priority"),t);let i;if(n.isLeafNode()){const o=n,a=wy(o.getValue(),e,t);return a!==o.getValue()||s!==o.getPriority().val()?new He(a,Se(s)):n}else{const o=n;return i=o,s!==o.getPriority().val()&&(i=i.updatePriority(new He(s))),o.forEachChild(_e,(a,l)=>{const u=Up(l,e.getImmediateChild(a),t);u!==l&&(i=i.updateImmediateChild(a,u))}),i}}class Bp{constructor(e="",t=null,r={children:{},childCount:0}){this.name=e,this.parent=t,this.node=r}}function Bu(n,e){let t=e instanceof ue?e:new ue(e),r=n,s=Z(t);for(;s!==null;){const i=Is(r.node.children,s)||{children:{},childCount:0};r=new Bp(s,r,i),t=pe(t),s=Z(t)}return r}function $s(n){return n.node.value}function qp(n,e){n.node.value=e,Xd(n)}function BT(n){return n.node.childCount>0}function wO(n){return $s(n)===void 0&&!BT(n)}function qu(n,e){et(n.node.children,(t,r)=>{e(new Bp(t,n,r))})}function qT(n,e,t,r){t&&e(n),qu(n,s=>{qT(s,e,!0)})}function EO(n,e,t){let r=n.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function _c(n){return new ue(n.parent===null?n.name:_c(n.parent)+"/"+n.name)}function Xd(n){n.parent!==null&&TO(n.parent,n.name,n)}function TO(n,e,t){const r=wO(t),s=Ut(n.node.children,e);r&&s?(delete n.node.children[e],n.node.childCount--,Xd(n)):!r&&!s&&(n.node.children[e]=t.node,n.node.childCount++,Xd(n))}const vO=/[\[\].#$\/\u0000-\u001F\u007F]/,AO=/[\[\].#$\u0000-\u001F\u007F]/,dd=10*1024*1024,Wu=function(n){return typeof n=="string"&&n.length!==0&&!vO.test(n)},WT=function(n){return typeof n=="string"&&n.length!==0&&!AO.test(n)},bO=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),WT(n)},Ua=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!Nu(n)||n&&typeof n=="object"&&Ut(n,".sv")},Pn=function(n,e,t,r){r&&e===void 0||yc(Nt(n,"value"),e,t)},yc=function(n,e,t){const r=t instanceof ue?new q0(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+es(r));if(typeof e=="function")throw new Error(n+"contains a function "+es(r)+" with contents = "+e.toString());if(Nu(e))throw new Error(n+"contains "+e.toString()+" "+es(r));if(typeof e=="string"&&e.length>dd/3&&Iu(e)>dd)throw new Error(n+"contains a string greater than "+dd+" utf8 bytes "+es(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,i=!1;if(et(e,(o,a)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(i=!0,!Wu(o)))throw new Error(n+" contains an invalid key ("+o+") "+es(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);W0(r,o),yc(n,a,r),$0(r)}),s&&i)throw new Error(n+' contains ".value" child '+es(r)+" in addition to actual children.")}},RO=function(n,e){let t,r;for(t=0;t<e.length;t++){r=e[t];const i=xa(r);for(let o=0;o<i.length;o++)if(!(i[o]===".priority"&&o===i.length-1)){if(!Wu(i[o]))throw new Error(n+"contains an invalid key ("+i[o]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(B0);let s=null;for(t=0;t<e.length;t++){if(r=e[t],s!==null&&$t(s,r))throw new Error(n+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString());s=r}},$T=function(n,e,t,r){const s=Nt(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(s+" must be an object containing the children to replace.");const i=[];et(e,(o,a)=>{const l=new ue(o);if(yc(s,a,Ae(t,l)),yp(l)===".priority"&&!Ua(a))throw new Error(s+"contains an invalid value for '"+l.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");i.push(l)}),RO(s,i)},Wp=function(n,e,t){if(Nu(e))throw new Error(Nt(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Ua(e))throw new Error(Nt(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")},Ic=function(n,e,t,r){if(t!==void 0&&!Wu(t))throw new Error(Nt(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},Ba=function(n,e,t,r){if(!WT(t))throw new Error(Nt(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},SO=function(n,e,t,r){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Ba(n,e,t)},zt=function(n,e){if(Z(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},zT=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Wu(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!bO(t))throw new Error(Nt(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};class CO{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function $u(n,e){let t=null;for(let r=0;r<e.length;r++){const s=e[r],i=s.getPath();t!==null&&!Ip(i,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:i}),t.events.push(s)}t&&n.eventLists_.push(t)}function GT(n,e,t){$u(n,t),jT(n,r=>Ip(r,e))}function Bt(n,e,t){$u(n,t),jT(n,r=>$t(r,e)||$t(e,r))}function jT(n,e){n.recursionDepth_++;let t=!0;for(let r=0;r<n.eventLists_.length;r++){const s=n.eventLists_[r];if(s){const i=s.path;e(i)?(PO(n.eventLists_[r]),n.eventLists_[r]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function PO(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const r=t.getEventRunner();gs&&Je("event: "+t.toString()),ro(r)}}}const HT="repo_interrupt",kO=25;class NO{constructor(e,t,r,s){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=r,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new CO,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Wl(),this.transactionQueueTree_=new Bp,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function DO(n,e,t){if(n.stats_=gp(n.repoInfo_),n.forceRestClient_||h0())n.server_=new ql(n.repoInfo_,(r,s,i,o)=>{Ey(n,r,s,i,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>Ty(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{We(t)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}n.persistentConnection_=new Fn(n.repoInfo_,e,(r,s,i,o)=>{Ey(n,r,s,i,o)},r=>{Ty(n,r)},r=>{xO(n,r)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(r=>{n.server_.refreshAuthToken(r)}),n.appCheckProvider_.addTokenChangeListener(r=>{n.server_.refreshAppCheckToken(r.token)}),n.statsReporter_=g0(n.repoInfo_,()=>new _x(n.stats_,n.server_)),n.infoData_=new dx,n.infoSyncTree_=new Iy({startListening:(r,s,i,o)=>{let a=[];const l=n.infoData_.getNode(r._path);return l.isEmpty()||(a=gc(n.infoSyncTree_,r._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),$p(n,"connected",!1),n.serverSyncTree_=new Iy({startListening:(r,s,i,o)=>(n.server_.listen(r,i,s,(a,l)=>{const u=o(a,l);Bt(n.eventQueue_,r._path,u)}),[]),stopListening:(r,s)=>{n.server_.unlisten(r,s)}})}function KT(n){const t=n.infoData_.getNode(new ue(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function wc(n){return _O({timestamp:KT(n)})}function Ey(n,e,t,r,s){n.dataUpdateCount++;const i=new ue(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(s)if(r){const l=kl(t,u=>Se(u));o=hO(n.serverSyncTree_,i,l,s)}else{const l=Se(t);o=VT(n.serverSyncTree_,i,l,s)}else if(r){const l=kl(t,u=>Se(u));o=cO(n.serverSyncTree_,i,l)}else{const l=Se(t);o=gc(n.serverSyncTree_,i,l)}let a=i;o.length>0&&(a=Ni(n,i)),Bt(n.eventQueue_,a,o)}function Ty(n,e){$p(n,"connected",e),e===!1&&LO(n)}function xO(n,e){et(e,(t,r)=>{$p(n,t,r)})}function $p(n,e,t){const r=new ue("/.info/"+e),s=Se(t);n.infoData_.updateSnapshot(r,s);const i=gc(n.infoSyncTree_,r,s);Bt(n.eventQueue_,r,i)}function zu(n){return n.nextWriteId_++}function OO(n,e,t){const r=dO(n.serverSyncTree_,e);return r!=null?Promise.resolve(r):n.server_.get(e).then(s=>{const i=Se(s).withIndex(e._queryParams.getIndex());Jd(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=gc(n.serverSyncTree_,e._path,i);else{const a=Fa(n.serverSyncTree_,e);o=VT(n.serverSyncTree_,e._path,i,a)}return Bt(n.eventQueue_,e._path,o),Yl(n.serverSyncTree_,e,t,null,!0),i},s=>(oo(n,"get for query "+We(e)+" failed: "+s),Promise.reject(new Error(s))))}function zp(n,e,t,r,s){oo(n,"set",{path:e.toString(),value:t,priority:r});const i=wc(n),o=Se(t,r),a=Fu(n.serverSyncTree_,e),l=Fp(o,a,i),u=zu(n),h=Dp(n.serverSyncTree_,e,l,u,!0);$u(n.eventQueue_,h),n.server_.put(e.toString(),o.val(!0),(m,_)=>{const A=m==="ok";A||ht("set at "+e+" failed: "+m);const k=fr(n.serverSyncTree_,u,!A);Bt(n.eventQueue_,e,k),kr(n,s,m,_)});const f=jp(n,e);Ni(n,f),Bt(n.eventQueue_,f,[])}function VO(n,e,t,r){oo(n,"update",{path:e.toString(),value:t});let s=!0;const i=wc(n),o={};if(et(t,(a,l)=>{s=!1,o[a]=UT(Ae(e,a),Se(l),n.serverSyncTree_,i)}),s)Je("update() called with empty data.  Don't do anything."),kr(n,r,"ok",void 0);else{const a=zu(n),l=aO(n.serverSyncTree_,e,o,a);$u(n.eventQueue_,l),n.server_.merge(e.toString(),t,(u,h)=>{const f=u==="ok";f||ht("update at "+e+" failed: "+u);const m=fr(n.serverSyncTree_,a,!f),_=m.length>0?Ni(n,e):e;Bt(n.eventQueue_,_,m),kr(n,r,u,h)}),et(t,u=>{const h=jp(n,Ae(e,u));Ni(n,h)}),Bt(n.eventQueue_,e,[])}}function LO(n){oo(n,"onDisconnectEvents");const e=wc(n),t=Wl();Gd(n.onDisconnect_,ae(),(s,i)=>{const o=UT(s,i,n.serverSyncTree_,e);so(t,s,o)});let r=[];Gd(t,ae(),(s,i)=>{r=r.concat(gc(n.serverSyncTree_,s,i));const o=jp(n,s);Ni(n,o)}),n.onDisconnect_=Wl(),Bt(n.eventQueue_,ae(),r)}function MO(n,e,t){n.server_.onDisconnectCancel(e.toString(),(r,s)=>{r==="ok"&&zd(n.onDisconnect_,e),kr(n,t,r,s)})}function vy(n,e,t,r){const s=Se(t);n.server_.onDisconnectPut(e.toString(),s.val(!0),(i,o)=>{i==="ok"&&so(n.onDisconnect_,e,s),kr(n,r,i,o)})}function FO(n,e,t,r,s){const i=Se(t,r);n.server_.onDisconnectPut(e.toString(),i.val(!0),(o,a)=>{o==="ok"&&so(n.onDisconnect_,e,i),kr(n,s,o,a)})}function UO(n,e,t,r){if(Pl(t)){Je("onDisconnect().update() called with empty data.  Don't do anything."),kr(n,r,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(s,i)=>{s==="ok"&&et(t,(o,a)=>{const l=Se(a);so(n.onDisconnect_,Ae(e,o),l)}),kr(n,r,s,i)})}function BO(n,e,t){let r;Z(e._path)===".info"?r=Jd(n.infoSyncTree_,e,t):r=Jd(n.serverSyncTree_,e,t),GT(n.eventQueue_,e._path,r)}function Zd(n,e,t){let r;Z(e._path)===".info"?r=Yl(n.infoSyncTree_,e,t):r=Yl(n.serverSyncTree_,e,t),GT(n.eventQueue_,e._path,r)}function QT(n){n.persistentConnection_&&n.persistentConnection_.interrupt(HT)}function qO(n){n.persistentConnection_&&n.persistentConnection_.resume(HT)}function oo(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),Je(t,...e)}function kr(n,e,t,r){e&&ro(()=>{if(t==="ok")e(null);else{const s=(t||"error").toUpperCase();let i=s;r&&(i+=": "+r);const o=new Error(i);o.code=s,e(o)}})}function WO(n,e,t,r,s,i){oo(n,"transaction on "+e);const o={path:e,update:t,onComplete:r,status:null,order:zE(),applyLocally:i,retryCount:0,unwatcher:s,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=Gp(n,e,void 0);o.currentInputSnapshot=a;const l=o.update(a.val());if(l===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{yc("transaction failed: Data returned ",l,o.path),o.status=0;const u=Bu(n.transactionQueueTree_,e),h=$s(u)||[];h.push(o),qp(u,h);let f;typeof l=="object"&&l!==null&&Ut(l,".priority")?(f=Is(l,".priority"),V(Ua(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):f=(Fu(n.serverSyncTree_,e)||j.EMPTY_NODE).getPriority().val();const m=wc(n),_=Se(l,f),A=Fp(_,a,m);o.currentOutputSnapshotRaw=_,o.currentOutputSnapshotResolved=A,o.currentWriteId=zu(n);const k=Dp(n.serverSyncTree_,e,A,o.currentWriteId,o.applyLocally);Bt(n.eventQueue_,e,k),Gu(n,n.transactionQueueTree_)}}function Gp(n,e,t){return Fu(n.serverSyncTree_,e,t)||j.EMPTY_NODE}function Gu(n,e=n.transactionQueueTree_){if(e||ju(n,e),$s(e)){const t=JT(n,e);V(t.length>0,"Sending zero length transaction queue"),t.every(s=>s.status===0)&&$O(n,_c(e),t)}else BT(e)&&qu(e,t=>{Gu(n,t)})}function $O(n,e,t){const r=t.map(u=>u.currentWriteId),s=Gp(n,e,r);let i=s;const o=s.hash();for(let u=0;u<t.length;u++){const h=t[u];V(h.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;const f=Et(e,h.path);i=i.updateChild(f,h.currentOutputSnapshotRaw)}const a=i.val(!0),l=e;n.server_.put(l.toString(),a,u=>{oo(n,"transaction put response",{path:l.toString(),status:u});let h=[];if(u==="ok"){const f=[];for(let m=0;m<t.length;m++)t[m].status=2,h=h.concat(fr(n.serverSyncTree_,t[m].currentWriteId)),t[m].onComplete&&f.push(()=>t[m].onComplete(null,!0,t[m].currentOutputSnapshotResolved)),t[m].unwatcher();ju(n,Bu(n.transactionQueueTree_,e)),Gu(n,n.transactionQueueTree_),Bt(n.eventQueue_,e,h);for(let m=0;m<f.length;m++)ro(f[m])}else{if(u==="datastale")for(let f=0;f<t.length;f++)t[f].status===3?t[f].status=4:t[f].status=0;else{ht("transaction at "+l.toString()+" failed: "+u);for(let f=0;f<t.length;f++)t[f].status=4,t[f].abortReason=u}Ni(n,e)}},o)}function Ni(n,e){const t=YT(n,e),r=_c(t),s=JT(n,t);return zO(n,s,r),r}function zO(n,e,t){if(e.length===0)return;const r=[];let s=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const l=e[a],u=Et(t,l.path);let h=!1,f;if(V(u!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)h=!0,f=l.abortReason,s=s.concat(fr(n.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=kO)h=!0,f="maxretry",s=s.concat(fr(n.serverSyncTree_,l.currentWriteId,!0));else{const m=Gp(n,l.path,o);l.currentInputSnapshot=m;const _=e[a].update(m.val());if(_!==void 0){yc("transaction failed: Data returned ",_,l.path);let A=Se(_);typeof _=="object"&&_!=null&&Ut(_,".priority")||(A=A.updatePriority(m.getPriority()));const N=l.currentWriteId,W=wc(n),z=Fp(A,m,W);l.currentOutputSnapshotRaw=A,l.currentOutputSnapshotResolved=z,l.currentWriteId=zu(n),o.splice(o.indexOf(N),1),s=s.concat(Dp(n.serverSyncTree_,l.path,z,l.currentWriteId,l.applyLocally)),s=s.concat(fr(n.serverSyncTree_,N,!0))}else h=!0,f="nodata",s=s.concat(fr(n.serverSyncTree_,l.currentWriteId,!0))}Bt(n.eventQueue_,t,s),s=[],h&&(e[a].status=2,(function(m){setTimeout(m,Math.floor(0))})(e[a].unwatcher),e[a].onComplete&&(f==="nodata"?r.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):r.push(()=>e[a].onComplete(new Error(f),!1,null))))}ju(n,n.transactionQueueTree_);for(let a=0;a<r.length;a++)ro(r[a]);Gu(n,n.transactionQueueTree_)}function YT(n,e){let t,r=n.transactionQueueTree_;for(t=Z(e);t!==null&&$s(r)===void 0;)r=Bu(r,t),e=pe(e),t=Z(e);return r}function JT(n,e){const t=[];return XT(n,e,t),t.sort((r,s)=>r.order-s.order),t}function XT(n,e,t){const r=$s(e);if(r)for(let s=0;s<r.length;s++)t.push(r[s]);qu(e,s=>{XT(n,s,t)})}function ju(n,e){const t=$s(e);if(t){let r=0;for(let s=0;s<t.length;s++)t[s].status!==2&&(t[r]=t[s],r++);t.length=r,qp(e,t.length>0?t:void 0)}qu(e,r=>{ju(n,r)})}function jp(n,e){const t=_c(YT(n,e)),r=Bu(n.transactionQueueTree_,e);return EO(r,s=>{fd(n,s)}),fd(n,r),qT(r,s=>{fd(n,s)}),t}function fd(n,e){const t=$s(e);if(t){const r=[];let s=[],i=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(V(i===o-1,"All SENT items should be at beginning of queue."),i=o,t[o].status=3,t[o].abortReason="set"):(V(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),s=s.concat(fr(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&r.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));i===-1?qp(e,void 0):t.length=i+1,Bt(n.eventQueue_,_c(e),s);for(let o=0;o<r.length;o++)ro(r[o])}}function GO(n){let e="";const t=n.split("/");for(let r=0;r<t.length;r++)if(t[r].length>0){let s=t[r];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function jO(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const r=t.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):ht(`Invalid query segment '${t}' in query '${n}'`)}return e}const ef=function(n,e){const t=HO(n),r=t.namespace;t.domain==="firebase.com"&&Cn(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&t.domain!=="localhost"&&Cn("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||n0();const s=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new sT(t.host,t.secure,r,s,e,"",r!==t.subdomain),path:new ue(t.pathString)}},HO=function(n){let e="",t="",r="",s="",i="",o=!0,a="https",l=443;if(typeof n=="string"){let u=n.indexOf("//");u>=0&&(a=n.substring(0,u-1),n=n.substring(u+2));let h=n.indexOf("/");h===-1&&(h=n.length);let f=n.indexOf("?");f===-1&&(f=n.length),e=n.substring(0,Math.min(h,f)),h<f&&(s=GO(n.substring(h,f)));const m=jO(n.substring(Math.min(n.length,f)));u=e.indexOf(":"),u>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(u+1),10)):u=e.length;const _=e.slice(0,u);if(_.toLowerCase()==="localhost")t="localhost";else if(_.split(".").length<=2)t=_;else{const A=e.indexOf(".");r=e.substring(0,A).toLowerCase(),t=e.substring(A+1),i=r}"ns"in m&&(i=m.ns)}return{host:e,port:l,domain:t,subdomain:r,secure:o,scheme:a,pathString:s,namespace:i}};const Ay="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",KO=(function(){let n=0;const e=[];return function(t){const r=t===n;n=t;let s;const i=new Array(8);for(s=7;s>=0;s--)i[s]=Ay.charAt(t%64),t=Math.floor(t/64);V(t===0,"Cannot push at time == 0");let o=i.join("");if(r){for(s=11;s>=0&&e[s]===63;s--)e[s]=0;e[s]++}else for(s=0;s<12;s++)e[s]=Math.floor(Math.random()*64);for(s=0;s<12;s++)o+=Ay.charAt(e[s]);return V(o.length===20,"nextPushId: Length should be 20."),o}})();class ZT{constructor(e,t,r,s){this.eventType=e,this.eventRegistration=t,this.snapshot=r,this.prevName=s}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+We(this.snapshot.exportVal())}}class ev{constructor(e,t,r){this.eventRegistration=e,this.error=t,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class Hp{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return V(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}let QO=class{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new Rt;return MO(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){zt("OnDisconnect.remove",this._path);const e=new Rt;return vy(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){zt("OnDisconnect.set",this._path),Pn("OnDisconnect.set",e,this._path,!1);const t=new Rt;return vy(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){zt("OnDisconnect.setWithPriority",this._path),Pn("OnDisconnect.setWithPriority",e,this._path,!1),Wp("OnDisconnect.setWithPriority",t);const r=new Rt;return FO(this._repo,this._path,e,t,r.wrapCallback(()=>{})),r.promise}update(e){zt("OnDisconnect.update",this._path),$T("OnDisconnect.update",e,this._path);const t=new Rt;return UO(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}};class Dt{constructor(e,t,r,s){this._repo=e,this._path=t,this._queryParams=r,this._orderByCalled=s}get key(){return ee(this._path)?null:yp(this._path)}get ref(){return new Jt(this._repo,this._path)}get _queryIdentifier(){const e=ly(this._queryParams),t=pp(e);return t==="{}"?"default":t}get _queryObject(){return ly(this._queryParams)}isEqual(e){if(e=U(e),!(e instanceof Dt))return!1;const t=this._repo===e._repo,r=Ip(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return t&&r&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+U0(this._path)}}function Hu(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function Ur(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===vn){const r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",s="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==Rr)throw new Error(r);if(typeof e!="string")throw new Error(s)}if(n.hasEnd()){if(n.getIndexEndName()!==$n)throw new Error(r);if(typeof t!="string")throw new Error(s)}}else if(n.getIndex()===_e){if(e!=null&&!Ua(e)||t!=null&&!Ua(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(V(n.getIndex()instanceof Tp||n.getIndex()===vp,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function Ku(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class Jt extends Dt{constructor(e,t){super(e,t,new xu,!1)}get parent(){const e=fT(this._path);return e===null?null:new Jt(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}let Qu=class tf{constructor(e,t,r){this._node=e,this.ref=t,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new ue(e),r=bs(this.ref,e);return new tf(this._node.getChild(t),r,_e)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,s)=>e(new tf(s,bs(this.ref,r),_e)))}hasChild(e){const t=new ue(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function tv(n,e){return n=U(n),n._checkNotDeleted("ref"),e!==void 0?bs(n._root,e):n._root}function by(n,e){n=U(n),n._checkNotDeleted("refFromURL");const t=ef(e,n._repo.repoInfo_.nodeAdmin);zT("refFromURL",t);const r=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&r.host!==n._repo.repoInfo_.host&&Cn("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+n._repo.repoInfo_.host+")"),tv(n,t.path.toString())}function bs(n,e){return n=U(n),Z(n._path)===null?SO("child","path",e):Ba("child","path",e),new Jt(n._repo,Ae(n._path,e))}function YO(n,e){n=U(n),zt("push",n._path),Pn("push",e,n._path,!0);const t=KT(n._repo),r=KO(t),s=bs(n,r),i=bs(n,r);let o;return e!=null?o=Kp(i,e).then(()=>i):o=Promise.resolve(i),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}function JO(n){return zt("remove",n._path),Kp(n,null)}function Kp(n,e){n=U(n),zt("set",n._path),Pn("set",e,n._path,!1);const t=new Rt;return zp(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function XO(n,e){n=U(n),zt("setPriority",n._path),Wp("setPriority",e);const t=new Rt;return zp(n._repo,Ae(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function ZO(n,e,t){if(zt("setWithPriority",n._path),Pn("setWithPriority",e,n._path,!1),Wp("setWithPriority",t),n.key===".length"||n.key===".keys")throw"setWithPriority failed: "+n.key+" is a read-only object.";const r=new Rt;return zp(n._repo,n._path,e,t,r.wrapCallback(()=>{})),r.promise}function eV(n,e){$T("update",e,n._path);const t=new Rt;return VO(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function tV(n){n=U(n);const e=new Hp(()=>{}),t=new Ec(e);return OO(n._repo,n,t).then(r=>new Qu(r,new Jt(n._repo,n._path),n._queryParams.getIndex()))}class Ec{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){const r=t._queryParams.getIndex();return new ZT("value",this,new Qu(e.snapshotNode,new Jt(t._repo,t._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new ev(this,e,t):null}matches(e){return e instanceof Ec?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}class Yu{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new ev(this,e,t):null}createEvent(e,t){V(e.childName!=null,"Child events should have a childName.");const r=bs(new Jt(t._repo,t._path),e.childName),s=t._queryParams.getIndex();return new ZT(e.type,this,new Qu(e.snapshotNode,r,s),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof Yu?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}}function Tc(n,e,t,r,s){let i;if(typeof r=="object"&&(i=void 0,s=r),typeof r=="function"&&(i=r),s&&s.onlyOnce){const l=t,u=(h,f)=>{Zd(n._repo,n,a),l(h,f)};u.userCallback=t.userCallback,u.context=t.context,t=u}const o=new Hp(t,i||void 0),a=e==="value"?new Ec(o):new Yu(e,o);return BO(n._repo,n,a),()=>Zd(n._repo,n,a)}function nf(n,e,t,r){return Tc(n,"value",e,t,r)}function Ry(n,e,t,r){return Tc(n,"child_added",e,t,r)}function Sy(n,e,t,r){return Tc(n,"child_changed",e,t,r)}function Cy(n,e,t,r){return Tc(n,"child_moved",e,t,r)}function Py(n,e,t,r){return Tc(n,"child_removed",e,t,r)}function ky(n,e,t){let r=null;const s=t?new Hp(t):null;e==="value"?r=new Ec(s):e&&(r=new Yu(e,s)),Zd(n._repo,n,r)}let ln=class{},nv=class extends ln{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){Pn("endAt",this._value,e._path,!0);const t=$d(e._queryParams,this._value,this._key);if(Ku(t),Ur(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Dt(e._repo,e._path,t,e._orderByCalled)}};function nV(n,e){return Ic("endAt","key",e),new nv(n,e)}class rV extends ln{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){Pn("endBefore",this._value,e._path,!1);const t=hx(e._queryParams,this._value,this._key);if(Ku(t),Ur(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Dt(e._repo,e._path,t,e._orderByCalled)}}function sV(n,e){return Ic("endBefore","key",e),new rV(n,e)}let rv=class extends ln{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){Pn("startAt",this._value,e._path,!0);const t=Wd(e._queryParams,this._value,this._key);if(Ku(t),Ur(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new Dt(e._repo,e._path,t,e._orderByCalled)}};function iV(n=null,e){return Ic("startAt","key",e),new rv(n,e)}class oV extends ln{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){Pn("startAfter",this._value,e._path,!1);const t=ux(e._queryParams,this._value,this._key);if(Ku(t),Ur(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new Dt(e._repo,e._path,t,e._orderByCalled)}}function aV(n,e){return Ic("startAfter","key",e),new oV(n,e)}class cV extends ln{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new Dt(e._repo,e._path,cx(e._queryParams,this._limit),e._orderByCalled)}}function lV(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new cV(n)}class uV extends ln{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new Dt(e._repo,e._path,lx(e._queryParams,this._limit),e._orderByCalled)}}function hV(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new uV(n)}class dV extends ln{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){Hu(e,"orderByChild");const t=new ue(this._path);if(ee(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");const r=new Tp(t),s=Ou(e._queryParams,r);return Ur(s),new Dt(e._repo,e._path,s,!0)}}function fV(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return Ba("orderByChild","path",n),new dV(n)}class pV extends ln{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){Hu(e,"orderByKey");const t=Ou(e._queryParams,vn);return Ur(t),new Dt(e._repo,e._path,t,!0)}}function mV(){return new pV}class gV extends ln{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){Hu(e,"orderByPriority");const t=Ou(e._queryParams,_e);return Ur(t),new Dt(e._repo,e._path,t,!0)}}function _V(){return new gV}class yV extends ln{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){Hu(e,"orderByValue");const t=Ou(e._queryParams,vp);return Ur(t),new Dt(e._repo,e._path,t,!0)}}function IV(){return new yV}class wV extends ln{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(Pn("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new nv(this._value,this._key)._apply(new rv(this._value,this._key)._apply(e))}}function EV(n,e){return Ic("equalTo","key",e),new wV(n,e)}function Xt(n,...e){let t=U(n);for(const r of e)t=r._apply(t);return t}Zx(Jt);sO(Jt);const TV="FIREBASE_DATABASE_EMULATOR_HOST",rf={};let vV=!1;function AV(n,e,t,r){const s=e.lastIndexOf(":"),i=e.substring(0,s),o=Yt(i);n.repoInfo_=new sT(e,o,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0,t),r&&(n.authTokenProvider_=r)}function sv(n,e,t,r,s){let i=r||n.options.databaseURL;i===void 0&&(n.options.projectId||Cn("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Je("Using default host for project ",n.options.projectId),i=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=ef(i,s),a=o.repoInfo,l,u;typeof process<"u"&&G_&&(u=G_[TV]),u?(l=!0,i=`http://${u}?ns=${a.namespace}`,o=ef(i,s),a=o.repoInfo):l=!o.repoInfo.secure;const h=s&&l?new yi(yi.OWNER):new f0(n.name,n.options,e);zT("Invalid Firebase Database URL",o),ee(o.path)||Cn("Database URL must point to the root of a Firebase Database (not including a child path).");const f=RV(a,n,h,new d0(n,t));return new SV(f,n)}function bV(n,e){const t=rf[e];(!t||t[n.key]!==n)&&Cn(`Database ${e}(${n.repoInfo_}) has already been deleted.`),QT(n),delete t[n.key]}function RV(n,e,t,r){let s=rf[e.name];s||(s={},rf[e.name]=s);let i=s[n.toURLString()];return i&&Cn("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new NO(n,vV,t,r),s[n.toURLString()]=i,i}let SV=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(DO(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Jt(this._repo,ae())),this._rootInternal}_delete(){return this._rootInternal!==null&&(bV(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Cn("Cannot call "+e+" on a deleted database.")}};function iv(){Si.IS_TRANSPORT_INITIALIZED&&ht("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function CV(){iv(),dr.forceDisallow()}function PV(){iv(),Wt.forceDisallow(),dr.forceAllow()}function kV(n,e,t,r={}){n=U(n),n._checkNotDeleted("useEmulator");const s=`${e}:${t}`,i=n._repoInternal;if(n._instanceStarted){if(s===n._repoInternal.repoInfo_.host&&Bn(r,i.repoInfo_.emulatorOptions))return;Cn("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&Cn('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new yi(yi.OWNER);else if(r.mockUserToken){const a=typeof r.mockUserToken=="string"?r.mockUserToken:Bf(r.mockUserToken,n.app.options.projectId);o=new yi(a)}Yt(e)&&(sc(e),ic("Database",!0)),AV(i,s,r,o)}function NV(n){n=U(n),n._checkNotDeleted("goOffline"),QT(n._repo)}function DV(n){n=U(n),n._checkNotDeleted("goOnline"),qO(n._repo)}function xV(n,e){jE(n,e)}function OV(n){WE(Dn),an(new Ze("database",(e,{instanceIdentifier:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return sv(r,s,i,t)},"PUBLIC").setMultipleInstances(!0)),rt(j_,H_,n),rt(j_,H_,"esm2020")}const VV={".sv":"timestamp"};function LV(){return VV}function MV(n){return{".sv":{increment:n}}}let FV=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}};function UV(n,e,t){if(n=U(n),zt("Reference.transaction",n._path),n.key===".length"||n.key===".keys")throw"Reference.transaction failed: "+n.key+" is a read-only object.";const r=t?.applyLocally??!0,s=new Rt,i=(a,l,u)=>{let h=null;a?s.reject(a):(h=new Qu(u,new Jt(n._repo,n._path),_e),s.resolve(new FV(l,h)))},o=nf(n,()=>{});return WO(n._repo,n._path,e,i,o,r),s.promise}Fn.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};Fn.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};OV();const BV="@firebase/database-compat",qV="2.1.0";const WV=new Zi("@firebase/database-compat"),ov=function(n){const e="FIREBASE WARNING: "+n;WV.warn(e)};const $V=function(n,e,t,r){if(t!==void 0&&typeof t!="boolean")throw new Error(Nt(n,e)+"must be a boolean.")},zV=function(n,e,t){if(e!==void 0)switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Nt(n,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}};class GV{constructor(e){this._delegate=e}cancel(e){H("OnDisconnect.cancel",0,1,arguments.length),Qe("OnDisconnect.cancel","onComplete",e,!0);const t=this._delegate.cancel();return e&&t.then(()=>e(null),r=>e(r)),t}remove(e){H("OnDisconnect.remove",0,1,arguments.length),Qe("OnDisconnect.remove","onComplete",e,!0);const t=this._delegate.remove();return e&&t.then(()=>e(null),r=>e(r)),t}set(e,t){H("OnDisconnect.set",1,2,arguments.length),Qe("OnDisconnect.set","onComplete",t,!0);const r=this._delegate.set(e);return t&&r.then(()=>t(null),s=>t(s)),r}setWithPriority(e,t,r){H("OnDisconnect.setWithPriority",2,3,arguments.length),Qe("OnDisconnect.setWithPriority","onComplete",r,!0);const s=this._delegate.setWithPriority(e,t);return r&&s.then(()=>r(null),i=>r(i)),s}update(e,t){if(H("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){const s={};for(let i=0;i<e.length;++i)s[""+i]=e[i];e=s,ov("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Qe("OnDisconnect.update","onComplete",t,!0);const r=this._delegate.update(e);return t&&r.then(()=>t(null),s=>t(s)),r}}class jV{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return H("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}}class wr{constructor(e,t){this._database=e,this._delegate=t}val(){return H("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return H("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return H("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return H("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return H("DataSnapshot.child",0,1,arguments.length),e=String(e),Ba("DataSnapshot.child","path",e),new wr(this._database,this._delegate.child(e))}hasChild(e){return H("DataSnapshot.hasChild",1,1,arguments.length),Ba("DataSnapshot.hasChild","path",e),this._delegate.hasChild(e)}getPriority(){return H("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return H("DataSnapshot.forEach",1,1,arguments.length),Qe("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(t=>e(new wr(this._database,t)))}hasChildren(){return H("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return H("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return H("DataSnapshot.ref",0,0,arguments.length),new us(this._database,this._delegate.ref)}get ref(){return this.getRef()}}let av=class _t{constructor(e,t){this.database=e,this._delegate=t}on(e,t,r,s){H("Query.on",2,4,arguments.length),Qe("Query.on","callback",t,!1);const i=_t.getCancelAndContextArgs_("Query.on",r,s),o=(l,u)=>{t.call(i.context,new wr(this.database,l),u)};o.userCallback=t,o.context=i.context;const a=i.cancel?.bind(i.context);switch(e){case"value":return nf(this._delegate,o,a),t;case"child_added":return Ry(this._delegate,o,a),t;case"child_removed":return Py(this._delegate,o,a),t;case"child_changed":return Sy(this._delegate,o,a),t;case"child_moved":return Cy(this._delegate,o,a),t;default:throw new Error(Nt("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,r){if(H("Query.off",0,3,arguments.length),zV("Query.off",e),Qe("Query.off","callback",t,!0),f_("Query.off","context",r),t){const s=()=>{};s.userCallback=t,s.context=r,ky(this._delegate,e,s)}else ky(this._delegate,e)}get(){return tV(this._delegate).then(e=>new wr(this.database,e))}once(e,t,r,s){H("Query.once",1,4,arguments.length),Qe("Query.once","callback",t,!0);const i=_t.getCancelAndContextArgs_("Query.once",r,s),o=new Rt,a=(u,h)=>{const f=new wr(this.database,u);t&&t.call(i.context,f,h),o.resolve(f)};a.userCallback=t,a.context=i.context;const l=u=>{i.cancel&&i.cancel.call(i.context,u),o.reject(u)};switch(e){case"value":nf(this._delegate,a,l,{onlyOnce:!0});break;case"child_added":Ry(this._delegate,a,l,{onlyOnce:!0});break;case"child_removed":Py(this._delegate,a,l,{onlyOnce:!0});break;case"child_changed":Sy(this._delegate,a,l,{onlyOnce:!0});break;case"child_moved":Cy(this._delegate,a,l,{onlyOnce:!0});break;default:throw new Error(Nt("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return o.promise}limitToFirst(e){return H("Query.limitToFirst",1,1,arguments.length),new _t(this.database,Xt(this._delegate,lV(e)))}limitToLast(e){return H("Query.limitToLast",1,1,arguments.length),new _t(this.database,Xt(this._delegate,hV(e)))}orderByChild(e){return H("Query.orderByChild",1,1,arguments.length),new _t(this.database,Xt(this._delegate,fV(e)))}orderByKey(){return H("Query.orderByKey",0,0,arguments.length),new _t(this.database,Xt(this._delegate,mV()))}orderByPriority(){return H("Query.orderByPriority",0,0,arguments.length),new _t(this.database,Xt(this._delegate,_V()))}orderByValue(){return H("Query.orderByValue",0,0,arguments.length),new _t(this.database,Xt(this._delegate,IV()))}startAt(e=null,t){return H("Query.startAt",0,2,arguments.length),new _t(this.database,Xt(this._delegate,iV(e,t)))}startAfter(e=null,t){return H("Query.startAfter",0,2,arguments.length),new _t(this.database,Xt(this._delegate,aV(e,t)))}endAt(e=null,t){return H("Query.endAt",0,2,arguments.length),new _t(this.database,Xt(this._delegate,nV(e,t)))}endBefore(e=null,t){return H("Query.endBefore",0,2,arguments.length),new _t(this.database,Xt(this._delegate,sV(e,t)))}equalTo(e,t){return H("Query.equalTo",1,2,arguments.length),new _t(this.database,Xt(this._delegate,EV(e,t)))}toString(){return H("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return H("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(H("Query.isEqual",1,1,arguments.length),!(e instanceof _t)){const t="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(t)}return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,r){const s={cancel:void 0,context:void 0};if(t&&r)s.cancel=t,Qe(e,"cancel",s.cancel,!0),s.context=r,f_(e,"context",s.context);else if(t)if(typeof t=="object"&&t!==null)s.context=t;else if(typeof t=="function")s.cancel=t;else throw new Error(Nt(e,"cancelOrContext")+" must either be a cancel callback or a context object.");return s}get ref(){return new us(this.database,new Jt(this._delegate._repo,this._delegate._path))}},us=class oi extends av{constructor(e,t){super(e,new Dt(t._repo,t._path,new xu,!1)),this.database=e,this._delegate=t}getKey(){return H("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return H("Reference.child",1,1,arguments.length),typeof e=="number"&&(e=String(e)),new oi(this.database,bs(this._delegate,e))}getParent(){H("Reference.parent",0,0,arguments.length);const e=this._delegate.parent;return e?new oi(this.database,e):null}getRoot(){return H("Reference.root",0,0,arguments.length),new oi(this.database,this._delegate.root)}set(e,t){H("Reference.set",1,2,arguments.length),Qe("Reference.set","onComplete",t,!0);const r=Kp(this._delegate,e);return t&&r.then(()=>t(null),s=>t(s)),r}update(e,t){if(H("Reference.update",1,2,arguments.length),Array.isArray(e)){const s={};for(let i=0;i<e.length;++i)s[""+i]=e[i];e=s,ov("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}zt("Reference.update",this._delegate._path),Qe("Reference.update","onComplete",t,!0);const r=eV(this._delegate,e);return t&&r.then(()=>t(null),s=>t(s)),r}setWithPriority(e,t,r){H("Reference.setWithPriority",2,3,arguments.length),Qe("Reference.setWithPriority","onComplete",r,!0);const s=ZO(this._delegate,e,t);return r&&s.then(()=>r(null),i=>r(i)),s}remove(e){H("Reference.remove",0,1,arguments.length),Qe("Reference.remove","onComplete",e,!0);const t=JO(this._delegate);return e&&t.then(()=>e(null),r=>e(r)),t}transaction(e,t,r){H("Reference.transaction",1,3,arguments.length),Qe("Reference.transaction","transactionUpdate",e,!1),Qe("Reference.transaction","onComplete",t,!0),$V("Reference.transaction","applyLocally",r);const s=UV(this._delegate,e,{applyLocally:r}).then(i=>new jV(i.committed,new wr(this.database,i.snapshot)));return t&&s.then(i=>t(null,i.committed,i.snapshot),i=>t(i,!1,null)),s}setPriority(e,t){H("Reference.setPriority",1,2,arguments.length),Qe("Reference.setPriority","onComplete",t,!0);const r=XO(this._delegate,e);return t&&r.then(()=>t(null),s=>t(s)),r}push(e,t){H("Reference.push",0,2,arguments.length),Qe("Reference.push","onComplete",t,!0);const r=YO(this._delegate,e),s=r.then(o=>new oi(this.database,o));t&&s.then(()=>t(null),o=>t(o));const i=new oi(this.database,r);return i.then=s.then.bind(s),i.catch=s.catch.bind(s,void 0),i}onDisconnect(){return zt("Reference.onDisconnect",this._delegate._path),new GV(new QO(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}};class qa{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:CV,forceLongPolling:PV}}useEmulator(e,t,r={}){kV(this._delegate,e,t,r)}ref(e){if(H("database.ref",0,1,arguments.length),e instanceof us){const t=by(this._delegate,e.toString());return new us(this,t)}else{const t=tv(this._delegate,e);return new us(this,t)}}refFromURL(e){H("database.refFromURL",1,1,arguments.length);const r=by(this._delegate,e);return new us(this,r)}goOffline(){return H("database.goOffline",0,0,arguments.length),NV(this._delegate)}goOnline(){return H("database.goOnline",0,0,arguments.length),DV(this._delegate)}}qa.ServerValue={TIMESTAMP:LV(),increment:n=>MV(n)};function HV({app:n,url:e,version:t,customAuthImpl:r,customAppCheckImpl:s,namespace:i,nodeAdmin:o=!1}){WE(t);const a=new Wf("database-standalone"),l=new Rd("auth-internal",a);l.setComponent(new Ze("auth-internal",()=>r,"PRIVATE"));let u;return s&&(u=new Rd("app-check-internal",a),u.setComponent(new Ze("app-check-internal",()=>s,"PRIVATE"))),{instance:new qa(sv(n,l,u,e,o),n),namespace:i}}var KV=Object.freeze({__proto__:null,initStandalone:HV});const QV=qa.ServerValue;function YV(n){n.INTERNAL.registerComponent(new Ze("database-compat",(e,{instanceIdentifier:t})=>{const r=e.getProvider("app-compat").getImmediate(),s=e.getProvider("database").getImmediate({identifier:t});return new qa(s,r)},"PUBLIC").setServiceProps({Reference:us,Query:av,Database:qa,DataSnapshot:wr,enableLogging:xV,INTERNAL:KV,ServerValue:QV}).setMultipleInstances(!0)),n.registerVersion(BV,qV)}YV(Kt);var Ny=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Er,cv;(function(){var n;function e(E,y){function w(){}w.prototype=y.prototype,E.F=y.prototype,E.prototype=new w,E.prototype.constructor=E,E.D=function(v,T,S){for(var I=Array(arguments.length-2),At=2;At<arguments.length;At++)I[At-2]=arguments[At];return y.prototype[T].apply(v,I)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(E,y,w){w||(w=0);const v=Array(16);if(typeof y=="string")for(var T=0;T<16;++T)v[T]=y.charCodeAt(w++)|y.charCodeAt(w++)<<8|y.charCodeAt(w++)<<16|y.charCodeAt(w++)<<24;else for(T=0;T<16;++T)v[T]=y[w++]|y[w++]<<8|y[w++]<<16|y[w++]<<24;y=E.g[0],w=E.g[1],T=E.g[2];let S=E.g[3],I;I=y+(S^w&(T^S))+v[0]+3614090360&4294967295,y=w+(I<<7&4294967295|I>>>25),I=S+(T^y&(w^T))+v[1]+3905402710&4294967295,S=y+(I<<12&4294967295|I>>>20),I=T+(w^S&(y^w))+v[2]+606105819&4294967295,T=S+(I<<17&4294967295|I>>>15),I=w+(y^T&(S^y))+v[3]+3250441966&4294967295,w=T+(I<<22&4294967295|I>>>10),I=y+(S^w&(T^S))+v[4]+4118548399&4294967295,y=w+(I<<7&4294967295|I>>>25),I=S+(T^y&(w^T))+v[5]+1200080426&4294967295,S=y+(I<<12&4294967295|I>>>20),I=T+(w^S&(y^w))+v[6]+2821735955&4294967295,T=S+(I<<17&4294967295|I>>>15),I=w+(y^T&(S^y))+v[7]+4249261313&4294967295,w=T+(I<<22&4294967295|I>>>10),I=y+(S^w&(T^S))+v[8]+1770035416&4294967295,y=w+(I<<7&4294967295|I>>>25),I=S+(T^y&(w^T))+v[9]+2336552879&4294967295,S=y+(I<<12&4294967295|I>>>20),I=T+(w^S&(y^w))+v[10]+4294925233&4294967295,T=S+(I<<17&4294967295|I>>>15),I=w+(y^T&(S^y))+v[11]+2304563134&4294967295,w=T+(I<<22&4294967295|I>>>10),I=y+(S^w&(T^S))+v[12]+1804603682&4294967295,y=w+(I<<7&4294967295|I>>>25),I=S+(T^y&(w^T))+v[13]+4254626195&4294967295,S=y+(I<<12&4294967295|I>>>20),I=T+(w^S&(y^w))+v[14]+2792965006&4294967295,T=S+(I<<17&4294967295|I>>>15),I=w+(y^T&(S^y))+v[15]+1236535329&4294967295,w=T+(I<<22&4294967295|I>>>10),I=y+(T^S&(w^T))+v[1]+4129170786&4294967295,y=w+(I<<5&4294967295|I>>>27),I=S+(w^T&(y^w))+v[6]+3225465664&4294967295,S=y+(I<<9&4294967295|I>>>23),I=T+(y^w&(S^y))+v[11]+643717713&4294967295,T=S+(I<<14&4294967295|I>>>18),I=w+(S^y&(T^S))+v[0]+3921069994&4294967295,w=T+(I<<20&4294967295|I>>>12),I=y+(T^S&(w^T))+v[5]+3593408605&4294967295,y=w+(I<<5&4294967295|I>>>27),I=S+(w^T&(y^w))+v[10]+38016083&4294967295,S=y+(I<<9&4294967295|I>>>23),I=T+(y^w&(S^y))+v[15]+3634488961&4294967295,T=S+(I<<14&4294967295|I>>>18),I=w+(S^y&(T^S))+v[4]+3889429448&4294967295,w=T+(I<<20&4294967295|I>>>12),I=y+(T^S&(w^T))+v[9]+568446438&4294967295,y=w+(I<<5&4294967295|I>>>27),I=S+(w^T&(y^w))+v[14]+3275163606&4294967295,S=y+(I<<9&4294967295|I>>>23),I=T+(y^w&(S^y))+v[3]+4107603335&4294967295,T=S+(I<<14&4294967295|I>>>18),I=w+(S^y&(T^S))+v[8]+1163531501&4294967295,w=T+(I<<20&4294967295|I>>>12),I=y+(T^S&(w^T))+v[13]+2850285829&4294967295,y=w+(I<<5&4294967295|I>>>27),I=S+(w^T&(y^w))+v[2]+4243563512&4294967295,S=y+(I<<9&4294967295|I>>>23),I=T+(y^w&(S^y))+v[7]+1735328473&4294967295,T=S+(I<<14&4294967295|I>>>18),I=w+(S^y&(T^S))+v[12]+2368359562&4294967295,w=T+(I<<20&4294967295|I>>>12),I=y+(w^T^S)+v[5]+4294588738&4294967295,y=w+(I<<4&4294967295|I>>>28),I=S+(y^w^T)+v[8]+2272392833&4294967295,S=y+(I<<11&4294967295|I>>>21),I=T+(S^y^w)+v[11]+1839030562&4294967295,T=S+(I<<16&4294967295|I>>>16),I=w+(T^S^y)+v[14]+4259657740&4294967295,w=T+(I<<23&4294967295|I>>>9),I=y+(w^T^S)+v[1]+2763975236&4294967295,y=w+(I<<4&4294967295|I>>>28),I=S+(y^w^T)+v[4]+1272893353&4294967295,S=y+(I<<11&4294967295|I>>>21),I=T+(S^y^w)+v[7]+4139469664&4294967295,T=S+(I<<16&4294967295|I>>>16),I=w+(T^S^y)+v[10]+3200236656&4294967295,w=T+(I<<23&4294967295|I>>>9),I=y+(w^T^S)+v[13]+681279174&4294967295,y=w+(I<<4&4294967295|I>>>28),I=S+(y^w^T)+v[0]+3936430074&4294967295,S=y+(I<<11&4294967295|I>>>21),I=T+(S^y^w)+v[3]+3572445317&4294967295,T=S+(I<<16&4294967295|I>>>16),I=w+(T^S^y)+v[6]+76029189&4294967295,w=T+(I<<23&4294967295|I>>>9),I=y+(w^T^S)+v[9]+3654602809&4294967295,y=w+(I<<4&4294967295|I>>>28),I=S+(y^w^T)+v[12]+3873151461&4294967295,S=y+(I<<11&4294967295|I>>>21),I=T+(S^y^w)+v[15]+530742520&4294967295,T=S+(I<<16&4294967295|I>>>16),I=w+(T^S^y)+v[2]+3299628645&4294967295,w=T+(I<<23&4294967295|I>>>9),I=y+(T^(w|~S))+v[0]+4096336452&4294967295,y=w+(I<<6&4294967295|I>>>26),I=S+(w^(y|~T))+v[7]+1126891415&4294967295,S=y+(I<<10&4294967295|I>>>22),I=T+(y^(S|~w))+v[14]+2878612391&4294967295,T=S+(I<<15&4294967295|I>>>17),I=w+(S^(T|~y))+v[5]+4237533241&4294967295,w=T+(I<<21&4294967295|I>>>11),I=y+(T^(w|~S))+v[12]+1700485571&4294967295,y=w+(I<<6&4294967295|I>>>26),I=S+(w^(y|~T))+v[3]+2399980690&4294967295,S=y+(I<<10&4294967295|I>>>22),I=T+(y^(S|~w))+v[10]+4293915773&4294967295,T=S+(I<<15&4294967295|I>>>17),I=w+(S^(T|~y))+v[1]+2240044497&4294967295,w=T+(I<<21&4294967295|I>>>11),I=y+(T^(w|~S))+v[8]+1873313359&4294967295,y=w+(I<<6&4294967295|I>>>26),I=S+(w^(y|~T))+v[15]+4264355552&4294967295,S=y+(I<<10&4294967295|I>>>22),I=T+(y^(S|~w))+v[6]+2734768916&4294967295,T=S+(I<<15&4294967295|I>>>17),I=w+(S^(T|~y))+v[13]+1309151649&4294967295,w=T+(I<<21&4294967295|I>>>11),I=y+(T^(w|~S))+v[4]+4149444226&4294967295,y=w+(I<<6&4294967295|I>>>26),I=S+(w^(y|~T))+v[11]+3174756917&4294967295,S=y+(I<<10&4294967295|I>>>22),I=T+(y^(S|~w))+v[2]+718787259&4294967295,T=S+(I<<15&4294967295|I>>>17),I=w+(S^(T|~y))+v[9]+3951481745&4294967295,E.g[0]=E.g[0]+y&4294967295,E.g[1]=E.g[1]+(T+(I<<21&4294967295|I>>>11))&4294967295,E.g[2]=E.g[2]+T&4294967295,E.g[3]=E.g[3]+S&4294967295}r.prototype.v=function(E,y){y===void 0&&(y=E.length);const w=y-this.blockSize,v=this.C;let T=this.h,S=0;for(;S<y;){if(T==0)for(;S<=w;)s(this,E,S),S+=this.blockSize;if(typeof E=="string"){for(;S<y;)if(v[T++]=E.charCodeAt(S++),T==this.blockSize){s(this,v),T=0;break}}else for(;S<y;)if(v[T++]=E[S++],T==this.blockSize){s(this,v),T=0;break}}this.h=T,this.o+=y},r.prototype.A=function(){var E=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);E[0]=128;for(var y=1;y<E.length-8;++y)E[y]=0;y=this.o*8;for(var w=E.length-8;w<E.length;++w)E[w]=y&255,y/=256;for(this.v(E),E=Array(16),y=0,w=0;w<4;++w)for(let v=0;v<32;v+=8)E[y++]=this.g[w]>>>v&255;return E};function i(E,y){var w=a;return Object.prototype.hasOwnProperty.call(w,E)?w[E]:w[E]=y(E)}function o(E,y){this.h=y;const w=[];let v=!0;for(let T=E.length-1;T>=0;T--){const S=E[T]|0;v&&S==y||(w[T]=S,v=!1)}this.g=w}var a={};function l(E){return-128<=E&&E<128?i(E,function(y){return new o([y|0],y<0?-1:0)}):new o([E|0],E<0?-1:0)}function u(E){if(isNaN(E)||!isFinite(E))return f;if(E<0)return N(u(-E));const y=[];let w=1;for(let v=0;E>=w;v++)y[v]=E/w|0,w*=4294967296;return new o(y,0)}function h(E,y){if(E.length==0)throw Error("number format error: empty string");if(y=y||10,y<2||36<y)throw Error("radix out of range: "+y);if(E.charAt(0)=="-")return N(h(E.substring(1),y));if(E.indexOf("-")>=0)throw Error('number format error: interior "-" character');const w=u(Math.pow(y,8));let v=f;for(let S=0;S<E.length;S+=8){var T=Math.min(8,E.length-S);const I=parseInt(E.substring(S,S+T),y);T<8?(T=u(Math.pow(y,T)),v=v.j(T).add(u(I))):(v=v.j(w),v=v.add(u(I)))}return v}var f=l(0),m=l(1),_=l(16777216);n=o.prototype,n.m=function(){if(k(this))return-N(this).m();let E=0,y=1;for(let w=0;w<this.g.length;w++){const v=this.i(w);E+=(v>=0?v:4294967296+v)*y,y*=4294967296}return E},n.toString=function(E){if(E=E||10,E<2||36<E)throw Error("radix out of range: "+E);if(A(this))return"0";if(k(this))return"-"+N(this).toString(E);const y=u(Math.pow(E,6));var w=this;let v="";for(;;){const T=K(w,y).g;w=W(w,T.j(y));let S=((w.g.length>0?w.g[0]:w.h)>>>0).toString(E);if(w=T,A(w))return S+v;for(;S.length<6;)S="0"+S;v=S+v}},n.i=function(E){return E<0?0:E<this.g.length?this.g[E]:this.h};function A(E){if(E.h!=0)return!1;for(let y=0;y<E.g.length;y++)if(E.g[y]!=0)return!1;return!0}function k(E){return E.h==-1}n.l=function(E){return E=W(this,E),k(E)?-1:A(E)?0:1};function N(E){const y=E.g.length,w=[];for(let v=0;v<y;v++)w[v]=~E.g[v];return new o(w,~E.h).add(m)}n.abs=function(){return k(this)?N(this):this},n.add=function(E){const y=Math.max(this.g.length,E.g.length),w=[];let v=0;for(let T=0;T<=y;T++){let S=v+(this.i(T)&65535)+(E.i(T)&65535),I=(S>>>16)+(this.i(T)>>>16)+(E.i(T)>>>16);v=I>>>16,S&=65535,I&=65535,w[T]=I<<16|S}return new o(w,w[w.length-1]&-2147483648?-1:0)};function W(E,y){return E.add(N(y))}n.j=function(E){if(A(this)||A(E))return f;if(k(this))return k(E)?N(this).j(N(E)):N(N(this).j(E));if(k(E))return N(this.j(N(E)));if(this.l(_)<0&&E.l(_)<0)return u(this.m()*E.m());const y=this.g.length+E.g.length,w=[];for(var v=0;v<2*y;v++)w[v]=0;for(v=0;v<this.g.length;v++)for(let T=0;T<E.g.length;T++){const S=this.i(v)>>>16,I=this.i(v)&65535,At=E.i(T)>>>16,jr=E.i(T)&65535;w[2*v+2*T]+=I*jr,z(w,2*v+2*T),w[2*v+2*T+1]+=S*jr,z(w,2*v+2*T+1),w[2*v+2*T+1]+=I*At,z(w,2*v+2*T+1),w[2*v+2*T+2]+=S*At,z(w,2*v+2*T+2)}for(E=0;E<y;E++)w[E]=w[2*E+1]<<16|w[2*E];for(E=y;E<2*y;E++)w[E]=0;return new o(w,0)};function z(E,y){for(;(E[y]&65535)!=E[y];)E[y+1]+=E[y]>>>16,E[y]&=65535,y++}function q(E,y){this.g=E,this.h=y}function K(E,y){if(A(y))throw Error("division by zero");if(A(E))return new q(f,f);if(k(E))return y=K(N(E),y),new q(N(y.g),N(y.h));if(k(y))return y=K(E,N(y)),new q(N(y.g),y.h);if(E.g.length>30){if(k(E)||k(y))throw Error("slowDivide_ only works with positive integers.");for(var w=m,v=y;v.l(E)<=0;)w=ie(w),v=ie(v);var T=J(w,1),S=J(v,1);for(v=J(v,2),w=J(w,2);!A(v);){var I=S.add(v);I.l(E)<=0&&(T=T.add(w),S=I),v=J(v,1),w=J(w,1)}return y=W(E,T.j(y)),new q(T,y)}for(T=f;E.l(y)>=0;){for(w=Math.max(1,Math.floor(E.m()/y.m())),v=Math.ceil(Math.log(w)/Math.LN2),v=v<=48?1:Math.pow(2,v-48),S=u(w),I=S.j(y);k(I)||I.l(E)>0;)w-=v,S=u(w),I=S.j(y);A(S)&&(S=m),T=T.add(S),E=W(E,I)}return new q(T,E)}n.B=function(E){return K(this,E).h},n.and=function(E){const y=Math.max(this.g.length,E.g.length),w=[];for(let v=0;v<y;v++)w[v]=this.i(v)&E.i(v);return new o(w,this.h&E.h)},n.or=function(E){const y=Math.max(this.g.length,E.g.length),w=[];for(let v=0;v<y;v++)w[v]=this.i(v)|E.i(v);return new o(w,this.h|E.h)},n.xor=function(E){const y=Math.max(this.g.length,E.g.length),w=[];for(let v=0;v<y;v++)w[v]=this.i(v)^E.i(v);return new o(w,this.h^E.h)};function ie(E){const y=E.g.length+1,w=[];for(let v=0;v<y;v++)w[v]=E.i(v)<<1|E.i(v-1)>>>31;return new o(w,E.h)}function J(E,y){const w=y>>5;y%=32;const v=E.g.length-w,T=[];for(let S=0;S<v;S++)T[S]=y>0?E.i(S+w)>>>y|E.i(S+w+1)<<32-y:E.i(S+w);return new o(T,E.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,cv=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.B,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=h,Er=o}).apply(typeof Ny<"u"?Ny:typeof self<"u"?self:typeof window<"u"?window:{});var nl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var lv,Xo,uv,_l,sf,hv,dv,fv;(function(){var n,e=Object.defineProperty;function t(c){c=[typeof globalThis=="object"&&globalThis,c,typeof window=="object"&&window,typeof self=="object"&&self,typeof nl=="object"&&nl];for(var d=0;d<c.length;++d){var p=c[d];if(p&&p.Math==Math)return p}throw Error("Cannot find global object")}var r=t(this);function s(c,d){if(d)e:{var p=r;c=c.split(".");for(var g=0;g<c.length-1;g++){var R=c[g];if(!(R in p))break e;p=p[R]}c=c[c.length-1],g=p[c],d=d(g),d!=g&&d!=null&&e(p,c,{configurable:!0,writable:!0,value:d})}}s("Symbol.dispose",function(c){return c||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(c){return c||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(c){return c||function(d){var p=[],g;for(g in d)Object.prototype.hasOwnProperty.call(d,g)&&p.push([g,d[g]]);return p}});var i=i||{},o=this||self;function a(c){var d=typeof c;return d=="object"&&c!=null||d=="function"}function l(c,d,p){return c.call.apply(c.bind,arguments)}function u(c,d,p){return u=l,u.apply(null,arguments)}function h(c,d){var p=Array.prototype.slice.call(arguments,1);return function(){var g=p.slice();return g.push.apply(g,arguments),c.apply(this,g)}}function f(c,d){function p(){}p.prototype=d.prototype,c.Z=d.prototype,c.prototype=new p,c.prototype.constructor=c,c.Ob=function(g,R,P){for(var M=Array(arguments.length-2),X=2;X<arguments.length;X++)M[X-2]=arguments[X];return d.prototype[R].apply(g,M)}}var m=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?c=>c&&AsyncContext.Snapshot.wrap(c):c=>c;function _(c){const d=c.length;if(d>0){const p=Array(d);for(let g=0;g<d;g++)p[g]=c[g];return p}return[]}function A(c,d){for(let g=1;g<arguments.length;g++){const R=arguments[g];var p=typeof R;if(p=p!="object"?p:R?Array.isArray(R)?"array":p:"null",p=="array"||p=="object"&&typeof R.length=="number"){p=c.length||0;const P=R.length||0;c.length=p+P;for(let M=0;M<P;M++)c[p+M]=R[M]}else c.push(R)}}class k{constructor(d,p){this.i=d,this.j=p,this.h=0,this.g=null}get(){let d;return this.h>0?(this.h--,d=this.g,this.g=d.next,d.next=null):d=this.i(),d}}function N(c){o.setTimeout(()=>{throw c},0)}function W(){var c=E;let d=null;return c.g&&(d=c.g,c.g=c.g.next,c.g||(c.h=null),d.next=null),d}class z{constructor(){this.h=this.g=null}add(d,p){const g=q.get();g.set(d,p),this.h?this.h.next=g:this.g=g,this.h=g}}var q=new k(()=>new K,c=>c.reset());class K{constructor(){this.next=this.g=this.h=null}set(d,p){this.h=d,this.g=p,this.next=null}reset(){this.next=this.g=this.h=null}}let ie,J=!1,E=new z,y=()=>{const c=Promise.resolve(void 0);ie=()=>{c.then(w)}};function w(){for(var c;c=W();){try{c.h.call(c.g)}catch(p){N(p)}var d=q;d.j(c),d.h<100&&(d.h++,c.next=d.g,d.g=c)}J=!1}function v(){this.u=this.u,this.C=this.C}v.prototype.u=!1,v.prototype.dispose=function(){this.u||(this.u=!0,this.N())},v.prototype[Symbol.dispose]=function(){this.dispose()},v.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function T(c,d){this.type=c,this.g=this.target=d,this.defaultPrevented=!1}T.prototype.h=function(){this.defaultPrevented=!0};var S=(function(){if(!o.addEventListener||!Object.defineProperty)return!1;var c=!1,d=Object.defineProperty({},"passive",{get:function(){c=!0}});try{const p=()=>{};o.addEventListener("test",p,d),o.removeEventListener("test",p,d)}catch{}return c})();function I(c){return/^[\s\xa0]*$/.test(c)}function At(c,d){T.call(this,c?c.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,c&&this.init(c,d)}f(At,T),At.prototype.init=function(c,d){const p=this.type=c.type,g=c.changedTouches&&c.changedTouches.length?c.changedTouches[0]:null;this.target=c.target||c.srcElement,this.g=d,d=c.relatedTarget,d||(p=="mouseover"?d=c.fromElement:p=="mouseout"&&(d=c.toElement)),this.relatedTarget=d,g?(this.clientX=g.clientX!==void 0?g.clientX:g.pageX,this.clientY=g.clientY!==void 0?g.clientY:g.pageY,this.screenX=g.screenX||0,this.screenY=g.screenY||0):(this.clientX=c.clientX!==void 0?c.clientX:c.pageX,this.clientY=c.clientY!==void 0?c.clientY:c.pageY,this.screenX=c.screenX||0,this.screenY=c.screenY||0),this.button=c.button,this.key=c.key||"",this.ctrlKey=c.ctrlKey,this.altKey=c.altKey,this.shiftKey=c.shiftKey,this.metaKey=c.metaKey,this.pointerId=c.pointerId||0,this.pointerType=c.pointerType,this.state=c.state,this.i=c,c.defaultPrevented&&At.Z.h.call(this)},At.prototype.h=function(){At.Z.h.call(this);const c=this.i;c.preventDefault?c.preventDefault():c.returnValue=!1};var jr="closure_listenable_"+(Math.random()*1e6|0),NR=0;function DR(c,d,p,g,R){this.listener=c,this.proxy=null,this.src=d,this.type=p,this.capture=!!g,this.ha=R,this.key=++NR,this.da=this.fa=!1}function Fc(c){c.da=!0,c.listener=null,c.proxy=null,c.src=null,c.ha=null}function Uc(c,d,p){for(const g in c)d.call(p,c[g],g,c)}function xR(c,d){for(const p in c)d.call(void 0,c[p],p,c)}function lg(c){const d={};for(const p in c)d[p]=c[p];return d}const ug="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function hg(c,d){let p,g;for(let R=1;R<arguments.length;R++){g=arguments[R];for(p in g)c[p]=g[p];for(let P=0;P<ug.length;P++)p=ug[P],Object.prototype.hasOwnProperty.call(g,p)&&(c[p]=g[p])}}function Bc(c){this.src=c,this.g={},this.h=0}Bc.prototype.add=function(c,d,p,g,R){const P=c.toString();c=this.g[P],c||(c=this.g[P]=[],this.h++);const M=Sh(c,d,g,R);return M>-1?(d=c[M],p||(d.fa=!1)):(d=new DR(d,this.src,P,!!g,R),d.fa=p,c.push(d)),d};function Rh(c,d){const p=d.type;if(p in c.g){var g=c.g[p],R=Array.prototype.indexOf.call(g,d,void 0),P;(P=R>=0)&&Array.prototype.splice.call(g,R,1),P&&(Fc(d),c.g[p].length==0&&(delete c.g[p],c.h--))}}function Sh(c,d,p,g){for(let R=0;R<c.length;++R){const P=c[R];if(!P.da&&P.listener==d&&P.capture==!!p&&P.ha==g)return R}return-1}var Ch="closure_lm_"+(Math.random()*1e6|0),Ph={};function dg(c,d,p,g,R){if(Array.isArray(d)){for(let P=0;P<d.length;P++)dg(c,d[P],p,g,R);return null}return p=mg(p),c&&c[jr]?c.J(d,p,a(g)?!!g.capture:!1,R):OR(c,d,p,!1,g,R)}function OR(c,d,p,g,R,P){if(!d)throw Error("Invalid event type");const M=a(R)?!!R.capture:!!R;let X=Nh(c);if(X||(c[Ch]=X=new Bc(c)),p=X.add(d,p,g,M,P),p.proxy)return p;if(g=VR(),p.proxy=g,g.src=c,g.listener=p,c.addEventListener)S||(R=M),R===void 0&&(R=!1),c.addEventListener(d.toString(),g,R);else if(c.attachEvent)c.attachEvent(pg(d.toString()),g);else if(c.addListener&&c.removeListener)c.addListener(g);else throw Error("addEventListener and attachEvent are unavailable.");return p}function VR(){function c(p){return d.call(c.src,c.listener,p)}const d=LR;return c}function fg(c,d,p,g,R){if(Array.isArray(d))for(var P=0;P<d.length;P++)fg(c,d[P],p,g,R);else g=a(g)?!!g.capture:!!g,p=mg(p),c&&c[jr]?(c=c.i,P=String(d).toString(),P in c.g&&(d=c.g[P],p=Sh(d,p,g,R),p>-1&&(Fc(d[p]),Array.prototype.splice.call(d,p,1),d.length==0&&(delete c.g[P],c.h--)))):c&&(c=Nh(c))&&(d=c.g[d.toString()],c=-1,d&&(c=Sh(d,p,g,R)),(p=c>-1?d[c]:null)&&kh(p))}function kh(c){if(typeof c!="number"&&c&&!c.da){var d=c.src;if(d&&d[jr])Rh(d.i,c);else{var p=c.type,g=c.proxy;d.removeEventListener?d.removeEventListener(p,g,c.capture):d.detachEvent?d.detachEvent(pg(p),g):d.addListener&&d.removeListener&&d.removeListener(g),(p=Nh(d))?(Rh(p,c),p.h==0&&(p.src=null,d[Ch]=null)):Fc(c)}}}function pg(c){return c in Ph?Ph[c]:Ph[c]="on"+c}function LR(c,d){if(c.da)c=!0;else{d=new At(d,this);const p=c.listener,g=c.ha||c.src;c.fa&&kh(c),c=p.call(g,d)}return c}function Nh(c){return c=c[Ch],c instanceof Bc?c:null}var Dh="__closure_events_fn_"+(Math.random()*1e9>>>0);function mg(c){return typeof c=="function"?c:(c[Dh]||(c[Dh]=function(d){return c.handleEvent(d)}),c[Dh])}function ot(){v.call(this),this.i=new Bc(this),this.M=this,this.G=null}f(ot,v),ot.prototype[jr]=!0,ot.prototype.removeEventListener=function(c,d,p,g){fg(this,c,d,p,g)};function pt(c,d){var p,g=c.G;if(g)for(p=[];g;g=g.G)p.push(g);if(c=c.M,g=d.type||d,typeof d=="string")d=new T(d,c);else if(d instanceof T)d.target=d.target||c;else{var R=d;d=new T(g,c),hg(d,R)}R=!0;let P,M;if(p)for(M=p.length-1;M>=0;M--)P=d.g=p[M],R=qc(P,g,!0,d)&&R;if(P=d.g=c,R=qc(P,g,!0,d)&&R,R=qc(P,g,!1,d)&&R,p)for(M=0;M<p.length;M++)P=d.g=p[M],R=qc(P,g,!1,d)&&R}ot.prototype.N=function(){if(ot.Z.N.call(this),this.i){var c=this.i;for(const d in c.g){const p=c.g[d];for(let g=0;g<p.length;g++)Fc(p[g]);delete c.g[d],c.h--}}this.G=null},ot.prototype.J=function(c,d,p,g){return this.i.add(String(c),d,!1,p,g)},ot.prototype.K=function(c,d,p,g){return this.i.add(String(c),d,!0,p,g)};function qc(c,d,p,g){if(d=c.i.g[String(d)],!d)return!0;d=d.concat();let R=!0;for(let P=0;P<d.length;++P){const M=d[P];if(M&&!M.da&&M.capture==p){const X=M.listener,qe=M.ha||M.src;M.fa&&Rh(c.i,M),R=X.call(qe,g)!==!1&&R}}return R&&!g.defaultPrevented}function MR(c,d){if(typeof c!="function")if(c&&typeof c.handleEvent=="function")c=u(c.handleEvent,c);else throw Error("Invalid listener argument");return Number(d)>2147483647?-1:o.setTimeout(c,d||0)}function gg(c){c.g=MR(()=>{c.g=null,c.i&&(c.i=!1,gg(c))},c.l);const d=c.h;c.h=null,c.m.apply(null,d)}class FR extends v{constructor(d,p){super(),this.m=d,this.l=p,this.h=null,this.i=!1,this.g=null}j(d){this.h=arguments,this.g?this.i=!0:gg(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function _o(c){v.call(this),this.h=c,this.g={}}f(_o,v);var _g=[];function yg(c){Uc(c.g,function(d,p){this.g.hasOwnProperty(p)&&kh(d)},c),c.g={}}_o.prototype.N=function(){_o.Z.N.call(this),yg(this)},_o.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var xh=o.JSON.stringify,UR=o.JSON.parse,BR=class{stringify(c){return o.JSON.stringify(c,void 0)}parse(c){return o.JSON.parse(c,void 0)}};function Ig(){}function wg(){}var yo={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Oh(){T.call(this,"d")}f(Oh,T);function Vh(){T.call(this,"c")}f(Vh,T);var Hr={},Eg=null;function Wc(){return Eg=Eg||new ot}Hr.Ia="serverreachability";function Tg(c){T.call(this,Hr.Ia,c)}f(Tg,T);function Io(c){const d=Wc();pt(d,new Tg(d))}Hr.STAT_EVENT="statevent";function vg(c,d){T.call(this,Hr.STAT_EVENT,c),this.stat=d}f(vg,T);function mt(c){const d=Wc();pt(d,new vg(d,c))}Hr.Ja="timingevent";function Ag(c,d){T.call(this,Hr.Ja,c),this.size=d}f(Ag,T);function wo(c,d){if(typeof c!="function")throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){c()},d)}function Eo(){this.g=!0}Eo.prototype.ua=function(){this.g=!1};function qR(c,d,p,g,R,P){c.info(function(){if(c.g)if(P){var M="",X=P.split("&");for(let fe=0;fe<X.length;fe++){var qe=X[fe].split("=");if(qe.length>1){const je=qe[0];qe=qe[1];const hn=je.split("_");M=hn.length>=2&&hn[1]=="type"?M+(je+"="+qe+"&"):M+(je+"=redacted&")}}}else M=null;else M=P;return"XMLHTTP REQ ("+g+") [attempt "+R+"]: "+d+`
`+p+`
`+M})}function WR(c,d,p,g,R,P,M){c.info(function(){return"XMLHTTP RESP ("+g+") [ attempt "+R+"]: "+d+`
`+p+`
`+P+" "+M})}function Ks(c,d,p,g){c.info(function(){return"XMLHTTP TEXT ("+d+"): "+zR(c,p)+(g?" "+g:"")})}function $R(c,d){c.info(function(){return"TIMEOUT: "+d})}Eo.prototype.info=function(){};function zR(c,d){if(!c.g)return d;if(!d)return null;try{const P=JSON.parse(d);if(P){for(c=0;c<P.length;c++)if(Array.isArray(P[c])){var p=P[c];if(!(p.length<2)){var g=p[1];if(Array.isArray(g)&&!(g.length<1)){var R=g[0];if(R!="noop"&&R!="stop"&&R!="close")for(let M=1;M<g.length;M++)g[M]=""}}}}return xh(P)}catch{return d}}var $c={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},bg={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Rg;function Lh(){}f(Lh,Ig),Lh.prototype.g=function(){return new XMLHttpRequest},Rg=new Lh;function To(c){return encodeURIComponent(String(c))}function GR(c){var d=1;c=c.split(":");const p=[];for(;d>0&&c.length;)p.push(c.shift()),d--;return c.length&&p.push(c.join(":")),p}function Zn(c,d,p,g){this.j=c,this.i=d,this.l=p,this.S=g||1,this.V=new _o(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Sg}function Sg(){this.i=null,this.g="",this.h=!1}var Cg={},Mh={};function Fh(c,d,p){c.M=1,c.A=Gc(un(d)),c.u=p,c.R=!0,Pg(c,null)}function Pg(c,d){c.F=Date.now(),zc(c),c.B=un(c.A);var p=c.B,g=c.S;Array.isArray(g)||(g=[String(g)]),Wg(p.i,"t",g),c.C=0,p=c.j.L,c.h=new Sg,c.g=o_(c.j,p?d:null,!c.u),c.P>0&&(c.O=new FR(u(c.Y,c,c.g),c.P)),d=c.V,p=c.g,g=c.ba;var R="readystatechange";Array.isArray(R)||(R&&(_g[0]=R.toString()),R=_g);for(let P=0;P<R.length;P++){const M=dg(p,R[P],g||d.handleEvent,!1,d.h||d);if(!M)break;d.g[M.key]=M}d=c.J?lg(c.J):{},c.u?(c.v||(c.v="POST"),d["Content-Type"]="application/x-www-form-urlencoded",c.g.ea(c.B,c.v,c.u,d)):(c.v="GET",c.g.ea(c.B,c.v,null,d)),Io(),qR(c.i,c.v,c.B,c.l,c.S,c.u)}Zn.prototype.ba=function(c){c=c.target;const d=this.O;d&&nr(c)==3?d.j():this.Y(c)},Zn.prototype.Y=function(c){try{if(c==this.g)e:{const X=nr(this.g),qe=this.g.ya(),fe=this.g.ca();if(!(X<3)&&(X!=3||this.g&&(this.h.h||this.g.la()||Qg(this.g)))){this.K||X!=4||qe==7||(qe==8||fe<=0?Io(3):Io(2)),Uh(this);var d=this.g.ca();this.X=d;var p=jR(this);if(this.o=d==200,WR(this.i,this.v,this.B,this.l,this.S,X,d),this.o){if(this.U&&!this.L){t:{if(this.g){var g,R=this.g;if((g=R.g?R.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!I(g)){var P=g;break t}}P=null}if(c=P)Ks(this.i,this.l,c,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Bh(this,c);else{this.o=!1,this.m=3,mt(12),Kr(this),vo(this);break e}}if(this.R){c=!0;let je;for(;!this.K&&this.C<p.length;)if(je=HR(this,p),je==Mh){X==4&&(this.m=4,mt(14),c=!1),Ks(this.i,this.l,null,"[Incomplete Response]");break}else if(je==Cg){this.m=4,mt(15),Ks(this.i,this.l,p,"[Invalid Chunk]"),c=!1;break}else Ks(this.i,this.l,je,null),Bh(this,je);if(kg(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),X!=4||p.length!=0||this.h.h||(this.m=1,mt(16),c=!1),this.o=this.o&&c,!c)Ks(this.i,this.l,p,"[Invalid Chunked Response]"),Kr(this),vo(this);else if(p.length>0&&!this.W){this.W=!0;var M=this.j;M.g==this&&M.aa&&!M.P&&(M.j.info("Great, no buffering proxy detected. Bytes received: "+p.length),Kh(M),M.P=!0,mt(11))}}else Ks(this.i,this.l,p,null),Bh(this,p);X==4&&Kr(this),this.o&&!this.K&&(X==4?n_(this.j,this):(this.o=!1,zc(this)))}else aS(this.g),d==400&&p.indexOf("Unknown SID")>0?(this.m=3,mt(12)):(this.m=0,mt(13)),Kr(this),vo(this)}}}catch{}};function jR(c){if(!kg(c))return c.g.la();const d=Qg(c.g);if(d==="")return"";let p="";const g=d.length,R=nr(c.g)==4;if(!c.h.i){if(typeof TextDecoder>"u")return Kr(c),vo(c),"";c.h.i=new o.TextDecoder}for(let P=0;P<g;P++)c.h.h=!0,p+=c.h.i.decode(d[P],{stream:!(R&&P==g-1)});return d.length=0,c.h.g+=p,c.C=0,c.h.g}function kg(c){return c.g?c.v=="GET"&&c.M!=2&&c.j.Aa:!1}function HR(c,d){var p=c.C,g=d.indexOf(`
`,p);return g==-1?Mh:(p=Number(d.substring(p,g)),isNaN(p)?Cg:(g+=1,g+p>d.length?Mh:(d=d.slice(g,g+p),c.C=g+p,d)))}Zn.prototype.cancel=function(){this.K=!0,Kr(this)};function zc(c){c.T=Date.now()+c.H,Ng(c,c.H)}function Ng(c,d){if(c.D!=null)throw Error("WatchDog timer not null");c.D=wo(u(c.aa,c),d)}function Uh(c){c.D&&(o.clearTimeout(c.D),c.D=null)}Zn.prototype.aa=function(){this.D=null;const c=Date.now();c-this.T>=0?($R(this.i,this.B),this.M!=2&&(Io(),mt(17)),Kr(this),this.m=2,vo(this)):Ng(this,this.T-c)};function vo(c){c.j.I==0||c.K||n_(c.j,c)}function Kr(c){Uh(c);var d=c.O;d&&typeof d.dispose=="function"&&d.dispose(),c.O=null,yg(c.V),c.g&&(d=c.g,c.g=null,d.abort(),d.dispose())}function Bh(c,d){try{var p=c.j;if(p.I!=0&&(p.g==c||qh(p.h,c))){if(!c.L&&qh(p.h,c)&&p.I==3){try{var g=p.Ba.g.parse(d)}catch{g=null}if(Array.isArray(g)&&g.length==3){var R=g;if(R[0]==0){e:if(!p.v){if(p.g)if(p.g.F+3e3<c.F)Yc(p),Kc(p);else break e;Hh(p),mt(18)}}else p.xa=R[1],0<p.xa-p.K&&R[2]<37500&&p.F&&p.A==0&&!p.C&&(p.C=wo(u(p.Va,p),6e3));Og(p.h)<=1&&p.ta&&(p.ta=void 0)}else Yr(p,11)}else if((c.L||p.g==c)&&Yc(p),!I(d))for(R=p.Ba.g.parse(d),d=0;d<R.length;d++){let fe=R[d];const je=fe[0];if(!(je<=p.K))if(p.K=je,fe=fe[1],p.I==2)if(fe[0]=="c"){p.M=fe[1],p.ba=fe[2];const hn=fe[3];hn!=null&&(p.ka=hn,p.j.info("VER="+p.ka));const Jr=fe[4];Jr!=null&&(p.za=Jr,p.j.info("SVER="+p.za));const rr=fe[5];rr!=null&&typeof rr=="number"&&rr>0&&(g=1.5*rr,p.O=g,p.j.info("backChannelRequestTimeoutMs_="+g)),g=p;const sr=c.g;if(sr){const Xc=sr.g?sr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Xc){var P=g.h;P.g||Xc.indexOf("spdy")==-1&&Xc.indexOf("quic")==-1&&Xc.indexOf("h2")==-1||(P.j=P.l,P.g=new Set,P.h&&(Wh(P,P.h),P.h=null))}if(g.G){const Qh=sr.g?sr.g.getResponseHeader("X-HTTP-Session-Id"):null;Qh&&(g.wa=Qh,we(g.J,g.G,Qh))}}p.I=3,p.l&&p.l.ra(),p.aa&&(p.T=Date.now()-c.F,p.j.info("Handshake RTT: "+p.T+"ms")),g=p;var M=c;if(g.na=i_(g,g.L?g.ba:null,g.W),M.L){Vg(g.h,M);var X=M,qe=g.O;qe&&(X.H=qe),X.D&&(Uh(X),zc(X)),g.g=M}else e_(g);p.i.length>0&&Qc(p)}else fe[0]!="stop"&&fe[0]!="close"||Yr(p,7);else p.I==3&&(fe[0]=="stop"||fe[0]=="close"?fe[0]=="stop"?Yr(p,7):jh(p):fe[0]!="noop"&&p.l&&p.l.qa(fe),p.A=0)}}Io(4)}catch{}}var KR=class{constructor(c,d){this.g=c,this.map=d}};function Dg(c){this.l=c||10,o.PerformanceNavigationTiming?(c=o.performance.getEntriesByType("navigation"),c=c.length>0&&(c[0].nextHopProtocol=="hq"||c[0].nextHopProtocol=="h2")):c=!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=c?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function xg(c){return c.h?!0:c.g?c.g.size>=c.j:!1}function Og(c){return c.h?1:c.g?c.g.size:0}function qh(c,d){return c.h?c.h==d:c.g?c.g.has(d):!1}function Wh(c,d){c.g?c.g.add(d):c.h=d}function Vg(c,d){c.h&&c.h==d?c.h=null:c.g&&c.g.has(d)&&c.g.delete(d)}Dg.prototype.cancel=function(){if(this.i=Lg(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const c of this.g.values())c.cancel();this.g.clear()}};function Lg(c){if(c.h!=null)return c.i.concat(c.h.G);if(c.g!=null&&c.g.size!==0){let d=c.i;for(const p of c.g.values())d=d.concat(p.G);return d}return _(c.i)}var Mg=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function QR(c,d){if(c){c=c.split("&");for(let p=0;p<c.length;p++){const g=c[p].indexOf("=");let R,P=null;g>=0?(R=c[p].substring(0,g),P=c[p].substring(g+1)):R=c[p],d(R,P?decodeURIComponent(P.replace(/\+/g," ")):"")}}}function er(c){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let d;c instanceof er?(this.l=c.l,Ao(this,c.j),this.o=c.o,this.g=c.g,bo(this,c.u),this.h=c.h,$h(this,$g(c.i)),this.m=c.m):c&&(d=String(c).match(Mg))?(this.l=!1,Ao(this,d[1]||"",!0),this.o=Ro(d[2]||""),this.g=Ro(d[3]||"",!0),bo(this,d[4]),this.h=Ro(d[5]||"",!0),$h(this,d[6]||"",!0),this.m=Ro(d[7]||"")):(this.l=!1,this.i=new Co(null,this.l))}er.prototype.toString=function(){const c=[];var d=this.j;d&&c.push(So(d,Fg,!0),":");var p=this.g;return(p||d=="file")&&(c.push("//"),(d=this.o)&&c.push(So(d,Fg,!0),"@"),c.push(To(p).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),p=this.u,p!=null&&c.push(":",String(p))),(p=this.h)&&(this.g&&p.charAt(0)!="/"&&c.push("/"),c.push(So(p,p.charAt(0)=="/"?XR:JR,!0))),(p=this.i.toString())&&c.push("?",p),(p=this.m)&&c.push("#",So(p,eS)),c.join("")},er.prototype.resolve=function(c){const d=un(this);let p=!!c.j;p?Ao(d,c.j):p=!!c.o,p?d.o=c.o:p=!!c.g,p?d.g=c.g:p=c.u!=null;var g=c.h;if(p)bo(d,c.u);else if(p=!!c.h){if(g.charAt(0)!="/")if(this.g&&!this.h)g="/"+g;else{var R=d.h.lastIndexOf("/");R!=-1&&(g=d.h.slice(0,R+1)+g)}if(R=g,R==".."||R==".")g="";else if(R.indexOf("./")!=-1||R.indexOf("/.")!=-1){g=R.lastIndexOf("/",0)==0,R=R.split("/");const P=[];for(let M=0;M<R.length;){const X=R[M++];X=="."?g&&M==R.length&&P.push(""):X==".."?((P.length>1||P.length==1&&P[0]!="")&&P.pop(),g&&M==R.length&&P.push("")):(P.push(X),g=!0)}g=P.join("/")}else g=R}return p?d.h=g:p=c.i.toString()!=="",p?$h(d,$g(c.i)):p=!!c.m,p&&(d.m=c.m),d};function un(c){return new er(c)}function Ao(c,d,p){c.j=p?Ro(d,!0):d,c.j&&(c.j=c.j.replace(/:$/,""))}function bo(c,d){if(d){if(d=Number(d),isNaN(d)||d<0)throw Error("Bad port number "+d);c.u=d}else c.u=null}function $h(c,d,p){d instanceof Co?(c.i=d,tS(c.i,c.l)):(p||(d=So(d,ZR)),c.i=new Co(d,c.l))}function we(c,d,p){c.i.set(d,p)}function Gc(c){return we(c,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),c}function Ro(c,d){return c?d?decodeURI(c.replace(/%25/g,"%2525")):decodeURIComponent(c):""}function So(c,d,p){return typeof c=="string"?(c=encodeURI(c).replace(d,YR),p&&(c=c.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c):null}function YR(c){return c=c.charCodeAt(0),"%"+(c>>4&15).toString(16)+(c&15).toString(16)}var Fg=/[#\/\?@]/g,JR=/[#\?:]/g,XR=/[#\?]/g,ZR=/[#\?@]/g,eS=/#/g;function Co(c,d){this.h=this.g=null,this.i=c||null,this.j=!!d}function Qr(c){c.g||(c.g=new Map,c.h=0,c.i&&QR(c.i,function(d,p){c.add(decodeURIComponent(d.replace(/\+/g," ")),p)}))}n=Co.prototype,n.add=function(c,d){Qr(this),this.i=null,c=Qs(this,c);let p=this.g.get(c);return p||this.g.set(c,p=[]),p.push(d),this.h+=1,this};function Ug(c,d){Qr(c),d=Qs(c,d),c.g.has(d)&&(c.i=null,c.h-=c.g.get(d).length,c.g.delete(d))}function Bg(c,d){return Qr(c),d=Qs(c,d),c.g.has(d)}n.forEach=function(c,d){Qr(this),this.g.forEach(function(p,g){p.forEach(function(R){c.call(d,R,g,this)},this)},this)};function qg(c,d){Qr(c);let p=[];if(typeof d=="string")Bg(c,d)&&(p=p.concat(c.g.get(Qs(c,d))));else for(c=Array.from(c.g.values()),d=0;d<c.length;d++)p=p.concat(c[d]);return p}n.set=function(c,d){return Qr(this),this.i=null,c=Qs(this,c),Bg(this,c)&&(this.h-=this.g.get(c).length),this.g.set(c,[d]),this.h+=1,this},n.get=function(c,d){return c?(c=qg(this,c),c.length>0?String(c[0]):d):d};function Wg(c,d,p){Ug(c,d),p.length>0&&(c.i=null,c.g.set(Qs(c,d),_(p)),c.h+=p.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const c=[],d=Array.from(this.g.keys());for(let g=0;g<d.length;g++){var p=d[g];const R=To(p);p=qg(this,p);for(let P=0;P<p.length;P++){let M=R;p[P]!==""&&(M+="="+To(p[P])),c.push(M)}}return this.i=c.join("&")};function $g(c){const d=new Co;return d.i=c.i,c.g&&(d.g=new Map(c.g),d.h=c.h),d}function Qs(c,d){return d=String(d),c.j&&(d=d.toLowerCase()),d}function tS(c,d){d&&!c.j&&(Qr(c),c.i=null,c.g.forEach(function(p,g){const R=g.toLowerCase();g!=R&&(Ug(this,g),Wg(this,R,p))},c)),c.j=d}function nS(c,d){const p=new Eo;if(o.Image){const g=new Image;g.onload=h(tr,p,"TestLoadImage: loaded",!0,d,g),g.onerror=h(tr,p,"TestLoadImage: error",!1,d,g),g.onabort=h(tr,p,"TestLoadImage: abort",!1,d,g),g.ontimeout=h(tr,p,"TestLoadImage: timeout",!1,d,g),o.setTimeout(function(){g.ontimeout&&g.ontimeout()},1e4),g.src=c}else d(!1)}function rS(c,d){const p=new Eo,g=new AbortController,R=setTimeout(()=>{g.abort(),tr(p,"TestPingServer: timeout",!1,d)},1e4);fetch(c,{signal:g.signal}).then(P=>{clearTimeout(R),P.ok?tr(p,"TestPingServer: ok",!0,d):tr(p,"TestPingServer: server error",!1,d)}).catch(()=>{clearTimeout(R),tr(p,"TestPingServer: error",!1,d)})}function tr(c,d,p,g,R){try{R&&(R.onload=null,R.onerror=null,R.onabort=null,R.ontimeout=null),g(p)}catch{}}function sS(){this.g=new BR}function zh(c){this.i=c.Sb||null,this.h=c.ab||!1}f(zh,Ig),zh.prototype.g=function(){return new jc(this.i,this.h)};function jc(c,d){ot.call(this),this.H=c,this.o=d,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}f(jc,ot),n=jc.prototype,n.open=function(c,d){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=c,this.D=d,this.readyState=1,ko(this)},n.send=function(c){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const d={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};c&&(d.body=c),(this.H||o).fetch(new Request(this.D,d)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Po(this)),this.readyState=0},n.Pa=function(c){if(this.g&&(this.l=c,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=c.headers,this.readyState=2,ko(this)),this.g&&(this.readyState=3,ko(this),this.g)))if(this.responseType==="arraybuffer")c.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof o.ReadableStream<"u"&&"body"in c){if(this.j=c.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;zg(this)}else c.text().then(this.Oa.bind(this),this.ga.bind(this))};function zg(c){c.j.read().then(c.Ma.bind(c)).catch(c.ga.bind(c))}n.Ma=function(c){if(this.g){if(this.o&&c.value)this.response.push(c.value);else if(!this.o){var d=c.value?c.value:new Uint8Array(0);(d=this.B.decode(d,{stream:!c.done}))&&(this.response=this.responseText+=d)}c.done?Po(this):ko(this),this.readyState==3&&zg(this)}},n.Oa=function(c){this.g&&(this.response=this.responseText=c,Po(this))},n.Na=function(c){this.g&&(this.response=c,Po(this))},n.ga=function(){this.g&&Po(this)};function Po(c){c.readyState=4,c.l=null,c.j=null,c.B=null,ko(c)}n.setRequestHeader=function(c,d){this.A.append(c,d)},n.getResponseHeader=function(c){return this.h&&this.h.get(c.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const c=[],d=this.h.entries();for(var p=d.next();!p.done;)p=p.value,c.push(p[0]+": "+p[1]),p=d.next();return c.join(`\r
`)};function ko(c){c.onreadystatechange&&c.onreadystatechange.call(c)}Object.defineProperty(jc.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(c){this.m=c?"include":"same-origin"}});function Gg(c){let d="";return Uc(c,function(p,g){d+=g,d+=":",d+=p,d+=`\r
`}),d}function Gh(c,d,p){e:{for(g in p){var g=!1;break e}g=!0}g||(p=Gg(p),typeof c=="string"?p!=null&&To(p):we(c,d,p))}function Ne(c){ot.call(this),this.headers=new Map,this.L=c||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}f(Ne,ot);var iS=/^https?$/i,oS=["POST","PUT"];n=Ne.prototype,n.Fa=function(c){this.H=c},n.ea=function(c,d,p,g){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+c);d=d?d.toUpperCase():"GET",this.D=c,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Rg.g(),this.g.onreadystatechange=m(u(this.Ca,this));try{this.B=!0,this.g.open(d,String(c),!0),this.B=!1}catch(P){jg(this,P);return}if(c=p||"",p=new Map(this.headers),g)if(Object.getPrototypeOf(g)===Object.prototype)for(var R in g)p.set(R,g[R]);else if(typeof g.keys=="function"&&typeof g.get=="function")for(const P of g.keys())p.set(P,g.get(P));else throw Error("Unknown input type for opt_headers: "+String(g));g=Array.from(p.keys()).find(P=>P.toLowerCase()=="content-type"),R=o.FormData&&c instanceof o.FormData,!(Array.prototype.indexOf.call(oS,d,void 0)>=0)||g||R||p.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[P,M]of p)this.g.setRequestHeader(P,M);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(c),this.v=!1}catch(P){jg(this,P)}};function jg(c,d){c.h=!1,c.g&&(c.j=!0,c.g.abort(),c.j=!1),c.l=d,c.o=5,Hg(c),Hc(c)}function Hg(c){c.A||(c.A=!0,pt(c,"complete"),pt(c,"error"))}n.abort=function(c){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=c||7,pt(this,"complete"),pt(this,"abort"),Hc(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Hc(this,!0)),Ne.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?Kg(this):this.Xa())},n.Xa=function(){Kg(this)};function Kg(c){if(c.h&&typeof i<"u"){if(c.v&&nr(c)==4)setTimeout(c.Ca.bind(c),0);else if(pt(c,"readystatechange"),nr(c)==4){c.h=!1;try{const P=c.ca();e:switch(P){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var d=!0;break e;default:d=!1}var p;if(!(p=d)){var g;if(g=P===0){let M=String(c.D).match(Mg)[1]||null;!M&&o.self&&o.self.location&&(M=o.self.location.protocol.slice(0,-1)),g=!iS.test(M?M.toLowerCase():"")}p=g}if(p)pt(c,"complete"),pt(c,"success");else{c.o=6;try{var R=nr(c)>2?c.g.statusText:""}catch{R=""}c.l=R+" ["+c.ca()+"]",Hg(c)}}finally{Hc(c)}}}}function Hc(c,d){if(c.g){c.m&&(clearTimeout(c.m),c.m=null);const p=c.g;c.g=null,d||pt(c,"ready");try{p.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function nr(c){return c.g?c.g.readyState:0}n.ca=function(){try{return nr(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(c){if(this.g){var d=this.g.responseText;return c&&d.indexOf(c)==0&&(d=d.substring(c.length)),UR(d)}};function Qg(c){try{if(!c.g)return null;if("response"in c.g)return c.g.response;switch(c.F){case"":case"text":return c.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in c.g)return c.g.mozResponseArrayBuffer}return null}catch{return null}}function aS(c){const d={};c=(c.g&&nr(c)>=2&&c.g.getAllResponseHeaders()||"").split(`\r
`);for(let g=0;g<c.length;g++){if(I(c[g]))continue;var p=GR(c[g]);const R=p[0];if(p=p[1],typeof p!="string")continue;p=p.trim();const P=d[R]||[];d[R]=P,P.push(p)}xR(d,function(g){return g.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function No(c,d,p){return p&&p.internalChannelParams&&p.internalChannelParams[c]||d}function Yg(c){this.za=0,this.i=[],this.j=new Eo,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=No("failFast",!1,c),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=No("baseRetryDelayMs",5e3,c),this.Za=No("retryDelaySeedMs",1e4,c),this.Ta=No("forwardChannelMaxRetries",2,c),this.va=No("forwardChannelRequestTimeoutMs",2e4,c),this.ma=c&&c.xmlHttpFactory||void 0,this.Ua=c&&c.Rb||void 0,this.Aa=c&&c.useFetchStreams||!1,this.O=void 0,this.L=c&&c.supportsCrossDomainXhr||!1,this.M="",this.h=new Dg(c&&c.concurrentRequestLimit),this.Ba=new sS,this.S=c&&c.fastHandshake||!1,this.R=c&&c.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=c&&c.Pb||!1,c&&c.ua&&this.j.ua(),c&&c.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&c&&c.detectBufferingProxy||!1,this.ia=void 0,c&&c.longPollingTimeout&&c.longPollingTimeout>0&&(this.ia=c.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=Yg.prototype,n.ka=8,n.I=1,n.connect=function(c,d,p,g){mt(0),this.W=c,this.H=d||{},p&&g!==void 0&&(this.H.OSID=p,this.H.OAID=g),this.F=this.X,this.J=i_(this,null,this.W),Qc(this)};function jh(c){if(Jg(c),c.I==3){var d=c.V++,p=un(c.J);if(we(p,"SID",c.M),we(p,"RID",d),we(p,"TYPE","terminate"),Do(c,p),d=new Zn(c,c.j,d),d.M=2,d.A=Gc(un(p)),p=!1,o.navigator&&o.navigator.sendBeacon)try{p=o.navigator.sendBeacon(d.A.toString(),"")}catch{}!p&&o.Image&&(new Image().src=d.A,p=!0),p||(d.g=o_(d.j,null),d.g.ea(d.A)),d.F=Date.now(),zc(d)}s_(c)}function Kc(c){c.g&&(Kh(c),c.g.cancel(),c.g=null)}function Jg(c){Kc(c),c.v&&(o.clearTimeout(c.v),c.v=null),Yc(c),c.h.cancel(),c.m&&(typeof c.m=="number"&&o.clearTimeout(c.m),c.m=null)}function Qc(c){if(!xg(c.h)&&!c.m){c.m=!0;var d=c.Ea;ie||y(),J||(ie(),J=!0),E.add(d,c),c.D=0}}function cS(c,d){return Og(c.h)>=c.h.j-(c.m?1:0)?!1:c.m?(c.i=d.G.concat(c.i),!0):c.I==1||c.I==2||c.D>=(c.Sa?0:c.Ta)?!1:(c.m=wo(u(c.Ea,c,d),r_(c,c.D)),c.D++,!0)}n.Ea=function(c){if(this.m)if(this.m=null,this.I==1){if(!c){this.V=Math.floor(Math.random()*1e5),c=this.V++;const R=new Zn(this,this.j,c);let P=this.o;if(this.U&&(P?(P=lg(P),hg(P,this.U)):P=this.U),this.u!==null||this.R||(R.J=P,P=null),this.S)e:{for(var d=0,p=0;p<this.i.length;p++){t:{var g=this.i[p];if("__data__"in g.map&&(g=g.map.__data__,typeof g=="string")){g=g.length;break t}g=void 0}if(g===void 0)break;if(d+=g,d>4096){d=p;break e}if(d===4096||p===this.i.length-1){d=p+1;break e}}d=1e3}else d=1e3;d=Zg(this,R,d),p=un(this.J),we(p,"RID",c),we(p,"CVER",22),this.G&&we(p,"X-HTTP-Session-Id",this.G),Do(this,p),P&&(this.R?d="headers="+To(Gg(P))+"&"+d:this.u&&Gh(p,this.u,P)),Wh(this.h,R),this.Ra&&we(p,"TYPE","init"),this.S?(we(p,"$req",d),we(p,"SID","null"),R.U=!0,Fh(R,p,null)):Fh(R,p,d),this.I=2}}else this.I==3&&(c?Xg(this,c):this.i.length==0||xg(this.h)||Xg(this))};function Xg(c,d){var p;d?p=d.l:p=c.V++;const g=un(c.J);we(g,"SID",c.M),we(g,"RID",p),we(g,"AID",c.K),Do(c,g),c.u&&c.o&&Gh(g,c.u,c.o),p=new Zn(c,c.j,p,c.D+1),c.u===null&&(p.J=c.o),d&&(c.i=d.G.concat(c.i)),d=Zg(c,p,1e3),p.H=Math.round(c.va*.5)+Math.round(c.va*.5*Math.random()),Wh(c.h,p),Fh(p,g,d)}function Do(c,d){c.H&&Uc(c.H,function(p,g){we(d,g,p)}),c.l&&Uc({},function(p,g){we(d,g,p)})}function Zg(c,d,p){p=Math.min(c.i.length,p);const g=c.l?u(c.l.Ka,c.l,c):null;e:{var R=c.i;let X=-1;for(;;){const qe=["count="+p];X==-1?p>0?(X=R[0].g,qe.push("ofs="+X)):X=0:qe.push("ofs="+X);let fe=!0;for(let je=0;je<p;je++){var P=R[je].g;const hn=R[je].map;if(P-=X,P<0)X=Math.max(0,R[je].g-100),fe=!1;else try{P="req"+P+"_"||"";try{var M=hn instanceof Map?hn:Object.entries(hn);for(const[Jr,rr]of M){let sr=rr;a(rr)&&(sr=xh(rr)),qe.push(P+Jr+"="+encodeURIComponent(sr))}}catch(Jr){throw qe.push(P+"type="+encodeURIComponent("_badmap")),Jr}}catch{g&&g(hn)}}if(fe){M=qe.join("&");break e}}M=void 0}return c=c.i.splice(0,p),d.G=c,M}function e_(c){if(!c.g&&!c.v){c.Y=1;var d=c.Da;ie||y(),J||(ie(),J=!0),E.add(d,c),c.A=0}}function Hh(c){return c.g||c.v||c.A>=3?!1:(c.Y++,c.v=wo(u(c.Da,c),r_(c,c.A)),c.A++,!0)}n.Da=function(){if(this.v=null,t_(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var c=4*this.T;this.j.info("BP detection timer enabled: "+c),this.B=wo(u(this.Wa,this),c)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,mt(10),Kc(this),t_(this))};function Kh(c){c.B!=null&&(o.clearTimeout(c.B),c.B=null)}function t_(c){c.g=new Zn(c,c.j,"rpc",c.Y),c.u===null&&(c.g.J=c.o),c.g.P=0;var d=un(c.na);we(d,"RID","rpc"),we(d,"SID",c.M),we(d,"AID",c.K),we(d,"CI",c.F?"0":"1"),!c.F&&c.ia&&we(d,"TO",c.ia),we(d,"TYPE","xmlhttp"),Do(c,d),c.u&&c.o&&Gh(d,c.u,c.o),c.O&&(c.g.H=c.O);var p=c.g;c=c.ba,p.M=1,p.A=Gc(un(d)),p.u=null,p.R=!0,Pg(p,c)}n.Va=function(){this.C!=null&&(this.C=null,Kc(this),Hh(this),mt(19))};function Yc(c){c.C!=null&&(o.clearTimeout(c.C),c.C=null)}function n_(c,d){var p=null;if(c.g==d){Yc(c),Kh(c),c.g=null;var g=2}else if(qh(c.h,d))p=d.G,Vg(c.h,d),g=1;else return;if(c.I!=0){if(d.o)if(g==1){p=d.u?d.u.length:0,d=Date.now()-d.F;var R=c.D;g=Wc(),pt(g,new Ag(g,p)),Qc(c)}else e_(c);else if(R=d.m,R==3||R==0&&d.X>0||!(g==1&&cS(c,d)||g==2&&Hh(c)))switch(p&&p.length>0&&(d=c.h,d.i=d.i.concat(p)),R){case 1:Yr(c,5);break;case 4:Yr(c,10);break;case 3:Yr(c,6);break;default:Yr(c,2)}}}function r_(c,d){let p=c.Qa+Math.floor(Math.random()*c.Za);return c.isActive()||(p*=2),p*d}function Yr(c,d){if(c.j.info("Error code "+d),d==2){var p=u(c.bb,c),g=c.Ua;const R=!g;g=new er(g||"//www.google.com/images/cleardot.gif"),o.location&&o.location.protocol=="http"||Ao(g,"https"),Gc(g),R?nS(g.toString(),p):rS(g.toString(),p)}else mt(2);c.I=0,c.l&&c.l.pa(d),s_(c),Jg(c)}n.bb=function(c){c?(this.j.info("Successfully pinged google.com"),mt(2)):(this.j.info("Failed to ping google.com"),mt(1))};function s_(c){if(c.I=0,c.ja=[],c.l){const d=Lg(c.h);(d.length!=0||c.i.length!=0)&&(A(c.ja,d),A(c.ja,c.i),c.h.i.length=0,_(c.i),c.i.length=0),c.l.oa()}}function i_(c,d,p){var g=p instanceof er?un(p):new er(p);if(g.g!="")d&&(g.g=d+"."+g.g),bo(g,g.u);else{var R=o.location;g=R.protocol,d=d?d+"."+R.hostname:R.hostname,R=+R.port;const P=new er(null);g&&Ao(P,g),d&&(P.g=d),R&&bo(P,R),p&&(P.h=p),g=P}return p=c.G,d=c.wa,p&&d&&we(g,p,d),we(g,"VER",c.ka),Do(c,g),g}function o_(c,d,p){if(d&&!c.L)throw Error("Can't create secondary domain capable XhrIo object.");return d=c.Aa&&!c.ma?new Ne(new zh({ab:p})):new Ne(c.ma),d.Fa(c.L),d}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function a_(){}n=a_.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function Jc(){}Jc.prototype.g=function(c,d){return new xt(c,d)};function xt(c,d){ot.call(this),this.g=new Yg(d),this.l=c,this.h=d&&d.messageUrlParams||null,c=d&&d.messageHeaders||null,d&&d.clientProtocolHeaderRequired&&(c?c["X-Client-Protocol"]="webchannel":c={"X-Client-Protocol":"webchannel"}),this.g.o=c,c=d&&d.initMessageHeaders||null,d&&d.messageContentType&&(c?c["X-WebChannel-Content-Type"]=d.messageContentType:c={"X-WebChannel-Content-Type":d.messageContentType}),d&&d.sa&&(c?c["X-WebChannel-Client-Profile"]=d.sa:c={"X-WebChannel-Client-Profile":d.sa}),this.g.U=c,(c=d&&d.Qb)&&!I(c)&&(this.g.u=c),this.A=d&&d.supportsCrossDomainXhr||!1,this.v=d&&d.sendRawJson||!1,(d=d&&d.httpSessionIdParam)&&!I(d)&&(this.g.G=d,c=this.h,c!==null&&d in c&&(c=this.h,d in c&&delete c[d])),this.j=new Ys(this)}f(xt,ot),xt.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},xt.prototype.close=function(){jh(this.g)},xt.prototype.o=function(c){var d=this.g;if(typeof c=="string"){var p={};p.__data__=c,c=p}else this.v&&(p={},p.__data__=xh(c),c=p);d.i.push(new KR(d.Ya++,c)),d.I==3&&Qc(d)},xt.prototype.N=function(){this.g.l=null,delete this.j,jh(this.g),delete this.g,xt.Z.N.call(this)};function c_(c){Oh.call(this),c.__headers__&&(this.headers=c.__headers__,this.statusCode=c.__status__,delete c.__headers__,delete c.__status__);var d=c.__sm__;if(d){e:{for(const p in d){c=p;break e}c=void 0}(this.i=c)&&(c=this.i,d=d!==null&&c in d?d[c]:void 0),this.data=d}else this.data=c}f(c_,Oh);function l_(){Vh.call(this),this.status=1}f(l_,Vh);function Ys(c){this.g=c}f(Ys,a_),Ys.prototype.ra=function(){pt(this.g,"a")},Ys.prototype.qa=function(c){pt(this.g,new c_(c))},Ys.prototype.pa=function(c){pt(this.g,new l_)},Ys.prototype.oa=function(){pt(this.g,"b")},Jc.prototype.createWebChannel=Jc.prototype.g,xt.prototype.send=xt.prototype.o,xt.prototype.open=xt.prototype.m,xt.prototype.close=xt.prototype.close,fv=function(){return new Jc},dv=function(){return Wc()},hv=Hr,sf={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},$c.NO_ERROR=0,$c.TIMEOUT=8,$c.HTTP_ERROR=6,_l=$c,bg.COMPLETE="complete",uv=bg,wg.EventType=yo,yo.OPEN="a",yo.CLOSE="b",yo.ERROR="c",yo.MESSAGE="d",ot.prototype.listen=ot.prototype.J,Xo=wg,Ne.prototype.listenOnce=Ne.prototype.K,Ne.prototype.getLastError=Ne.prototype.Ha,Ne.prototype.getLastErrorCode=Ne.prototype.ya,Ne.prototype.getStatus=Ne.prototype.ca,Ne.prototype.getResponseJson=Ne.prototype.La,Ne.prototype.getResponseText=Ne.prototype.la,Ne.prototype.send=Ne.prototype.ea,Ne.prototype.setWithCredentials=Ne.prototype.Fa,lv=Ne}).apply(typeof nl<"u"?nl:typeof self<"u"?self:typeof window<"u"?window:{});class Ye{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ye.UNAUTHENTICATED=new Ye(null),Ye.GOOGLE_CREDENTIALS=new Ye("google-credentials-uid"),Ye.FIRST_PARTY=new Ye("first-party-uid"),Ye.MOCK_USER=new Ye("mock-user");let ao="12.8.0";function JV(n){ao=n}const Nr=new Zi("@firebase/firestore");function ai(){return Nr.logLevel}function XV(n){Nr.setLogLevel(n)}function x(n,...e){if(Nr.logLevel<=te.DEBUG){const t=e.map(Qp);Nr.debug(`Firestore (${ao}): ${n}`,...t)}}function Ve(n,...e){if(Nr.logLevel<=te.ERROR){const t=e.map(Qp);Nr.error(`Firestore (${ao}): ${n}`,...t)}}function kn(n,...e){if(Nr.logLevel<=te.WARN){const t=e.map(Qp);Nr.warn(`Firestore (${ao}): ${n}`,...t)}}function Qp(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function B(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,pv(n,r,t)}function pv(n,e,t){let r=`FIRESTORE (${ao}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw Ve(r),new Error(r)}function $(n,e,t,r){let s="Unexpected state";typeof t=="string"?s=t:r=t,n||pv(e,s,r)}function ZV(n,e){n||B(57014,e)}function F(n,e){return n}const C={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class D extends $e{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class st{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class mv{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class e1{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Ye.UNAUTHENTICATED)))}shutdown(){}}class t1{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class n1{constructor(e){this.t=e,this.currentUser=Ye.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){$(this.o===void 0,42304);let r=this.i;const s=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve();let i=new st;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new st,e.enqueueRetryable((()=>s(this.currentUser)))};const o=()=>{const l=i;e.enqueueRetryable((async()=>{await l.promise,await s(this.currentUser)}))},a=l=>{x("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit((l=>a(l))),setTimeout((()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(x("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new st)}}),0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((r=>this.i!==e?(x("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?($(typeof r.accessToken=="string",31837,{l:r}),new mv(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return $(e===null||typeof e=="string",2055,{h:e}),new Ye(e)}}class r1{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=Ye.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);const e=this.A();return e&&this.R.set("Authorization",e),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class s1{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new r1(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(Ye.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Dy{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class i1{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,me(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){$(this.o===void 0,3512);const r=i=>{i.error!=null&&x("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.m;return this.m=i.token,x("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable((()=>r(i)))};const s=i=>{x("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((i=>s(i))),setTimeout((()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?s(i):x("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Dy(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?($(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Dy(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function o1(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class Yp{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=o1(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%62))}return r}}function Q(n,e){return n<e?-1:n>e?1:0}function of(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const s=n.charAt(r),i=e.charAt(r);if(s!==i)return pd(s)===pd(i)?Q(s,i):pd(s)?1:-1}return Q(n.length,e.length)}const a1=55296,c1=57343;function pd(n){const e=n.charCodeAt(0);return e>=a1&&e<=c1}function Di(n,e,t){return n.length===e.length&&n.every(((r,s)=>t(r,e[s])))}function gv(n){return n+"\0"}const xy="__name__";class dn{constructor(e,t,r){t===void 0?t=0:t>e.length&&B(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&B(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return dn.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof dn?e.forEach((r=>{t.push(r)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=dn.compareSegments(e.get(s),t.get(s));if(i!==0)return i}return Q(e.length,t.length)}static compareSegments(e,t){const r=dn.isNumericId(e),s=dn.isNumericId(t);return r&&!s?-1:!r&&s?1:r&&s?dn.extractNumericId(e).compare(dn.extractNumericId(t)):of(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Er.fromString(e.substring(4,e.length-2))}}class re extends dn{construct(e,t,r){return new re(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new D(C.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter((s=>s.length>0)))}return new re(t)}static emptyPath(){return new re([])}}const l1=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class be extends dn{construct(e,t,r){return new be(e,t,r)}static isValidIdentifier(e){return l1.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),be.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===xy}static keyField(){return new be([xy])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new D(C.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new D(C.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new D(C.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new D(C.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new be(t)}static emptyPath(){return new be([])}}class L{constructor(e){this.path=e}static fromPath(e){return new L(re.fromString(e))}static fromName(e){return new L(re.fromString(e).popFirst(5))}static empty(){return new L(re.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&re.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return re.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new L(new re(e.slice()))}}function Jp(n,e,t){if(!t)throw new D(C.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function _v(n,e,t,r){if(e===!0&&r===!0)throw new D(C.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Oy(n){if(!L.isDocumentKey(n))throw new D(C.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Vy(n){if(L.isDocumentKey(n))throw new D(C.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function yv(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Ju(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":B(12329,{type:typeof n})}function ce(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new D(C.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Ju(n);throw new D(C.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function Iv(n,e){if(e<=0)throw new D(C.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function Be(n,e){const t={typeString:n};return e&&(t.value=e),t}function vc(n,e){if(!yv(n))throw new D(C.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const s=e[r].typeString,i="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const o=n[r];if(s&&typeof o!==s){t=`JSON field '${r}' must be a ${s}.`;break}if(i!==void 0&&o!==i.value){t=`Expected '${r}' field to equal '${i.value}'`;break}}if(t)throw new D(C.INVALID_ARGUMENT,t);return!0}const Ly=-62135596800,My=1e6;class le{static now(){return le.fromMillis(Date.now())}static fromDate(e){return le.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*My);return new le(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new D(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new D(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Ly)throw new D(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new D(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/My}_compareTo(e){return this.seconds===e.seconds?Q(this.nanoseconds,e.nanoseconds):Q(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:le._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(vc(e,le._jsonSchema))return new le(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Ly;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}le._jsonSchemaVersion="firestore/timestamp/1.0",le._jsonSchema={type:Be("string",le._jsonSchemaVersion),seconds:Be("number"),nanoseconds:Be("number")};class G{static fromTimestamp(e){return new G(e)}static min(){return new G(new le(0,0))}static max(){return new G(new le(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const xi=-1;class Jl{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function af(n){return n.fields.find((e=>e.kind===2))}function ts(n){return n.fields.filter((e=>e.kind!==2))}Jl.UNKNOWN_ID=-1;class yl{constructor(e,t){this.fieldPath=e,this.kind=t}}class Wa{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Wa(0,qt.min())}}function wv(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=G.fromTimestamp(r===1e9?new le(t+1,0):new le(t,r));return new qt(s,L.empty(),e)}function Ev(n){return new qt(n.readTime,n.key,xi)}class qt{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new qt(G.min(),L.empty(),xi)}static max(){return new qt(G.max(),L.empty(),xi)}}function Xp(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=L.comparator(n.documentKey,e.documentKey),t!==0?t:Q(n.largestBatchId,e.largestBatchId))}const Tv="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class vv{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function Br(n){if(n.code!==C.FAILED_PRECONDITION||n.message!==Tv)throw n;x("LocalStore","Unexpectedly lost primary lease")}class b{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&B(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new b(((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof b?t:b.resolve(t)}catch(t){return b.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):b.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):b.reject(t)}static resolve(e){return new b(((t,r)=>{t(e)}))}static reject(e){return new b(((t,r)=>{r(e)}))}static waitFor(e){return new b(((t,r)=>{let s=0,i=0,o=!1;e.forEach((a=>{++s,a.next((()=>{++i,o&&i===s&&t()}),(l=>r(l)))})),o=!0,i===s&&t()}))}static or(e){let t=b.resolve(!1);for(const r of e)t=t.next((s=>s?b.resolve(s):r()));return t}static forEach(e,t){const r=[];return e.forEach(((s,i)=>{r.push(t.call(this,s,i))})),this.waitFor(r)}static mapArray(e,t){return new b(((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const u=l;t(e[u]).next((h=>{o[u]=h,++a,a===i&&r(o)}),(h=>s(h)))}}))}static doWhile(e,t){return new b(((r,s)=>{const i=()=>{e()===!0?t().next((()=>{i()}),s):r()};i()}))}}const Vt="SimpleDb";class Xu{static open(e,t,r,s){try{return new Xu(t,e.transaction(s,r))}catch(i){throw new fa(t,i)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new st,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new fa(e,t.error)):this.S.resolve()},this.transaction.onerror=r=>{const s=Zp(r.target.error);this.S.reject(new fa(e,s))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(x(Vt,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new h1(t)}}class An{static delete(e){return x(Vt,"Removing database:",e),rs(Mf().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!ba())return!1;if(An.F())return!0;const e=Ce(),t=An.M(e),r=0<t&&t<10,s=Av(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static F(){return typeof process<"u"&&process.__PRIVATE_env?.__PRIVATE_USE_MOCK_PERSISTENCE==="YES"}static O(e,t){return e.store(t)}static M(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}constructor(e,t,r){this.name=e,this.version=t,this.N=r,this.B=null,An.M(Ce())===12.2&&Ve("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(x(Vt,"Opening database:",this.name),this.db=await new Promise(((t,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;t(o)},s.onblocked=()=>{r(new fa(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?r(new D(C.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new D(C.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new fa(e,o))},s.onupgradeneeded=i=>{x(Vt,'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.N.k(o,s.transaction,i.oldVersion,this.version).next((()=>{x(Vt,"Database upgrade to version "+this.version+" complete")}))}}))),this.K&&(this.db.onversionchange=t=>this.K(t)),this.db}q(e){this.K=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,s){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.L(e);const a=Xu.open(this.db,e,i?"readonly":"readwrite",r),l=s(a).next((u=>(a.C(),u))).catch((u=>(a.abort(u),b.reject(u)))).toPromise();return l.catch((()=>{})),await a.D,l}catch(a){const l=a,u=l.name!=="FirebaseError"&&o<3;if(x(Vt,"Transaction failed with error:",l.message,"Retrying:",u),this.close(),!u)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function Av(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class u1{constructor(e){this.U=e,this.$=!1,this.W=null}get isDone(){return this.$}get G(){return this.W}set cursor(e){this.U=e}done(){this.$=!0}j(e){this.W=e}delete(){return rs(this.U.delete())}}class fa extends D{constructor(e,t){super(C.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function qr(n){return n.name==="IndexedDbTransactionError"}class h1{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(x(Vt,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(x(Vt,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),rs(r)}add(e){return x(Vt,"ADD",this.store.name,e,e),rs(this.store.add(e))}get(e){return rs(this.store.get(e)).next((t=>(t===void 0&&(t=null),x(Vt,"GET",this.store.name,e,t),t)))}delete(e){return x(Vt,"DELETE",this.store.name,e),rs(this.store.delete(e))}count(){return x(Vt,"COUNT",this.store.name),rs(this.store.count())}H(e,t){const r=this.options(e,t),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new b(((o,a)=>{i.onerror=l=>{a(l.target.error)},i.onsuccess=l=>{o(l.target.result)}}))}{const i=this.cursor(r),o=[];return this.J(i,((a,l)=>{o.push(l)})).next((()=>o))}}Z(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new b(((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}}))}X(e,t){x(Vt,"DELETE ALL",this.store.name);const r=this.options(e,t);r.Y=!1;const s=this.cursor(r);return this.J(s,((i,o,a)=>a.delete()))}ee(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.J(s,t)}te(e){const t=this.cursor({});return new b(((r,s)=>{t.onerror=i=>{const o=Zp(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next((a=>{a?o.continue():r()})):r()}}))}J(e,t){const r=[];return new b(((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const l=new u1(a),u=t(a.primaryKey,a.value,l);if(u instanceof b){const h=u.catch((f=>(l.done(),b.reject(f))));r.push(h)}l.isDone?s():l.G===null?a.continue():a.continue(l.G)}})).next((()=>b.waitFor(r)))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.Y?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function rs(n){return new b(((e,t)=>{n.onsuccess=r=>{const s=r.target.result;e(s)},n.onerror=r=>{const s=Zp(r.target.error);t(s)}}))}let Fy=!1;function Zp(n){const e=An.M(Ce());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new D("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Fy||(Fy=!0,setTimeout((()=>{throw r}),0)),r}}return n}const pa="IndexBackfiller";class d1{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(e){x(pa,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(async()=>{this.task=null;try{const t=await this.ne.ie();x(pa,`Documents written: ${t}`)}catch(t){qr(t)?x(pa,"Ignoring IndexedDB error during index backfill: ",t):await Br(t)}await this.re(6e4)}))}}class f1{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(t=>this.se(t,e)))}se(e,t){const r=new Set;let s=t,i=!0;return b.doWhile((()=>i===!0&&s>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((o=>{if(o!==null&&!r.has(o))return x(pa,`Processing collection: ${o}`),this.oe(e,o,s).next((a=>{s-=a,r.add(o)}));i=!1})))).next((()=>t-s))}oe(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next((i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next((()=>this._e(s,i))).next((a=>(x(pa,`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a)))).next((()=>o.size))}))))}_e(e,t){let r=e;return t.changes.forEach(((s,i)=>{const o=Ev(i);Xp(o,r)>0&&(r=o)})),new qt(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}class St{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}St.ce=-1;const Tr=-1;function Ac(n){return n==null}function $a(n){return n===0&&1/n==-1/0}function bv(n){return typeof n=="number"&&Number.isInteger(n)&&!$a(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const Xl="";function dt(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Uy(e)),e=p1(n.get(t),e);return Uy(e)}function p1(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case Xl:t+="";break;default:t+=i}}return t}function Uy(n){return n+Xl+""}function En(n){const e=n.length;if($(e>=2,64408,{path:n}),e===2)return $(n.charAt(0)===Xl&&n.charAt(1)==="",56145,{path:n}),re.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf(Xl,i);switch((o<0||o>t)&&B(50515,{path:n}),n.charAt(o+1)){case"":const a=n.substring(i,o);let l;s.length===0?l=a:(s+=a,l=s,s=""),r.push(l);break;case"":s+=n.substring(i,o),s+="\0";break;case"":s+=n.substring(i,o+1);break;default:B(61167,{path:n})}i=o+2}return new re(r)}const ns="remoteDocuments",bc="owner",Zs="owner",za="mutationQueues",m1="userId",Zt="mutations",By="batchId",hs="userMutationsIndex",qy=["userId","batchId"];function Il(n,e){return[n,dt(e)]}function Rv(n,e,t){return[n,dt(e),t]}const g1={},Oi="documentMutations",Zl="remoteDocumentsV14",_1=["prefixPath","collectionGroup","readTime","documentId"],wl="documentKeyIndex",y1=["prefixPath","collectionGroup","documentId"],Sv="collectionGroupIndex",I1=["collectionGroup","readTime","prefixPath","documentId"],Ga="remoteDocumentGlobal",cf="remoteDocumentGlobalKey",Vi="targets",Cv="queryTargetsIndex",w1=["canonicalId","targetId"],Li="targetDocuments",E1=["targetId","path"],em="documentTargetsIndex",T1=["path","targetId"],eu="targetGlobalKey",_s="targetGlobal",ja="collectionParents",v1=["collectionId","parent"],Mi="clientMetadata",A1="clientId",Zu="bundles",b1="bundleId",eh="namedQueries",R1="name",tm="indexConfiguration",S1="indexId",lf="collectionGroupIndex",C1="collectionGroup",ma="indexState",P1=["indexId","uid"],Pv="sequenceNumberIndex",k1=["uid","sequenceNumber"],ga="indexEntries",N1=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],kv="documentKeyIndex",D1=["indexId","uid","orderedDocumentKey"],th="documentOverlays",x1=["userId","collectionPath","documentId"],uf="collectionPathOverlayIndex",O1=["userId","collectionPath","largestBatchId"],Nv="collectionGroupOverlayIndex",V1=["userId","collectionGroup","largestBatchId"],nm="globals",L1="name",Dv=[za,Zt,Oi,ns,Vi,bc,_s,Li,Mi,Ga,ja,Zu,eh],M1=[...Dv,th],xv=[za,Zt,Oi,Zl,Vi,bc,_s,Li,Mi,Ga,ja,Zu,eh,th],Ov=xv,rm=[...Ov,tm,ma,ga],F1=rm,Vv=[...rm,nm],U1=Vv;class hf extends vv{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function Ge(n,e){const t=F(n);return An.O(t.le,e)}function Wy(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Wr(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Lv(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class Ie{constructor(e,t){this.comparator=e,this.root=t||tt.EMPTY}insert(e,t){return new Ie(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,tt.BLACK,null,null))}remove(e){return new Ie(this.comparator,this.root.remove(e,this.comparator).copy(null,null,tt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,r)=>(e(t,r),!1)))}toString(){const e=[];return this.inorderTraversal(((t,r)=>(e.push(`${t}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new rl(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new rl(this.root,e,this.comparator,!1)}getReverseIterator(){return new rl(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new rl(this.root,e,this.comparator,!0)}}class rl{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class tt{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??tt.RED,this.left=s??tt.EMPTY,this.right=i??tt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new tt(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return tt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return tt.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,tt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,tt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw B(43730,{key:this.key,value:this.value});if(this.right.isRed())throw B(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw B(27949);return e+(this.isRed()?0:1)}}tt.EMPTY=null,tt.RED=!0,tt.BLACK=!1;tt.EMPTY=new class{constructor(){this.size=0}get key(){throw B(57766)}get value(){throw B(16141)}get color(){throw B(16727)}get left(){throw B(29726)}get right(){throw B(36894)}copy(e,t,r,s,i){return this}insert(e,t,r){return new tt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class de{constructor(e){this.comparator=e,this.data=new Ie(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,r)=>(e(t),!1)))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new $y(this.data.getIterator())}getIteratorFrom(e){return new $y(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((r=>{t=t.add(r)})),t}isEqual(e){if(!(e instanceof de)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new de(this.comparator);return t.data=e,t}}class $y{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function ei(n){return n.hasNext()?n.getNext():void 0}class Ct{constructor(e){this.fields=e,e.sort(be.comparator)}static empty(){return new Ct([])}unionWith(e){let t=new de(be.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Ct(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Di(this.fields,e.fields,((t,r)=>t.isEqual(r)))}}class Mv extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}function B1(){return typeof atob<"u"}class De{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new Mv("Invalid base64 string: "+i):i}})(e);return new De(t)}static fromUint8Array(e){const t=(function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i})(e);return new De(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Q(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}De.EMPTY_BYTE_STRING=new De("");const q1=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function zn(n){if($(!!n,39018),typeof n=="string"){let e=0;const t=q1.exec(n);if($(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:ve(n.seconds),nanos:ve(n.nanos)}}function ve(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Gn(n){return typeof n=="string"?De.fromBase64String(n):De.fromUint8Array(n)}const Fv="server_timestamp",Uv="__type__",Bv="__previous_value__",qv="__local_write_time__";function nh(n){return(n?.mapValue?.fields||{})[Uv]?.stringValue===Fv}function rh(n){const e=n.mapValue.fields[Bv];return nh(e)?rh(e):e}function Ha(n){const e=zn(n.mapValue.fields[qv].timestampValue);return new le(e.seconds,e.nanos)}class W1{constructor(e,t,r,s,i,o,a,l,u,h,f){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=u,this.isUsingEmulator=h,this.apiKey=f}}const df="(default)";class Dr{constructor(e,t){this.projectId=e,this.database=t||df}static empty(){return new Dr("","")}get isDefaultDatabase(){return this.database===df}isEqual(e){return e instanceof Dr&&e.projectId===this.projectId&&e.database===this.database}}function $1(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new D(C.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Dr(n.options.projectId,e)}const sm="__type__",Wv="__max__",pr={mapValue:{fields:{__type__:{stringValue:Wv}}}},im="__vector__",Fi="value",El={nullValue:"NULL_VALUE"};function xr(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?nh(n)?4:$v(n)?9007199254740991:sh(n)?10:11:B(28295,{value:n})}function Nn(n,e){if(n===e)return!0;const t=xr(n);if(t!==xr(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Ha(n).isEqual(Ha(e));case 3:return(function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=zn(s.timestampValue),a=zn(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(s,i){return Gn(s.bytesValue).isEqual(Gn(i.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(s,i){return ve(s.geoPointValue.latitude)===ve(i.geoPointValue.latitude)&&ve(s.geoPointValue.longitude)===ve(i.geoPointValue.longitude)})(n,e);case 2:return(function(s,i){if("integerValue"in s&&"integerValue"in i)return ve(s.integerValue)===ve(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=ve(s.doubleValue),a=ve(i.doubleValue);return o===a?$a(o)===$a(a):isNaN(o)&&isNaN(a)}return!1})(n,e);case 9:return Di(n.arrayValue.values||[],e.arrayValue.values||[],Nn);case 10:case 11:return(function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(Wy(o)!==Wy(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!Nn(o[l],a[l])))return!1;return!0})(n,e);default:return B(52216,{left:n})}}function Ka(n,e){return(n.values||[]).find((t=>Nn(t,e)))!==void 0}function Or(n,e){if(n===e)return 0;const t=xr(n),r=xr(e);if(t!==r)return Q(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Q(n.booleanValue,e.booleanValue);case 2:return(function(i,o){const a=ve(i.integerValue||i.doubleValue),l=ve(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1})(n,e);case 3:return zy(n.timestampValue,e.timestampValue);case 4:return zy(Ha(n),Ha(e));case 5:return of(n.stringValue,e.stringValue);case 6:return(function(i,o){const a=Gn(i),l=Gn(o);return a.compareTo(l)})(n.bytesValue,e.bytesValue);case 7:return(function(i,o){const a=i.split("/"),l=o.split("/");for(let u=0;u<a.length&&u<l.length;u++){const h=Q(a[u],l[u]);if(h!==0)return h}return Q(a.length,l.length)})(n.referenceValue,e.referenceValue);case 8:return(function(i,o){const a=Q(ve(i.latitude),ve(o.latitude));return a!==0?a:Q(ve(i.longitude),ve(o.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return Gy(n.arrayValue,e.arrayValue);case 10:return(function(i,o){const a=i.fields||{},l=o.fields||{},u=a[Fi]?.arrayValue,h=l[Fi]?.arrayValue,f=Q(u?.values?.length||0,h?.values?.length||0);return f!==0?f:Gy(u,h)})(n.mapValue,e.mapValue);case 11:return(function(i,o){if(i===pr.mapValue&&o===pr.mapValue)return 0;if(i===pr.mapValue)return 1;if(o===pr.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),u=o.fields||{},h=Object.keys(u);l.sort(),h.sort();for(let f=0;f<l.length&&f<h.length;++f){const m=of(l[f],h[f]);if(m!==0)return m;const _=Or(a[l[f]],u[h[f]]);if(_!==0)return _}return Q(l.length,h.length)})(n.mapValue,e.mapValue);default:throw B(23264,{he:t})}}function zy(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Q(n,e);const t=zn(n),r=zn(e),s=Q(t.seconds,r.seconds);return s!==0?s:Q(t.nanos,r.nanos)}function Gy(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=Or(t[s],r[s]);if(i)return i}return Q(t.length,r.length)}function Ui(n){return ff(n)}function ff(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const r=zn(t);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return Gn(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return L.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=ff(i);return r+"]"})(n.arrayValue):"mapValue"in n?(function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${ff(t.fields[o])}`;return s+"}"})(n.mapValue):B(61005,{value:n})}function Tl(n){switch(xr(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=rh(n);return e?16+Tl(e):16;case 5:return 2*n.stringValue.length;case 6:return Gn(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((s,i)=>s+Tl(i)),0)})(n.arrayValue);case 10:case 11:return(function(r){let s=0;return Wr(r.fields,((i,o)=>{s+=i.length+Tl(o)})),s})(n.mapValue);default:throw B(13486,{value:n})}}function Rs(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function pf(n){return!!n&&"integerValue"in n}function Qa(n){return!!n&&"arrayValue"in n}function jy(n){return!!n&&"nullValue"in n}function Hy(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function vl(n){return!!n&&"mapValue"in n}function sh(n){return(n?.mapValue?.fields||{})[sm]?.stringValue===im}function _a(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return Wr(n.mapValue.fields,((t,r)=>e.mapValue.fields[t]=_a(r))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=_a(n.arrayValue.values[t]);return e}return{...n}}function $v(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Wv}const zv={mapValue:{fields:{[sm]:{stringValue:im},[Fi]:{arrayValue:{}}}}};function z1(n){return"nullValue"in n?El:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Rs(Dr.empty(),L.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?sh(n)?zv:{mapValue:{}}:B(35942,{value:n})}function G1(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Rs(Dr.empty(),L.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?zv:"mapValue"in n?sh(n)?{mapValue:{}}:pr:B(61959,{value:n})}function Ky(n,e){const t=Or(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function Qy(n,e){const t=Or(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}class nt{constructor(e){this.value=e}static empty(){return new nt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!vl(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=_a(t)}setAll(e){let t=be.emptyPath(),r={},s=[];e.forEach(((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=_a(o):s.push(a.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());vl(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Nn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];vl(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){Wr(t,((s,i)=>e[s]=i));for(const s of r)delete e[s]}clone(){return new nt(_a(this.value))}}function Gv(n){const e=[];return Wr(n.fields,((t,r)=>{const s=new be([t]);if(vl(r)){const i=Gv(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)})),new Ct(e)}class Ee{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new Ee(e,0,G.min(),G.min(),G.min(),nt.empty(),0)}static newFoundDocument(e,t,r,s){return new Ee(e,1,t,G.min(),r,s,0)}static newNoDocument(e,t){return new Ee(e,2,t,G.min(),G.min(),nt.empty(),0)}static newUnknownDocument(e,t){return new Ee(e,3,t,G.min(),G.min(),nt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(G.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=nt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=nt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=G.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Ee&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ee(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Vr{constructor(e,t){this.position=e,this.inclusive=t}}function Yy(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=L.comparator(L.fromName(o.referenceValue),t.key):r=Or(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function Jy(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Nn(n.position[t],e.position[t]))return!1;return!0}class Ya{constructor(e,t="asc"){this.field=e,this.dir=t}}function j1(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class jv{}class se extends jv{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new H1(e,t,r):t==="array-contains"?new Y1(e,r):t==="in"?new Xv(e,r):t==="not-in"?new J1(e,r):t==="array-contains-any"?new X1(e,r):new se(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new K1(e,r):new Q1(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Or(t,this.value)):t!==null&&xr(this.value)===xr(t)&&this.matchesComparison(Or(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return B(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class he extends jv{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new he(e,t)}matches(e){return Bi(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Bi(n){return n.op==="and"}function mf(n){return n.op==="or"}function om(n){return Hv(n)&&Bi(n)}function Hv(n){for(const e of n.filters)if(e instanceof he)return!1;return!0}function gf(n){if(n instanceof se)return n.field.canonicalString()+n.op.toString()+Ui(n.value);if(om(n))return n.filters.map((e=>gf(e))).join(",");{const e=n.filters.map((t=>gf(t))).join(",");return`${n.op}(${e})`}}function Kv(n,e){return n instanceof se?(function(r,s){return s instanceof se&&r.op===s.op&&r.field.isEqual(s.field)&&Nn(r.value,s.value)})(n,e):n instanceof he?(function(r,s){return s instanceof he&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce(((i,o,a)=>i&&Kv(o,s.filters[a])),!0):!1})(n,e):void B(19439)}function Qv(n,e){const t=n.filters.concat(e);return he.create(t,n.op)}function Yv(n){return n instanceof se?(function(t){return`${t.field.canonicalString()} ${t.op} ${Ui(t.value)}`})(n):n instanceof he?(function(t){return t.op.toString()+" {"+t.getFilters().map(Yv).join(" ,")+"}"})(n):"Filter"}class H1 extends se{constructor(e,t,r){super(e,t,r),this.key=L.fromName(r.referenceValue)}matches(e){const t=L.comparator(e.key,this.key);return this.matchesComparison(t)}}class K1 extends se{constructor(e,t){super(e,"in",t),this.keys=Jv("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class Q1 extends se{constructor(e,t){super(e,"not-in",t),this.keys=Jv("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Jv(n,e){return(e.arrayValue?.values||[]).map((t=>L.fromName(t.referenceValue)))}class Y1 extends se{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Qa(t)&&Ka(t.arrayValue,this.value)}}class Xv extends se{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Ka(this.value.arrayValue,t)}}class J1 extends se{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ka(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Ka(this.value.arrayValue,t)}}class X1 extends se{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Qa(t)||!t.arrayValue.values)&&t.arrayValue.values.some((r=>Ka(this.value.arrayValue,r)))}}class Z1{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.Te=null}}function _f(n,e=null,t=[],r=[],s=null,i=null,o=null){return new Z1(n,e,t,r,s,i,o)}function Ss(n){const e=F(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((r=>gf(r))).join(","),t+="|ob:",t+=e.orderBy.map((r=>(function(i){return i.field.canonicalString()+i.dir})(r))).join(","),Ac(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((r=>Ui(r))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((r=>Ui(r))).join(",")),e.Te=t}return e.Te}function Rc(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!j1(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Kv(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Jy(n.startAt,e.startAt)&&Jy(n.endAt,e.endAt)}function tu(n){return L.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function nu(n,e){return n.filters.filter((t=>t instanceof se&&t.field.isEqual(e)))}function Xy(n,e,t){let r=El,s=!0;for(const i of nu(n,e)){let o=El,a=!0;switch(i.op){case"<":case"<=":o=z1(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=El}Ky({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];Ky({value:r,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}function Zy(n,e,t){let r=pr,s=!0;for(const i of nu(n,e)){let o=pr,a=!0;switch(i.op){case">=":case">":o=G1(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=pr}Qy({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];Qy({value:r,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}class Kn{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function Zv(n,e,t,r,s,i,o,a){return new Kn(n,e,t,r,s,i,o,a)}function co(n){return new Kn(n)}function eI(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function eL(n){return L.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function am(n){return n.collectionGroup!==null}function Ii(n){const e=F(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new de(be.comparator);return o.filters.forEach((l=>{l.getFlattenedFilters().forEach((u=>{u.isInequality()&&(a=a.add(u.field))}))})),a})(e).forEach((i=>{t.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new Ya(i,r))})),t.has(be.keyField().canonicalString())||e.Ie.push(new Ya(be.keyField(),r))}return e.Ie}function Tt(n){const e=F(n);return e.Ee||(e.Ee=tL(e,Ii(n))),e.Ee}function tL(n,e){if(n.limitType==="F")return _f(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((s=>{const i=s.dir==="desc"?"asc":"desc";return new Ya(s.field,i)}));const t=n.endAt?new Vr(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Vr(n.startAt.position,n.startAt.inclusive):null;return _f(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function yf(n,e){const t=n.filters.concat([e]);return new Kn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function nL(n,e){const t=n.explicitOrderBy.concat([e]);return new Kn(n.path,n.collectionGroup,t,n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function ru(n,e,t){return new Kn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function rL(n,e){return new Kn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,e,n.endAt)}function sL(n,e){return new Kn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,e)}function Sc(n,e){return Rc(Tt(n),Tt(e))&&n.limitType===e.limitType}function eA(n){return`${Ss(Tt(n))}|lt:${n.limitType}`}function ci(n){return`Query(target=${(function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map((s=>Yv(s))).join(", ")}]`),Ac(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map((s=>(function(o){return`${o.field.canonicalString()} (${o.dir})`})(s))).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map((s=>Ui(s))).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map((s=>Ui(s))).join(",")),`Target(${r})`})(Tt(n))}; limitType=${n.limitType})`}function Cc(n,e){return e.isFoundDocument()&&(function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):L.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)})(n,e)&&(function(r,s){for(const i of Ii(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0})(n,e)&&(function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0})(n,e)&&(function(r,s){return!(r.startAt&&!(function(o,a,l){const u=Yy(o,a,l);return o.inclusive?u<=0:u<0})(r.startAt,Ii(r),s)||r.endAt&&!(function(o,a,l){const u=Yy(o,a,l);return o.inclusive?u>=0:u>0})(r.endAt,Ii(r),s))})(n,e)}function tA(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function nA(n){return(e,t)=>{let r=!1;for(const s of Ii(n)){const i=iL(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function iL(n,e,t){const r=n.field.isKeyField()?L.comparator(e.key,t.key):(function(i,o,a){const l=o.data.field(i),u=a.data.field(i);return l!==null&&u!==null?Or(l,u):B(42886)})(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return B(19790,{direction:n.dir})}}class Qn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Wr(this.inner,((t,r)=>{for(const[s,i]of r)e(s,i)}))}isEmpty(){return Lv(this.inner)}size(){return this.innerSize}}const oL=new Ie(L.comparator);function Pt(){return oL}const rA=new Ie(L.comparator);function Zo(...n){let e=rA;for(const t of n)e=e.insert(t.key,t);return e}function sA(n){let e=rA;return n.forEach(((t,r)=>e=e.insert(t,r.overlayedDocument))),e}function Tn(){return ya()}function iA(){return ya()}function ya(){return new Qn((n=>n.toString()),((n,e)=>n.isEqual(e)))}const aL=new Ie(L.comparator),cL=new de(L.comparator);function Y(...n){let e=cL;for(const t of n)e=e.add(t);return e}const lL=new de(Q);function cm(){return lL}function lm(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:$a(e)?"-0":e}}function oA(n){return{integerValue:""+n}}function aA(n,e){return bv(e)?oA(e):lm(n,e)}class ih{constructor(){this._=void 0}}function uL(n,e,t){return n instanceof qi?(function(s,i){const o={fields:{[Uv]:{stringValue:Fv},[qv]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&nh(i)&&(i=rh(i)),i&&(o.fields[Bv]=i),{mapValue:o}})(t,e):n instanceof Cs?lA(n,e):n instanceof Ps?uA(n,e):(function(s,i){const o=cA(s,i),a=tI(o)+tI(s.Ae);return pf(o)&&pf(s.Ae)?oA(a):lm(s.serializer,a)})(n,e)}function hL(n,e,t){return n instanceof Cs?lA(n,e):n instanceof Ps?uA(n,e):t}function cA(n,e){return n instanceof Wi?(function(r){return pf(r)||(function(i){return!!i&&"doubleValue"in i})(r)})(e)?e:{integerValue:0}:null}class qi extends ih{}class Cs extends ih{constructor(e){super(),this.elements=e}}function lA(n,e){const t=hA(e);for(const r of n.elements)t.some((s=>Nn(s,r)))||t.push(r);return{arrayValue:{values:t}}}class Ps extends ih{constructor(e){super(),this.elements=e}}function uA(n,e){let t=hA(e);for(const r of n.elements)t=t.filter((s=>!Nn(s,r)));return{arrayValue:{values:t}}}class Wi extends ih{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function tI(n){return ve(n.integerValue||n.doubleValue)}function hA(n){return Qa(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class Pc{constructor(e,t){this.field=e,this.transform=t}}function dL(n,e){return n.field.isEqual(e.field)&&(function(r,s){return r instanceof Cs&&s instanceof Cs||r instanceof Ps&&s instanceof Ps?Di(r.elements,s.elements,Nn):r instanceof Wi&&s instanceof Wi?Nn(r.Ae,s.Ae):r instanceof qi&&s instanceof qi})(n.transform,e.transform)}class fL{constructor(e,t){this.version=e,this.transformResults=t}}class Re{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Re}static exists(e){return new Re(void 0,e)}static updateTime(e){return new Re(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Al(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class oh{}function dA(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new uo(n.key,Re.none()):new lo(n.key,n.data,Re.none());{const t=n.data,r=nt.empty();let s=new de(be.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new Yn(n.key,r,new Ct(s.toArray()),Re.none())}}function pL(n,e,t){n instanceof lo?(function(s,i,o){const a=s.value.clone(),l=rI(s.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()})(n,e,t):n instanceof Yn?(function(s,i,o){if(!Al(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=rI(s.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(fA(s)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()})(n,e,t):(function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()})(0,e,t)}function Ia(n,e,t,r){return n instanceof lo?(function(i,o,a,l){if(!Al(i.precondition,o))return a;const u=i.value.clone(),h=sI(i.fieldTransforms,l,o);return u.setAll(h),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null})(n,e,t,r):n instanceof Yn?(function(i,o,a,l){if(!Al(i.precondition,o))return a;const u=sI(i.fieldTransforms,l,o),h=o.data;return h.setAll(fA(i)),h.setAll(u),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map((f=>f.field)))})(n,e,t,r):(function(i,o,a){return Al(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a})(n,e,t)}function mL(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=cA(r.transform,s||null);i!=null&&(t===null&&(t=nt.empty()),t.set(r.field,i))}return t||null}function nI(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Di(r,s,((i,o)=>dL(i,o)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class lo extends oh{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Yn extends oh{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function fA(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}})),e}function rI(n,e,t){const r=new Map;$(n.length===t.length,32656,{Ve:t.length,de:n.length});for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,hL(o,a,t[s]))}return r}function sI(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,uL(i,o,e))}return r}class uo extends oh{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class um extends oh{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class hm{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&pL(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Ia(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Ia(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=iA();return this.mutations.forEach((s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const l=dA(o,a);l!==null&&r.set(s.key,l),o.isValidDocument()||o.convertToNoDocument(G.min())})),r}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),Y())}isEqual(e){return this.batchId===e.batchId&&Di(this.mutations,e.mutations,((t,r)=>nI(t,r)))&&Di(this.baseMutations,e.baseMutations,((t,r)=>nI(t,r)))}}class dm{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){$(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=(function(){return aL})();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new dm(e,t,r,s)}}class fm{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class gL{constructor(e,t){this.count=e,this.unchangedNames=t}}var Fe,oe;function pA(n){switch(n){case C.OK:return B(64938);case C.CANCELLED:case C.UNKNOWN:case C.DEADLINE_EXCEEDED:case C.RESOURCE_EXHAUSTED:case C.INTERNAL:case C.UNAVAILABLE:case C.UNAUTHENTICATED:return!1;case C.INVALID_ARGUMENT:case C.NOT_FOUND:case C.ALREADY_EXISTS:case C.PERMISSION_DENIED:case C.FAILED_PRECONDITION:case C.ABORTED:case C.OUT_OF_RANGE:case C.UNIMPLEMENTED:case C.DATA_LOSS:return!0;default:return B(15467,{code:n})}}function mA(n){if(n===void 0)return Ve("GRPC error has no .code"),C.UNKNOWN;switch(n){case Fe.OK:return C.OK;case Fe.CANCELLED:return C.CANCELLED;case Fe.UNKNOWN:return C.UNKNOWN;case Fe.DEADLINE_EXCEEDED:return C.DEADLINE_EXCEEDED;case Fe.RESOURCE_EXHAUSTED:return C.RESOURCE_EXHAUSTED;case Fe.INTERNAL:return C.INTERNAL;case Fe.UNAVAILABLE:return C.UNAVAILABLE;case Fe.UNAUTHENTICATED:return C.UNAUTHENTICATED;case Fe.INVALID_ARGUMENT:return C.INVALID_ARGUMENT;case Fe.NOT_FOUND:return C.NOT_FOUND;case Fe.ALREADY_EXISTS:return C.ALREADY_EXISTS;case Fe.PERMISSION_DENIED:return C.PERMISSION_DENIED;case Fe.FAILED_PRECONDITION:return C.FAILED_PRECONDITION;case Fe.ABORTED:return C.ABORTED;case Fe.OUT_OF_RANGE:return C.OUT_OF_RANGE;case Fe.UNIMPLEMENTED:return C.UNIMPLEMENTED;case Fe.DATA_LOSS:return C.DATA_LOSS;default:return B(39323,{code:n})}}(oe=Fe||(Fe={}))[oe.OK=0]="OK",oe[oe.CANCELLED=1]="CANCELLED",oe[oe.UNKNOWN=2]="UNKNOWN",oe[oe.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",oe[oe.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",oe[oe.NOT_FOUND=5]="NOT_FOUND",oe[oe.ALREADY_EXISTS=6]="ALREADY_EXISTS",oe[oe.PERMISSION_DENIED=7]="PERMISSION_DENIED",oe[oe.UNAUTHENTICATED=16]="UNAUTHENTICATED",oe[oe.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",oe[oe.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",oe[oe.ABORTED=10]="ABORTED",oe[oe.OUT_OF_RANGE=11]="OUT_OF_RANGE",oe[oe.UNIMPLEMENTED=12]="UNIMPLEMENTED",oe[oe.INTERNAL=13]="INTERNAL",oe[oe.UNAVAILABLE=14]="UNAVAILABLE",oe[oe.DATA_LOSS=15]="DATA_LOSS";function gA(){return new TextEncoder}const _L=new Er([4294967295,4294967295],0);function iI(n){const e=gA().encode(n),t=new cv;return t.update(e),new Uint8Array(t.digest())}function oI(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Er([t,r],0),new Er([s,i],0)]}class pm{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new ea(`Invalid padding: ${t}`);if(r<0)throw new ea(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new ea(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new ea(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Er.fromNumber(this.ge)}ye(e,t,r){let s=e.add(t.multiply(Er.fromNumber(r)));return s.compare(_L)===1&&(s=new Er([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=iI(e),[r,s]=oI(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(r,s,i);if(!this.we(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new pm(i,s,t);return r.forEach((a=>o.insert(a))),o}insert(e){if(this.ge===0)return;const t=iI(e),[r,s]=oI(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(r,s,i);this.be(o)}}be(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class ea extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class kc{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Nc.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new kc(G.min(),s,new Ie(Q),Pt(),Y())}}class Nc{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Nc(r,t,Y(),Y(),Y())}}class bl{constructor(e,t,r,s){this.Se=e,this.removedTargetIds=t,this.key=r,this.De=s}}class _A{constructor(e,t){this.targetId=e,this.Ce=t}}class yA{constructor(e,t,r=De.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class aI{constructor(){this.ve=0,this.Fe=cI(),this.Me=De.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Y(),t=Y(),r=Y();return this.Fe.forEach(((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:B(38017,{changeType:i})}})),new Nc(this.Me,this.xe,e,t,r)}Ke(){this.Oe=!1,this.Fe=cI()}qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}Ue(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}$e(){this.ve+=1}We(){this.ve-=1,$(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class yL{constructor(e){this.Ge=e,this.ze=new Map,this.je=Pt(),this.He=sl(),this.Je=sl(),this.Ze=new Ie(Q)}Xe(e){for(const t of e.Se)e.De&&e.De.isFoundDocument()?this.Ye(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.We(),r.Ne||r.Ke(),r.Le(e.resumeToken);break;case 2:r.We(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.Qe(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:B(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((r,s)=>{this.rt(s)&&t(s)}))}st(e){const t=e.targetId,r=e.Ce.count,s=this.ot(t);if(s){const i=s.target;if(tu(i))if(r===0){const o=new L(i.path);this.et(t,o,Ee.newNoDocument(o,G.min()))}else $(r===1,20013,{expectedCount:r});else{const o=this._t(t);if(o!==r){const a=this.ut(e),l=a?this.ct(a,e,o):1;if(l!==0){this.it(t);const u=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(t,u)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=Gn(r).toUint8Array()}catch(l){if(l instanceof Mv)return kn("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new pm(o,s,i)}catch(l){return kn(l instanceof ea?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.ge===0?null:a}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let s=0;return r.forEach((i=>{const o=this.Ge.ht(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.et(t,i,null),s++)})),s}Tt(e){const t=new Map;this.ze.forEach(((i,o)=>{const a=this.ot(o);if(a){if(i.current&&tu(a.target)){const l=new L(a.target.path);this.It(l).has(o)||this.Et(o,l)||this.et(o,l,Ee.newNoDocument(l,e))}i.Be&&(t.set(o,i.ke()),i.Ke())}}));let r=Y();this.Je.forEach(((i,o)=>{let a=!0;o.forEachWhile((l=>{const u=this.ot(l);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)})),a&&(r=r.add(i))})),this.je.forEach(((i,o)=>o.setReadTime(e)));const s=new kc(e,t,this.Ze,this.je,r);return this.je=Pt(),this.He=sl(),this.Je=sl(),this.Ze=new Ie(Q),s}Ye(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).qe(t.key,r),this.je=this.je.insert(t.key,t),this.He=this.He.insert(t.key,this.It(t.key).add(e)),this.Je=this.Je.insert(t.key,this.Rt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.qe(t,1):s.Ue(t),this.Je=this.Je.insert(t,this.Rt(t).delete(e)),this.Je=this.Je.insert(t,this.Rt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.nt(e).$e()}nt(e){let t=this.ze.get(e);return t||(t=new aI,this.ze.set(e,t)),t}Rt(e){let t=this.Je.get(e);return t||(t=new de(Q),this.Je=this.Je.insert(e,t)),t}It(e){let t=this.He.get(e);return t||(t=new de(Q),this.He=this.He.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||x("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new aI),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function sl(){return new Ie(L.comparator)}function cI(){return new Ie(L.comparator)}const IL={asc:"ASCENDING",desc:"DESCENDING"},wL={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},EL={and:"AND",or:"OR"};class TL{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function If(n,e){return n.useProto3Json||Ac(e)?e:{value:e}}function $i(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function IA(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function vL(n,e){return $i(n,e.toTimestamp())}function Le(n){return $(!!n,49232),G.fromTimestamp((function(t){const r=zn(t);return new le(r.seconds,r.nanos)})(n))}function mm(n,e){return wf(n,e).canonicalString()}function wf(n,e){const t=(function(s){return new re(["projects",s.projectId,"databases",s.database])})(n).child("documents");return e===void 0?t:t.child(e)}function wA(n){const e=re.fromString(n);return $(kA(e),10190,{key:e.toString()}),e}function Ja(n,e){return mm(n.databaseId,e.path)}function bn(n,e){const t=wA(e);if(t.get(1)!==n.databaseId.projectId)throw new D(C.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new D(C.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new L(vA(t))}function EA(n,e){return mm(n.databaseId,e)}function TA(n){const e=wA(n);return e.length===4?re.emptyPath():vA(e)}function Ef(n){return new re(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function vA(n){return $(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function lI(n,e,t){return{name:Ja(n,e),fields:t.value.mapValue.fields}}function AA(n,e,t){const r=bn(n,e.name),s=Le(e.updateTime),i=e.createTime?Le(e.createTime):G.min(),o=new nt({mapValue:{fields:e.fields}}),a=Ee.newFoundDocument(r,s,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function AL(n,e){return"found"in e?(function(r,s){$(!!s.found,43571),s.found.name,s.found.updateTime;const i=bn(r,s.found.name),o=Le(s.found.updateTime),a=s.found.createTime?Le(s.found.createTime):G.min(),l=new nt({mapValue:{fields:s.found.fields}});return Ee.newFoundDocument(i,o,a,l)})(n,e):"missing"in e?(function(r,s){$(!!s.missing,3894),$(!!s.readTime,22933);const i=bn(r,s.missing),o=Le(s.readTime);return Ee.newNoDocument(i,o)})(n,e):B(7234,{result:e})}function bL(n,e){let t;if("targetChange"in e){e.targetChange;const r=(function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:B(39313,{state:u})})(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=(function(u,h){return u.useProto3Json?($(h===void 0||typeof h=="string",58123),De.fromBase64String(h||"")):($(h===void 0||h instanceof Buffer||h instanceof Uint8Array,16193),De.fromUint8Array(h||new Uint8Array))})(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&(function(u){const h=u.code===void 0?C.UNKNOWN:mA(u.code);return new D(h,u.message||"")})(o);t=new yA(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=bn(n,r.document.name),i=Le(r.document.updateTime),o=r.document.createTime?Le(r.document.createTime):G.min(),a=new nt({mapValue:{fields:r.document.fields}}),l=Ee.newFoundDocument(s,i,o,a),u=r.targetIds||[],h=r.removedTargetIds||[];t=new bl(u,h,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=bn(n,r.document),i=r.readTime?Le(r.readTime):G.min(),o=Ee.newNoDocument(s,i),a=r.removedTargetIds||[];t=new bl([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=bn(n,r.document),i=r.removedTargetIds||[];t=new bl([],i,s,null)}else{if(!("filter"in e))return B(11601,{Vt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new gL(s,i),a=r.targetId;t=new _A(a,o)}}return t}function Xa(n,e){let t;if(e instanceof lo)t={update:lI(n,e.key,e.value)};else if(e instanceof uo)t={delete:Ja(n,e.key)};else if(e instanceof Yn)t={update:lI(n,e.key,e.data),updateMask:NL(e.fieldMask)};else{if(!(e instanceof um))return B(16599,{dt:e.type});t={verify:Ja(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((r=>(function(i,o){const a=o.transform;if(a instanceof qi)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Cs)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Ps)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Wi)return{fieldPath:o.field.canonicalString(),increment:a.Ae};throw B(20930,{transform:o.transform})})(0,r)))),e.precondition.isNone||(t.currentDocument=(function(s,i){return i.updateTime!==void 0?{updateTime:vL(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:B(27497)})(n,e.precondition)),t}function Tf(n,e){const t=e.currentDocument?(function(i){return i.updateTime!==void 0?Re.updateTime(Le(i.updateTime)):i.exists!==void 0?Re.exists(i.exists):Re.none()})(e.currentDocument):Re.none(),r=e.updateTransforms?e.updateTransforms.map((s=>(function(o,a){let l=null;if("setToServerValue"in a)$(a.setToServerValue==="REQUEST_TIME",16630,{proto:a}),l=new qi;else if("appendMissingElements"in a){const h=a.appendMissingElements.values||[];l=new Cs(h)}else if("removeAllFromArray"in a){const h=a.removeAllFromArray.values||[];l=new Ps(h)}else"increment"in a?l=new Wi(o,a.increment):B(16584,{proto:a});const u=be.fromServerFormat(a.fieldPath);return new Pc(u,l)})(n,s))):[];if(e.update){e.update.name;const s=bn(n,e.update.name),i=new nt({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=(function(l){const u=l.fieldPaths||[];return new Ct(u.map((h=>be.fromServerFormat(h))))})(e.updateMask);return new Yn(s,i,o,t,r)}return new lo(s,i,t,r)}if(e.delete){const s=bn(n,e.delete);return new uo(s,t)}if(e.verify){const s=bn(n,e.verify);return new um(s,t)}return B(1463,{proto:e})}function RL(n,e){return n&&n.length>0?($(e!==void 0,14353),n.map((t=>(function(s,i){let o=s.updateTime?Le(s.updateTime):Le(i);return o.isEqual(G.min())&&(o=Le(i)),new fL(o,s.transformResults||[])})(t,e)))):[]}function bA(n,e){return{documents:[EA(n,e.path)]}}function RA(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=EA(n,s);const i=(function(u){if(u.length!==0)return PA(he.create(u,"and"))})(e.filters);i&&(t.structuredQuery.where=i);const o=(function(u){if(u.length!==0)return u.map((h=>(function(m){return{field:li(m.field),direction:CL(m.dir)}})(h)))})(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=If(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=(function(u){return{before:u.inclusive,values:u.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(u){return{before:!u.inclusive,values:u.position}})(e.endAt)),{ft:t,parent:s}}function SA(n){let e=TA(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){$(r===1,65062);const h=t.from[0];h.allDescendants?s=h.collectionId:e=e.child(h.collectionId)}let i=[];t.where&&(i=(function(f){const m=CA(f);return m instanceof he&&om(m)?m.getFilters():[m]})(t.where));let o=[];t.orderBy&&(o=(function(f){return f.map((m=>(function(A){return new Ya(ui(A.field),(function(N){switch(N){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(A.direction))})(m)))})(t.orderBy));let a=null;t.limit&&(a=(function(f){let m;return m=typeof f=="object"?f.value:f,Ac(m)?null:m})(t.limit));let l=null;t.startAt&&(l=(function(f){const m=!!f.before,_=f.values||[];return new Vr(_,m)})(t.startAt));let u=null;return t.endAt&&(u=(function(f){const m=!f.before,_=f.values||[];return new Vr(_,m)})(t.endAt)),Zv(e,s,o,i,a,"F",l,u)}function SL(n,e){const t=(function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return B(28987,{purpose:s})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function CA(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=ui(t.unaryFilter.field);return se.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=ui(t.unaryFilter.field);return se.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=ui(t.unaryFilter.field);return se.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=ui(t.unaryFilter.field);return se.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return B(61313);default:return B(60726)}})(n):n.fieldFilter!==void 0?(function(t){return se.create(ui(t.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return B(58110);default:return B(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return he.create(t.compositeFilter.filters.map((r=>CA(r))),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return B(1026)}})(t.compositeFilter.op))})(n):B(30097,{filter:n})}function CL(n){return IL[n]}function PL(n){return wL[n]}function kL(n){return EL[n]}function li(n){return{fieldPath:n.canonicalString()}}function ui(n){return be.fromServerFormat(n.fieldPath)}function PA(n){return n instanceof se?(function(t){if(t.op==="=="){if(Hy(t.value))return{unaryFilter:{field:li(t.field),op:"IS_NAN"}};if(jy(t.value))return{unaryFilter:{field:li(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Hy(t.value))return{unaryFilter:{field:li(t.field),op:"IS_NOT_NAN"}};if(jy(t.value))return{unaryFilter:{field:li(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:li(t.field),op:PL(t.op),value:t.value}}})(n):n instanceof he?(function(t){const r=t.getFilters().map((s=>PA(s)));return r.length===1?r[0]:{compositeFilter:{op:kL(t.op),filters:r}}})(n):B(54877,{filter:n})}function NL(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function kA(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}function NA(n){return!!n&&typeof n._toProto=="function"&&n._protoValueType==="ProtoValue"}class Ln{constructor(e,t,r,s,i=G.min(),o=G.min(),a=De.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new Ln(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Ln(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Ln(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Ln(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class DA{constructor(e){this.yt=e}}function DL(n,e){let t;if(e.document)t=AA(n.yt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=L.fromSegments(e.noDocument.path),s=Ns(e.noDocument.readTime);t=Ee.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return B(56709);{const r=L.fromSegments(e.unknownDocument.path),s=Ns(e.unknownDocument.version);t=Ee.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime((function(s){const i=new le(s[0],s[1]);return G.fromTimestamp(i)})(e.readTime)),t}function uI(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:su(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=(function(i,o){return{name:Ja(i,o.key),fields:o.data.value.mapValue.fields,updateTime:$i(i,o.version.toTimestamp()),createTime:$i(i,o.createTime.toTimestamp())}})(n.yt,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:ks(e.version)};else{if(!e.isUnknownDocument())return B(57904,{document:e});r.unknownDocument={path:t.path.toArray(),version:ks(e.version)}}return r}function su(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function ks(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Ns(n){const e=new le(n.seconds,n.nanoseconds);return G.fromTimestamp(e)}function ss(n,e){const t=(e.baseMutations||[]).map((i=>Tf(n.yt,i)));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map((i=>Tf(n.yt,i))),s=le.fromMillis(e.localWriteTimeMs);return new hm(e.batchId,s,t,r)}function ta(n){const e=Ns(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Ns(n.lastLimboFreeSnapshotVersion):G.min();let r;return r=(function(i){return i.documents!==void 0})(n.query)?(function(i){const o=i.documents.length;return $(o===1,1966,{count:o}),Tt(co(TA(i.documents[0])))})(n.query):(function(i){return Tt(SA(i))})(n.query),new Ln(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,De.fromBase64String(n.resumeToken))}function xA(n,e){const t=ks(e.snapshotVersion),r=ks(e.lastLimboFreeSnapshotVersion);let s;s=tu(e.target)?bA(n.yt,e.target):RA(n.yt,e.target).ft;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Ss(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function gm(n){const e=SA({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?ru(e,e.limit,"L"):e}function md(n,e){return new fm(e.largestBatchId,Tf(n.yt,e.overlayMutation))}function hI(n,e){const t=e.path.lastSegment();return[n,dt(e.path.popLast()),t]}function dI(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:ks(r.readTime),documentKey:dt(r.documentKey.path),largestBatchId:r.largestBatchId}}class xL{getBundleMetadata(e,t){return fI(e).get(t).next((r=>{if(r)return(function(i){return{id:i.bundleId,createTime:Ns(i.createTime),version:i.version}})(r)}))}saveBundleMetadata(e,t){return fI(e).put((function(s){return{bundleId:s.id,createTime:ks(Le(s.createTime)),version:s.version}})(t))}getNamedQuery(e,t){return pI(e).get(t).next((r=>{if(r)return(function(i){return{name:i.name,query:gm(i.bundledQuery),readTime:Ns(i.readTime)}})(r)}))}saveNamedQuery(e,t){return pI(e).put((function(s){return{name:s.name,readTime:ks(Le(s.readTime)),bundledQuery:s.bundledQuery}})(t))}}function fI(n){return Ge(n,Zu)}function pI(n){return Ge(n,eh)}class ah{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){const r=t.uid||"";return new ah(e,r)}getOverlay(e,t){return qo(e).get(hI(this.userId,t)).next((r=>r?md(this.serializer,r):null))}getOverlays(e,t){const r=Tn();return b.forEach(t,(s=>this.getOverlay(e,s).next((i=>{i!==null&&r.set(s,i)})))).next((()=>r))}saveOverlays(e,t,r){const s=[];return r.forEach(((i,o)=>{const a=new fm(t,o);s.push(this.bt(e,a))})),b.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach((o=>s.add(dt(o.getCollectionPath()))));const i=[];return s.forEach((o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(qo(e).X(uf,a))})),b.waitFor(i)}getOverlaysForCollection(e,t,r){const s=Tn(),i=dt(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return qo(e).H(uf,o).next((a=>{for(const l of a){const u=md(this.serializer,l);s.set(u.getKey(),u)}return s}))}getOverlaysForCollectionGroup(e,t,r,s){const i=Tn();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return qo(e).ee({index:Nv,range:a},((l,u,h)=>{const f=md(this.serializer,u);i.size()<s||f.largestBatchId===o?(i.set(f.getKey(),f),o=f.largestBatchId):h.done()})).next((()=>i))}bt(e,t){return qo(e).put((function(s,i,o){const[a,l,u]=hI(i,o.mutation.key);return{userId:i,collectionPath:l,documentId:u,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Xa(s.yt,o.mutation)}})(this.serializer,this.userId,t))}}function qo(n){return Ge(n,th)}class OL{St(e){return Ge(e,nm)}getSessionToken(e){return this.St(e).get("sessionToken").next((t=>{const r=t?.value;return r?De.fromUint8Array(r):De.EMPTY_BYTE_STRING}))}setSessionToken(e,t){return this.St(e).put({name:"sessionToken",value:t.toUint8Array()})}}class is{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(ve(e.integerValue));else if("doubleValue"in e){const r=ve(e.doubleValue);isNaN(r)?this.Ft(t,13):(this.Ft(t,15),$a(r)?t.Mt(0):t.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(t,20),typeof r=="string"&&(r=zn(r)),t.xt(`${r.seconds||""}`),t.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(Gn(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.Ft(t,45),t.Mt(r.latitude||0),t.Mt(r.longitude||0)}else"mapValue"in e?$v(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):sh(e)?this.kt(e.mapValue,t):(this.Kt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Nt(t)):B(19022,{Ut:e})}Ot(e,t){this.Ft(t,25),this.$t(e,t)}$t(e,t){t.xt(e)}Kt(e,t){const r=e.fields||{};this.Ft(t,55);for(const s of Object.keys(r))this.Ot(s,t),this.Ct(r[s],t)}kt(e,t){const r=e.fields||{};this.Ft(t,53);const s=Fi,i=r[s].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(ve(i)),this.Ot(s,t),this.Ct(r[s],t)}qt(e,t){const r=e.values||[];this.Ft(t,50);for(const s of r)this.Ct(s,t)}Lt(e,t){this.Ft(t,37),L.fromName(e).path.forEach((r=>{this.Ft(t,60),this.$t(r,t)}))}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}is.Wt=new is;const ti=255;function VL(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n<<=4),n>>6||(e+=2,n<<=2),n>>7||(e+=1),e}function mI(n){const e=64-(function(r){let s=0;for(let i=0;i<8;++i){const o=VL(255&r[i]);if(s+=o,o!==8)break}return s})(n);return Math.ceil(e/8)}class LL{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Qt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Gt(r.value),r=t.next();this.zt()}jt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ht(r.value),r=t.next();this.Jt()}Zt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Gt(r);else if(r<2048)this.Gt(960|r>>>6),this.Gt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|r>>>12),this.Gt(128|63&r>>>6),this.Gt(128|63&r);else{const s=t.codePointAt(0);this.Gt(240|s>>>18),this.Gt(128|63&s>>>12),this.Gt(128|63&s>>>6),this.Gt(128|63&s)}}this.zt()}Xt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ht(r);else if(r<2048)this.Ht(960|r>>>6),this.Ht(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ht(480|r>>>12),this.Ht(128|63&r>>>6),this.Ht(128|63&r);else{const s=t.codePointAt(0);this.Ht(240|s>>>18),this.Ht(128|63&s>>>12),this.Ht(128|63&s>>>6),this.Ht(128|63&s)}}this.Jt()}Yt(e){const t=this.en(e),r=mI(t);this.tn(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}nn(e){const t=this.en(e),r=mI(t);this.tn(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}rn(){this.sn(ti),this.sn(255)}_n(){this.an(ti),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){const t=(function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)})(e),r=!!(128&t[0]);t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Gt(e){const t=255&e;t===0?(this.sn(0),this.sn(255)):t===ti?(this.sn(ti),this.sn(0)):this.sn(t)}Ht(e){const t=255&e;t===0?(this.an(0),this.an(255)):t===ti?(this.an(ti),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Jt(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class ML{constructor(e){this.cn=e}Bt(e){this.cn.Qt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.Yt(e)}vt(){this.cn.rn()}}class FL{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Xt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class Wo{constructor(){this.cn=new LL,this.ascending=new ML(this.cn),this.descending=new FL(this.cn)}seed(e){this.cn.seed(e)}ln(e){return e===0?this.ascending:this.descending}un(){return this.cn.un()}reset(){this.cn.reset()}}class os{constructor(e,t,r,s){this.hn=e,this.Pn=t,this.Tn=r,this.In=s}En(){const e=this.In.length,t=e===0||this.In[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.In,0),t!==e?r.set([0],this.In.length):++r[r.length-1],new os(this.hn,this.Pn,this.Tn,r)}Rn(e,t,r){return{indexId:this.hn,uid:e,arrayValue:Rl(this.Tn),directionalValue:Rl(this.In),orderedDocumentKey:Rl(t),documentKey:r.path.toArray()}}An(e,t,r){const s=this.Rn(e,t,r);return[s.indexId,s.uid,s.arrayValue,s.directionalValue,s.orderedDocumentKey,s.documentKey]}}function or(n,e){let t=n.hn-e.hn;return t!==0?t:(t=gI(n.Tn,e.Tn),t!==0?t:(t=gI(n.In,e.In),t!==0?t:L.comparator(n.Pn,e.Pn)))}function gI(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}function Rl(n){return Cw()?(function(t){let r="";for(let s=0;s<t.length;s++)r+=String.fromCharCode(t[s]);return r})(n):n}function _I(n){return typeof n!="string"?n:(function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r})(n)}class yI{constructor(e){this.Vn=new de(((t,r)=>be.comparator(t.field,r.field))),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.dn=e.orderBy,this.mn=[];for(const t of e.filters){const r=t;r.isInequality()?this.Vn=this.Vn.add(r):this.mn.push(r)}}get fn(){return this.Vn.size>1}gn(e){if($(e.collectionGroup===this.collectionId,49279),this.fn)return!1;const t=af(e);if(t!==void 0&&!this.pn(t))return!1;const r=ts(e);let s=new Set,i=0,o=0;for(;i<r.length&&this.pn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.Vn.size>0){const a=this.Vn.getIterator().getNext();if(!s.has(a.field.canonicalString())){const l=r[i];if(!this.yn(a,l)||!this.wn(this.dn[o++],l))return!1}++i}for(;i<r.length;++i){const a=r[i];if(o>=this.dn.length||!this.wn(this.dn[o++],a))return!1}return!0}bn(){if(this.fn)return null;let e=new de(be.comparator);const t=[];for(const r of this.mn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new yl(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new yl(r.field,0))}for(const r of this.dn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new yl(r.field,r.dir==="asc"?0:1)));return new Jl(Jl.UNKNOWN_ID,this.collectionId,t,Wa.empty())}pn(e){for(const t of this.mn)if(this.yn(t,e))return!0;return!1}yn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}wn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}function OA(n){if($(n instanceof se||n instanceof he,20012),n instanceof se){if(n instanceof Xv){const t=n.value.arrayValue?.values?.map((r=>se.create(n.field,"==",r)))||[];return he.create(t,"or")}return n}const e=n.filters.map((t=>OA(t)));return he.create(e,n.op)}function UL(n){if(n.getFilters().length===0)return[];const e=bf(OA(n));return $(VA(e),7391),vf(e)||Af(e)?[e]:e.getFilters()}function vf(n){return n instanceof se}function Af(n){return n instanceof he&&om(n)}function VA(n){return vf(n)||Af(n)||(function(t){if(t instanceof he&&mf(t)){for(const r of t.getFilters())if(!vf(r)&&!Af(r))return!1;return!0}return!1})(n)}function bf(n){if($(n instanceof se||n instanceof he,34018),n instanceof se)return n;if(n.filters.length===1)return bf(n.filters[0]);const e=n.filters.map((r=>bf(r)));let t=he.create(e,n.op);return t=iu(t),VA(t)?t:($(t instanceof he,64498),$(Bi(t),40251),$(t.filters.length>1,57927),t.filters.reduce(((r,s)=>_m(r,s))))}function _m(n,e){let t;return $(n instanceof se||n instanceof he,38388),$(e instanceof se||e instanceof he,25473),t=n instanceof se?e instanceof se?(function(s,i){return he.create([s,i],"and")})(n,e):II(n,e):e instanceof se?II(e,n):(function(s,i){if($(s.filters.length>0&&i.filters.length>0,48005),Bi(s)&&Bi(i))return Qv(s,i.getFilters());const o=mf(s)?s:i,a=mf(s)?i:s,l=o.filters.map((u=>_m(u,a)));return he.create(l,"or")})(n,e),iu(t)}function II(n,e){if(Bi(e))return Qv(e,n.getFilters());{const t=e.filters.map((r=>_m(n,r)));return he.create(t,"or")}}function iu(n){if($(n instanceof se||n instanceof he,11850),n instanceof se)return n;const e=n.getFilters();if(e.length===1)return iu(e[0]);if(Hv(n))return n;const t=e.map((s=>iu(s))),r=[];return t.forEach((s=>{s instanceof se?r.push(s):s instanceof he&&(s.op===n.op?r.push(...s.filters):r.push(s))})),r.length===1?r[0]:he.create(r,n.op)}class BL{constructor(){this.Sn=new ym}addToCollectionParentIndex(e,t){return this.Sn.add(t),b.resolve()}getCollectionParents(e,t){return b.resolve(this.Sn.getEntries(t))}addFieldIndex(e,t){return b.resolve()}deleteFieldIndex(e,t){return b.resolve()}deleteAllFieldIndexes(e){return b.resolve()}createTargetIndexes(e,t){return b.resolve()}getDocumentsMatchingTarget(e,t){return b.resolve(null)}getIndexType(e,t){return b.resolve(0)}getFieldIndexes(e,t){return b.resolve([])}getNextCollectionGroupToUpdate(e){return b.resolve(null)}getMinOffset(e,t){return b.resolve(qt.min())}getMinOffsetFromCollectionGroup(e,t){return b.resolve(qt.min())}updateCollectionGroup(e,t,r){return b.resolve()}updateIndexEntries(e,t){return b.resolve()}}class ym{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new de(re.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new de(re.comparator)).toArray()}}const wI="IndexedDbIndexManager",il=new Uint8Array(0);class qL{constructor(e,t){this.databaseId=t,this.Dn=new ym,this.Cn=new Qn((r=>Ss(r)),((r,s)=>Rc(r,s))),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Dn.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener((()=>{this.Dn.add(t)}));const i={collectionId:r,parent:dt(s)};return EI(e).put(i)}return b.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[gv(t),""],!1,!0);return EI(e).H(s).next((i=>{for(const o of i){if(o.collectionId!==t)break;r.push(En(o.parent))}return r}))}addFieldIndex(e,t){const r=$o(e),s=(function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map((l=>[l.fieldPath.canonicalString(),l.kind]))}})(t);delete s.indexId;const i=r.add(s);if(t.indexState){const o=ri(e);return i.next((a=>{o.put(dI(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))}))}return i.next()}deleteFieldIndex(e,t){const r=$o(e),s=ri(e),i=ni(e);return r.delete(t.indexId).next((()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))).next((()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))))}deleteAllFieldIndexes(e){const t=$o(e),r=ni(e),s=ri(e);return t.X().next((()=>r.X())).next((()=>s.X()))}createTargetIndexes(e,t){return b.forEach(this.vn(t),(r=>this.getIndexType(e,r).next((s=>{if(s===0||s===1){const i=new yI(r).bn();if(i!=null)return this.addFieldIndex(e,i)}}))))}getDocumentsMatchingTarget(e,t){const r=ni(e);let s=!0;const i=new Map;return b.forEach(this.vn(t),(o=>this.Fn(e,o).next((a=>{s&&(s=!!a),i.set(o,a)})))).next((()=>{if(s){let o=Y();const a=[];return b.forEach(i,((l,u)=>{x(wI,`Using index ${(function(q){return`id=${q.indexId}|cg=${q.collectionGroup}|f=${q.fields.map((K=>`${K.fieldPath}:${K.kind}`)).join(",")}`})(l)} to execute ${Ss(t)}`);const h=(function(q,K){const ie=af(K);if(ie===void 0)return null;for(const J of nu(q,ie.fieldPath))switch(J.op){case"array-contains-any":return J.value.arrayValue.values||[];case"array-contains":return[J.value]}return null})(u,l),f=(function(q,K){const ie=new Map;for(const J of ts(K))for(const E of nu(q,J.fieldPath))switch(E.op){case"==":case"in":ie.set(J.fieldPath.canonicalString(),E.value);break;case"not-in":case"!=":return ie.set(J.fieldPath.canonicalString(),E.value),Array.from(ie.values())}return null})(u,l),m=(function(q,K){const ie=[];let J=!0;for(const E of ts(K)){const y=E.kind===0?Xy(q,E.fieldPath,q.startAt):Zy(q,E.fieldPath,q.startAt);ie.push(y.value),J&&(J=y.inclusive)}return new Vr(ie,J)})(u,l),_=(function(q,K){const ie=[];let J=!0;for(const E of ts(K)){const y=E.kind===0?Zy(q,E.fieldPath,q.endAt):Xy(q,E.fieldPath,q.endAt);ie.push(y.value),J&&(J=y.inclusive)}return new Vr(ie,J)})(u,l),A=this.Mn(l,u,m),k=this.Mn(l,u,_),N=this.xn(l,u,f),W=this.On(l.indexId,h,A,m.inclusive,k,_.inclusive,N);return b.forEach(W,(z=>r.Z(z,t.limit).next((q=>{q.forEach((K=>{const ie=L.fromSegments(K.documentKey);o.has(ie)||(o=o.add(ie),a.push(ie))}))}))))})).next((()=>a))}return b.resolve(null)}))}vn(e){let t=this.Cn.get(e);return t||(e.filters.length===0?t=[e]:t=UL(he.create(e.filters,"and")).map((r=>_f(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt))),this.Cn.set(e,t),t)}On(e,t,r,s,i,o,a){const l=(t!=null?t.length:1)*Math.max(r.length,i.length),u=l/(t!=null?t.length:1),h=[];for(let f=0;f<l;++f){const m=t?this.Nn(t[f/u]):il,_=this.Bn(e,m,r[f%u],s),A=this.Ln(e,m,i[f%u],o),k=a.map((N=>this.Bn(e,m,N,!0)));h.push(...this.createRange(_,A,k))}return h}Bn(e,t,r,s){const i=new os(e,L.empty(),t,r);return s?i:i.En()}Ln(e,t,r,s){const i=new os(e,L.empty(),t,r);return s?i.En():i}Fn(e,t){const r=new yI(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next((i=>{let o=null;for(const a of i)r.gn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o}))}getIndexType(e,t){let r=2;const s=this.vn(t);return b.forEach(s,(i=>this.Fn(e,i).next((o=>{o?r!==0&&o.fields.length<(function(l){let u=new de(be.comparator),h=!1;for(const f of l.filters)for(const m of f.getFlattenedFilters())m.field.isKeyField()||(m.op==="array-contains"||m.op==="array-contains-any"?h=!0:u=u.add(m.field));for(const f of l.orderBy)f.field.isKeyField()||(u=u.add(f.field));return u.size+(h?1:0)})(i)&&(r=1):r=0})))).next((()=>(function(o){return o.limit!==null})(t)&&s.length>1&&r===2?1:r))}kn(e,t){const r=new Wo;for(const s of ts(e)){const i=t.data.field(s.fieldPath);if(i==null)return null;const o=r.ln(s.kind);is.Wt.Dt(i,o)}return r.un()}Nn(e){const t=new Wo;return is.Wt.Dt(e,t.ln(0)),t.un()}Kn(e,t){const r=new Wo;return is.Wt.Dt(Rs(this.databaseId,t),r.ln((function(i){const o=ts(i);return o.length===0?0:o[o.length-1].kind})(e))),r.un()}xn(e,t,r){if(r===null)return[];let s=[];s.push(new Wo);let i=0;for(const o of ts(e)){const a=r[i++];for(const l of s)if(this.qn(t,o.fieldPath)&&Qa(a))s=this.Un(s,o,a);else{const u=l.ln(o.kind);is.Wt.Dt(a,u)}}return this.$n(s)}Mn(e,t,r){return this.xn(e,t,r.position)}$n(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].un();return t}Un(e,t,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const l=new Wo;l.seed(a.un()),is.Wt.Dt(o,l.ln(t.kind)),i.push(l)}return i}qn(e,t){return!!e.filters.find((r=>r instanceof se&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in")))}getFieldIndexes(e,t){const r=$o(e),s=ri(e);return(t?r.H(lf,IDBKeyRange.bound(t,t)):r.H()).next((i=>{const o=[];return b.forEach(i,(a=>s.get([a.indexId,this.uid]).next((l=>{o.push((function(h,f){const m=f?new Wa(f.sequenceNumber,new qt(Ns(f.readTime),new L(En(f.documentKey)),f.largestBatchId)):Wa.empty(),_=h.fields.map((([A,k])=>new yl(be.fromServerFormat(A),k)));return new Jl(h.indexId,h.collectionGroup,_,m)})(a,l))})))).next((()=>o))}))}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next((t=>t.length===0?null:(t.sort(((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:Q(r.collectionGroup,s.collectionGroup)})),t[0].collectionGroup)))}updateCollectionGroup(e,t,r){const s=$o(e),i=ri(e);return this.Wn(e).next((o=>s.H(lf,IDBKeyRange.bound(t,t)).next((a=>b.forEach(a,(l=>i.put(dI(l.indexId,this.uid,o,r))))))))}updateIndexEntries(e,t){const r=new Map;return b.forEach(t,((s,i)=>{const o=r.get(s.collectionGroup);return(o?b.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next((a=>(r.set(s.collectionGroup,a),b.forEach(a,(l=>this.Qn(e,s,l).next((u=>{const h=this.Gn(i,l);return u.isEqual(h)?b.resolve():this.zn(e,i,l,u,h)})))))))}))}jn(e,t,r,s){return ni(e).put(s.Rn(this.uid,this.Kn(r,t.key),t.key))}Hn(e,t,r,s){return ni(e).delete(s.An(this.uid,this.Kn(r,t.key),t.key))}Qn(e,t,r){const s=ni(e);let i=new de(or);return s.ee({index:kv,range:IDBKeyRange.only([r.indexId,this.uid,Rl(this.Kn(r,t))])},((o,a)=>{i=i.add(new os(r.indexId,t,_I(a.arrayValue),_I(a.directionalValue)))})).next((()=>i))}Gn(e,t){let r=new de(or);const s=this.kn(t,e);if(s==null)return r;const i=af(t);if(i!=null){const o=e.data.field(i.fieldPath);if(Qa(o))for(const a of o.arrayValue.values||[])r=r.add(new os(t.indexId,e.key,this.Nn(a),s))}else r=r.add(new os(t.indexId,e.key,il,s));return r}zn(e,t,r,s,i){x(wI,"Updating index entries for document '%s'",t.key);const o=[];return(function(l,u,h,f,m){const _=l.getIterator(),A=u.getIterator();let k=ei(_),N=ei(A);for(;k||N;){let W=!1,z=!1;if(k&&N){const q=h(k,N);q<0?z=!0:q>0&&(W=!0)}else k!=null?z=!0:W=!0;W?(f(N),N=ei(A)):z?(m(k),k=ei(_)):(k=ei(_),N=ei(A))}})(s,i,or,(a=>{o.push(this.jn(e,t,r,a))}),(a=>{o.push(this.Hn(e,t,r,a))})),b.waitFor(o)}Wn(e){let t=1;return ri(e).ee({index:Pv,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((r,s,i)=>{i.done(),t=s.sequenceNumber+1})).next((()=>t))}createRange(e,t,r){r=r.sort(((o,a)=>or(o,a))).filter(((o,a,l)=>!a||or(o,l[a-1])!==0));const s=[];s.push(e);for(const o of r){const a=or(o,e),l=or(o,t);if(a===0)s[0]=e.En();else if(a>0&&l<0)s.push(o),s.push(o.En());else if(l>0)break}s.push(t);const i=[];for(let o=0;o<s.length;o+=2){if(this.Jn(s[o],s[o+1]))return[];const a=s[o].An(this.uid,il,L.empty()),l=s[o+1].An(this.uid,il,L.empty());i.push(IDBKeyRange.bound(a,l))}return i}Jn(e,t){return or(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(TI)}getMinOffset(e,t){return b.mapArray(this.vn(t),(r=>this.Fn(e,r).next((s=>s||B(44426))))).next(TI)}}function EI(n){return Ge(n,ja)}function ni(n){return Ge(n,ga)}function $o(n){return Ge(n,tm)}function ri(n){return Ge(n,ma)}function TI(n){$(n.length!==0,28825);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;Xp(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new qt(e.readTime,e.documentKey,t)}const vI={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},LA=41943040;class ct{static withCacheSize(e){return new ct(e,ct.DEFAULT_COLLECTION_PERCENTILE,ct.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}function MA(n,e,t){const r=n.store(Zt),s=n.store(Oi),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const l=r.ee({range:o},((h,f,m)=>(a++,m.delete())));i.push(l.next((()=>{$(a===1,47070,{batchId:t.batchId})})));const u=[];for(const h of t.mutations){const f=Rv(e,h.key.path,t.batchId);i.push(s.delete(f)),u.push(h.key)}return b.waitFor(i).next((()=>u))}function ou(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw B(14731);e=n.noDocument}return JSON.stringify(e).length}ct.DEFAULT_COLLECTION_PERCENTILE=10,ct.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ct.DEFAULT=new ct(LA,ct.DEFAULT_COLLECTION_PERCENTILE,ct.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ct.DISABLED=new ct(-1,0,0);class ch{constructor(e,t,r,s){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=s,this.Zn={}}static wt(e,t,r,s){$(e.uid!=="",64387);const i=e.isAuthenticated()?e.uid:"";return new ch(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ar(e).ee({index:hs,range:r},((s,i,o)=>{t=!1,o.done()})).next((()=>t))}addMutationBatch(e,t,r,s){const i=hi(e),o=ar(e);return o.add({}).next((a=>{$(typeof a=="number",49019);const l=new hm(a,t,r,s),u=(function(_,A,k){const N=k.baseMutations.map((z=>Xa(_.yt,z))),W=k.mutations.map((z=>Xa(_.yt,z)));return{userId:A,batchId:k.batchId,localWriteTimeMs:k.localWriteTime.toMillis(),baseMutations:N,mutations:W}})(this.serializer,this.userId,l),h=[];let f=new de(((m,_)=>Q(m.canonicalString(),_.canonicalString())));for(const m of s){const _=Rv(this.userId,m.key.path,a);f=f.add(m.key.path.popLast()),h.push(o.put(u)),h.push(i.put(_,g1))}return f.forEach((m=>{h.push(this.indexManager.addToCollectionParentIndex(e,m))})),e.addOnCommittedListener((()=>{this.Zn[a]=l.keys()})),b.waitFor(h).next((()=>l))}))}lookupMutationBatch(e,t){return ar(e).get(t).next((r=>r?($(r.userId===this.userId,48,"Unexpected user for mutation batch",{userId:r.userId,batchId:t}),ss(this.serializer,r)):null))}Xn(e,t){return this.Zn[t]?b.resolve(this.Zn[t]):this.lookupMutationBatch(e,t).next((r=>{if(r){const s=r.keys();return this.Zn[t]=s,s}return null}))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return ar(e).ee({index:hs,range:s},((o,a,l)=>{a.userId===this.userId&&($(a.batchId>=r,47524,{Yn:r}),i=ss(this.serializer,a)),l.done()})).next((()=>i))}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=Tr;return ar(e).ee({index:hs,range:t,reverse:!0},((s,i,o)=>{r=i.batchId,o.done()})).next((()=>r))}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,Tr],[this.userId,Number.POSITIVE_INFINITY]);return ar(e).H(hs,t).next((r=>r.map((s=>ss(this.serializer,s)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=Il(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return hi(e).ee({range:s},((o,a,l)=>{const[u,h,f]=o,m=En(h);if(u===this.userId&&t.path.isEqual(m))return ar(e).get(f).next((_=>{if(!_)throw B(61480,{er:o,batchId:f});$(_.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:_.userId,batchId:f}),i.push(ss(this.serializer,_))}));l.done()})).next((()=>i))}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new de(Q);const s=[];return t.forEach((i=>{const o=Il(this.userId,i.path),a=IDBKeyRange.lowerBound(o),l=hi(e).ee({range:a},((u,h,f)=>{const[m,_,A]=u,k=En(_);m===this.userId&&i.path.isEqual(k)?r=r.add(A):f.done()}));s.push(l)})),b.waitFor(s).next((()=>this.tr(e,r)))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=Il(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new de(Q);return hi(e).ee({range:o},((l,u,h)=>{const[f,m,_]=l,A=En(m);f===this.userId&&r.isPrefixOf(A)?A.length===s&&(a=a.add(_)):h.done()})).next((()=>this.tr(e,a)))}tr(e,t){const r=[],s=[];return t.forEach((i=>{s.push(ar(e).get(i).next((o=>{if(o===null)throw B(35274,{batchId:i});$(o.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:o.userId,batchId:i}),r.push(ss(this.serializer,o))})))})),b.waitFor(s).next((()=>r))}removeMutationBatch(e,t){return MA(e.le,this.userId,t).next((r=>(e.addOnCommittedListener((()=>{this.nr(t.batchId)})),b.forEach(r,(s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))))}nr(e){delete this.Zn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return b.resolve();const r=IDBKeyRange.lowerBound((function(o){return[o]})(this.userId)),s=[];return hi(e).ee({range:r},((i,o,a)=>{if(i[0]===this.userId){const l=En(i[1]);s.push(l)}else a.done()})).next((()=>{$(s.length===0,56720,{rr:s.map((i=>i.canonicalString()))})}))}))}containsKey(e,t){return FA(e,this.userId,t)}ir(e){return UA(e).get(this.userId).next((t=>t||{userId:this.userId,lastAcknowledgedBatchId:Tr,lastStreamToken:""}))}}function FA(n,e,t){const r=Il(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return hi(n).ee({range:i,Y:!0},((a,l,u)=>{const[h,f,m]=a;h===e&&f===s&&(o=!0),u.done()})).next((()=>o))}function ar(n){return Ge(n,Zt)}function hi(n){return Ge(n,Oi)}function UA(n){return Ge(n,za)}class Ds{constructor(e){this.sr=e}next(){return this.sr+=2,this.sr}static _r(){return new Ds(0)}static ar(){return new Ds(-1)}}class WL{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.ur(e).next((t=>{const r=new Ds(t.highestTargetId);return t.highestTargetId=r.next(),this.cr(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.ur(e).next((t=>G.fromTimestamp(new le(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.ur(e).next((t=>t.highestListenSequenceNumber))}setTargetsMetadata(e,t,r){return this.ur(e).next((s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.cr(e,s))))}addTargetData(e,t){return this.lr(e,t).next((()=>this.ur(e).next((r=>(r.targetCount+=1,this.hr(t,r),this.cr(e,r))))))}updateTargetData(e,t){return this.lr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>si(e).delete(t.targetId))).next((()=>this.ur(e))).next((r=>($(r.targetCount>0,8065),r.targetCount-=1,this.cr(e,r))))}removeTargets(e,t,r){let s=0;const i=[];return si(e).ee(((o,a)=>{const l=ta(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(s++,i.push(this.removeTargetData(e,l)))})).next((()=>b.waitFor(i))).next((()=>s))}forEachTarget(e,t){return si(e).ee(((r,s)=>{const i=ta(s);t(i)}))}ur(e){return AI(e).get(eu).next((t=>($(t!==null,2888),t)))}cr(e,t){return AI(e).put(eu,t)}lr(e,t){return si(e).put(xA(this.serializer,t))}hr(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.ur(e).next((t=>t.targetCount))}getTargetData(e,t){const r=Ss(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return si(e).ee({range:s,index:Cv},((o,a,l)=>{const u=ta(a);Rc(t,u.target)&&(i=u,l.done())})).next((()=>i))}addMatchingKeys(e,t,r){const s=[],i=ur(e);return t.forEach((o=>{const a=dt(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))})),b.waitFor(s)}removeMatchingKeys(e,t,r){const s=ur(e);return b.forEach(t,(i=>{const o=dt(i.path);return b.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])}))}removeMatchingKeysForTargetId(e,t){const r=ur(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=ur(e);let i=Y();return s.ee({range:r,Y:!0},((o,a,l)=>{const u=En(o[1]),h=new L(u);i=i.add(h)})).next((()=>i))}containsKey(e,t){const r=dt(t.path),s=IDBKeyRange.bound([r],[gv(r)],!1,!0);let i=0;return ur(e).ee({index:em,Y:!0,range:s},(([o,a],l,u)=>{o!==0&&(i++,u.done())})).next((()=>i>0))}At(e,t){return si(e).get(t).next((r=>r?ta(r):null))}}function si(n){return Ge(n,Vi)}function AI(n){return Ge(n,_s)}function ur(n){return Ge(n,Li)}const bI="LruGarbageCollector",$L=1048576;function RI([n,e],[t,r]){const s=Q(n,t);return s===0?Q(e,r):s}class zL{constructor(e){this.Pr=e,this.buffer=new de(RI),this.Tr=0}Ir(){return++this.Tr}Er(e){const t=[e,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();RI(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class BA{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Ar(e){x(bI,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){qr(t)?x(bI,"Ignoring IndexedDB error during garbage collection: ",t):await Br(t)}await this.Ar(3e5)}))}}class GL{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.dr(e).next((r=>Math.floor(t/100*r)))}nthSequenceNumber(e,t){if(t===0)return b.resolve(St.ce);const r=new zL(t);return this.Vr.forEachTarget(e,(s=>r.Er(s.sequenceNumber))).next((()=>this.Vr.mr(e,(s=>r.Er(s))))).next((()=>r.maxValue))}removeTargets(e,t,r){return this.Vr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(x("LruGarbageCollector","Garbage collection skipped; disabled"),b.resolve(vI)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(x("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),vI):this.gr(e,t)))}getCacheSize(e){return this.Vr.getCacheSize(e)}gr(e,t){let r,s,i,o,a,l,u;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((f=>(f>this.params.maximumSequenceNumbersToCollect?(x("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,o=Date.now(),this.nthSequenceNumber(e,s)))).next((f=>(r=f,a=Date.now(),this.removeTargets(e,r,t)))).next((f=>(i=f,l=Date.now(),this.removeOrphanedDocuments(e,r)))).next((f=>(u=Date.now(),ai()<=te.DEBUG&&x("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-h}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${f} documents in `+(u-l)+`ms
Total Duration: ${u-h}ms`),b.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:f}))))}}function qA(n,e){return new GL(n,e)}class jL{constructor(e,t){this.db=e,this.garbageCollector=qA(this,t)}dr(e){const t=this.pr(e);return this.db.getTargetCache().getTargetCount(e).next((r=>t.next((s=>r+s))))}pr(e){let t=0;return this.mr(e,(r=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}mr(e,t){return this.yr(e,((r,s)=>t(s)))}addReference(e,t,r){return ol(e,r)}removeReference(e,t,r){return ol(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return ol(e,t)}wr(e,t){return(function(s,i){let o=!1;return UA(s).te((a=>FA(s,a,i).next((l=>(l&&(o=!0),b.resolve(!l)))))).next((()=>o))})(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.yr(e,((o,a)=>{if(a<=t){const l=this.wr(e,o).next((u=>{if(!u)return i++,r.getEntry(e,o).next((()=>(r.removeEntry(o,G.min()),ur(e).delete((function(f){return[0,dt(f.path)]})(o)))))}));s.push(l)}})).next((()=>b.waitFor(s))).next((()=>r.apply(e))).next((()=>i))}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return ol(e,t)}yr(e,t){const r=ur(e);let s,i=St.ce;return r.ee({index:em},(([o,a],{path:l,sequenceNumber:u})=>{o===0?(i!==St.ce&&t(new L(En(s)),i),i=u,s=l):i=St.ce})).next((()=>{i!==St.ce&&t(new L(En(s)),i)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function ol(n,e){return ur(n).put((function(r,s){return{targetId:0,path:dt(r.path),sequenceNumber:s}})(e,n.currentSequenceNumber))}class WA{constructor(){this.changes=new Qn((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ee.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?b.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class HL{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Xr(e).put(r)}removeEntry(e,t,r){return Xr(e).delete((function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],su(o),a[a.length-1]]})(t,r))}updateMetadata(e,t){return this.getMetadata(e).next((r=>(r.byteSize+=t,this.br(e,r))))}getEntry(e,t){let r=Ee.newInvalidDocument(t);return Xr(e).ee({index:wl,range:IDBKeyRange.only(zo(t))},((s,i)=>{r=this.Sr(t,i)})).next((()=>r))}Dr(e,t){let r={size:0,document:Ee.newInvalidDocument(t)};return Xr(e).ee({index:wl,range:IDBKeyRange.only(zo(t))},((s,i)=>{r={document:this.Sr(t,i),size:ou(i)}})).next((()=>r))}getEntries(e,t){let r=Pt();return this.Cr(e,t,((s,i)=>{const o=this.Sr(s,i);r=r.insert(s,o)})).next((()=>r))}vr(e,t){let r=Pt(),s=new Ie(L.comparator);return this.Cr(e,t,((i,o)=>{const a=this.Sr(i,o);r=r.insert(i,a),s=s.insert(i,ou(o))})).next((()=>({documents:r,Fr:s})))}Cr(e,t,r){if(t.isEmpty())return b.resolve();let s=new de(PI);t.forEach((l=>s=s.add(l)));const i=IDBKeyRange.bound(zo(s.first()),zo(s.last())),o=s.getIterator();let a=o.getNext();return Xr(e).ee({index:wl,range:i},((l,u,h)=>{const f=L.fromSegments([...u.prefixPath,u.collectionGroup,u.documentId]);for(;a&&PI(a,f)<0;)r(a,null),a=o.getNext();a&&a.isEqual(f)&&(r(a,u),a=o.hasNext()?o.getNext():null),a?h.j(zo(a)):h.done()})).next((()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null}))}getDocumentsMatchingQuery(e,t,r,s,i){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),su(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Xr(e).H(IDBKeyRange.bound(a,l,!0)).next((u=>{i?.incrementDocumentReadCount(u.length);let h=Pt();for(const f of u){const m=this.Sr(L.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);m.isFoundDocument()&&(Cc(t,m)||s.has(m.key))&&(h=h.insert(m.key,m))}return h}))}getAllFromCollectionGroup(e,t,r,s){let i=Pt();const o=CI(t,r),a=CI(t,qt.max());return Xr(e).ee({index:Sv,range:IDBKeyRange.bound(o,a,!0)},((l,u,h)=>{const f=this.Sr(L.fromSegments(u.prefixPath.concat(u.collectionGroup,u.documentId)),u);i=i.insert(f.key,f),i.size===s&&h.done()})).next((()=>i))}newChangeBuffer(e){return new KL(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((t=>t.byteSize))}getMetadata(e){return SI(e).get(cf).next((t=>($(!!t,20021),t)))}br(e,t){return SI(e).put(cf,t)}Sr(e,t){if(t){const r=DL(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(G.min())))return r}return Ee.newInvalidDocument(e)}}function $A(n){return new HL(n)}class KL extends WA{constructor(e,t){super(),this.Mr=e,this.trackRemovals=t,this.Or=new Qn((r=>r.toString()),((r,s)=>r.isEqual(s)))}applyChanges(e){const t=[];let r=0,s=new de(((i,o)=>Q(i.canonicalString(),o.canonicalString())));return this.changes.forEach(((i,o)=>{const a=this.Or.get(i);if(t.push(this.Mr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const l=uI(this.Mr.serializer,o);s=s.add(i.path.popLast());const u=ou(l);r+=u-a.size,t.push(this.Mr.addEntry(e,i,l))}else if(r-=a.size,this.trackRemovals){const l=uI(this.Mr.serializer,o.convertToNoDocument(G.min()));t.push(this.Mr.addEntry(e,i,l))}})),s.forEach((i=>{t.push(this.Mr.indexManager.addToCollectionParentIndex(e,i))})),t.push(this.Mr.updateMetadata(e,r)),b.waitFor(t)}getFromCache(e,t){return this.Mr.Dr(e,t).next((r=>(this.Or.set(t,{size:r.size,readTime:r.document.readTime}),r.document)))}getAllFromCache(e,t){return this.Mr.vr(e,t).next((({documents:r,Fr:s})=>(s.forEach(((i,o)=>{this.Or.set(i,{size:o,readTime:r.get(i).readTime})})),r)))}}function SI(n){return Ge(n,Ga)}function Xr(n){return Ge(n,Zl)}function zo(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function CI(n,e){const t=e.documentKey.path.toArray();return[n,su(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function PI(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=Q(t[i],r[i]),s)return s;return s=Q(t.length,r.length),s||(s=Q(t[t.length-2],r[r.length-2]),s||Q(t[t.length-1],r[r.length-1]))}class QL{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class zA{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next((s=>(r=s,this.remoteDocumentCache.getEntry(e,t)))).next((s=>(r!==null&&Ia(r.mutation,s,Ct.empty(),le.now()),s)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.getLocalViewOfDocuments(e,r,Y()).next((()=>r))))}getLocalViewOfDocuments(e,t,r=Y()){const s=Tn();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,r).next((i=>{let o=Zo();return i.forEach(((a,l)=>{o=o.insert(a,l.overlayedDocument)})),o}))))}getOverlayedDocuments(e,t){const r=Tn();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,Y())))}populateOverlays(e,t,r){const s=[];return r.forEach((i=>{t.has(i)||s.push(i)})),this.documentOverlayCache.getOverlays(e,s).next((i=>{i.forEach(((o,a)=>{t.set(o,a)}))}))}computeViews(e,t,r,s){let i=Pt();const o=ya(),a=(function(){return ya()})();return t.forEach(((l,u)=>{const h=r.get(u.key);s.has(u.key)&&(h===void 0||h.mutation instanceof Yn)?i=i.insert(u.key,u):h!==void 0?(o.set(u.key,h.mutation.getFieldMask()),Ia(h.mutation,u,h.mutation.getFieldMask(),le.now())):o.set(u.key,Ct.empty())})),this.recalculateAndSaveOverlays(e,i).next((l=>(l.forEach(((u,h)=>o.set(u,h))),t.forEach(((u,h)=>a.set(u,new QL(h,o.get(u)??null)))),a)))}recalculateAndSaveOverlays(e,t){const r=ya();let s=new Ie(((o,a)=>o-a)),i=Y();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((o=>{for(const a of o)a.keys().forEach((l=>{const u=t.get(l);if(u===null)return;let h=r.get(l)||Ct.empty();h=a.applyToLocalView(u,h),r.set(l,h);const f=(s.get(a.batchId)||Y()).add(l);s=s.insert(a.batchId,f)}))})).next((()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),u=l.key,h=l.value,f=iA();h.forEach((m=>{if(!i.has(m)){const _=dA(t.get(m),r.get(m));_!==null&&f.set(m,_),i=i.add(m)}})),o.push(this.documentOverlayCache.saveOverlays(e,u,f))}return b.waitFor(o)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,t,r,s){return eL(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):am(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next((i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):b.resolve(Tn());let a=xi,l=i;return o.next((u=>b.forEach(u,((h,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),i.get(h)?b.resolve():this.remoteDocumentCache.getEntry(e,h).next((m=>{l=l.insert(h,m)}))))).next((()=>this.populateOverlays(e,u,i))).next((()=>this.computeViews(e,l,u,Y()))).next((h=>({batchId:a,changes:sA(h)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new L(t)).next((r=>{let s=Zo();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s}))}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=Zo();return this.indexManager.getCollectionParents(e,i).next((a=>b.forEach(a,(l=>{const u=(function(f,m){return new Kn(m,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)})(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,u,r,s).next((h=>{h.forEach(((f,m)=>{o=o.insert(f,m)}))}))})).next((()=>o))))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next((o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s)))).next((o=>{i.forEach(((l,u)=>{const h=u.getKey();o.get(h)===null&&(o=o.insert(h,Ee.newInvalidDocument(h)))}));let a=Zo();return o.forEach(((l,u)=>{const h=i.get(l);h!==void 0&&Ia(h.mutation,u,Ct.empty(),le.now()),Cc(t,u)&&(a=a.insert(l,u))})),a}))}}class YL{constructor(e){this.serializer=e,this.Nr=new Map,this.Br=new Map}getBundleMetadata(e,t){return b.resolve(this.Nr.get(t))}saveBundleMetadata(e,t){return this.Nr.set(t.id,(function(s){return{id:s.id,version:s.version,createTime:Le(s.createTime)}})(t)),b.resolve()}getNamedQuery(e,t){return b.resolve(this.Br.get(t))}saveNamedQuery(e,t){return this.Br.set(t.name,(function(s){return{name:s.name,query:gm(s.bundledQuery),readTime:Le(s.readTime)}})(t)),b.resolve()}}class JL{constructor(){this.overlays=new Ie(L.comparator),this.Lr=new Map}getOverlay(e,t){return b.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Tn();return b.forEach(t,(s=>this.getOverlay(e,s).next((i=>{i!==null&&r.set(s,i)})))).next((()=>r))}saveOverlays(e,t,r){return r.forEach(((s,i)=>{this.bt(e,t,i)})),b.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Lr.get(r);return s!==void 0&&(s.forEach((i=>this.overlays=this.overlays.remove(i))),this.Lr.delete(r)),b.resolve()}getOverlaysForCollection(e,t,r){const s=Tn(),i=t.length+1,o=new L(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,u=l.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return b.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new Ie(((u,h)=>u-h));const o=this.overlays.getIterator();for(;o.hasNext();){const u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let h=i.get(u.largestBatchId);h===null&&(h=Tn(),i=i.insert(u.largestBatchId,h)),h.set(u.getKey(),u)}}const a=Tn(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach(((u,h)=>a.set(u,h))),!(a.size()>=s)););return b.resolve(a)}bt(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.Lr.get(s.largestBatchId).delete(r.key);this.Lr.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new fm(t,r));let i=this.Lr.get(t);i===void 0&&(i=Y(),this.Lr.set(t,i)),this.Lr.set(t,i.add(r.key))}}class XL{constructor(){this.sessionToken=De.EMPTY_BYTE_STRING}getSessionToken(e){return b.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,b.resolve()}}class Im{constructor(){this.kr=new de(Ke.Kr),this.qr=new de(Ke.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(e,t){const r=new Ke(e,t);this.kr=this.kr.add(r),this.qr=this.qr.add(r)}$r(e,t){e.forEach((r=>this.addReference(r,t)))}removeReference(e,t){this.Wr(new Ke(e,t))}Qr(e,t){e.forEach((r=>this.removeReference(r,t)))}Gr(e){const t=new L(new re([])),r=new Ke(t,e),s=new Ke(t,e+1),i=[];return this.qr.forEachInRange([r,s],(o=>{this.Wr(o),i.push(o.key)})),i}zr(){this.kr.forEach((e=>this.Wr(e)))}Wr(e){this.kr=this.kr.delete(e),this.qr=this.qr.delete(e)}jr(e){const t=new L(new re([])),r=new Ke(t,e),s=new Ke(t,e+1);let i=Y();return this.qr.forEachInRange([r,s],(o=>{i=i.add(o.key)})),i}containsKey(e){const t=new Ke(e,0),r=this.kr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class Ke{constructor(e,t){this.key=e,this.Hr=t}static Kr(e,t){return L.comparator(e.key,t.key)||Q(e.Hr,t.Hr)}static Ur(e,t){return Q(e.Hr,t.Hr)||L.comparator(e.key,t.key)}}class ZL{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Yn=1,this.Jr=new de(Ke.Kr)}checkEmpty(e){return b.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new hm(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.Jr=this.Jr.add(new Ke(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return b.resolve(o)}lookupMutationBatch(e,t){return b.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.Xr(r),i=s<0?0:s;return b.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return b.resolve(this.mutationQueue.length===0?Tr:this.Yn-1)}getAllMutationBatches(e){return b.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Ke(t,0),s=new Ke(t,Number.POSITIVE_INFINITY),i=[];return this.Jr.forEachInRange([r,s],(o=>{const a=this.Zr(o.Hr);i.push(a)})),b.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new de(Q);return t.forEach((s=>{const i=new Ke(s,0),o=new Ke(s,Number.POSITIVE_INFINITY);this.Jr.forEachInRange([i,o],(a=>{r=r.add(a.Hr)}))})),b.resolve(this.Yr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;L.isDocumentKey(i)||(i=i.child(""));const o=new Ke(new L(i),0);let a=new de(Q);return this.Jr.forEachWhile((l=>{const u=l.key.path;return!!r.isPrefixOf(u)&&(u.length===s&&(a=a.add(l.Hr)),!0)}),o),b.resolve(this.Yr(a))}Yr(e){const t=[];return e.forEach((r=>{const s=this.Zr(r);s!==null&&t.push(s)})),t}removeMutationBatch(e,t){$(this.ei(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Jr;return b.forEach(t.mutations,(s=>{const i=new Ke(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)})).next((()=>{this.Jr=r}))}nr(e){}containsKey(e,t){const r=new Ke(t,0),s=this.Jr.firstAfterOrEqual(r);return b.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,b.resolve()}ei(e,t){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){const t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class eM{constructor(e){this.ti=e,this.docs=(function(){return new Ie(L.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.ti(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return b.resolve(r?r.document.mutableCopy():Ee.newInvalidDocument(t))}getEntries(e,t){let r=Pt();return t.forEach((s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():Ee.newInvalidDocument(s))})),b.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=Pt();const o=t.path,a=new L(o.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:u,value:{document:h}}=l.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||Xp(Ev(h),r)<=0||(s.has(h.key)||Cc(t,h))&&(i=i.insert(h.key,h.mutableCopy()))}return b.resolve(i)}getAllFromCollectionGroup(e,t,r,s){B(9500)}ni(e,t){return b.forEach(this.docs,(r=>t(r)))}newChangeBuffer(e){return new tM(this)}getSize(e){return b.resolve(this.size)}}class tM extends WA{constructor(e){super(),this.Mr=e}applyChanges(e){const t=[];return this.changes.forEach(((r,s)=>{s.isValidDocument()?t.push(this.Mr.addEntry(e,s)):this.Mr.removeEntry(r)})),b.waitFor(t)}getFromCache(e,t){return this.Mr.getEntry(e,t)}getAllFromCache(e,t){return this.Mr.getEntries(e,t)}}class nM{constructor(e){this.persistence=e,this.ri=new Qn((t=>Ss(t)),Rc),this.lastRemoteSnapshotVersion=G.min(),this.highestTargetId=0,this.ii=0,this.si=new Im,this.targetCount=0,this.oi=Ds._r()}forEachTarget(e,t){return this.ri.forEach(((r,s)=>t(s))),b.resolve()}getLastRemoteSnapshotVersion(e){return b.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return b.resolve(this.ii)}allocateTargetId(e){return this.highestTargetId=this.oi.next(),b.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.ii&&(this.ii=t),b.resolve()}lr(e){this.ri.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.oi=new Ds(t),this.highestTargetId=t),e.sequenceNumber>this.ii&&(this.ii=e.sequenceNumber)}addTargetData(e,t){return this.lr(t),this.targetCount+=1,b.resolve()}updateTargetData(e,t){return this.lr(t),b.resolve()}removeTargetData(e,t){return this.ri.delete(t.target),this.si.Gr(t.targetId),this.targetCount-=1,b.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.ri.forEach(((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.ri.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)})),b.waitFor(i).next((()=>s))}getTargetCount(e){return b.resolve(this.targetCount)}getTargetData(e,t){const r=this.ri.get(t)||null;return b.resolve(r)}addMatchingKeys(e,t,r){return this.si.$r(t,r),b.resolve()}removeMatchingKeys(e,t,r){this.si.Qr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach((o=>{i.push(s.markPotentiallyOrphaned(e,o))})),b.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.si.Gr(t),b.resolve()}getMatchingKeysForTargetId(e,t){const r=this.si.jr(t);return b.resolve(r)}containsKey(e,t){return b.resolve(this.si.containsKey(t))}}class wm{constructor(e,t){this._i={},this.overlays={},this.ai=new St(0),this.ui=!1,this.ui=!0,this.ci=new XL,this.referenceDelegate=e(this),this.li=new nM(this),this.indexManager=new BL,this.remoteDocumentCache=(function(s){return new eM(s)})((r=>this.referenceDelegate.hi(r))),this.serializer=new DA(t),this.Pi=new YL(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new JL,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this._i[e.toKey()];return r||(r=new ZL(t,this.referenceDelegate),this._i[e.toKey()]=r),r}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(e,t,r){x("MemoryPersistence","Starting transaction:",e);const s=new rM(this.ai.next());return this.referenceDelegate.Ti(),r(s).next((i=>this.referenceDelegate.Ii(s).next((()=>i)))).toPromise().then((i=>(s.raiseOnCommittedEvent(),i)))}Ei(e,t){return b.or(Object.values(this._i).map((r=>()=>r.containsKey(e,t))))}}class rM extends vv{constructor(e){super(),this.currentSequenceNumber=e}}class lh{constructor(e){this.persistence=e,this.Ri=new Im,this.Ai=null}static Vi(e){return new lh(e)}get di(){if(this.Ai)return this.Ai;throw B(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.di.delete(r.toString()),b.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.di.add(r.toString()),b.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),b.resolve()}removeTarget(e,t){this.Ri.Gr(t.targetId).forEach((s=>this.di.add(s.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next((s=>{s.forEach((i=>this.di.add(i.toString())))})).next((()=>r.removeTargetData(e,t)))}Ti(){this.Ai=new Set}Ii(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return b.forEach(this.di,(r=>{const s=L.fromPath(r);return this.mi(e,s).next((i=>{i||t.removeEntry(s,G.min())}))})).next((()=>(this.Ai=null,t.apply(e))))}updateLimboDocument(e,t){return this.mi(e,t).next((r=>{r?this.di.delete(t.toString()):this.di.add(t.toString())}))}hi(e){return 0}mi(e,t){return b.or([()=>b.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class au{constructor(e,t){this.persistence=e,this.fi=new Qn((r=>dt(r.path)),((r,s)=>r.isEqual(s))),this.garbageCollector=qA(this,t)}static Vi(e,t){return new au(e,t)}Ti(){}Ii(e){return b.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){const t=this.pr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>t.next((s=>r+s))))}pr(e){let t=0;return this.mr(e,(r=>{t++})).next((()=>t))}mr(e,t){return b.forEach(this.fi,((r,s)=>this.wr(e,r,s).next((i=>i?b.resolve():t(s)))))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ni(e,(o=>this.wr(e,o,t).next((a=>{a||(r++,i.removeEntry(o,G.min()))})))).next((()=>i.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,t){return this.fi.set(t,e.currentSequenceNumber),b.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),b.resolve()}removeReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),b.resolve()}updateLimboDocument(e,t){return this.fi.set(t,e.currentSequenceNumber),b.resolve()}hi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Tl(e.data.value)),t}wr(e,t,r){return b.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.fi.get(t);return b.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class sM{constructor(e){this.serializer=e}k(e,t,r,s){const i=new Xu("createOrUpgrade",t);r<1&&s>=1&&((function(l){l.createObjectStore(bc)})(e),(function(l){l.createObjectStore(za,{keyPath:m1}),l.createObjectStore(Zt,{keyPath:By,autoIncrement:!0}).createIndex(hs,qy,{unique:!0}),l.createObjectStore(Oi)})(e),kI(e),(function(l){l.createObjectStore(ns)})(e));let o=b.resolve();return r<3&&s>=3&&(r!==0&&((function(l){l.deleteObjectStore(Li),l.deleteObjectStore(Vi),l.deleteObjectStore(_s)})(e),kI(e)),o=o.next((()=>(function(l){const u=l.store(_s),h={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:G.min().toTimestamp(),targetCount:0};return u.put(eu,h)})(i)))),r<4&&s>=4&&(r!==0&&(o=o.next((()=>(function(l,u){return u.store(Zt).H().next((f=>{l.deleteObjectStore(Zt),l.createObjectStore(Zt,{keyPath:By,autoIncrement:!0}).createIndex(hs,qy,{unique:!0});const m=u.store(Zt),_=f.map((A=>m.put(A)));return b.waitFor(_)}))})(e,i)))),o=o.next((()=>{(function(l){l.createObjectStore(Mi,{keyPath:A1})})(e)}))),r<5&&s>=5&&(o=o.next((()=>this.gi(i)))),r<6&&s>=6&&(o=o.next((()=>((function(l){l.createObjectStore(Ga)})(e),this.pi(i))))),r<7&&s>=7&&(o=o.next((()=>this.yi(i)))),r<8&&s>=8&&(o=o.next((()=>this.wi(e,i)))),r<9&&s>=9&&(o=o.next((()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)}))),r<10&&s>=10&&(o=o.next((()=>this.bi(i)))),r<11&&s>=11&&(o=o.next((()=>{(function(l){l.createObjectStore(Zu,{keyPath:b1})})(e),(function(l){l.createObjectStore(eh,{keyPath:R1})})(e)}))),r<12&&s>=12&&(o=o.next((()=>{(function(l){const u=l.createObjectStore(th,{keyPath:x1});u.createIndex(uf,O1,{unique:!1}),u.createIndex(Nv,V1,{unique:!1})})(e)}))),r<13&&s>=13&&(o=o.next((()=>(function(l){const u=l.createObjectStore(Zl,{keyPath:_1});u.createIndex(wl,y1),u.createIndex(Sv,I1)})(e))).next((()=>this.Si(e,i))).next((()=>e.deleteObjectStore(ns)))),r<14&&s>=14&&(o=o.next((()=>this.Di(e,i)))),r<15&&s>=15&&(o=o.next((()=>(function(l){l.createObjectStore(tm,{keyPath:S1,autoIncrement:!0}).createIndex(lf,C1,{unique:!1}),l.createObjectStore(ma,{keyPath:P1}).createIndex(Pv,k1,{unique:!1}),l.createObjectStore(ga,{keyPath:N1}).createIndex(kv,D1,{unique:!1})})(e)))),r<16&&s>=16&&(o=o.next((()=>{t.objectStore(ma).clear()})).next((()=>{t.objectStore(ga).clear()}))),r<17&&s>=17&&(o=o.next((()=>{(function(l){l.createObjectStore(nm,{keyPath:L1})})(e)}))),r<18&&s>=18&&Cw()&&(o=o.next((()=>{t.objectStore(ma).clear()})).next((()=>{t.objectStore(ga).clear()}))),o}pi(e){let t=0;return e.store(ns).ee(((r,s)=>{t+=ou(s)})).next((()=>{const r={byteSize:t};return e.store(Ga).put(cf,r)}))}gi(e){const t=e.store(za),r=e.store(Zt);return t.H().next((s=>b.forEach(s,(i=>{const o=IDBKeyRange.bound([i.userId,Tr],[i.userId,i.lastAcknowledgedBatchId]);return r.H(hs,o).next((a=>b.forEach(a,(l=>{$(l.userId===i.userId,18650,"Cannot process batch from unexpected user",{batchId:l.batchId});const u=ss(this.serializer,l);return MA(e,i.userId,u).next((()=>{}))}))))}))))}yi(e){const t=e.store(Li),r=e.store(ns);return e.store(_s).get(eu).next((s=>{const i=[];return r.ee(((o,a)=>{const l=new re(o),u=(function(f){return[0,dt(f)]})(l);i.push(t.get(u).next((h=>h?b.resolve():(f=>t.put({targetId:0,path:dt(f),sequenceNumber:s.highestListenSequenceNumber}))(l))))})).next((()=>b.waitFor(i)))}))}wi(e,t){e.createObjectStore(ja,{keyPath:v1});const r=t.store(ja),s=new ym,i=o=>{if(s.add(o)){const a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:dt(l)})}};return t.store(ns).ee({Y:!0},((o,a)=>{const l=new re(o);return i(l.popLast())})).next((()=>t.store(Oi).ee({Y:!0},(([o,a,l],u)=>{const h=En(a);return i(h.popLast())}))))}bi(e){const t=e.store(Vi);return t.ee(((r,s)=>{const i=ta(s),o=xA(this.serializer,i);return t.put(o)}))}Si(e,t){const r=t.store(ns),s=[];return r.ee(((i,o)=>{const a=t.store(Zl),l=(function(f){return f.document?new L(re.fromString(f.document.name).popFirst(5)):f.noDocument?L.fromSegments(f.noDocument.path):f.unknownDocument?L.fromSegments(f.unknownDocument.path):B(36783)})(o).path.toArray(),u={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(u))})).next((()=>b.waitFor(s)))}Di(e,t){const r=t.store(Zt),s=$A(this.serializer),i=new wm(lh.Vi,this.serializer.yt);return r.H().next((o=>{const a=new Map;return o.forEach((l=>{let u=a.get(l.userId)??Y();ss(this.serializer,l).keys().forEach((h=>u=u.add(h))),a.set(l.userId,u)})),b.forEach(a,((l,u)=>{const h=new Ye(u),f=ah.wt(this.serializer,h),m=i.getIndexManager(h),_=ch.wt(h,this.serializer,m,i.referenceDelegate);return new zA(s,_,f,m).recalculateAndSaveOverlaysForDocumentKeys(new hf(t,St.ce),l).next()}))}))}}function kI(n){n.createObjectStore(Li,{keyPath:E1}).createIndex(em,T1,{unique:!0}),n.createObjectStore(Vi,{keyPath:"targetId"}).createIndex(Cv,w1,{unique:!0}),n.createObjectStore(_s)}const cr="IndexedDbPersistence",gd=18e5,_d=5e3,yd="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",GA="main";class Em{constructor(e,t,r,s,i,o,a,l,u,h,f=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Ci=i,this.window=o,this.document=a,this.Fi=u,this.Mi=h,this.xi=f,this.ai=null,this.ui=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Oi=null,this.inForeground=!1,this.Ni=null,this.Bi=null,this.Li=Number.NEGATIVE_INFINITY,this.ki=m=>Promise.resolve(),!Em.v())throw new D(C.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new jL(this,s),this.Ki=t+GA,this.serializer=new DA(l),this.qi=new An(this.Ki,this.xi,new sM(this.serializer)),this.ci=new OL,this.li=new WL(this.referenceDelegate,this.serializer),this.remoteDocumentCache=$A(this.serializer),this.Pi=new xL,this.window&&this.window.localStorage?this.Ui=this.window.localStorage:(this.Ui=null,h===!1&&Ve(cr,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.$i().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new D(C.FAILED_PRECONDITION,yd);return this.Wi(),this.Qi(),this.Gi(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.li.getHighestSequenceNumber(e)))})).then((e=>{this.ai=new St(e,this.Fi)})).then((()=>{this.ui=!0})).catch((e=>(this.qi&&this.qi.close(),Promise.reject(e))))}zi(e){return this.ki=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.qi.q((async t=>{t.newVersion===null&&await e()}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Ci.enqueueAndForget((async()=>{this.started&&await this.$i()})))}$i(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>al(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.ji(e).next((t=>{t||(this.isPrimary=!1,this.Ci.enqueueRetryable((()=>this.ki(!1))))}))})).next((()=>this.Hi(e))).next((t=>this.isPrimary&&!t?this.Ji(e).next((()=>!1)):!!t&&this.Zi(e).next((()=>!0)))))).catch((e=>{if(qr(e))return x(cr,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return x(cr,"Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.Ci.enqueueRetryable((()=>this.ki(e))),this.isPrimary=e}))}ji(e){return Go(e).get(Zs).next((t=>b.resolve(this.Xi(t))))}Yi(e){return al(e).delete(this.clientId)}async es(){if(this.isPrimary&&!this.ts(this.Li,gd)){this.Li=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(t=>{const r=Ge(t,Mi);return r.H().next((s=>{const i=this.ns(s,gd),o=s.filter((a=>i.indexOf(a)===-1));return b.forEach(o,(a=>r.delete(a.clientId))).next((()=>o))}))})).catch((()=>[]));if(this.Ui)for(const t of e)this.Ui.removeItem(this.rs(t.clientId))}}Gi(){this.Bi=this.Ci.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.$i().then((()=>this.es())).then((()=>this.Gi()))))}Xi(e){return!!e&&e.ownerId===this.clientId}Hi(e){return this.Mi?b.resolve(!0):Go(e).get(Zs).next((t=>{if(t!==null&&this.ts(t.leaseTimestampMs,_d)&&!this.ss(t.ownerId)){if(this.Xi(t)&&this.networkEnabled)return!0;if(!this.Xi(t)){if(!t.allowTabSynchronization)throw new D(C.FAILED_PRECONDITION,yd);return!1}}return!(!this.networkEnabled||!this.inForeground)||al(e).H().next((r=>this.ns(r,_d).find((s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(i||o&&a)return!0}return!1}))===void 0))})).next((t=>(this.isPrimary!==t&&x(cr,`Client ${t?"is":"is not"} eligible for a primary lease.`),t)))}async shutdown(){this.ui=!1,this._s(),this.Bi&&(this.Bi.cancel(),this.Bi=null),this.us(),this.cs(),await this.qi.runTransaction("shutdown","readwrite",[bc,Mi],(e=>{const t=new hf(e,St.ce);return this.Ji(t).next((()=>this.Yi(t)))})),this.qi.close(),this.ls()}ns(e,t){return e.filter((r=>this.ts(r.updateTimeMs,t)&&!this.ss(r.clientId)))}hs(){return this.runTransaction("getActiveClients","readonly",(e=>al(e).H().next((t=>this.ns(t,gd).map((r=>r.clientId))))))}get started(){return this.ui}getGlobalsCache(){return this.ci}getMutationQueue(e,t){return ch.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new qL(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return ah.wt(this.serializer,e)}getBundleCache(){return this.Pi}runTransaction(e,t,r){x(cr,"Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",i=(function(l){return l===18?U1:l===17?Vv:l===16?F1:l===15?rm:l===14?Ov:l===13?xv:l===12?M1:l===11?Dv:void B(60245)})(this.xi);let o;return this.qi.runTransaction(e,s,i,(a=>(o=new hf(a,this.ai?this.ai.next():St.ce),t==="readwrite-primary"?this.ji(o).next((l=>!!l||this.Hi(o))).next((l=>{if(!l)throw Ve(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Ci.enqueueRetryable((()=>this.ki(!1))),new D(C.FAILED_PRECONDITION,Tv);return r(o)})).next((l=>this.Zi(o).next((()=>l)))):this.Ps(o).next((()=>r(o)))))).then((a=>(o.raiseOnCommittedEvent(),a)))}Ps(e){return Go(e).get(Zs).next((t=>{if(t!==null&&this.ts(t.leaseTimestampMs,_d)&&!this.ss(t.ownerId)&&!this.Xi(t)&&!(this.Mi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new D(C.FAILED_PRECONDITION,yd)}))}Zi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Go(e).put(Zs,t)}static v(){return An.v()}Ji(e){const t=Go(e);return t.get(Zs).next((r=>this.Xi(r)?(x(cr,"Releasing primary lease."),t.delete(Zs)):b.resolve()))}ts(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(Ve(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Wi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ni=()=>{this.Ci.enqueueAndForget((()=>(this.inForeground=this.document.visibilityState==="visible",this.$i())))},this.document.addEventListener("visibilitychange",this.Ni),this.inForeground=this.document.visibilityState==="visible")}us(){this.Ni&&(this.document.removeEventListener("visibilitychange",this.Ni),this.Ni=null)}Qi(){typeof this.window?.addEventListener=="function"&&(this.Oi=()=>{this._s();const e=/(?:Version|Mobile)\/1[456]/;Sw()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Ci.enterRestrictedMode(!0),this.Ci.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.Oi))}cs(){this.Oi&&(this.window.removeEventListener("pagehide",this.Oi),this.Oi=null)}ss(e){try{const t=this.Ui?.getItem(this.rs(e))!==null;return x(cr,`Client '${e}' ${t?"is":"is not"} zombied in LocalStorage`),t}catch(t){return Ve(cr,"Failed to get zombied client id.",t),!1}}_s(){if(this.Ui)try{this.Ui.setItem(this.rs(this.clientId),String(Date.now()))}catch(e){Ve("Failed to set zombie client id.",e)}}ls(){if(this.Ui)try{this.Ui.removeItem(this.rs(this.clientId))}catch{}}rs(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Go(n){return Ge(n,bc)}function al(n){return Ge(n,Mi)}function Tm(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}class vm{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Ts=r,this.Is=s}static Es(e,t){let r=Y(),s=Y();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new vm(e,t.fromCache,r,s)}}class iM{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class jA{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=(function(){return Sw()?8:Av(Ce())>0?6:4})()}initialize(e,t){this.fs=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.gs(e,t).next((o=>{i.result=o})).next((()=>{if(!i.result)return this.ps(e,t,s,r).next((o=>{i.result=o}))})).next((()=>{if(i.result)return;const o=new iM;return this.ys(e,t,o).next((a=>{if(i.result=a,this.As)return this.ws(e,t,o,a.size)}))})).next((()=>i.result))}ws(e,t,r,s){return r.documentReadCount<this.Vs?(ai()<=te.DEBUG&&x("QueryEngine","SDK will not create cache indexes for query:",ci(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),b.resolve()):(ai()<=te.DEBUG&&x("QueryEngine","Query:",ci(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.ds*s?(ai()<=te.DEBUG&&x("QueryEngine","The SDK decides to create cache indexes for query:",ci(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Tt(t))):b.resolve())}gs(e,t){if(eI(t))return b.resolve(null);let r=Tt(t);return this.indexManager.getIndexType(e,r).next((s=>s===0?null:(t.limit!==null&&s===1&&(t=ru(t,null,"F"),r=Tt(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next((i=>{const o=Y(...i);return this.fs.getDocuments(e,o).next((a=>this.indexManager.getMinOffset(e,r).next((l=>{const u=this.bs(t,a);return this.Ss(t,u,o,l.readTime)?this.gs(e,ru(t,null,"F")):this.Ds(e,u,t,l)}))))})))))}ps(e,t,r,s){return eI(t)||s.isEqual(G.min())?b.resolve(null):this.fs.getDocuments(e,r).next((i=>{const o=this.bs(t,i);return this.Ss(t,o,r,s)?b.resolve(null):(ai()<=te.DEBUG&&x("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),ci(t)),this.Ds(e,o,t,wv(s,xi)).next((a=>a)))}))}bs(e,t){let r=new de(nA(e));return t.forEach(((s,i)=>{Cc(e,i)&&(r=r.add(i))})),r}Ss(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}ys(e,t,r){return ai()<=te.DEBUG&&x("QueryEngine","Using full collection scan to execute query:",ci(t)),this.fs.getDocumentsMatchingQuery(e,t,qt.min(),r)}Ds(e,t,r,s){return this.fs.getDocumentsMatchingQuery(e,r,s).next((i=>(t.forEach((o=>{i=i.insert(o.key,o)})),i)))}}const Am="LocalStore",oM=3e8;class aM{constructor(e,t,r,s){this.persistence=e,this.Cs=t,this.serializer=s,this.vs=new Ie(Q),this.Fs=new Qn((i=>Ss(i)),Rc),this.Ms=new Map,this.xs=e.getRemoteDocumentCache(),this.li=e.getTargetCache(),this.Pi=e.getBundleCache(),this.Os(r)}Os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new zA(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.vs)))}}function HA(n,e,t,r){return new aM(n,e,t,r)}async function KA(n,e){const t=F(n);return await t.persistence.runTransaction("Handle user change","readonly",(r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next((i=>(s=i,t.Os(e),t.mutationQueue.getAllMutationBatches(r)))).next((i=>{const o=[],a=[];let l=Y();for(const u of s){o.push(u.batchId);for(const h of u.mutations)l=l.add(h.key)}for(const u of i){a.push(u.batchId);for(const h of u.mutations)l=l.add(h.key)}return t.localDocuments.getDocuments(r,l).next((u=>({Ns:u,removedBatchIds:o,addedBatchIds:a})))}))}))}function cM(n,e){const t=F(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const s=e.batch.keys(),i=t.xs.newChangeBuffer({trackRemovals:!0});return(function(a,l,u,h){const f=u.batch,m=f.keys();let _=b.resolve();return m.forEach((A=>{_=_.next((()=>h.getEntry(l,A))).next((k=>{const N=u.docVersions.get(A);$(N!==null,48541),k.version.compareTo(N)<0&&(f.applyToRemoteDocument(k,u),k.isValidDocument()&&(k.setReadTime(u.commitVersion),h.addEntry(k)))}))})),_.next((()=>a.mutationQueue.removeMutationBatch(l,f)))})(t,r,e,i).next((()=>i.apply(r))).next((()=>t.mutationQueue.performConsistencyCheck(r))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(a){let l=Y();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(l=l.add(a.batch.mutations[u].key));return l})(e)))).next((()=>t.localDocuments.getDocuments(r,s)))}))}function QA(n){const e=F(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.li.getLastRemoteSnapshotVersion(t)))}function lM(n,e){const t=F(n),r=e.snapshotVersion;let s=t.vs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(i=>{const o=t.xs.newChangeBuffer({trackRemovals:!0});s=t.vs;const a=[];e.targetChanges.forEach(((h,f)=>{const m=s.get(f);if(!m)return;a.push(t.li.removeMatchingKeys(i,h.removedDocuments,f).next((()=>t.li.addMatchingKeys(i,h.addedDocuments,f))));let _=m.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?_=_.withResumeToken(De.EMPTY_BYTE_STRING,G.min()).withLastLimboFreeSnapshotVersion(G.min()):h.resumeToken.approximateByteSize()>0&&(_=_.withResumeToken(h.resumeToken,r)),s=s.insert(f,_),(function(k,N,W){return k.resumeToken.approximateByteSize()===0||N.snapshotVersion.toMicroseconds()-k.snapshotVersion.toMicroseconds()>=oM?!0:W.addedDocuments.size+W.modifiedDocuments.size+W.removedDocuments.size>0})(m,_,h)&&a.push(t.li.updateTargetData(i,_))}));let l=Pt(),u=Y();if(e.documentUpdates.forEach((h=>{e.resolvedLimboDocuments.has(h)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,h))})),a.push(YA(i,o,e.documentUpdates).next((h=>{l=h.Bs,u=h.Ls}))),!r.isEqual(G.min())){const h=t.li.getLastRemoteSnapshotVersion(i).next((f=>t.li.setTargetsMetadata(i,i.currentSequenceNumber,r)));a.push(h)}return b.waitFor(a).next((()=>o.apply(i))).next((()=>t.localDocuments.getLocalViewOfDocuments(i,l,u))).next((()=>l))})).then((i=>(t.vs=s,i)))}function YA(n,e,t){let r=Y(),s=Y();return t.forEach((i=>r=r.add(i))),e.getEntries(n,r).next((i=>{let o=Pt();return t.forEach(((a,l)=>{const u=i.get(a);l.isFoundDocument()!==u.isFoundDocument()&&(s=s.add(a)),l.isNoDocument()&&l.version.isEqual(G.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!u.isValidDocument()||l.version.compareTo(u.version)>0||l.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):x(Am,"Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",l.version)})),{Bs:o,Ls:s}}))}function uM(n,e){const t=F(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=Tr),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function zi(n,e){const t=F(n);return t.persistence.runTransaction("Allocate target","readwrite",(r=>{let s;return t.li.getTargetData(r,e).next((i=>i?(s=i,b.resolve(s)):t.li.allocateTargetId(r).next((o=>(s=new Ln(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.li.addTargetData(r,s).next((()=>s)))))))})).then((r=>{const s=t.vs.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.vs=t.vs.insert(r.targetId,r),t.Fs.set(e,r.targetId)),r}))}async function Gi(n,e,t){const r=F(n),s=r.vs.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,(o=>r.persistence.referenceDelegate.removeTarget(o,s)))}catch(o){if(!qr(o))throw o;x(Am,`Failed to update sequence numbers for target ${e}: ${o}`)}r.vs=r.vs.remove(e),r.Fs.delete(s.target)}function cu(n,e,t){const r=F(n);let s=G.min(),i=Y();return r.persistence.runTransaction("Execute query","readwrite",(o=>(function(l,u,h){const f=F(l),m=f.Fs.get(h);return m!==void 0?b.resolve(f.vs.get(m)):f.li.getTargetData(u,h)})(r,o,Tt(e)).next((a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.li.getMatchingKeysForTargetId(o,a.targetId).next((l=>{i=l}))})).next((()=>r.Cs.getDocumentsMatchingQuery(o,e,t?s:G.min(),t?i:Y()))).next((a=>(ZA(r,tA(e),a),{documents:a,ks:i})))))}function JA(n,e){const t=F(n),r=F(t.li),s=t.vs.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",(i=>r.At(i,e).next((o=>o?o.target:null))))}function XA(n,e){const t=F(n),r=t.Ms.get(e)||G.min();return t.persistence.runTransaction("Get new document changes","readonly",(s=>t.xs.getAllFromCollectionGroup(s,e,wv(r,xi),Number.MAX_SAFE_INTEGER))).then((s=>(ZA(t,e,s),s)))}function ZA(n,e,t){let r=n.Ms.get(e)||G.min();t.forEach(((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)})),n.Ms.set(e,r)}async function hM(n,e,t,r){const s=F(n);let i=Y(),o=Pt();for(const u of t){const h=e.Ks(u.metadata.name);u.document&&(i=i.add(h));const f=e.qs(u);f.setReadTime(e.Us(u.metadata.readTime)),o=o.insert(h,f)}const a=s.xs.newChangeBuffer({trackRemovals:!0}),l=await zi(s,(function(h){return Tt(co(re.fromString(`__bundle__/docs/${h}`)))})(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",(u=>YA(u,a,o).next((h=>(a.apply(u),h))).next((h=>s.li.removeMatchingKeysForTargetId(u,l.targetId).next((()=>s.li.addMatchingKeys(u,i,l.targetId))).next((()=>s.localDocuments.getLocalViewOfDocuments(u,h.Bs,h.Ls))).next((()=>h.Bs))))))}async function dM(n,e,t=Y()){const r=await zi(n,Tt(gm(e.bundledQuery))),s=F(n);return s.persistence.runTransaction("Save named query","readwrite",(i=>{const o=Le(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Pi.saveNamedQuery(i,e);const a=r.withResumeToken(De.EMPTY_BYTE_STRING,o);return s.vs=s.vs.insert(a.targetId,a),s.li.updateTargetData(i,a).next((()=>s.li.removeMatchingKeysForTargetId(i,r.targetId))).next((()=>s.li.addMatchingKeys(i,t,r.targetId))).next((()=>s.Pi.saveNamedQuery(i,e)))}))}const eb="firestore_clients";function NI(n,e){return`${eb}_${n}_${e}`}const tb="firestore_mutations";function DI(n,e,t){let r=`${tb}_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}const nb="firestore_targets";function Id(n,e){return`${nb}_${n}_${e}`}const fn="SharedClientState";class lu{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static $s(e,t,r){const s=JSON.parse(r);let i,o=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return o&&s.error&&(o=typeof s.error.message=="string"&&typeof s.error.code=="string",o&&(i=new D(s.error.code,s.error.message))),o?new lu(e,t,s.state,i):(Ve(fn,`Failed to parse mutation state for ID '${t}': ${r}`),null)}Ws(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class wa{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static $s(e,t){const r=JSON.parse(t);let s,i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new D(r.error.code,r.error.message))),i?new wa(e,r.state,s):(Ve(fn,`Failed to parse target state for ID '${e}': ${t}`),null)}Ws(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class uu{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static $s(e,t){const r=JSON.parse(t);let s=typeof r=="object"&&r.activeTargetIds instanceof Array,i=cm();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=bv(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new uu(e,i):(Ve(fn,`Failed to parse client data for instance '${e}': ${t}`),null)}}class bm{constructor(e,t){this.clientId=e,this.onlineState=t}static $s(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new bm(t.clientId,t.onlineState):(Ve(fn,`Failed to parse online state: ${e}`),null)}}class Rf{constructor(){this.activeTargetIds=cm()}Qs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class wd{constructor(e,t,r,s,i){this.window=e,this.Ci=t,this.persistenceKey=r,this.zs=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.js=this.Hs.bind(this),this.Js=new Ie(Q),this.started=!1,this.Zs=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Xs=NI(this.persistenceKey,this.zs),this.Ys=(function(l){return`firestore_sequence_number_${l}`})(this.persistenceKey),this.Js=this.Js.insert(this.zs,new Rf),this.eo=new RegExp(`^${eb}_${o}_([^_]*)$`),this.no=new RegExp(`^${tb}_${o}_(\\d+)(?:_(.*))?$`),this.ro=new RegExp(`^${nb}_${o}_(\\d+)$`),this.io=(function(l){return`firestore_online_state_${l}`})(this.persistenceKey),this.so=(function(l){return`firestore_bundle_loaded_v2_${l}`})(this.persistenceKey),this.window.addEventListener("storage",this.js)}static v(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.hs();for(const r of e){if(r===this.zs)continue;const s=this.getItem(NI(this.persistenceKey,r));if(s){const i=uu.$s(r,s);i&&(this.Js=this.Js.insert(i.clientId,i))}}this.oo();const t=this.storage.getItem(this.io);if(t){const r=this._o(t);r&&this.ao(r)}for(const r of this.Zs)this.Hs(r);this.Zs=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(e){this.setItem(this.Ys,JSON.stringify(e))}getAllActiveQueryTargets(){return this.uo(this.Js)}isActiveQueryTarget(e){let t=!1;return this.Js.forEach(((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)})),t}addPendingMutation(e){this.co(e,"pending")}updateMutationState(e,t,r){this.co(e,t,r),this.lo(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const s=this.storage.getItem(Id(this.persistenceKey,e));if(s){const i=wa.$s(e,s);i&&(r=i.state)}}return t&&this.ho.Qs(e),this.oo(),r}removeLocalQueryTarget(e){this.ho.Gs(e),this.oo()}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Id(this.persistenceKey,e))}updateQueryState(e,t,r){this.Po(e,t,r)}handleUserChange(e,t,r){t.forEach((s=>{this.lo(s)})),this.currentUser=e,r.forEach((s=>{this.addPendingMutation(s)}))}setOnlineState(e){this.To(e)}notifyBundleLoaded(e){this.Io(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.js),this.removeItem(this.Xs),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return x(fn,"READ",e,t),t}setItem(e,t){x(fn,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){x(fn,"REMOVE",e),this.storage.removeItem(e)}Hs(e){const t=e;if(t.storageArea===this.storage){if(x(fn,"EVENT",t.key,t.newValue),t.key===this.Xs)return void Ve("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Ci.enqueueRetryable((async()=>{if(this.started){if(t.key!==null){if(this.eo.test(t.key)){if(t.newValue==null){const r=this.Eo(t.key);return this.Ro(r,null)}{const r=this.Ao(t.key,t.newValue);if(r)return this.Ro(r.clientId,r)}}else if(this.no.test(t.key)){if(t.newValue!==null){const r=this.Vo(t.key,t.newValue);if(r)return this.mo(r)}}else if(this.ro.test(t.key)){if(t.newValue!==null){const r=this.fo(t.key,t.newValue);if(r)return this.po(r)}}else if(t.key===this.io){if(t.newValue!==null){const r=this._o(t.newValue);if(r)return this.ao(r)}}else if(t.key===this.Ys){const r=(function(i){let o=St.ce;if(i!=null)try{const a=JSON.parse(i);$(typeof a=="number",30636,{yo:i}),o=a}catch(a){Ve(fn,"Failed to read sequence number from WebStorage",a)}return o})(t.newValue);r!==St.ce&&this.sequenceNumberHandler(r)}else if(t.key===this.so){const r=this.wo(t.newValue);await Promise.all(r.map((s=>this.syncEngine.bo(s))))}}}else this.Zs.push(t)}))}}get ho(){return this.Js.get(this.zs)}oo(){this.setItem(this.Xs,this.ho.Ws())}co(e,t,r){const s=new lu(this.currentUser,e,t,r),i=DI(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Ws())}lo(e){const t=DI(this.persistenceKey,this.currentUser,e);this.removeItem(t)}To(e){const t={clientId:this.zs,onlineState:e};this.storage.setItem(this.io,JSON.stringify(t))}Po(e,t,r){const s=Id(this.persistenceKey,e),i=new wa(e,t,r);this.setItem(s,i.Ws())}Io(e){const t=JSON.stringify(Array.from(e));this.setItem(this.so,t)}Eo(e){const t=this.eo.exec(e);return t?t[1]:null}Ao(e,t){const r=this.Eo(e);return uu.$s(r,t)}Vo(e,t){const r=this.no.exec(e),s=Number(r[1]),i=r[2]!==void 0?r[2]:null;return lu.$s(new Ye(i),s,t)}fo(e,t){const r=this.ro.exec(e),s=Number(r[1]);return wa.$s(s,t)}_o(e){return bm.$s(e)}wo(e){return JSON.parse(e)}async mo(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.So(e.batchId,e.state,e.error);x(fn,`Ignoring mutation for non-active user ${e.user.uid}`)}po(e){return this.syncEngine.Do(e.targetId,e.state,e.error)}Ro(e,t){const r=t?this.Js.insert(e,t):this.Js.remove(e),s=this.uo(this.Js),i=this.uo(r),o=[],a=[];return i.forEach((l=>{s.has(l)||o.push(l)})),s.forEach((l=>{i.has(l)||a.push(l)})),this.syncEngine.Co(o,a).then((()=>{this.Js=r}))}ao(e){this.Js.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}uo(e){let t=cm();return e.forEach(((r,s)=>{t=t.unionWith(s.activeTargetIds)})),t}}class rb{constructor(){this.vo=new Rf,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.vo.Qs(e),this.Fo[e]||"not-current"}updateQueryState(e,t,r){this.Fo[e]=t}removeLocalQueryTarget(e){this.vo.Gs(e)}isLocalQueryTarget(e){return this.vo.activeTargetIds.has(e)}clearQueryState(e){delete this.Fo[e]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(e){return this.vo.activeTargetIds.has(e)}start(){return this.vo=new Rf,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class fM{Mo(e){}shutdown(){}}const xI="ConnectivityMonitor";class OI{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(e){this.Lo.push(e)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){x(xI,"Network connectivity changed: AVAILABLE");for(const e of this.Lo)e(0)}Bo(){x(xI,"Network connectivity changed: UNAVAILABLE");for(const e of this.Lo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let cl=null;function Sf(){return cl===null?cl=(function(){return 268435456+Math.round(2147483648*Math.random())})():cl++,"0x"+cl.toString(16)}const Ed="RestConnection",pM={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class mM{get Ko(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.qo=t+"://"+e.host,this.Uo=`projects/${r}/databases/${s}`,this.$o=this.databaseId.database===df?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Wo(e,t,r,s,i){const o=Sf(),a=this.Qo(e,t.toUriEncodedString());x(Ed,`Sending RPC '${e}' ${o}:`,a,r);const l={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(l,s,i);const{host:u}=new URL(a),h=Yt(u);return this.zo(e,a,l,r,h).then((f=>(x(Ed,`Received RPC '${e}' ${o}: `,f),f)),(f=>{throw kn(Ed,`RPC '${e}' ${o} failed with error: `,f,"url: ",a,"request:",r),f}))}jo(e,t,r,s,i,o){return this.Wo(e,t,r,s,i)}Go(e,t,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+ao})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((s,i)=>e[i]=s)),r&&r.headers.forEach(((s,i)=>e[i]=s))}Qo(e,t){const r=pM[e];let s=`${this.qo}/v1/${t}:${r}`;return this.databaseInfo.apiKey&&(s=`${s}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),s}terminate(){}}class gM{constructor(e){this.Ho=e.Ho,this.Jo=e.Jo}Zo(e){this.Xo=e}Yo(e){this.e_=e}t_(e){this.n_=e}onMessage(e){this.r_=e}close(){this.Jo()}send(e){this.Ho(e)}i_(){this.Xo()}s_(){this.e_()}o_(e){this.n_(e)}__(e){this.r_(e)}}const at="WebChannelConnection",jo=(n,e,t)=>{n.listen(e,(r=>{try{t(r)}catch(s){setTimeout((()=>{throw s}),0)}}))};class wi extends mM{constructor(e){super(e),this.a_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}static u_(){if(!wi.c_){const e=dv();jo(e,hv.STAT_EVENT,(t=>{t.stat===sf.PROXY?x(at,"STAT_EVENT: detected buffering proxy"):t.stat===sf.NOPROXY&&x(at,"STAT_EVENT: detected no buffering proxy")})),wi.c_=!0}}zo(e,t,r,s,i){const o=Sf();return new Promise(((a,l)=>{const u=new lv;u.setWithCredentials(!0),u.listenOnce(uv.COMPLETE,(()=>{try{switch(u.getLastErrorCode()){case _l.NO_ERROR:const f=u.getResponseJson();x(at,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(f)),a(f);break;case _l.TIMEOUT:x(at,`RPC '${e}' ${o} timed out`),l(new D(C.DEADLINE_EXCEEDED,"Request time out"));break;case _l.HTTP_ERROR:const m=u.getStatus();if(x(at,`RPC '${e}' ${o} failed with status:`,m,"response text:",u.getResponseText()),m>0){let _=u.getResponseJson();Array.isArray(_)&&(_=_[0]);const A=_?.error;if(A&&A.status&&A.message){const k=(function(W){const z=W.toLowerCase().replace(/_/g,"-");return Object.values(C).indexOf(z)>=0?z:C.UNKNOWN})(A.status);l(new D(k,A.message))}else l(new D(C.UNKNOWN,"Server responded with status "+u.getStatus()))}else l(new D(C.UNAVAILABLE,"Connection failed."));break;default:B(9055,{l_:e,streamId:o,h_:u.getLastErrorCode(),P_:u.getLastError()})}}finally{x(at,`RPC '${e}' ${o} completed.`)}}));const h=JSON.stringify(s);x(at,`RPC '${e}' ${o} sending request:`,s),u.send(t,"POST",h,r,15)}))}T_(e,t,r){const s=Sf(),i=[this.qo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=this.createWebChannelTransport(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;l!==void 0&&(a.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Go(a.initMessageHeaders,t,r),a.encodeInitMessageHeaders=!0;const u=i.join("");x(at,`Creating RPC '${e}' stream ${s}: ${u}`,a);const h=o.createWebChannel(u,a);this.I_(h);let f=!1,m=!1;const _=new gM({Ho:A=>{m?x(at,`Not sending because RPC '${e}' stream ${s} is closed:`,A):(f||(x(at,`Opening RPC '${e}' stream ${s} transport.`),h.open(),f=!0),x(at,`RPC '${e}' stream ${s} sending:`,A),h.send(A))},Jo:()=>h.close()});return jo(h,Xo.EventType.OPEN,(()=>{m||(x(at,`RPC '${e}' stream ${s} transport opened.`),_.i_())})),jo(h,Xo.EventType.CLOSE,(()=>{m||(m=!0,x(at,`RPC '${e}' stream ${s} transport closed`),_.o_(),this.E_(h))})),jo(h,Xo.EventType.ERROR,(A=>{m||(m=!0,kn(at,`RPC '${e}' stream ${s} transport errored. Name:`,A.name,"Message:",A.message),_.o_(new D(C.UNAVAILABLE,"The operation could not be completed")))})),jo(h,Xo.EventType.MESSAGE,(A=>{if(!m){const k=A.data[0];$(!!k,16349);const N=k,W=N?.error||N[0]?.error;if(W){x(at,`RPC '${e}' stream ${s} received error:`,W);const z=W.status;let q=(function(J){const E=Fe[J];if(E!==void 0)return mA(E)})(z),K=W.message;q===void 0&&(q=C.INTERNAL,K="Unknown error status: "+z+" with message "+W.message),m=!0,_.o_(new D(q,K)),h.close()}else x(at,`RPC '${e}' stream ${s} received:`,k),_.__(k)}})),wi.u_(),setTimeout((()=>{_.s_()}),0),_}terminate(){this.a_.forEach((e=>e.close())),this.a_=[]}I_(e){this.a_.push(e)}E_(e){this.a_=this.a_.filter((t=>t===e))}Go(e,t,r){super.Go(e,t,r),this.databaseInfo.apiKey&&(e["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return fv()}}function _M(n){return new wi(n)}function sb(){return typeof window<"u"?window:null}function Sl(){return typeof document<"u"?document:null}function Dc(n){return new TL(n,!0)}wi.c_=!1;class Rm{constructor(e,t,r=1e3,s=1.5,i=6e4){this.Ci=e,this.timerId=t,this.R_=r,this.A_=s,this.V_=i,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(e){this.cancel();const t=Math.floor(this.d_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-r);s>0&&x("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.d_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,s,(()=>(this.f_=Date.now(),e()))),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}const VI="PersistentStream";class ib{constructor(e,t,r,s,i,o,a,l){this.Ci=e,this.b_=r,this.S_=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Rm(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,(()=>this.k_())))}K_(e){this.q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===C.RESOURCE_EXHAUSTED?(Ve(t.toString()),Ve("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===C.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.t_(t)}W_(){}auth(){this.state=1;const e=this.Q_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,s])=>{this.D_===t&&this.G_(r,s)}),(r=>{e((()=>{const s=new D(C.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)}))}))}G_(e,t){const r=this.Q_(this.D_);this.stream=this.j_(e,t),this.stream.Zo((()=>{r((()=>this.listener.Zo()))})),this.stream.Yo((()=>{r((()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.Yo())))})),this.stream.t_((s=>{r((()=>this.z_(s)))})),this.stream.onMessage((s=>{r((()=>++this.F_==1?this.H_(s):this.onNext(s)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return x(VI,`close with error: ${e}`),this.stream=null,this.close(4,e)}Q_(e){return t=>{this.Ci.enqueueAndForget((()=>this.D_===e?t():(x(VI,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class yM extends ib{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}H_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=bL(this.serializer,e),r=(function(i){if(!("targetChange"in i))return G.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?G.min():o.readTime?Le(o.readTime):G.min()})(e);return this.listener.J_(t,r)}Z_(e){const t={};t.database=Ef(this.serializer),t.addTarget=(function(i,o){let a;const l=o.target;if(a=tu(l)?{documents:bA(i,l)}:{query:RA(i,l).ft},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=IA(i,o.resumeToken);const u=If(i,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(G.min())>0){a.readTime=$i(i,o.snapshotVersion.toTimestamp());const u=If(i,o.expectedCount);u!==null&&(a.expectedCount=u)}return a})(this.serializer,e);const r=SL(this.serializer,e);r&&(t.labels=r),this.K_(t)}X_(e){const t={};t.database=Ef(this.serializer),t.removeTarget=e,this.K_(t)}}class IM extends ib{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}H_(e){return $(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,$(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){$(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=RL(e.writeResults,e.commitTime),r=Le(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=Ef(this.serializer),this.K_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((r=>Xa(this.serializer,r)))};this.K_(t)}}class wM{}class EM extends wM{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new D(C.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,o])=>this.connection.Wo(e,wf(t,r),s,i,o))).catch((i=>{throw i.name==="FirebaseError"?(i.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new D(C.UNKNOWN,i.toString())}))}jo(e,t,r,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,a])=>this.connection.jo(e,wf(t,r),s,o,a,i))).catch((o=>{throw o.name==="FirebaseError"?(o.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new D(C.UNKNOWN,o.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}function TM(n,e,t,r){return new EM(n,e,t,r)}class vM{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Ve(t),this.aa=!1):x("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const xs="RemoteStore";class AM{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=i,this.Aa.Mo((o=>{r.enqueueAndForget((async()=>{$r(this)&&(x(xs,"Restarting streams for network reachability change."),await(async function(l){const u=F(l);u.Ea.add(4),await ho(u),u.Va.set("Unknown"),u.Ea.delete(4),await xc(u)})(this))}))})),this.Va=new vM(r,s)}}async function xc(n){if($r(n))for(const e of n.Ra)await e(!0)}async function ho(n){for(const e of n.Ra)await e(!1)}function uh(n,e){const t=F(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),Pm(t)?Cm(t):po(t).O_()&&Sm(t,e))}function ji(n,e){const t=F(n),r=po(t);t.Ia.delete(e),r.O_()&&ob(t,e),t.Ia.size===0&&(r.O_()?r.L_():$r(t)&&t.Va.set("Unknown"))}function Sm(n,e){if(n.da.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(G.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}po(n).Z_(e)}function ob(n,e){n.da.$e(e),po(n).X_(e)}function Cm(n){n.da=new yL({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),po(n).start(),n.Va.ua()}function Pm(n){return $r(n)&&!po(n).x_()&&n.Ia.size>0}function $r(n){return F(n).Ea.size===0}function ab(n){n.da=void 0}async function bM(n){n.Va.set("Online")}async function RM(n){n.Ia.forEach(((e,t)=>{Sm(n,e)}))}async function SM(n,e){ab(n),Pm(n)?(n.Va.ha(e),Cm(n)):n.Va.set("Unknown")}async function CM(n,e,t){if(n.Va.set("Online"),e instanceof yA&&e.state===2&&e.cause)try{await(async function(s,i){const o=i.cause;for(const a of i.targetIds)s.Ia.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.Ia.delete(a),s.da.removeTarget(a))})(n,e)}catch(r){x(xs,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await hu(n,r)}else if(e instanceof bl?n.da.Xe(e):e instanceof _A?n.da.st(e):n.da.tt(e),!t.isEqual(G.min()))try{const r=await QA(n.localStore);t.compareTo(r)>=0&&await(function(i,o){const a=i.da.Tt(o);return a.targetChanges.forEach(((l,u)=>{if(l.resumeToken.approximateByteSize()>0){const h=i.Ia.get(u);h&&i.Ia.set(u,h.withResumeToken(l.resumeToken,o))}})),a.targetMismatches.forEach(((l,u)=>{const h=i.Ia.get(l);if(!h)return;i.Ia.set(l,h.withResumeToken(De.EMPTY_BYTE_STRING,h.snapshotVersion)),ob(i,l);const f=new Ln(h.target,l,u,h.sequenceNumber);Sm(i,f)})),i.remoteSyncer.applyRemoteEvent(a)})(n,t)}catch(r){x(xs,"Failed to raise snapshot:",r),await hu(n,r)}}async function hu(n,e,t){if(!qr(e))throw e;n.Ea.add(1),await ho(n),n.Va.set("Offline"),t||(t=()=>QA(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{x(xs,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await xc(n)}))}function cb(n,e){return e().catch((t=>hu(n,t,e)))}async function fo(n){const e=F(n),t=Lr(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Tr;for(;PM(e);)try{const s=await uM(e.localStore,r);if(s===null){e.Ta.length===0&&t.L_();break}r=s.batchId,kM(e,s)}catch(s){await hu(e,s)}lb(e)&&ub(e)}function PM(n){return $r(n)&&n.Ta.length<10}function kM(n,e){n.Ta.push(e);const t=Lr(n);t.O_()&&t.Y_&&t.ea(e.mutations)}function lb(n){return $r(n)&&!Lr(n).x_()&&n.Ta.length>0}function ub(n){Lr(n).start()}async function NM(n){Lr(n).ra()}async function DM(n){const e=Lr(n);for(const t of n.Ta)e.ea(t.mutations)}async function xM(n,e,t){const r=n.Ta.shift(),s=dm.from(r,e,t);await cb(n,(()=>n.remoteSyncer.applySuccessfulWrite(s))),await fo(n)}async function OM(n,e){e&&Lr(n).Y_&&await(async function(r,s){if((function(o){return pA(o)&&o!==C.ABORTED})(s.code)){const i=r.Ta.shift();Lr(r).B_(),await cb(r,(()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s))),await fo(r)}})(n,e),lb(n)&&ub(n)}async function LI(n,e){const t=F(n);t.asyncQueue.verifyOperationInProgress(),x(xs,"RemoteStore received new credentials");const r=$r(t);t.Ea.add(3),await ho(t),r&&t.Va.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await xc(t)}async function Cf(n,e){const t=F(n);e?(t.Ea.delete(2),await xc(t)):e||(t.Ea.add(2),await ho(t),t.Va.set("Unknown"))}function po(n){return n.ma||(n.ma=(function(t,r,s){const i=F(t);return i.sa(),new yM(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)})(n.datastore,n.asyncQueue,{Zo:bM.bind(null,n),Yo:RM.bind(null,n),t_:SM.bind(null,n),J_:CM.bind(null,n)}),n.Ra.push((async e=>{e?(n.ma.B_(),Pm(n)?Cm(n):n.Va.set("Unknown")):(await n.ma.stop(),ab(n))}))),n.ma}function Lr(n){return n.fa||(n.fa=(function(t,r,s){const i=F(t);return i.sa(),new IM(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)})(n.datastore,n.asyncQueue,{Zo:()=>Promise.resolve(),Yo:NM.bind(null,n),t_:OM.bind(null,n),ta:DM.bind(null,n),na:xM.bind(null,n)}),n.Ra.push((async e=>{e?(n.fa.B_(),await fo(n)):(await n.fa.stop(),n.Ta.length>0&&(x(xs,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}class km{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new st,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((o=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new km(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new D(C.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function mo(n,e){if(Ve("AsyncQueue",`${e}: ${n}`),qr(n))return new D(C.UNAVAILABLE,`${e}: ${n}`);throw n}class Ei{static emptySet(e){return new Ei(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||L.comparator(t.key,r.key):(t,r)=>L.comparator(t.key,r.key),this.keyedMap=Zo(),this.sortedSet=new Ie(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,r)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Ei)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new Ei;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class MI{constructor(){this.ga=new Ie(L.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):B(63341,{Vt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,r)=>{e.push(r)})),e}}class Hi{constructor(e,t,r,s,i,o,a,l,u){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=u}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach((a=>{o.push({type:0,doc:a})})),new Hi(e,t,Ei.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Sc(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}class VM{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some((e=>e.Da()))}}class LM{constructor(){this.queries=FI(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const s=F(t),i=s.queries;s.queries=FI(),i.forEach(((o,a)=>{for(const l of a.ba)l.onError(r)}))})(this,new D(C.ABORTED,"Firestore shutting down"))}}function FI(){return new Qn((n=>eA(n)),Sc)}async function Nm(n,e){const t=F(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.Sa()&&e.Da()&&(r=2):(i=new VM,r=e.Da()?0:1);try{switch(r){case 0:i.wa=await t.onListen(s,!0);break;case 1:i.wa=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const a=mo(o,`Initialization of query '${ci(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.ba.push(e),e.va(t.onlineState),i.wa&&e.Fa(i.wa)&&xm(t)}async function Dm(n,e){const t=F(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.ba.indexOf(e);o>=0&&(i.ba.splice(o,1),i.ba.length===0?s=e.Da()?0:1:!i.Sa()&&e.Da()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function MM(n,e){const t=F(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.ba)a.Fa(s)&&(r=!0);o.wa=s}}r&&xm(t)}function FM(n,e,t){const r=F(n),s=r.queries.get(e);if(s)for(const i of s.ba)i.onError(t);r.queries.delete(e)}function xm(n){n.Ca.forEach((e=>{e.next()}))}var Pf,UI;(UI=Pf||(Pf={})).Ma="default",UI.Cache="cache";class Om{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Hi(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.Ka||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=Hi.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Pf.Cache}}class UM{constructor(e,t){this.qa=e,this.byteLength=t}Ua(){return"metadata"in this.qa}}class BI{constructor(e){this.serializer=e}Ks(e){return bn(this.serializer,e)}qs(e){return e.metadata.exists?AA(this.serializer,e.document,!1):Ee.newNoDocument(this.Ks(e.metadata.name),this.Us(e.metadata.readTime))}Us(e){return Le(e)}}class BM{constructor(e,t){this.$a=e,this.serializer=t,this.Wa=[],this.Qa=[],this.collectionGroups=new Set,this.progress=hb(e)}get queries(){return this.Wa}get documents(){return this.Qa}Ga(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.qa.namedQuery)this.Wa.push(e.qa.namedQuery);else if(e.qa.documentMetadata){this.Qa.push({metadata:e.qa.documentMetadata}),e.qa.documentMetadata.exists||++t;const r=re.fromString(e.qa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.qa.document&&(this.Qa[this.Qa.length-1].document=e.qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,{...this.progress}):null}za(e){const t=new Map,r=new BI(this.serializer);for(const s of e)if(s.metadata.queries){const i=r.Ks(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||Y()).add(i);t.set(o,a)}}return t}async ja(e){const t=await hM(e,new BI(this.serializer),this.Qa,this.$a.id),r=this.za(this.documents);for(const s of this.Wa)await dM(e,s,r.get(s.name));return this.progress.taskState="Success",{progress:this.progress,Ha:this.collectionGroups,Ja:t}}}function hb(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}class db{constructor(e){this.key=e}}class fb{constructor(e){this.key=e}}class pb{constructor(e,t){this.query=e,this.Za=t,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=Y(),this.mutatedKeys=Y(),this.eu=nA(e),this.tu=new Ei(this.eu)}get nu(){return this.Za}ru(e,t){const r=t?t.iu:new MI,s=t?t.tu:this.tu;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,u=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal(((h,f)=>{const m=s.get(h),_=Cc(this.query,f)?f:null,A=!!m&&this.mutatedKeys.has(m.key),k=!!_&&(_.hasLocalMutations||this.mutatedKeys.has(_.key)&&_.hasCommittedMutations);let N=!1;m&&_?m.data.isEqual(_.data)?A!==k&&(r.track({type:3,doc:_}),N=!0):this.su(m,_)||(r.track({type:2,doc:_}),N=!0,(l&&this.eu(_,l)>0||u&&this.eu(_,u)<0)&&(a=!0)):!m&&_?(r.track({type:0,doc:_}),N=!0):m&&!_&&(r.track({type:1,doc:m}),N=!0,(l||u)&&(a=!0)),N&&(_?(o=o.add(_),i=k?i.add(h):i.delete(h)):(o=o.delete(h),i=i.delete(h)))})),this.query.limit!==null)for(;o.size>this.query.limit;){const h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),i=i.delete(h.key),r.track({type:1,doc:h})}return{tu:o,iu:r,Ss:a,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const o=e.iu.ya();o.sort(((h,f)=>(function(_,A){const k=N=>{switch(N){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return B(20277,{Vt:N})}};return k(_)-k(A)})(h.type,f.type)||this.eu(h.doc,f.doc))),this.ou(r),s=s??!1;const a=t&&!s?this._u():[],l=this.Ya.size===0&&this.current&&!s?1:0,u=l!==this.Xa;return this.Xa=l,o.length!==0||u?{snapshot:new Hi(this.query,e.tu,i,o,e.mutatedKeys,l===0,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new MI,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(e){return!this.Za.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Za=this.Za.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Za=this.Za.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Ya;this.Ya=Y(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Ya=this.Ya.add(r.key))}));const t=[];return e.forEach((r=>{this.Ya.has(r)||t.push(new fb(r))})),this.Ya.forEach((r=>{e.has(r)||t.push(new db(r))})),t}cu(e){this.Za=e.ks,this.Ya=Y();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Hi.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Xa===0,this.hasCachedResults)}}const zr="SyncEngine";class qM{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class WM{constructor(e){this.key=e,this.hu=!1}}class $M{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new Qn((a=>eA(a)),Sc),this.Iu=new Map,this.Eu=new Set,this.Ru=new Ie(L.comparator),this.Au=new Map,this.Vu=new Im,this.du={},this.mu=new Map,this.fu=Ds.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function zM(n,e,t=!0){const r=hh(n);let s;const i=r.Tu.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await mb(r,e,t,!0),s}async function GM(n,e){const t=hh(n);await mb(t,e,!0,!1)}async function mb(n,e,t,r){const s=await zi(n.localStore,Tt(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return r&&(a=await Vm(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&uh(n.remoteStore,s),a}async function Vm(n,e,t,r,s){n.pu=(f,m,_)=>(async function(k,N,W,z){let q=N.view.ru(W);q.Ss&&(q=await cu(k.localStore,N.query,!1).then((({documents:E})=>N.view.ru(E,q))));const K=z&&z.targetChanges.get(N.targetId),ie=z&&z.targetMismatches.get(N.targetId)!=null,J=N.view.applyChanges(q,k.isPrimaryClient,K,ie);return kf(k,N.targetId,J.au),J.snapshot})(n,f,m,_);const i=await cu(n.localStore,e,!0),o=new pb(e,i.ks),a=o.ru(i.documents),l=Nc.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),u=o.applyChanges(a,n.isPrimaryClient,l);kf(n,t,u.au);const h=new qM(e,t,o);return n.Tu.set(e,h),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),u.snapshot}async function jM(n,e,t){const r=F(n),s=r.Tu.get(e),i=r.Iu.get(s.targetId);if(i.length>1)return r.Iu.set(s.targetId,i.filter((o=>!Sc(o,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Gi(r.localStore,s.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(s.targetId),t&&ji(r.remoteStore,s.targetId),Ki(r,s.targetId)})).catch(Br)):(Ki(r,s.targetId),await Gi(r.localStore,s.targetId,!0))}async function HM(n,e){const t=F(n),r=t.Tu.get(e),s=t.Iu.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),ji(t.remoteStore,r.targetId))}async function KM(n,e,t){const r=Um(n);try{const s=await(function(o,a){const l=F(o),u=le.now(),h=a.reduce(((_,A)=>_.add(A.key)),Y());let f,m;return l.persistence.runTransaction("Locally write mutations","readwrite",(_=>{let A=Pt(),k=Y();return l.xs.getEntries(_,h).next((N=>{A=N,A.forEach(((W,z)=>{z.isValidDocument()||(k=k.add(W))}))})).next((()=>l.localDocuments.getOverlayedDocuments(_,A))).next((N=>{f=N;const W=[];for(const z of a){const q=mL(z,f.get(z.key).overlayedDocument);q!=null&&W.push(new Yn(z.key,q,Gv(q.value.mapValue),Re.exists(!0)))}return l.mutationQueue.addMutationBatch(_,u,W,a)})).next((N=>{m=N;const W=N.applyToLocalDocumentSet(f,k);return l.documentOverlayCache.saveOverlays(_,N.batchId,W)}))})).then((()=>({batchId:m.batchId,changes:sA(f)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),(function(o,a,l){let u=o.du[o.currentUser.toKey()];u||(u=new Ie(Q)),u=u.insert(a,l),o.du[o.currentUser.toKey()]=u})(r,s.batchId,t),await Jn(r,s.changes),await fo(r.remoteStore)}catch(s){const i=mo(s,"Failed to persist write");t.reject(i)}}async function gb(n,e){const t=F(n);try{const r=await lM(t.localStore,e);e.targetChanges.forEach(((s,i)=>{const o=t.Au.get(i);o&&($(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?o.hu=!0:s.modifiedDocuments.size>0?$(o.hu,14607):s.removedDocuments.size>0&&($(o.hu,42227),o.hu=!1))})),await Jn(t,r,e)}catch(r){await Br(r)}}function qI(n,e,t){const r=F(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Tu.forEach(((i,o)=>{const a=o.view.va(e);a.snapshot&&s.push(a.snapshot)})),(function(o,a){const l=F(o);l.onlineState=a;let u=!1;l.queries.forEach(((h,f)=>{for(const m of f.ba)m.va(a)&&(u=!0)})),u&&xm(l)})(r.eventManager,e),s.length&&r.Pu.J_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function QM(n,e,t){const r=F(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Au.get(e),i=s&&s.key;if(i){let o=new Ie(L.comparator);o=o.insert(i,Ee.newNoDocument(i,G.min()));const a=Y().add(i),l=new kc(G.min(),new Map,new Ie(Q),o,a);await gb(r,l),r.Ru=r.Ru.remove(i),r.Au.delete(e),Fm(r)}else await Gi(r.localStore,e,!1).then((()=>Ki(r,e,t))).catch(Br)}async function YM(n,e){const t=F(n),r=e.batch.batchId;try{const s=await cM(t.localStore,e);Mm(t,r,null),Lm(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Jn(t,s)}catch(s){await Br(s)}}async function JM(n,e,t){const r=F(n);try{const s=await(function(o,a){const l=F(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",(u=>{let h;return l.mutationQueue.lookupMutationBatch(u,a).next((f=>($(f!==null,37113),h=f.keys(),l.mutationQueue.removeMutationBatch(u,f)))).next((()=>l.mutationQueue.performConsistencyCheck(u))).next((()=>l.documentOverlayCache.removeOverlaysForBatchId(u,h,a))).next((()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,h))).next((()=>l.localDocuments.getDocuments(u,h)))}))})(r.localStore,e);Mm(r,e,t),Lm(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Jn(r,s)}catch(s){await Br(s)}}async function XM(n,e){const t=F(n);$r(t.remoteStore)||x(zr,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await(function(o){const a=F(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(l=>a.mutationQueue.getHighestUnacknowledgedBatchId(l)))})(t.localStore);if(r===Tr)return void e.resolve();const s=t.mu.get(r)||[];s.push(e),t.mu.set(r,s)}catch(r){const s=mo(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}function Lm(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function Mm(n,e,t){const r=F(n);let s=r.du[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.du[r.currentUser.toKey()]=s}}function Ki(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Vu.Gr(e).forEach((r=>{n.Vu.containsKey(r)||_b(n,r)}))}function _b(n,e){n.Eu.delete(e.path.canonicalString());const t=n.Ru.get(e);t!==null&&(ji(n.remoteStore,t),n.Ru=n.Ru.remove(e),n.Au.delete(t),Fm(n))}function kf(n,e,t){for(const r of t)r instanceof db?(n.Vu.addReference(r.key,e),ZM(n,r)):r instanceof fb?(x(zr,"Document no longer in limbo: "+r.key),n.Vu.removeReference(r.key,e),n.Vu.containsKey(r.key)||_b(n,r.key)):B(19791,{wu:r})}function ZM(n,e){const t=e.key,r=t.path.canonicalString();n.Ru.get(t)||n.Eu.has(r)||(x(zr,"New document in limbo: "+t),n.Eu.add(r),Fm(n))}function Fm(n){for(;n.Eu.size>0&&n.Ru.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new L(re.fromString(e)),r=n.fu.next();n.Au.set(r,new WM(t)),n.Ru=n.Ru.insert(t,r),uh(n.remoteStore,new Ln(Tt(co(t.path)),r,"TargetPurposeLimboResolution",St.ce))}}async function Jn(n,e,t){const r=F(n),s=[],i=[],o=[];r.Tu.isEmpty()||(r.Tu.forEach(((a,l)=>{o.push(r.pu(l,e,t).then((u=>{if((u||t)&&r.isPrimaryClient){const h=u?!u.fromCache:t?.targetChanges.get(l.targetId)?.current;r.sharedClientState.updateQueryState(l.targetId,h?"current":"not-current")}if(u){s.push(u);const h=vm.Es(l.targetId,u);i.push(h)}})))})),await Promise.all(o),r.Pu.J_(s),await(async function(l,u){const h=F(l);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",(f=>b.forEach(u,(m=>b.forEach(m.Ts,(_=>h.persistence.referenceDelegate.addReference(f,m.targetId,_))).next((()=>b.forEach(m.Is,(_=>h.persistence.referenceDelegate.removeReference(f,m.targetId,_)))))))))}catch(f){if(!qr(f))throw f;x(Am,"Failed to update sequence numbers: "+f)}for(const f of u){const m=f.targetId;if(!f.fromCache){const _=h.vs.get(m),A=_.snapshotVersion,k=_.withLastLimboFreeSnapshotVersion(A);h.vs=h.vs.insert(m,k)}}})(r.localStore,i))}async function eF(n,e){const t=F(n);if(!t.currentUser.isEqual(e)){x(zr,"User change. New user:",e.toKey());const r=await KA(t.localStore,e);t.currentUser=e,(function(i,o){i.mu.forEach((a=>{a.forEach((l=>{l.reject(new D(C.CANCELLED,o))}))})),i.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Jn(t,r.Ns)}}function tF(n,e){const t=F(n),r=t.Au.get(e);if(r&&r.hu)return Y().add(r.key);{let s=Y();const i=t.Iu.get(e);if(!i)return s;for(const o of i){const a=t.Tu.get(o);s=s.unionWith(a.view.nu)}return s}}async function nF(n,e){const t=F(n),r=await cu(t.localStore,e.query,!0),s=e.view.cu(r);return t.isPrimaryClient&&kf(t,e.targetId,s.au),s}async function rF(n,e){const t=F(n);return XA(t.localStore,e).then((r=>Jn(t,r)))}async function sF(n,e,t,r){const s=F(n),i=await(function(a,l){const u=F(a),h=F(u.mutationQueue);return u.persistence.runTransaction("Lookup mutation documents","readonly",(f=>h.Xn(f,l).next((m=>m?u.localDocuments.getDocuments(f,m):b.resolve(null)))))})(s.localStore,e);i!==null?(t==="pending"?await fo(s.remoteStore):t==="acknowledged"||t==="rejected"?(Mm(s,e,r||null),Lm(s,e),(function(a,l){F(F(a).mutationQueue).nr(l)})(s.localStore,e)):B(6720,"Unknown batchState",{bu:t}),await Jn(s,i)):x(zr,"Cannot apply mutation batch with id: "+e)}async function iF(n,e){const t=F(n);if(hh(t),Um(t),e===!0&&t.gu!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),s=await WI(t,r.toArray());t.gu=!0,await Cf(t.remoteStore,!0);for(const i of s)uh(t.remoteStore,i)}else if(e===!1&&t.gu!==!1){const r=[];let s=Promise.resolve();t.Iu.forEach(((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then((()=>(Ki(t,o),Gi(t.localStore,o,!0)))),ji(t.remoteStore,o)})),await s,await WI(t,r),(function(o){const a=F(o);a.Au.forEach(((l,u)=>{ji(a.remoteStore,u)})),a.Vu.zr(),a.Au=new Map,a.Ru=new Ie(L.comparator)})(t),t.gu=!1,await Cf(t.remoteStore,!1)}}async function WI(n,e,t){const r=F(n),s=[],i=[];for(const o of e){let a;const l=r.Iu.get(o);if(l&&l.length!==0){a=await zi(r.localStore,Tt(l[0]));for(const u of l){const h=r.Tu.get(u),f=await nF(r,h);f.snapshot&&i.push(f.snapshot)}}else{const u=await JA(r.localStore,o);a=await zi(r.localStore,u),await Vm(r,yb(u),o,!1,a.resumeToken)}s.push(a)}return r.Pu.J_(i),s}function yb(n){return Zv(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function oF(n){return(function(t){return F(F(t).persistence).hs()})(F(n).localStore)}async function aF(n,e,t,r){const s=F(n);if(s.gu)return void x(zr,"Ignoring unexpected query state notification.");const i=s.Iu.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=await XA(s.localStore,tA(i[0])),a=kc.createSynthesizedRemoteEventForCurrentChange(e,t==="current",De.EMPTY_BYTE_STRING);await Jn(s,o,a);break}case"rejected":await Gi(s.localStore,e,!0),Ki(s,e,r);break;default:B(64155,t)}}async function cF(n,e,t){const r=hh(n);if(r.gu){for(const s of e){if(r.Iu.has(s)&&r.sharedClientState.isActiveQueryTarget(s)){x(zr,"Adding an already active target "+s);continue}const i=await JA(r.localStore,s),o=await zi(r.localStore,i);await Vm(r,yb(i),o.targetId,!1,o.resumeToken),uh(r.remoteStore,o)}for(const s of t)r.Iu.has(s)&&await Gi(r.localStore,s,!1).then((()=>{ji(r.remoteStore,s),Ki(r,s)})).catch(Br)}}function hh(n){const e=F(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=gb.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=tF.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=QM.bind(null,e),e.Pu.J_=MM.bind(null,e.eventManager),e.Pu.yu=FM.bind(null,e.eventManager),e}function Um(n){const e=F(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=YM.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=JM.bind(null,e),e}function lF(n,e,t){const r=F(n);(async function(i,o,a){try{const l=await o.getMetadata();if(await(function(_,A){const k=F(_),N=Le(A.createTime);return k.persistence.runTransaction("hasNewerBundle","readonly",(W=>k.Pi.getBundleMetadata(W,A.id))).then((W=>!!W&&W.createTime.compareTo(N)>=0))})(i.localStore,l))return await o.close(),a._completeWith((function(_){return{taskState:"Success",documentsLoaded:_.totalDocuments,bytesLoaded:_.totalBytes,totalDocuments:_.totalDocuments,totalBytes:_.totalBytes}})(l)),Promise.resolve(new Set);a._updateProgress(hb(l));const u=new BM(l,o.serializer);let h=await o.Su();for(;h;){const m=await u.Ga(h);m&&a._updateProgress(m),h=await o.Su()}const f=await u.ja(i.localStore);return await Jn(i,f.Ja,void 0),await(function(_,A){const k=F(_);return k.persistence.runTransaction("Save bundle","readwrite",(N=>k.Pi.saveBundleMetadata(N,A)))})(i.localStore,l),a._completeWith(f.progress),Promise.resolve(f.Ha)}catch(l){return kn(zr,`Loading bundle failed with ${l}`),a._failWith(l),Promise.resolve(new Set)}})(r,e,t).then((s=>{r.sharedClientState.notifyBundleLoaded(s)}))}class Za{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Dc(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return HA(this.persistence,new jA,e.initialUser,this.serializer)}Cu(e){return new wm(lh.Vi,this.serializer)}Du(e){return new rb}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Za.provider={build:()=>new Za};class uF extends Za{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){$(this.persistence.referenceDelegate instanceof au,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new BA(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?ct.withCacheSize(this.cacheSizeBytes):ct.DEFAULT;return new wm((r=>au.Vi(r,t)),this.serializer)}}class Ib extends Za{constructor(e,t,r){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await Um(this.xu.syncEngine),await fo(this.xu.remoteStore),await this.persistence.zi((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}vu(e){return HA(this.persistence,new jA,e.initialUser,this.serializer)}Fu(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new BA(r,e.asyncQueue,t)}Mu(e,t){const r=new f1(t,this.persistence);return new d1(e.asyncQueue,r)}Cu(e){const t=Tm(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?ct.withCacheSize(this.cacheSizeBytes):ct.DEFAULT;return new Em(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,sb(),Sl(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new rb}}class hF extends Ib{constructor(e,t){super(e,t,!1),this.xu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.xu.syncEngine;this.sharedClientState instanceof wd&&(this.sharedClientState.syncEngine={So:sF.bind(null,t),Do:aF.bind(null,t),Co:cF.bind(null,t),hs:oF.bind(null,t),bo:rF.bind(null,t)},await this.sharedClientState.start()),await this.persistence.zi((async r=>{await iF(this.xu.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))}Du(e){const t=sb();if(!wd.v(t))throw new D(C.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=Tm(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new wd(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class ec{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>qI(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=eF.bind(null,this.syncEngine),await Cf(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new LM})()}createDatastore(e){const t=Dc(e.databaseInfo.databaseId),r=_M(e.databaseInfo);return TM(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return(function(r,s,i,o,a){return new AM(r,s,i,o,a)})(this.localStore,this.datastore,e.asyncQueue,(t=>qI(this.syncEngine,t,0)),(function(){return OI.v()?new OI:new fM})())}createSyncEngine(e,t){return(function(s,i,o,a,l,u,h){const f=new $M(s,i,o,a,l,u);return h&&(f.gu=!0),f})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const r=F(t);x(xs,"RemoteStore shutting down."),r.Ea.add(5),await ho(r),r.Aa.shutdown(),r.Va.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}ec.provider={build:()=>new ec};function $I(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}class dh{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Ve("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}class dF{constructor(e,t){this.Bu=e,this.serializer=t,this.metadata=new st,this.buffer=new Uint8Array,this.Lu=(function(){return new TextDecoder("utf-8")})(),this.ku().then((r=>{r&&r.Ua()?this.metadata.resolve(r.qa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.qa)}`))}),(r=>this.metadata.reject(r)))}close(){return this.Bu.cancel()}async getMetadata(){return this.metadata.promise}async Su(){return await this.getMetadata(),this.ku()}async ku(){const e=await this.Ku();if(e===null)return null;const t=this.Lu.decode(e),r=Number(t);isNaN(r)&&this.qu(`length string (${t}) is not valid number`);const s=await this.Uu(r);return new UM(JSON.parse(s),e.length+r)}$u(){return this.buffer.findIndex((e=>e===123))}async Ku(){for(;this.$u()<0&&!await this.Wu(););if(this.buffer.length===0)return null;const e=this.$u();e<0&&this.qu("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Uu(e){for(;this.buffer.length<e;)await this.Wu()&&this.qu("Reached the end of bundle when more is expected.");const t=this.Lu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}qu(e){throw this.Bu.cancel(),new Error(`Invalid bundle format: ${e}`)}async Wu(){const e=await this.Bu.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}let fF=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new D(C.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await(async function(s,i){const o=F(s),a={documents:i.map((f=>Ja(o.serializer,f)))},l=await o.jo("BatchGetDocuments",o.serializer.databaseId,re.emptyPath(),a,i.length),u=new Map;l.forEach((f=>{const m=AL(o.serializer,f);u.set(m.key.toString(),m)}));const h=[];return i.forEach((f=>{const m=u.get(f.toString());$(!!m,55234,{key:f}),h.push(m)})),h})(this.datastore,e);return t.forEach((r=>this.recordVersion(r))),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new uo(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach((t=>{e.delete(t.key.toString())})),e.forEach(((t,r)=>{const s=L.fromPath(r);this.mutations.push(new um(s,this.precondition(s)))})),await(async function(r,s){const i=F(r),o={writes:s.map((a=>Xa(i.serializer,a)))};await i.Wo("Commit",i.serializer.databaseId,re.emptyPath(),o)})(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw B(50498,{Gu:e.constructor.name});t=G.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new D(C.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(G.min())?Re.exists(!1):Re.updateTime(t):Re.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(G.min()))throw new D(C.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Re.updateTime(t)}return Re.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};class pF{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this.zu=r.maxAttempts,this.M_=new Rm(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Hu()}Hu(){this.M_.p_((async()=>{const e=new fF(this.datastore),t=this.Ju(e);t&&t.then((r=>{this.asyncQueue.enqueueAndForget((()=>e.commit().then((()=>{this.deferred.resolve(r)})).catch((s=>{this.Zu(s)}))))})).catch((r=>{this.Zu(r)}))}))}Ju(e){try{const t=this.updateFunction(e);return!Ac(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Zu(e){this.zu>0&&this.Xu(e)?(this.zu-=1,this.asyncQueue.enqueueAndForget((()=>(this.Hu(),Promise.resolve())))):this.deferred.reject(e)}Xu(e){if(e?.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!pA(t)}return!1}}const Mr="FirestoreClient";class mF{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this._databaseInfo=s,this.user=Ye.UNAUTHENTICATED,this.clientId=Yp.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,(async o=>{x(Mr,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(r,(o=>(x(Mr,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new st;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=mo(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function Td(n,e){n.asyncQueue.verifyOperationInProgress(),x(Mr,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener((async s=>{r.isEqual(s)||(await KA(e.localStore,s),r=s)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function zI(n,e){n.asyncQueue.verifyOperationInProgress();const t=await Bm(n);x(Mr,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((r=>LI(e.remoteStore,r))),n.setAppCheckTokenChangeListener(((r,s)=>LI(e.remoteStore,s))),n._onlineComponents=e}async function Bm(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){x(Mr,"Using user provided OfflineComponentProvider");try{await Td(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(s){return s.name==="FirebaseError"?s.code===C.FAILED_PRECONDITION||s.code===C.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(t))throw t;kn("Error using user provided cache. Falling back to memory cache: "+t),await Td(n,new Za)}}else x(Mr,"Using default OfflineComponentProvider"),await Td(n,new uF(void 0));return n._offlineComponents}async function fh(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(x(Mr,"Using user provided OnlineComponentProvider"),await zI(n,n._uninitializedComponentsProvider._online)):(x(Mr,"Using default OnlineComponentProvider"),await zI(n,new ec))),n._onlineComponents}function wb(n){return Bm(n).then((e=>e.persistence))}function qm(n){return Bm(n).then((e=>e.localStore))}function Eb(n){return fh(n).then((e=>e.remoteStore))}function Wm(n){return fh(n).then((e=>e.syncEngine))}function gF(n){return fh(n).then((e=>e.datastore))}async function Qi(n){const e=await fh(n),t=e.eventManager;return t.onListen=zM.bind(null,e.syncEngine),t.onUnlisten=jM.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=GM.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=HM.bind(null,e.syncEngine),t}function _F(n){return n.asyncQueue.enqueue((async()=>{const e=await wb(n),t=await Eb(n);return e.setNetworkEnabled(!0),(function(s){const i=F(s);return i.Ea.delete(0),xc(i)})(t)}))}function yF(n){return n.asyncQueue.enqueue((async()=>{const e=await wb(n),t=await Eb(n);return e.setNetworkEnabled(!1),(async function(s){const i=F(s);i.Ea.add(0),await ho(i),i.Va.set("Offline")})(t)}))}function IF(n,e,t,r){const s=new dh(r),i=new Om(e,s,t);return n.asyncQueue.enqueueAndForget((async()=>Nm(await Qi(n),i))),()=>{s.Nu(),n.asyncQueue.enqueueAndForget((async()=>Dm(await Qi(n),i)))}}function wF(n,e){const t=new st;return n.asyncQueue.enqueueAndForget((async()=>(async function(s,i,o){try{const a=await(function(u,h){const f=F(u);return f.persistence.runTransaction("read document","readonly",(m=>f.localDocuments.getDocument(m,h)))})(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new D(C.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const l=mo(a,`Failed to get document '${i} from cache`);o.reject(l)}})(await qm(n),e,t))),t.promise}function Tb(n,e,t={}){const r=new st;return n.asyncQueue.enqueueAndForget((async()=>(function(i,o,a,l,u){const h=new dh({next:m=>{h.Nu(),o.enqueueAndForget((()=>Dm(i,f)));const _=m.docs.has(a);!_&&m.fromCache?u.reject(new D(C.UNAVAILABLE,"Failed to get document because the client is offline.")):_&&m.fromCache&&l&&l.source==="server"?u.reject(new D(C.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(m)},error:m=>u.reject(m)}),f=new Om(co(a.path),h,{includeMetadataChanges:!0,Ka:!0});return Nm(i,f)})(await Qi(n),n.asyncQueue,e,t,r))),r.promise}function EF(n,e){const t=new st;return n.asyncQueue.enqueueAndForget((async()=>(async function(s,i,o){try{const a=await cu(s,i,!0),l=new pb(i,a.ks),u=l.ru(a.documents),h=l.applyChanges(u,!1);o.resolve(h.snapshot)}catch(a){const l=mo(a,`Failed to execute query '${i} against cache`);o.reject(l)}})(await qm(n),e,t))),t.promise}function vb(n,e,t={}){const r=new st;return n.asyncQueue.enqueueAndForget((async()=>(function(i,o,a,l,u){const h=new dh({next:m=>{h.Nu(),o.enqueueAndForget((()=>Dm(i,f))),m.fromCache&&l.source==="server"?u.reject(new D(C.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(m)},error:m=>u.reject(m)}),f=new Om(a,h,{includeMetadataChanges:!0,Ka:!0});return Nm(i,f)})(await Qi(n),n.asyncQueue,e,t,r))),r.promise}function TF(n,e){const t=new st;return n.asyncQueue.enqueueAndForget((async()=>KM(await Wm(n),e,t))),t.promise}function vF(n,e){const t=new dh(e);return n.asyncQueue.enqueueAndForget((async()=>(function(s,i){F(s).Ca.add(i),i.next()})(await Qi(n),t))),()=>{t.Nu(),n.asyncQueue.enqueueAndForget((async()=>(function(s,i){F(s).Ca.delete(i)})(await Qi(n),t)))}}function AF(n,e,t){const r=new st;return n.asyncQueue.enqueueAndForget((async()=>{const s=await gF(n);new pF(n.asyncQueue,s,t,e,r).ju()})),r.promise}function bF(n,e,t,r){const s=(function(o,a){let l;return l=typeof o=="string"?gA().encode(o):o,(function(h,f){return new dF(h,f)})((function(h,f){if(h instanceof Uint8Array)return $I(h,f);if(h instanceof ArrayBuffer)return $I(new Uint8Array(h),f);if(h instanceof ReadableStream)return h.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")})(l),a)})(t,Dc(e));n.asyncQueue.enqueueAndForget((async()=>{lF(await Wm(n),s,r)}))}function RF(n,e){return n.asyncQueue.enqueue((async()=>(function(r,s){const i=F(r);return i.persistence.runTransaction("Get named query","readonly",(o=>i.Pi.getNamedQuery(o,s)))})(await qm(n),e)))}function Ab(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}const SF="ComponentProvider",GI=new Map;function CF(n,e,t,r,s){return new W1(n,e,t,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,Ab(s.experimentalLongPollingOptions),s.useFetchStreams,s.isUsingEmulator,r)}const bb="firestore.googleapis.com",jI=!0;class HI{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new D(C.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=bb,this.ssl=jI}else this.host=e.host,this.ssl=e.ssl??jI;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=LA;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<$L)throw new D(C.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}_v("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Ab(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new D(C.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new D(C.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new D(C.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,s){return r.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Oc{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new HI({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new D(C.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new D(C.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new HI(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new e1;switch(r.type){case"firstParty":return new s1(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new D(C.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const r=GI.get(t);r&&(x(SF,"Removing Datastore"),GI.delete(t),r.terminate())})(this),Promise.resolve()}}function PF(n,e,t,r={}){n=ce(n,Oc);const s=Yt(e),i=n._getSettings(),o={...i,emulatorOptions:n._getEmulatorOptions()},a=`${e}:${t}`;s&&(sc(`https://${a}`),ic("Firestore",!0)),i.host!==bb&&i.host!==a&&kn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l={...i,host:a,ssl:s,emulatorOptions:r};if(!Bn(l,o)&&(n._setSettings(l),r.mockUserToken)){let u,h;if(typeof r.mockUserToken=="string")u=r.mockUserToken,h=Ye.MOCK_USER;else{u=Bf(r.mockUserToken,n._app?.options.projectId);const f=r.mockUserToken.sub||r.mockUserToken.user_id;if(!f)throw new D(C.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");h=new Ye(f)}n._authCredentials=new t1(new mv(u,h))}}let vt=class Rb{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Rb(this.firestore,e,this._query)}},ye=class na{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new vr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new na(this.firestore,e,this._key)}toJSON(){return{type:na._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(vc(t,na._jsonSchema))return new na(e,r||null,new L(re.fromString(t.referencePath)))}};ye._jsonSchemaVersion="firestore/documentReference/1.0",ye._jsonSchema={type:Be("string",ye._jsonSchemaVersion),referencePath:Be("string")};let vr=class Sb extends vt{constructor(e,t,r){super(e,t,co(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new ye(this.firestore,null,new L(e))}withConverter(e){return new Sb(this.firestore,e,this._path)}};function Cb(n,e,...t){if(n=U(n),Jp("collection","path",e),n instanceof Oc){const r=re.fromString(e,...t);return Vy(r),new vr(n,null,r)}{if(!(n instanceof ye||n instanceof vr))throw new D(C.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(re.fromString(e,...t));return Vy(r),new vr(n.firestore,null,r)}}function kF(n,e){if(n=ce(n,Oc),Jp("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new D(C.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new vt(n,null,(function(r){return new Kn(re.emptyPath(),r)})(e))}function du(n,e,...t){if(n=U(n),arguments.length===1&&(e=Yp.newId()),Jp("doc","path",e),n instanceof Oc){const r=re.fromString(e,...t);return Oy(r),new ye(n,null,new L(r))}{if(!(n instanceof ye||n instanceof vr))throw new D(C.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(re.fromString(e,...t));return Oy(r),new ye(n.firestore,n instanceof vr?n.converter:null,new L(r))}}function Pb(n,e){return n=U(n),e=U(e),(n instanceof ye||n instanceof vr)&&(e instanceof ye||e instanceof vr)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function kb(n,e){return n=U(n),e=U(e),n instanceof vt&&e instanceof vt&&n.firestore===e.firestore&&Sc(n._query,e._query)&&n.converter===e.converter}const KI="AsyncQueue";class QI{constructor(e=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Rm(this,"async_queue_retry"),this._c=()=>{const r=Sl();r&&x(KI,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=Sl();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Sl();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new st;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Yu.push(e),this.lc())))}async lc(){if(this.Yu.length!==0){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(e){if(!qr(e))throw e;x(KI,"Operation failed with retryable error: "+e)}this.Yu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,Ve("INTERNAL UNHANDLED ERROR: ",YI(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=km.createAndSchedule(this,e,t,r,(i=>this.hc(i)));return this.tc.push(s),s}uc(){this.nc&&B(47125,{Pc:YI(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,r)=>t.targetTimeMs-r.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}Rc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function YI(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class NF{constructor(){this._progressObserver={},this._taskCompletionResolver=new st,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}const DF=-1;let Me=class extends Oc{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new QI,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new QI(e),this._firestoreClient=void 0,await e}}};function ft(n){if(n._terminated)throw new D(C.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||Nb(n),n._firestoreClient}function Nb(n){const e=n._freezeSettings(),t=CF(n._databaseId,n._app?.options.appId||"",n._persistenceKey,n._app?.options.apiKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new mF(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(s){const i=s?._online.build();return{_offline:s?._offline.build(i),_online:i}})(n._componentsProvider))}function xF(n,e){kn("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return Db(n,ec.provider,{build:r=>new Ib(r,t.cacheSizeBytes,e?.forceOwnership)}),Promise.resolve()}async function OF(n){kn("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=n._freezeSettings();Db(n,ec.provider,{build:t=>new hF(t,e.cacheSizeBytes)})}function Db(n,e,t){if((n=ce(n,Me))._firestoreClient||n._terminated)throw new D(C.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new D(C.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},Nb(n)}function VF(n){if(n._initialized&&!n._terminated)throw new D(C.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new st;return n._queue.enqueueAndForgetEvenWhileRestricted((async()=>{try{await(async function(r){if(!An.v())return Promise.resolve();const s=r+GA;await An.delete(s)})(Tm(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function LF(n){return(function(t){const r=new st;return t.asyncQueue.enqueueAndForget((async()=>XM(await Wm(t),r))),r.promise})(ft(n=ce(n,Me)))}function MF(n){return _F(ft(n=ce(n,Me)))}function FF(n){return yF(ft(n=ce(n,Me)))}function UF(n,e){const t=ft(n=ce(n,Me)),r=new NF;return bF(t,n._databaseId,e,r),r}function BF(n,e){return RF(ft(n=ce(n,Me)),e).then((t=>t?new vt(n,null,t.query):null))}class lt{constructor(e){this._byteString=e}static fromBase64String(e){try{return new lt(De.fromBase64String(e))}catch(t){throw new D(C.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new lt(De.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:lt._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(vc(e,lt._jsonSchema))return lt.fromBase64String(e.bytes)}}lt._jsonSchemaVersion="firestore/bytes/1.0",lt._jsonSchema={type:Be("string",lt._jsonSchemaVersion),bytes:Be("string")};let Os=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new D(C.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new be(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};let zs=class{constructor(e){this._methodName=e}};class rn{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new D(C.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new D(C.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Q(this._lat,e._lat)||Q(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:rn._jsonSchemaVersion}}static fromJSON(e){if(vc(e,rn._jsonSchema))return new rn(e.latitude,e.longitude)}}rn._jsonSchemaVersion="firestore/geoPoint/1.0",rn._jsonSchema={type:Be("string",rn._jsonSchemaVersion),latitude:Be("number"),longitude:Be("number")};class sn{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0})(this._values,e._values)}toJSON(){return{type:sn._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(vc(e,sn._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new sn(e.vectorValues);throw new D(C.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}sn._jsonSchemaVersion="firestore/vectorValue/1.0",sn._jsonSchema={type:Be("string",sn._jsonSchemaVersion),vectorValues:Be("object")};const qF=/^__.*__$/;class WF{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Yn(e,this.data,this.fieldMask,t,this.fieldTransforms):new lo(e,this.data,t,this.fieldTransforms)}}class xb{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Yn(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Ob(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw B(40011,{dataSource:n})}}class ph{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.validatePath(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new ph({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){const t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePathSegment(e),r}childContextForFieldPath(e){const t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePath(),r}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return fu(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(Ob(this.dataSource)&&qF.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class $F{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Dc(e)}createContext(e,t,r,s=!1){return new ph({dataSource:e,methodName:t,targetDoc:r,path:be.emptyPath(),arrayElement:!1,hasConverter:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Gs(n){const e=n._freezeSettings(),t=Dc(n._databaseId);return new $F(n._databaseId,!!e.ignoreUndefinedProperties,t)}function mh(n,e,t,r,s,i={}){const o=n.createContext(i.merge||i.mergeFields?2:0,e,t,s);Qm("Data must be an object, but it was:",o,r);const a=Mb(r,o);let l,u;if(i.merge)l=new Ct(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const h=[];for(const f of i.mergeFields){const m=Vs(e,f,t);if(!o.contains(m))throw new D(C.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);Bb(h,m)||h.push(m)}l=new Ct(h),u=o.fieldTransforms.filter((f=>l.covers(f.field)))}else l=null,u=o.fieldTransforms;return new WF(new nt(a),l,u)}class Vc extends zs{_toFieldTransform(e){if(e.dataSource!==2)throw e.dataSource===1?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Vc}}function Vb(n,e,t){return new ph({dataSource:3,targetDoc:e.settings.targetDoc,methodName:n._methodName,arrayElement:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class $m extends zs{_toFieldTransform(e){return new Pc(e.path,new qi)}isEqual(e){return e instanceof $m}}class zm extends zs{constructor(e,t){super(e),this.Ac=t}_toFieldTransform(e){const t=Vb(this,e,!0),r=this.Ac.map((i=>js(i,t))),s=new Cs(r);return new Pc(e.path,s)}isEqual(e){return e instanceof zm&&Bn(this.Ac,e.Ac)}}class Gm extends zs{constructor(e,t){super(e),this.Ac=t}_toFieldTransform(e){const t=Vb(this,e,!0),r=this.Ac.map((i=>js(i,t))),s=new Ps(r);return new Pc(e.path,s)}isEqual(e){return e instanceof Gm&&Bn(this.Ac,e.Ac)}}class jm extends zs{constructor(e,t){super(e),this.Vc=t}_toFieldTransform(e){const t=new Wi(e.serializer,aA(e.serializer,this.Vc));return new Pc(e.path,t)}isEqual(e){return e instanceof jm&&this.Vc===e.Vc}}function Hm(n,e,t,r){const s=n.createContext(1,e,t);Qm("Data must be an object, but it was:",s,r);const i=[],o=nt.empty();Wr(r,((l,u)=>{const h=Ub(e,l,t);u=U(u);const f=s.childContextForFieldPath(h);if(u instanceof Vc)i.push(h);else{const m=js(u,f);m!=null&&(i.push(h),o.set(h,m))}}));const a=new Ct(i);return new xb(o,a,s.fieldTransforms)}function Km(n,e,t,r,s,i){const o=n.createContext(1,e,t),a=[Vs(e,r,t)],l=[s];if(i.length%2!=0)throw new D(C.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<i.length;m+=2)a.push(Vs(e,i[m])),l.push(i[m+1]);const u=[],h=nt.empty();for(let m=a.length-1;m>=0;--m)if(!Bb(u,a[m])){const _=a[m];let A=l[m];A=U(A);const k=o.childContextForFieldPath(_);if(A instanceof Vc)u.push(_);else{const N=js(A,k);N!=null&&(u.push(_),h.set(_,N))}}const f=new Ct(u);return new xb(h,f,o.fieldTransforms)}function Lb(n,e,t,r=!1){return js(t,n.createContext(r?4:3,e))}function js(n,e){if(Fb(n=U(n)))return Qm("Unsupported field value:",e,n),Mb(n,e);if(n instanceof zs)return(function(r,s){if(!Ob(s.dataSource))throw s.createError(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.createError(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return(function(r,s){const i=[];let o=0;for(const a of r){let l=js(a,s.childContextForArray(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}})(n,e)}return(function(r,s){if((r=U(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return aA(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=le.fromDate(r);return{timestampValue:$i(s.serializer,i)}}if(r instanceof le){const i=new le(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:$i(s.serializer,i)}}if(r instanceof rn)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof lt)return{bytesValue:IA(s.serializer,r._byteString)};if(r instanceof ye){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.createError(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:mm(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof sn)return(function(o,a){const l=o instanceof sn?o.toArray():o;return{mapValue:{fields:{[sm]:{stringValue:im},[Fi]:{arrayValue:{values:l.map((h=>{if(typeof h!="number")throw a.createError("VectorValues must only contain numeric values.");return lm(a.serializer,h)}))}}}}}})(r,s);if(NA(r))return r._toProto(s.serializer);throw s.createError(`Unsupported field value: ${Ju(r)}`)})(n,e)}function Mb(n,e){const t={};return Lv(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Wr(n,((r,s)=>{const i=js(s,e.childContextForField(r));i!=null&&(t[r]=i)})),{mapValue:{fields:t}}}function Fb(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof le||n instanceof rn||n instanceof lt||n instanceof ye||n instanceof zs||n instanceof sn||NA(n))}function Qm(n,e,t){if(!Fb(t)||!yv(t)){const r=Ju(t);throw r==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+r)}}function Vs(n,e,t){if((e=U(e))instanceof Os)return e._internalPath;if(typeof e=="string")return Ub(n,e);throw fu("Field path arguments must be of type string or ",n,!1,void 0,t)}const zF=new RegExp("[~\\*/\\[\\]]");function Ub(n,e,t){if(e.search(zF)>=0)throw fu(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Os(...e.split("."))._internalPath}catch{throw fu(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function fu(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${r}`),o&&(l+=` in document ${s}`),l+=")"),new D(C.INVALID_ARGUMENT,a+n+l)}function Bb(n,e){return n.some((t=>t.isEqual(e)))}class Ym{convertValue(e,t="none"){switch(xr(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ve(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Gn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw B(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Wr(e,((s,i)=>{r[s]=this.convertValue(i,t)})),r}convertVectorValue(e){const t=e.fields?.[Fi].arrayValue?.values?.map((r=>ve(r.doubleValue)));return new sn(t)}convertGeoPoint(e){return new rn(ve(e.latitude),ve(e.longitude))}convertArray(e,t){return(e.values||[]).map((r=>this.convertValue(r,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const r=rh(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Ha(e));default:return null}}convertTimestamp(e){const t=zn(e);return new le(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=re.fromString(e);$(kA(r),9688,{name:e});const s=new Dr(r.get(1),r.get(3)),i=new L(r.popFirst(5));return s.isEqual(t)||Ve(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}class Hs extends Ym{constructor(e){super(),this.firestore=e}convertBytes(e){return new lt(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new ye(this.firestore,null,t)}}function GF(){return new Vc("deleteField")}function jF(){return new $m("serverTimestamp")}function HF(...n){return new zm("arrayUnion",n)}function KF(...n){return new Gm("arrayRemove",n)}function QF(n){return new jm("increment",n)}const JI="@firebase/firestore",XI="4.10.0";function Nf(n){return(function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1})(n,["next","error","complete"])}class tc{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new ye(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new YF(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){return this._document?.data.clone().value.mapValue.fields??void 0}get(e){if(this._document){const t=this._document.data.field(Vs("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class YF extends tc{data(){return super.data()}}function qb(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new D(C.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Jm{}class Lc extends Jm{}function lr(n,e,...t){let r=[];e instanceof Jm&&r.push(e),r=r.concat(t),(function(i){const o=i.filter((l=>l instanceof Xm)).length,a=i.filter((l=>l instanceof gh)).length;if(o>1||o>0&&a>0)throw new D(C.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(const s of r)n=s._apply(n);return n}class gh extends Lc{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new gh(e,t,r)}_apply(e){const t=this._parse(e);return $b(e._query,t),new vt(e.firestore,e.converter,yf(e._query,t))}_parse(e){const t=Gs(e.firestore);return(function(i,o,a,l,u,h,f){let m;if(u.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new D(C.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){ew(f,h);const A=[];for(const k of f)A.push(ZI(l,i,k));m={arrayValue:{values:A}}}else m=ZI(l,i,f)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||ew(f,h),m=Lb(a,o,f,h==="in"||h==="not-in");return se.create(u,h,m)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function JF(n,e,t){const r=e,s=Vs("where",n);return gh._create(s,r,t)}class Xm extends Jm{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Xm(e,t)}_parse(e){const t=this._queryConstraints.map((r=>r._parse(e))).filter((r=>r.getFilters().length>0));return t.length===1?t[0]:he.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:((function(s,i){let o=s;const a=i.getFlattenedFilters();for(const l of a)$b(o,l),o=yf(o,l)})(e._query,t),new vt(e.firestore,e.converter,yf(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Zm extends Lc{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Zm(e,t)}_apply(e){const t=(function(s,i,o){if(s.startAt!==null)throw new D(C.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new D(C.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Ya(i,o)})(e._query,this._field,this._direction);return new vt(e.firestore,e.converter,nL(e._query,t))}}function XF(n,e="asc"){const t=e,r=Vs("orderBy",n);return Zm._create(r,t)}class _h extends Lc{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new _h(e,t,r)}_apply(e){return new vt(e.firestore,e.converter,ru(e._query,this._limit,this._limitType))}}function ZF(n){return Iv("limit",n),_h._create("limit",n,"F")}function eU(n){return Iv("limitToLast",n),_h._create("limitToLast",n,"L")}class yh extends Lc{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new yh(e,t,r)}_apply(e){const t=Wb(e,this.type,this._docOrFields,this._inclusive);return new vt(e.firestore,e.converter,rL(e._query,t))}}function tU(...n){return yh._create("startAt",n,!0)}function nU(...n){return yh._create("startAfter",n,!1)}class Ih extends Lc{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Ih(e,t,r)}_apply(e){const t=Wb(e,this.type,this._docOrFields,this._inclusive);return new vt(e.firestore,e.converter,sL(e._query,t))}}function rU(...n){return Ih._create("endBefore",n,!1)}function sU(...n){return Ih._create("endAt",n,!0)}function Wb(n,e,t,r){if(t[0]=U(t[0]),t[0]instanceof tc)return(function(i,o,a,l,u){if(!l)throw new D(C.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const h=[];for(const f of Ii(i))if(f.field.isKeyField())h.push(Rs(o,l.key));else{const m=l.data.field(f.field);if(nh(m))throw new D(C.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(m===null){const _=f.field.canonicalString();throw new D(C.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${_}' (used as the orderBy) does not exist.`)}h.push(m)}return new Vr(h,u)})(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=Gs(n.firestore);return(function(o,a,l,u,h,f){const m=o.explicitOrderBy;if(h.length>m.length)throw new D(C.INVALID_ARGUMENT,`Too many arguments provided to ${u}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const _=[];for(let A=0;A<h.length;A++){const k=h[A];if(m[A].field.isKeyField()){if(typeof k!="string")throw new D(C.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${u}(), but got a ${typeof k}`);if(!am(o)&&k.indexOf("/")!==-1)throw new D(C.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${u}() must be a plain document ID, but '${k}' contains a slash.`);const N=o.path.child(re.fromString(k));if(!L.isDocumentKey(N))throw new D(C.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${u}() must result in a valid document path, but '${N}' is not because it contains an odd number of segments.`);const W=new L(N);_.push(Rs(a,W))}else{const N=Lb(l,u,k);_.push(N)}}return new Vr(_,f)})(n._query,n.firestore._databaseId,s,e,t,r)}}function ZI(n,e,t){if(typeof(t=U(t))=="string"){if(t==="")throw new D(C.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!am(e)&&t.indexOf("/")!==-1)throw new D(C.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(re.fromString(t));if(!L.isDocumentKey(r))throw new D(C.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Rs(n,new L(r))}if(t instanceof ye)return Rs(n,t._key);throw new D(C.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Ju(t)}.`)}function ew(n,e){if(!Array.isArray(n)||n.length===0)throw new D(C.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function $b(n,e){const t=(function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null})(n.filters,(function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new D(C.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new D(C.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function wh(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class iU extends Ym{constructor(e){super(),this.firestore=e}convertBytes(e){return new lt(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new ye(this.firestore,null,t)}}class ds{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}let Ht=class zb extends tc{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Ea(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Vs("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new D(C.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=zb._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}};Ht._jsonSchemaVersion="firestore/documentSnapshot/1.0",Ht._jsonSchema={type:Be("string",Ht._jsonSchemaVersion),bundleSource:Be("string","DocumentSnapshot"),bundleName:Be("string"),bundle:Be("string")};let Ea=class extends Ht{data(e={}){return super.data(e)}},on=class Gb{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new ds(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((r=>{e.call(t,new Ea(this._firestore,this._userDataWriter,r.key,r,new ds(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new D(C.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map((a=>{const l=new Ea(s._firestore,s._userDataWriter,a.doc.key,a.doc,new ds(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}}))}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((a=>i||a.type!==3)).map((a=>{const l=new Ea(s._firestore,s._userDataWriter,a.doc.key,a.doc,new ds(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let u=-1,h=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),h=o.indexOf(a.doc.key)),{type:oU(a.type),doc:l,oldIndex:u,newIndex:h}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new D(C.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Gb._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Yp.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],s=[];return this.docs.forEach((i=>{i._document!==null&&(t.push(i._document),r.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}};function oU(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return B(61501,{type:n})}}function jb(n,e){return n instanceof Ht&&e instanceof Ht?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof on&&e instanceof on&&n._firestore===e._firestore&&kb(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}on._jsonSchemaVersion="firestore/querySnapshot/1.0",on._jsonSchema={type:Be("string",on._jsonSchemaVersion),bundleSource:Be("string","QuerySnapshot"),bundleName:Be("string"),bundle:Be("string")};const aU={maxAttempts:5};let cU=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Gs(e)}set(e,t,r){this._verifyNotCommitted();const s=mr(e,this._firestore),i=wh(s.converter,t,r),o=mh(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(o.toMutation(s._key,Re.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=mr(e,this._firestore);let o;return o=typeof(t=U(t))=="string"||t instanceof Os?Km(this._dataReader,"WriteBatch.update",i._key,t,r,s):Hm(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,Re.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=mr(e,this._firestore);return this._mutations=this._mutations.concat(new uo(t._key,Re.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new D(C.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function mr(n,e){if((n=U(n)).firestore!==e)throw new D(C.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}class lU{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Gs(e)}get(e){const t=mr(e,this._firestore),r=new iU(this._firestore);return this._transaction.lookup([t._key]).then((s=>{if(!s||s.length!==1)return B(24041);const i=s[0];if(i.isFoundDocument())return new tc(this._firestore,r,i.key,i,t.converter);if(i.isNoDocument())return new tc(this._firestore,r,t._key,null,t.converter);throw B(18433,{doc:i})}))}set(e,t,r){const s=mr(e,this._firestore),i=wh(s.converter,t,r),o=mh(this._dataReader,"Transaction.set",s._key,i,s.converter!==null,r);return this._transaction.set(s._key,o),this}update(e,t,r,...s){const i=mr(e,this._firestore);let o;return o=typeof(t=U(t))=="string"||t instanceof Os?Km(this._dataReader,"Transaction.update",i._key,t,r,s):Hm(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,o),this}delete(e){const t=mr(e,this._firestore);return this._transaction.delete(t._key),this}}let uU=class extends lU{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=mr(e,this._firestore),r=new Hs(this._firestore);return super.get(e).then((s=>new Ht(this._firestore,r,t._key,s._document,new ds(!1,!1),t.converter)))}};function hU(n,e,t){n=ce(n,Me);const r={...aU,...t};(function(o){if(o.maxAttempts<1)throw new D(C.INVALID_ARGUMENT,"Max attempts must be at least 1")})(r);const s=ft(n);return AF(s,(i=>e(new uU(n,i))),r)}function dU(n){n=ce(n,ye);const e=ce(n.firestore,Me),t=ft(e);return Tb(t,n._key).then((r=>eg(e,n,r)))}function fU(n){n=ce(n,ye);const e=ce(n.firestore,Me),t=ft(e),r=new Hs(e);return wF(t,n._key).then((s=>new Ht(e,r,n._key,s,new ds(s!==null&&s.hasLocalMutations,!0),n.converter)))}function pU(n){n=ce(n,ye);const e=ce(n.firestore,Me),t=ft(e);return Tb(t,n._key,{source:"server"}).then((r=>eg(e,n,r)))}function mU(n){n=ce(n,vt);const e=ce(n.firestore,Me),t=ft(e),r=new Hs(e);return qb(n._query),vb(t,n._query).then((s=>new on(e,r,n,s)))}function gU(n){n=ce(n,vt);const e=ce(n.firestore,Me),t=ft(e),r=new Hs(e);return EF(t,n._query).then((s=>new on(e,r,n,s)))}function _U(n){n=ce(n,vt);const e=ce(n.firestore,Me),t=ft(e),r=new Hs(e);return vb(t,n._query,{source:"server"}).then((s=>new on(e,r,n,s)))}function tw(n,e,t){n=ce(n,ye);const r=ce(n.firestore,Me),s=wh(n.converter,e,t),i=Gs(r);return Mc(r,[mh(i,"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,Re.none())])}function nw(n,e,t,...r){n=ce(n,ye);const s=ce(n.firestore,Me),i=Gs(s);let o;return o=typeof(e=U(e))=="string"||e instanceof Os?Km(i,"updateDoc",n._key,e,t,r):Hm(i,"updateDoc",n._key,e),Mc(s,[o.toMutation(n._key,Re.exists(!0))])}function yU(n){return Mc(ce(n.firestore,Me),[new uo(n._key,Re.none())])}function IU(n,e){const t=ce(n.firestore,Me),r=du(n),s=wh(n.converter,e),i=Gs(n.firestore);return Mc(t,[mh(i,"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,Re.exists(!1))]).then((()=>r))}function Hb(n,...e){n=U(n);let t={includeMetadataChanges:!1,source:"default"},r=0;typeof e[r]!="object"||Nf(e[r])||(t=e[r++]);const s={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(Nf(e[r])){const u=e[r];e[r]=u.next?.bind(u),e[r+1]=u.error?.bind(u),e[r+2]=u.complete?.bind(u)}let i,o,a;if(n instanceof ye)o=ce(n.firestore,Me),a=co(n._key.path),i={next:u=>{e[r]&&e[r](eg(o,n,u))},error:e[r+1],complete:e[r+2]};else{const u=ce(n,vt);o=ce(u.firestore,Me),a=u._query;const h=new Hs(o);i={next:f=>{e[r]&&e[r](new on(o,h,u,f))},error:e[r+1],complete:e[r+2]},qb(n._query)}const l=ft(o);return IF(l,a,s,i)}function wU(n,e){n=ce(n,Me);const t=ft(n),r=Nf(e)?e:{next:e};return vF(t,r)}function Mc(n,e){const t=ft(n);return TF(t,e)}function eg(n,e,t){const r=t.docs.get(e._key),s=new Hs(n);return new Ht(n,s,e._key,r,new ds(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){JV(Dn),an(new Ze("firestore",((r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new Me(new n1(r.getProvider("auth-internal")),new i1(o,r.getProvider("app-check-internal")),$1(o,s),o);return i={useFetchStreams:t,...i},a._setSettings(i),a}),"PUBLIC").setMultipleInstances(!0)),rt(JI,XI,e),rt(JI,XI,"esm2020")})();const EU="@firebase/firestore-compat",TU="0.4.4";function tg(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new D("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function rw(){if(typeof Uint8Array>"u")throw new D("unimplemented","Uint8Arrays are not available in this environment.")}function sw(){if(!B1())throw new D("unimplemented","Blobs are unavailable in Firestore in this environment.")}let Kb=class Df{constructor(e){this._delegate=e}static fromBase64String(e){return sw(),new Df(lt.fromBase64String(e))}static fromUint8Array(e){return rw(),new Df(lt.fromUint8Array(e))}toBase64(){return sw(),this._delegate.toBase64()}toUint8Array(){return rw(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function xf(n){return vU(n,["next","error","complete"])}function vU(n,e){if(typeof n!="object"||n===null)return!1;const t=n;for(const r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}class AU{enableIndexedDbPersistence(e,t){return xF(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return OF(e._delegate)}clearIndexedDbPersistence(e){return VF(e._delegate)}}class Qb{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof Dr||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&kn("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e={...t,...e},delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,r={}){PF(this._delegate,e,t,r)}enableNetwork(){return MF(this._delegate)}disableNetwork(){return FF(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,_v("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return LF(this._delegate)}onSnapshotsInSync(e){return wU(this._delegate,e)}get app(){if(!this._appCompat)throw new D("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Yi(this,Cb(this._delegate,e))}catch(t){throw It(t,"collection()","Firestore.collection()")}}doc(e){try{return new Gt(this,du(this._delegate,e))}catch(t){throw It(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new yt(this,kF(this._delegate,e))}catch(t){throw It(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return hU(this._delegate,t=>e(new Yb(this,t)))}batch(){return ft(this._delegate),new Jb(new cU(this._delegate,e=>Mc(this._delegate,e)))}loadBundle(e){return UF(this._delegate,e)}namedQuery(e){return BF(this._delegate,e).then(t=>t?new yt(this,t):null)}}class Eh extends Ym{constructor(e){super(),this.firestore=e}convertBytes(e){return new Kb(new lt(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return Gt.forKey(t,this.firestore,null)}}function bU(n){XV(n)}class Yb{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Eh(e)}get(e){const t=fs(e);return this._delegate.get(t).then(r=>new nc(this._firestore,new Ht(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){const s=fs(e);return r?(tg("Transaction.set",r),this._delegate.set(s,t,r)):this._delegate.set(s,t),this}update(e,t,r,...s){const i=fs(e);return arguments.length===2?this._delegate.update(i,t):this._delegate.update(i,t,r,...s),this}delete(e){const t=fs(e);return this._delegate.delete(t),this}}class Jb{constructor(e){this._delegate=e}set(e,t,r){const s=fs(e);return r?(tg("WriteBatch.set",r),this._delegate.set(s,t,r)):this._delegate.set(s,t),this}update(e,t,r,...s){const i=fs(e);return arguments.length===2?this._delegate.update(i,t):this._delegate.update(i,t,r,...s),this}delete(e){const t=fs(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class Ls{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){const r=new Ea(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new rc(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const r=Ls.INSTANCES;let s=r.get(e);s||(s=new WeakMap,r.set(e,s));let i=s.get(t);return i||(i=new Ls(e,new Eh(e),t),s.set(t,i)),i}}Ls.INSTANCES=new WeakMap;class Gt{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Eh(e)}static forPath(e,t,r){if(e.length%2!==0)throw new D("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new Gt(t,new ye(t._delegate,r,new L(e)))}static forKey(e,t,r){return new Gt(t,new ye(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new Yi(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Yi(this.firestore,Cb(this._delegate,e))}catch(t){throw It(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=U(e),e instanceof ye?Pb(this._delegate,e):!1}set(e,t){t=tg("DocumentReference.set",t);try{return t?tw(this._delegate,e,t):tw(this._delegate,e)}catch(r){throw It(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return arguments.length===1?nw(this._delegate,e):nw(this._delegate,e,t,...r)}catch(s){throw It(s,"updateDoc()","DocumentReference.update()")}}delete(){return yU(this._delegate)}onSnapshot(...e){const t=Xb(e),r=Zb(e,s=>new nc(this.firestore,new Ht(this.firestore._delegate,this._userDataWriter,s._key,s._document,s.metadata,this._delegate.converter)));return Hb(this._delegate,t,r)}get(e){let t;return e?.source==="cache"?t=fU(this._delegate):e?.source==="server"?t=pU(this._delegate):t=dU(this._delegate),t.then(r=>new nc(this.firestore,new Ht(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new Gt(this.firestore,e?this._delegate.withConverter(Ls.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function It(n,e,t){return n.message=n.message.replace(e,t),n}function Xb(n){for(const e of n)if(typeof e=="object"&&!xf(e))return e;return{}}function Zb(n,e){let t;return xf(n[0])?t=n[0]:xf(n[1])?t=n[1]:typeof n[0]=="function"?t={next:n[0],error:n[1],complete:n[2]}:t={next:n[1],error:n[2],complete:n[3]},{next:r=>{t.next&&t.next(e(r))},error:t.error?.bind(t),complete:t.complete?.bind(t)}}class nc{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Gt(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return jb(this._delegate,e._delegate)}}class rc extends nc{data(e){const t=this._delegate.data(e);return this._delegate._converter||ZV(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}}class yt{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Eh(e)}where(e,t,r){try{return new yt(this.firestore,lr(this._delegate,JF(e,t,r)))}catch(s){throw It(s,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new yt(this.firestore,lr(this._delegate,XF(e,t)))}catch(r){throw It(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new yt(this.firestore,lr(this._delegate,ZF(e)))}catch(t){throw It(t,"limit()","Query.limit()")}}limitToLast(e){try{return new yt(this.firestore,lr(this._delegate,eU(e)))}catch(t){throw It(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new yt(this.firestore,lr(this._delegate,tU(...e)))}catch(t){throw It(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new yt(this.firestore,lr(this._delegate,nU(...e)))}catch(t){throw It(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new yt(this.firestore,lr(this._delegate,rU(...e)))}catch(t){throw It(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new yt(this.firestore,lr(this._delegate,sU(...e)))}catch(t){throw It(t,"endAt()","Query.endAt()")}}isEqual(e){return kb(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=gU(this._delegate):e?.source==="server"?t=_U(this._delegate):t=mU(this._delegate),t.then(r=>new Of(this.firestore,new on(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){const t=Xb(e),r=Zb(e,s=>new Of(this.firestore,new on(this.firestore._delegate,this._userDataWriter,this._delegate,s._snapshot)));return Hb(this._delegate,t,r)}withConverter(e){return new yt(this.firestore,e?this._delegate.withConverter(Ls.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class RU{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new rc(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class Of{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new yt(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new rc(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new RU(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new rc(this._firestore,r))})}isEqual(e){return jb(this._delegate,e._delegate)}}class Yi extends yt{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new Gt(this.firestore,e):null}doc(e){try{return e===void 0?new Gt(this.firestore,du(this._delegate)):new Gt(this.firestore,du(this._delegate,e))}catch(t){throw It(t,"doc()","CollectionReference.doc()")}}add(e){return IU(this._delegate,e).then(t=>new Gt(this.firestore,t))}isEqual(e){return Pb(this._delegate,e._delegate)}withConverter(e){return new Yi(this.firestore,e?this._delegate.withConverter(Ls.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function fs(n){return ce(n,ye)}class ng{constructor(...e){this._delegate=new Os(...e)}static documentId(){return new ng(be.keyField().canonicalString())}isEqual(e){return e=U(e),e instanceof Os?this._delegate._internalPath.isEqual(e._internalPath):!1}}class as{static serverTimestamp(){const e=jF();return e._methodName="FieldValue.serverTimestamp",new as(e)}static delete(){const e=GF();return e._methodName="FieldValue.delete",new as(e)}static arrayUnion(...e){const t=HF(...e);return t._methodName="FieldValue.arrayUnion",new as(t)}static arrayRemove(...e){const t=KF(...e);return t._methodName="FieldValue.arrayRemove",new as(t)}static increment(e){const t=QF(e);return t._methodName="FieldValue.increment",new as(t)}constructor(e){this._delegate=e}isEqual(e){return this._delegate.isEqual(e._delegate)}}const SU={Firestore:Qb,GeoPoint:rn,Timestamp:le,Blob:Kb,Transaction:Yb,WriteBatch:Jb,DocumentReference:Gt,DocumentSnapshot:nc,Query:yt,QueryDocumentSnapshot:rc,QuerySnapshot:Of,CollectionReference:Yi,FieldPath:ng,FieldValue:as,setLogLevel:bU,CACHE_SIZE_UNLIMITED:DF};function CU(n,e){n.INTERNAL.registerComponent(new Ze("firestore-compat",t=>{const r=t.getProvider("app-compat").getImmediate(),s=t.getProvider("firestore").getImmediate();return e(r,s)},"PUBLIC").setServiceProps({...SU}))}function PU(n){CU(n,(e,t)=>new Qb(e,t,new AU)),n.registerVersion(EU,TU)}PU(Kt);const kU="type.googleapis.com/google.protobuf.Int64Value",NU="type.googleapis.com/google.protobuf.UInt64Value";function eR(n,e){const t={};for(const r in n)n.hasOwnProperty(r)&&(t[r]=e(n[r]));return t}function pu(n){if(n==null)return null;if(n instanceof Number&&(n=n.valueOf()),typeof n=="number"&&isFinite(n)||n===!0||n===!1||Object.prototype.toString.call(n)==="[object String]")return n;if(n instanceof Date)return n.toISOString();if(Array.isArray(n))return n.map(e=>pu(e));if(typeof n=="function"||typeof n=="object")return eR(n,e=>pu(e));throw new Error("Data cannot be encoded in JSON: "+n)}function Ji(n){if(n==null)return n;if(n["@type"])switch(n["@type"]){case kU:case NU:{const e=Number(n.value);if(isNaN(e))throw new Error("Data cannot be decoded from JSON: "+n);return e}default:throw new Error("Data cannot be decoded from JSON: "+n)}return Array.isArray(n)?n.map(e=>Ji(e)):typeof n=="function"||typeof n=="object"?eR(n,e=>Ji(e)):n}const tR="functions";const iw={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class kt extends $e{constructor(e,t,r){super(`${tR}/${e}`,t||""),this.details=r,Object.setPrototypeOf(this,kt.prototype)}}function DU(n){if(n>=200&&n<300)return"ok";switch(n){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function mu(n,e){let t=DU(n),r=t,s;try{const i=e&&e.error;if(i){const o=i.status;if(typeof o=="string"){if(!iw[o])return new kt("internal","internal");t=iw[o],r=o}const a=i.message;typeof a=="string"&&(r=a),s=i.details,s!==void 0&&(s=Ji(s))}}catch{}return t==="ok"?null:new kt(t,r,s)}class xU{constructor(e,t,r,s){this.app=e,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,me(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.auth=t.getImmediate({optional:!0}),this.messaging=r.getImmediate({optional:!0}),this.auth||t.get().then(i=>this.auth=i,()=>{}),this.messaging||r.get().then(i=>this.messaging=i,()=>{}),this.appCheck||s?.get().then(i=>this.appCheck=i,()=>{})}async getAuthToken(){if(this.auth)try{return(await this.auth.getToken())?.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(e){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){const t=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return t.error?null:t.token}return null}async getContext(e){const t=await this.getAuthToken(),r=await this.getMessagingToken(),s=await this.getAppCheckToken(e);return{authToken:t,messagingToken:r,appCheckToken:s}}}const ow="us-central1",OU=/^data: (.*?)(?:\n|$)/;function VU(n){let e=null;return{promise:new Promise((t,r)=>{e=setTimeout(()=>{r(new kt("deadline-exceeded","deadline-exceeded"))},n)}),cancel:()=>{e&&clearTimeout(e)}}}let LU=class{constructor(e,t,r,s,i=ow,o=(...a)=>fetch(...a)){this.app=e,this.fetchImpl=o,this.emulatorOrigin=null,this.contextProvider=new xU(e,t,r,s),this.cancelAllRequests=new Promise(a=>{this.deleteService=()=>Promise.resolve(a())});try{const a=new URL(i);this.customDomain=a.origin+(a.pathname==="/"?"":a.pathname),this.region=ow}catch{this.customDomain=null,this.region=i}}_delete(){return this.deleteService()}_url(e){const t=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${t}/${this.region}/${e}`:this.customDomain!==null?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`}};function MU(n,e,t){const r=Yt(e);n.emulatorOrigin=`http${r?"s":""}://${e}:${t}`,r&&(sc(n.emulatorOrigin+"/backends"),ic("Functions",!0))}function FU(n,e,t){const r=s=>qU(n,e,s,t||{});return r.stream=(s,i)=>WU(n,e,s,i),r}function UU(n,e,t){const r=s=>sR(n,e,s,t||{});return r.stream=(s,i)=>iR(n,e,s,i||{}),r}function nR(n){return n.emulatorOrigin&&Yt(n.emulatorOrigin)?"include":void 0}async function BU(n,e,t,r,s){t["Content-Type"]="application/json";let i;try{i=await r(n,{method:"POST",body:JSON.stringify(e),headers:t,credentials:nR(s)})}catch{return{status:0,json:null}}let o=null;try{o=await i.json()}catch{}return{status:i.status,json:o}}async function rR(n,e){const t={},r=await n.contextProvider.getContext(e.limitedUseAppCheckTokens);return r.authToken&&(t.Authorization="Bearer "+r.authToken),r.messagingToken&&(t["Firebase-Instance-ID-Token"]=r.messagingToken),r.appCheckToken!==null&&(t["X-Firebase-AppCheck"]=r.appCheckToken),t}function qU(n,e,t,r){const s=n._url(e);return sR(n,s,t,r)}async function sR(n,e,t,r){t=pu(t);const s={data:t},i=await rR(n,r),o=r.timeout||7e4,a=VU(o),l=await Promise.race([BU(e,s,i,n.fetchImpl,n),a.promise,n.cancelAllRequests]);if(a.cancel(),!l)throw new kt("cancelled","Firebase Functions instance was deleted.");const u=mu(l.status,l.json);if(u)throw u;if(!l.json)throw new kt("internal","Response is not valid JSON object.");let h=l.json.data;if(typeof h>"u"&&(h=l.json.result),typeof h>"u")throw new kt("internal","Response is missing data field.");return{data:Ji(h)}}function WU(n,e,t,r){const s=n._url(e);return iR(n,s,t,r||{})}async function iR(n,e,t,r){t=pu(t);const s={data:t},i=await rR(n,r);i["Content-Type"]="application/json",i.Accept="text/event-stream";let o;try{o=await n.fetchImpl(e,{method:"POST",body:JSON.stringify(s),headers:i,signal:r?.signal,credentials:nR(n)})}catch(m){if(m instanceof Error&&m.name==="AbortError"){const A=new kt("cancelled","Request was cancelled.");return{data:Promise.reject(A),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(A)}}}}}}const _=mu(0,null);return{data:Promise.reject(_),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(_)}}}}}}let a,l;const u=new Promise((m,_)=>{a=m,l=_});r?.signal?.addEventListener("abort",()=>{const m=new kt("cancelled","Request was cancelled.");l(m)});const h=o.body.getReader(),f=$U(h,a,l,r?.signal);return{stream:{[Symbol.asyncIterator](){const m=f.getReader();return{async next(){const{value:_,done:A}=await m.read();return{value:_,done:A}},async return(){return await m.cancel(),{done:!0,value:void 0}}}}},data:u}}function $U(n,e,t,r){const s=(o,a)=>{const l=o.match(OU);if(!l)return;const u=l[1];try{const h=JSON.parse(u);if("result"in h){e(Ji(h.result));return}if("message"in h){a.enqueue(Ji(h.message));return}if("error"in h){const f=mu(0,h);a.error(f),t(f);return}}catch(h){if(h instanceof kt){a.error(h),t(h);return}}},i=new TextDecoder;return new ReadableStream({start(o){let a="";return l();async function l(){if(r?.aborted){const u=new kt("cancelled","Request was cancelled");return o.error(u),t(u),Promise.resolve()}try{const{value:u,done:h}=await n.read();if(h){a.trim()&&s(a.trim(),o),o.close();return}if(r?.aborted){const m=new kt("cancelled","Request was cancelled");o.error(m),t(m),await n.cancel();return}a+=i.decode(u,{stream:!0});const f=a.split(`
`);a=f.pop()||"";for(const m of f)m.trim()&&s(m.trim(),o);return l()}catch(u){const h=u instanceof kt?u:mu(0,null);o.error(h),t(h)}}},cancel(){return n.cancel()}})}const aw="@firebase/functions",cw="0.13.1";const zU="auth-internal",GU="app-check-internal",jU="messaging-internal";function HU(n){const e=(t,{instanceIdentifier:r})=>{const s=t.getProvider("app").getImmediate(),i=t.getProvider(zU),o=t.getProvider(jU),a=t.getProvider(GU);return new LU(s,i,o,a,r)};an(new Ze(tR,e,"PUBLIC").setMultipleInstances(!0)),rt(aw,cw,n),rt(aw,cw,"esm2020")}function lw(n,e,t){MU(U(n),e,t)}function KU(n,e,t){return FU(U(n),e,t)}function QU(n,e,t){return UU(U(n),e,t)}HU();const YU="@firebase/functions-compat",JU="0.4.1";class oR{constructor(e,t){this.app=e,this._delegate=t,this._region=this._delegate.region,this._customDomain=this._delegate.customDomain}httpsCallable(e,t){return KU(this._delegate,e,t)}httpsCallableFromURL(e,t){return QU(this._delegate,e,t)}useFunctionsEmulator(e){const t=e.match("[a-zA-Z]+://([a-zA-Z0-9.-]+)(?::([0-9]+))?");if(t==null)throw new $e("functions","No origin provided to useFunctionsEmulator()");if(t[2]==null)throw new $e("functions","Port missing in origin provided to useFunctionsEmulator()");return lw(this._delegate,t[1],Number(t[2]))}useEmulator(e,t){return lw(this._delegate,e,t)}}const XU="us-central1",ZU=(n,{instanceIdentifier:e})=>{const t=n.getProvider("app-compat").getImmediate(),r=n.getProvider("functions").getImmediate({identifier:e??XU});return new oR(t,r)};function e2(){const n={Functions:oR};Kt.INTERNAL.registerComponent(new Ze("functions-compat",ZU,"PUBLIC").setServiceProps(n).setMultipleInstances(!0))}e2();Kt.registerVersion(YU,JU);const aR="firebasestorage.googleapis.com",cR="storageBucket",t2=120*1e3,n2=600*1e3,r2=1e3;class ke extends $e{constructor(e,t,r=0){super(vd(e),`Firebase Storage: ${t} (${vd(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,ke.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return vd(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Te;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Te||(Te={}));function vd(n){return"storage/"+n}function rg(){const n="An unknown error occurred, please check the error payload for server response.";return new ke(Te.UNKNOWN,n)}function s2(n){return new ke(Te.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function i2(n){return new ke(Te.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function o2(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new ke(Te.UNAUTHENTICATED,n)}function a2(){return new ke(Te.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function c2(n){return new ke(Te.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function lR(){return new ke(Te.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function uR(){return new ke(Te.CANCELED,"User canceled the upload/download.")}function l2(n){return new ke(Te.INVALID_URL,"Invalid URL '"+n+"'.")}function u2(n){return new ke(Te.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function h2(){return new ke(Te.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+cR+"' property when initializing the app?")}function hR(){return new ke(Te.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function d2(){return new ke(Te.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.")}function f2(){return new ke(Te.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function p2(n){return new ke(Te.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function Ti(n){return new ke(Te.INVALID_ARGUMENT,n)}function dR(){return new ke(Te.APP_DELETED,"The Firebase app was deleted.")}function fR(n){return new ke(Te.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Ta(n,e){return new ke(Te.INVALID_FORMAT,"String does not match format '"+n+"': "+e)}function Ho(n){throw new ke(Te.INTERNAL_ERROR,"Internal error: "+n)}class ut{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let r;try{r=ut.makeFromUrl(e,t)}catch{return new ut(e,"")}if(r.path==="")return r;throw u2(e)}static makeFromUrl(e,t){let r=null;const s="([A-Za-z0-9.\\-_]+)";function i(K){K.path.charAt(K.path.length-1)==="/"&&(K.path_=K.path_.slice(0,-1))}const o="(/(.*))?$",a=new RegExp("^gs://"+s+o,"i"),l={bucket:1,path:3};function u(K){K.path_=decodeURIComponent(K.path)}const h="v[A-Za-z0-9_]+",f=t.replace(/[.]/g,"\\."),m="(/([^?#]*).*)?$",_=new RegExp(`^https?://${f}/${h}/b/${s}/o${m}`,"i"),A={bucket:1,path:3},k=t===aR?"(?:storage.googleapis.com|storage.cloud.google.com)":t,N="([^?#]*)",W=new RegExp(`^https?://${k}/${s}/${N}`,"i"),q=[{regex:a,indices:l,postModify:i},{regex:_,indices:A,postModify:u},{regex:W,indices:{bucket:1,path:2},postModify:u}];for(let K=0;K<q.length;K++){const ie=q[K],J=ie.regex.exec(e);if(J){const E=J[ie.indices.bucket];let y=J[ie.indices.path];y||(y=""),r=new ut(E,y),ie.postModify(r);break}}if(r==null)throw l2(e);return r}}class m2{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function g2(n,e,t){let r=1,s=null,i=null,o=!1,a=0;function l(){return a===2}let u=!1;function h(...N){u||(u=!0,e.apply(null,N))}function f(N){s=setTimeout(()=>{s=null,n(_,l())},N)}function m(){i&&clearTimeout(i)}function _(N,...W){if(u){m();return}if(N){m(),h.call(null,N,...W);return}if(l()||o){m(),h.call(null,N,...W);return}r<64&&(r*=2);let q;a===1?(a=2,q=0):q=(r+Math.random())*1e3,f(q)}let A=!1;function k(N){A||(A=!0,m(),!u&&(s!==null?(N||(a=2),clearTimeout(s),f(0)):N||(a=1)))}return f(0),i=setTimeout(()=>{o=!0,k(!0)},t),k}function _2(n){n(!1)}function y2(n){return n!==void 0}function I2(n){return typeof n=="function"}function w2(n){return typeof n=="object"&&!Array.isArray(n)}function Th(n){return typeof n=="string"||n instanceof String}function uw(n){return sg()&&n instanceof Blob}function sg(){return typeof Blob<"u"}function Vf(n,e,t,r){if(r<e)throw Ti(`Invalid value for '${n}'. Expected ${e} or greater.`);if(r>t)throw Ti(`Invalid value for '${n}'. Expected ${t} or less.`)}function Gr(n,e,t){let r=e;return t==null&&(r=`https://${e}`),`${t}://${r}/v0${n}`}function pR(n){const e=encodeURIComponent;let t="?";for(const r in n)if(n.hasOwnProperty(r)){const s=e(r)+"="+e(n[r]);t=t+s+"&"}return t=t.slice(0,-1),t}var ys;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(ys||(ys={}));function mR(n,e){const t=n>=500&&n<600,s=[408,429].indexOf(n)!==-1,i=e.indexOf(n)!==-1;return t||s||i}class E2{constructor(e,t,r,s,i,o,a,l,u,h,f,m=!0,_=!1){this.url_=e,this.method_=t,this.headers_=r,this.body_=s,this.successCodes_=i,this.additionalRetryCodes_=o,this.callback_=a,this.errorCallback_=l,this.timeout_=u,this.progressCallback_=h,this.connectionFactory_=f,this.retry=m,this.isUsingEmulator=_,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((A,k)=>{this.resolve_=A,this.reject_=k,this.start_()})}start_(){const e=(r,s)=>{if(s){r(!1,new ll(!1,null,!0));return}const i=this.connectionFactory_();this.pendingConnection_=i;const o=a=>{const l=a.loaded,u=a.lengthComputable?a.total:-1;this.progressCallback_!==null&&this.progressCallback_(l,u)};this.progressCallback_!==null&&i.addUploadProgressListener(o),i.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&i.removeUploadProgressListener(o),this.pendingConnection_=null;const a=i.getErrorCode()===ys.NO_ERROR,l=i.getStatus();if(!a||mR(l,this.additionalRetryCodes_)&&this.retry){const h=i.getErrorCode()===ys.ABORT;r(!1,new ll(!1,null,h));return}const u=this.successCodes_.indexOf(l)!==-1;r(!0,new ll(u,i))})},t=(r,s)=>{const i=this.resolve_,o=this.reject_,a=s.connection;if(s.wasSuccessCode)try{const l=this.callback_(a,a.getResponse());y2(l)?i(l):i()}catch(l){o(l)}else if(a!==null){const l=rg();l.serverResponse=a.getErrorText(),this.errorCallback_?o(this.errorCallback_(a,l)):o(l)}else if(s.canceled){const l=this.appDelete_?dR():uR();o(l)}else{const l=lR();o(l)}};this.canceled_?t(!1,new ll(!1,null,!0)):this.backoffId_=g2(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&_2(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class ll{constructor(e,t,r){this.wasSuccessCode=e,this.connection=t,this.canceled=!!r}}function T2(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function v2(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function A2(n,e){e&&(n["X-Firebase-GMPID"]=e)}function b2(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function R2(n,e,t,r,s,i,o=!0,a=!1){const l=pR(n.urlParams),u=n.url+l,h=Object.assign({},n.headers);return A2(h,e),T2(h,t),v2(h,i),b2(h,r),new E2(u,n.method,h,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,s,o,a)}function S2(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function C2(...n){const e=S2();if(e!==void 0){const t=new e;for(let r=0;r<n.length;r++)t.append(n[r]);return t.getBlob()}else{if(sg())return new Blob(n);throw new ke(Te.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function P2(n,e,t){return n.webkitSlice?n.webkitSlice(e,t):n.mozSlice?n.mozSlice(e,t):n.slice?n.slice(e,t):null}function k2(n){if(typeof atob>"u")throw p2("base-64");return atob(n)}const jt={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class Ad{constructor(e,t){this.data=e,this.contentType=t||null}}function gR(n,e){switch(n){case jt.RAW:return new Ad(_R(e));case jt.BASE64:case jt.BASE64URL:return new Ad(yR(n,e));case jt.DATA_URL:return new Ad(D2(e),x2(e))}throw rg()}function _R(n){const e=[];for(let t=0;t<n.length;t++){let r=n.charCodeAt(t);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|r&63);else if((r&64512)===55296)if(!(t<n.length-1&&(n.charCodeAt(t+1)&64512)===56320))e.push(239,191,189);else{const i=r,o=n.charCodeAt(++t);r=65536|(i&1023)<<10|o&1023,e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63)}else(r&64512)===56320?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|r&63)}return new Uint8Array(e)}function N2(n){let e;try{e=decodeURIComponent(n)}catch{throw Ta(jt.DATA_URL,"Malformed data URL.")}return _R(e)}function yR(n,e){switch(n){case jt.BASE64:{const s=e.indexOf("-")!==-1,i=e.indexOf("_")!==-1;if(s||i)throw Ta(n,"Invalid character '"+(s?"-":"_")+"' found: is it base64url encoded?");break}case jt.BASE64URL:{const s=e.indexOf("+")!==-1,i=e.indexOf("/")!==-1;if(s||i)throw Ta(n,"Invalid character '"+(s?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let t;try{t=k2(e)}catch(s){throw s.message.includes("polyfill")?s:Ta(n,"Invalid character found")}const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}class IR{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(t===null)throw Ta(jt.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=t[1]||null;r!=null&&(this.base64=O2(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}}function D2(n){const e=new IR(n);return e.base64?yR(jt.BASE64,e.rest):N2(e.rest)}function x2(n){return new IR(n).contentType}function O2(n,e){return n.length>=e.length?n.substring(n.length-e.length)===e:!1}class xn{constructor(e,t){let r=0,s="";uw(e)?(this.data_=e,r=e.size,s=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=s}size(){return this.size_}type(){return this.type_}slice(e,t){if(uw(this.data_)){const r=this.data_,s=P2(r,e,t);return s===null?null:new xn(s)}else{const r=new Uint8Array(this.data_.buffer,e,t-e);return new xn(r,!0)}}static getBlob(...e){if(sg()){const t=e.map(r=>r instanceof xn?r.data_:r);return new xn(C2.apply(null,t))}else{const t=e.map(o=>Th(o)?gR(jt.RAW,o).data:o.data_);let r=0;t.forEach(o=>{r+=o.byteLength});const s=new Uint8Array(r);let i=0;return t.forEach(o=>{for(let a=0;a<o.length;a++)s[i++]=o[a]}),new xn(s,!0)}}uploadData(){return this.data_}}function ig(n){let e;try{e=JSON.parse(n)}catch{return null}return w2(e)?e:null}function V2(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function L2(n,e){const t=e.split("/").filter(r=>r.length>0).join("/");return n.length===0?t:n+"/"+t}function wR(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}function M2(n,e){return e}class gt{constructor(e,t,r,s){this.server=e,this.local=t||e,this.writable=!!r,this.xform=s||M2}}let ul=null;function F2(n){return!Th(n)||n.length<2?n:wR(n)}function vh(){if(ul)return ul;const n=[];n.push(new gt("bucket")),n.push(new gt("generation")),n.push(new gt("metageneration")),n.push(new gt("name","fullPath",!0));function e(i,o){return F2(o)}const t=new gt("name");t.xform=e,n.push(t);function r(i,o){return o!==void 0?Number(o):o}const s=new gt("size");return s.xform=r,n.push(s),n.push(new gt("timeCreated")),n.push(new gt("updated")),n.push(new gt("md5Hash",null,!0)),n.push(new gt("cacheControl",null,!0)),n.push(new gt("contentDisposition",null,!0)),n.push(new gt("contentEncoding",null,!0)),n.push(new gt("contentLanguage",null,!0)),n.push(new gt("contentType",null,!0)),n.push(new gt("metadata","customMetadata",!0)),ul=n,ul}function U2(n,e){function t(){const r=n.bucket,s=n.fullPath,i=new ut(r,s);return e._makeStorageReference(i)}Object.defineProperty(n,"ref",{get:t})}function B2(n,e,t){const r={};r.type="file";const s=t.length;for(let i=0;i<s;i++){const o=t[i];r[o.local]=o.xform(r,e[o.server])}return U2(r,n),r}function ER(n,e,t){const r=ig(e);return r===null?null:B2(n,r,t)}function q2(n,e,t,r){const s=ig(e);if(s===null||!Th(s.downloadTokens))return null;const i=s.downloadTokens;if(i.length===0)return null;const o=encodeURIComponent;return i.split(",").map(u=>{const h=n.bucket,f=n.fullPath,m="/b/"+o(h)+"/o/"+o(f),_=Gr(m,t,r),A=pR({alt:"media",token:u});return _+A})[0]}function og(n,e){const t={},r=e.length;for(let s=0;s<r;s++){const i=e[s];i.writable&&(t[i.server]=n[i.local])}return JSON.stringify(t)}const hw="prefixes",dw="items";function W2(n,e,t){const r={prefixes:[],items:[],nextPageToken:t.nextPageToken};if(t[hw])for(const s of t[hw]){const i=s.replace(/\/$/,""),o=n._makeStorageReference(new ut(e,i));r.prefixes.push(o)}if(t[dw])for(const s of t[dw]){const i=n._makeStorageReference(new ut(e,s.name));r.items.push(i)}return r}function $2(n,e,t){const r=ig(t);return r===null?null:W2(n,e,r)}class Xn{constructor(e,t,r,s){this.url=e,this.method=t,this.handler=r,this.timeout=s,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function Rn(n){if(!n)throw rg()}function Ah(n,e){function t(r,s){const i=ER(n,s,e);return Rn(i!==null),i}return t}function z2(n,e){function t(r,s){const i=$2(n,e,s);return Rn(i!==null),i}return t}function G2(n,e){function t(r,s){const i=ER(n,s,e);return Rn(i!==null),q2(i,s,n.host,n._protocol)}return t}function go(n){function e(t,r){let s;return t.getStatus()===401?t.getErrorText().includes("Firebase App Check token is invalid")?s=a2():s=o2():t.getStatus()===402?s=i2(n.bucket):t.getStatus()===403?s=c2(n.path):s=r,s.status=t.getStatus(),s.serverResponse=r.serverResponse,s}return e}function bh(n){const e=go(n);function t(r,s){let i=e(r,s);return r.getStatus()===404&&(i=s2(n.path)),i.serverResponse=s.serverResponse,i}return t}function TR(n,e,t){const r=e.fullServerUrl(),s=Gr(r,n.host,n._protocol),i="GET",o=n.maxOperationRetryTime,a=new Xn(s,i,Ah(n,t),o);return a.errorHandler=bh(e),a}function j2(n,e,t,r,s){const i={};e.isRoot?i.prefix="":i.prefix=e.path+"/",t.length>0&&(i.delimiter=t),r&&(i.pageToken=r),s&&(i.maxResults=s);const o=e.bucketOnlyServerUrl(),a=Gr(o,n.host,n._protocol),l="GET",u=n.maxOperationRetryTime,h=new Xn(a,l,z2(n,e.bucket),u);return h.urlParams=i,h.errorHandler=go(e),h}function H2(n,e,t){const r=e.fullServerUrl(),s=Gr(r,n.host,n._protocol),i="GET",o=n.maxOperationRetryTime,a=new Xn(s,i,G2(n,t),o);return a.errorHandler=bh(e),a}function K2(n,e,t,r){const s=e.fullServerUrl(),i=Gr(s,n.host,n._protocol),o="PATCH",a=og(t,r),l={"Content-Type":"application/json; charset=utf-8"},u=n.maxOperationRetryTime,h=new Xn(i,o,Ah(n,r),u);return h.headers=l,h.body=a,h.errorHandler=bh(e),h}function Q2(n,e){const t=e.fullServerUrl(),r=Gr(t,n.host,n._protocol),s="DELETE",i=n.maxOperationRetryTime;function o(l,u){}const a=new Xn(r,s,o,i);return a.successCodes=[200,204],a.errorHandler=bh(e),a}function Y2(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}function vR(n,e,t){const r=Object.assign({},t);return r.fullPath=n.path,r.size=e.size(),r.contentType||(r.contentType=Y2(null,e)),r}function J2(n,e,t,r,s){const i=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function a(){let q="";for(let K=0;K<2;K++)q=q+Math.random().toString().slice(2);return q}const l=a();o["Content-Type"]="multipart/related; boundary="+l;const u=vR(e,r,s),h=og(u,t),f="--"+l+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+h+`\r
--`+l+`\r
Content-Type: `+u.contentType+`\r
\r
`,m=`\r
--`+l+"--",_=xn.getBlob(f,r,m);if(_===null)throw hR();const A={name:u.fullPath},k=Gr(i,n.host,n._protocol),N="POST",W=n.maxUploadRetryTime,z=new Xn(k,N,Ah(n,t),W);return z.urlParams=A,z.headers=o,z.body=_.uploadData(),z.errorHandler=go(e),z}class gu{constructor(e,t,r,s){this.current=e,this.total=t,this.finalized=!!r,this.metadata=s||null}}function ag(n,e){let t=null;try{t=n.getResponseHeader("X-Goog-Upload-Status")}catch{Rn(!1)}return Rn(!!t&&(e||["active"]).indexOf(t)!==-1),t}function X2(n,e,t,r,s){const i=e.bucketOnlyServerUrl(),o=vR(e,r,s),a={name:o.fullPath},l=Gr(i,n.host,n._protocol),u="POST",h={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${r.size()}`,"X-Goog-Upload-Header-Content-Type":o.contentType,"Content-Type":"application/json; charset=utf-8"},f=og(o,t),m=n.maxUploadRetryTime;function _(k){ag(k);let N;try{N=k.getResponseHeader("X-Goog-Upload-URL")}catch{Rn(!1)}return Rn(Th(N)),N}const A=new Xn(l,u,_,m);return A.urlParams=a,A.headers=h,A.body=f,A.errorHandler=go(e),A}function Z2(n,e,t,r){const s={"X-Goog-Upload-Command":"query"};function i(u){const h=ag(u,["active","final"]);let f=null;try{f=u.getResponseHeader("X-Goog-Upload-Size-Received")}catch{Rn(!1)}f||Rn(!1);const m=Number(f);return Rn(!isNaN(m)),new gu(m,r.size(),h==="final")}const o="POST",a=n.maxUploadRetryTime,l=new Xn(t,o,i,a);return l.headers=s,l.errorHandler=go(e),l}const fw=256*1024;function eB(n,e,t,r,s,i,o,a){const l=new gu(0,0);if(o?(l.current=o.current,l.total=o.total):(l.current=0,l.total=r.size()),r.size()!==l.total)throw d2();const u=l.total-l.current;let h=u;s>0&&(h=Math.min(h,s));const f=l.current,m=f+h;let _="";h===0?_="finalize":u===h?_="upload, finalize":_="upload";const A={"X-Goog-Upload-Command":_,"X-Goog-Upload-Offset":`${l.current}`},k=r.slice(f,m);if(k===null)throw hR();function N(K,ie){const J=ag(K,["active","final"]),E=l.current+h,y=r.size();let w;return J==="final"?w=Ah(e,i)(K,ie):w=null,new gu(E,y,J==="final",w)}const W="POST",z=e.maxUploadRetryTime,q=new Xn(t,W,N,z);return q.headers=A,q.body=k.uploadData(),q.progressCallback=a||null,q.errorHandler=go(n),q}const tB={STATE_CHANGED:"state_changed"},wt={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function bd(n){switch(n){case"running":case"pausing":case"canceling":return wt.RUNNING;case"paused":return wt.PAUSED;case"success":return wt.SUCCESS;case"canceled":return wt.CANCELED;case"error":return wt.ERROR;default:return wt.ERROR}}class nB{constructor(e,t,r){if(I2(e)||t!=null||r!=null)this.next=e,this.error=t??void 0,this.complete=r??void 0;else{const i=e;this.next=i.next,this.error=i.error,this.complete=i.complete}}}function ii(n){return(...e)=>{Promise.resolve().then(()=>n(...e))}}class rB{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=ys.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=ys.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=ys.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,r,s,i){if(this.sent_)throw Ho("cannot .send() more than once");if(Yt(e)&&r&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(t,e,!0),i!==void 0)for(const o in i)i.hasOwnProperty(o)&&this.xhr_.setRequestHeader(o,i[o].toString());return s!==void 0?this.xhr_.send(s):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Ho("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Ho("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Ho("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Ho("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class sB extends rB{initXhr(){this.xhr_.responseType="text"}}function yn(){return new sB}class AR{isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}constructor(e,t,r=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=r,this._mappings=vh(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=s=>{if(this._request=void 0,this._chunkMultiplier=1,s._codeEquals(Te.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{const i=this.isExponentialBackoffExpired();if(mR(s.status,[]))if(i)s=lR();else{this.sleepTime=Math.max(this.sleepTime*2,r2),this._needToFetchStatus=!0,this.completeTransitions_();return}this._error=s,this._transition("error")}},this._metadataErrorHandler=s=>{this._request=void 0,s._codeEquals(Te.CANCELED)?this.completeTransitions_():(this._error=s,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise((s,i)=>{this._resolve=s,this._reject=i,this._start()}),this._promise.then(null,()=>{})}_makeProgressCallback(){const e=this._transferred;return t=>this._updateProgress(e+t)}_shouldDoResumable(e){return e.size()>256*1024}_start(){this._state==="running"&&this._request===void 0&&(this._resumable?this._uploadUrl===void 0?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout(()=>{this.pendingTimeout=void 0,this._continueUpload()},this.sleepTime):this._oneShotUpload())}_resolveToken(e){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([t,r])=>{switch(this._state){case"running":e(t,r);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused");break}})}_createResumable(){this._resolveToken((e,t)=>{const r=X2(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),s=this._ref.storage._makeRequest(r,yn,e,t);this._request=s,s.getPromise().then(i=>{this._request=void 0,this._uploadUrl=i,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const e=this._uploadUrl;this._resolveToken((t,r)=>{const s=Z2(this._ref.storage,this._ref._location,e,this._blob),i=this._ref.storage._makeRequest(s,yn,t,r);this._request=i,i.getPromise().then(o=>{o=o,this._request=void 0,this._updateProgress(o.current),this._needToFetchStatus=!1,o.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const e=fw*this._chunkMultiplier,t=new gu(this._transferred,this._blob.size()),r=this._uploadUrl;this._resolveToken((s,i)=>{let o;try{o=eB(this._ref._location,this._ref.storage,r,this._blob,e,this._mappings,t,this._makeProgressCallback())}catch(l){this._error=l,this._transition("error");return}const a=this._ref.storage._makeRequest(o,yn,s,i,!1);this._request=a,a.getPromise().then(l=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(l.current),l.finalized?(this._metadata=l.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){fw*this._chunkMultiplier*2<32*1024*1024&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,t)=>{const r=TR(this._ref.storage,this._ref._location,this._mappings),s=this._ref.storage._makeRequest(r,yn,e,t);this._request=s,s.getPromise().then(i=>{this._request=void 0,this._metadata=i,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,t)=>{const r=J2(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),s=this._ref.storage._makeRequest(r,yn,e,t);this._request=s,s.getPromise().then(i=>{this._request=void 0,this._metadata=i,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){const t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,this._request!==void 0?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":const t=this._state==="paused";this._state=e,t&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=uR(),this._state=e,this._notifyObservers();break;case"error":this._state=e,this._notifyObservers();break;case"success":this._state=e,this._notifyObservers();break}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start();break}}get snapshot(){const e=bd(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,t,r,s){const i=new nB(t||void 0,r||void 0,s||void 0);return this._addObserver(i),()=>{this._removeObserver(i)}}then(e,t){return this._promise.then(e,t)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){const t=this._observers.indexOf(e);t!==-1&&this._observers.splice(t,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach(t=>{this._notifyObserver(t)})}_finishPromise(){if(this._resolve!==void 0){let e=!0;switch(bd(this._state)){case wt.SUCCESS:ii(this._resolve.bind(null,this.snapshot))();break;case wt.CANCELED:case wt.ERROR:const t=this._reject;ii(t.bind(null,this._error))();break;default:e=!1;break}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(bd(this._state)){case wt.RUNNING:case wt.PAUSED:e.next&&ii(e.next.bind(e,this.snapshot))();break;case wt.SUCCESS:e.complete&&ii(e.complete.bind(e))();break;case wt.CANCELED:case wt.ERROR:e.error&&ii(e.error.bind(e,this._error))();break;default:e.error&&ii(e.error.bind(e,this._error))()}}resume(){const e=this._state==="paused"||this._state==="pausing";return e&&this._transition("running"),e}pause(){const e=this._state==="running";return e&&this._transition("pausing"),e}cancel(){const e=this._state==="running"||this._state==="pausing";return e&&this._transition("canceling"),e}}class Ms{constructor(e,t){this._service=e,t instanceof ut?this._location=t:this._location=ut.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new Ms(e,t)}get root(){const e=new ut(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return wR(this._location.path)}get storage(){return this._service}get parent(){const e=V2(this._location.path);if(e===null)return null;const t=new ut(this._location.bucket,e);return new Ms(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw fR(e)}}function iB(n,e,t){return n._throwIfRoot("uploadBytesResumable"),new AR(n,new xn(e),t)}function oB(n){const e={prefixes:[],items:[]};return bR(n,e).then(()=>e)}async function bR(n,e,t){const s=await RR(n,{pageToken:t});e.prefixes.push(...s.prefixes),e.items.push(...s.items),s.nextPageToken!=null&&await bR(n,e,s.nextPageToken)}function RR(n,e){e!=null&&typeof e.maxResults=="number"&&Vf("options.maxResults",1,1e3,e.maxResults);const t=e||{},r=j2(n.storage,n._location,"/",t.pageToken,t.maxResults);return n.storage.makeRequestWithTokens(r,yn)}function aB(n){n._throwIfRoot("getMetadata");const e=TR(n.storage,n._location,vh());return n.storage.makeRequestWithTokens(e,yn)}function cB(n,e){n._throwIfRoot("updateMetadata");const t=K2(n.storage,n._location,e,vh());return n.storage.makeRequestWithTokens(t,yn)}function lB(n){n._throwIfRoot("getDownloadURL");const e=H2(n.storage,n._location,vh());return n.storage.makeRequestWithTokens(e,yn).then(t=>{if(t===null)throw f2();return t})}function uB(n){n._throwIfRoot("deleteObject");const e=Q2(n.storage,n._location);return n.storage.makeRequestWithTokens(e,yn)}function SR(n,e){const t=L2(n._location.path,e),r=new ut(n._location.bucket,t);return new Ms(n.storage,r)}function hB(n){return/^[A-Za-z]+:\/\//.test(n)}function dB(n,e){return new Ms(n,e)}function CR(n,e){if(n instanceof cg){const t=n;if(t._bucket==null)throw h2();const r=new Ms(t,t._bucket);return e!=null?CR(r,e):r}else return e!==void 0?SR(n,e):n}function fB(n,e){if(e&&hB(e)){if(n instanceof cg)return dB(n,e);throw Ti("To use ref(service, url), the first argument must be a Storage instance.")}else return CR(n,e)}function pw(n,e){const t=e?.[cR];return t==null?null:ut.makeFromBucketSpec(t,n)}function pB(n,e,t,r={}){n.host=`${e}:${t}`;const s=Yt(e);s&&(sc(`https://${n.host}/b`),ic("Storage",!0)),n._isUsingEmulator=!0,n._protocol=s?"https":"http";const{mockUserToken:i}=r;i&&(n._overrideAuthToken=typeof i=="string"?i:Bf(i,n.app.options.projectId))}class cg{constructor(e,t,r,s,i,o=!1){this.app=e,this._authProvider=t,this._appCheckProvider=r,this._url=s,this._firebaseVersion=i,this._isUsingEmulator=o,this._bucket=null,this._host=aR,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=t2,this._maxUploadRetryTime=n2,this._requests=new Set,s!=null?this._bucket=ut.makeFromBucketSpec(s,this._host):this._bucket=pw(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=ut.makeFromBucketSpec(this._url,e):this._bucket=pw(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Vf("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Vf("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){if(me(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Ms(this,e)}_makeRequest(e,t,r,s,i=!0){if(this._deleted)return new m2(dR());{const o=R2(e,this._appId,r,s,t,this._firebaseVersion,i,this._isUsingEmulator);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(e,t){const[r,s]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,r,s).getPromise()}}const mw="@firebase/storage",gw="0.14.0";const mB="storage";function gB(n,e,t){return n=U(n),iB(n,e,t)}function _B(n){return n=U(n),aB(n)}function yB(n,e){return n=U(n),cB(n,e)}function IB(n,e){return n=U(n),RR(n,e)}function wB(n){return n=U(n),oB(n)}function EB(n){return n=U(n),lB(n)}function TB(n){return n=U(n),uB(n)}function _w(n,e){return n=U(n),fB(n,e)}function vB(n,e){return SR(n,e)}function AB(n,e,t,r={}){pB(n,e,t,r)}function bB(n,{instanceIdentifier:e}){const t=n.getProvider("app").getImmediate(),r=n.getProvider("auth-internal"),s=n.getProvider("app-check-internal");return new cg(t,r,s,e,Dn)}function RB(){an(new Ze(mB,bB,"PUBLIC").setMultipleInstances(!0)),rt(mw,gw,""),rt(mw,gw,"esm2020")}RB();class hl{constructor(e,t,r){this._delegate=e,this.task=t,this.ref=r}get bytesTransferred(){return this._delegate.bytesTransferred}get metadata(){return this._delegate.metadata}get state(){return this._delegate.state}get totalBytes(){return this._delegate.totalBytes}}class yw{constructor(e,t){this._delegate=e,this._ref=t,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}get snapshot(){return new hl(this._delegate.snapshot,this,this._ref)}then(e,t){return this._delegate.then(r=>{if(e)return e(new hl(r,this,this._ref))},t)}on(e,t,r,s){let i;return t&&(typeof t=="function"?i=o=>t(new hl(o,this,this._ref)):i={next:t.next?o=>t.next(new hl(o,this,this._ref)):void 0,complete:t.complete||void 0,error:t.error||void 0}),this._delegate.on(e,i,r||void 0,s||void 0)}}class Iw{constructor(e,t){this._delegate=e,this._service=t}get prefixes(){return this._delegate.prefixes.map(e=>new Un(e,this._service))}get items(){return this._delegate.items.map(e=>new Un(e,this._service))}get nextPageToken(){return this._delegate.nextPageToken||null}}class Un{constructor(e,t){this._delegate=e,this.storage=t}get name(){return this._delegate.name}get bucket(){return this._delegate.bucket}get fullPath(){return this._delegate.fullPath}toString(){return this._delegate.toString()}child(e){const t=vB(this._delegate,e);return new Un(t,this.storage)}get root(){return new Un(this._delegate.root,this.storage)}get parent(){const e=this._delegate.parent;return e==null?null:new Un(e,this.storage)}put(e,t){return this._throwIfRoot("put"),new yw(gB(this._delegate,e,t),this)}putString(e,t=jt.RAW,r){this._throwIfRoot("putString");const s=gR(t,e),i={...r};return i.contentType==null&&s.contentType!=null&&(i.contentType=s.contentType),new yw(new AR(this._delegate,new xn(s.data,!0),i),this)}listAll(){return wB(this._delegate).then(e=>new Iw(e,this.storage))}list(e){return IB(this._delegate,e||void 0).then(t=>new Iw(t,this.storage))}getMetadata(){return _B(this._delegate)}updateMetadata(e){return yB(this._delegate,e)}getDownloadURL(){return EB(this._delegate)}delete(){return this._throwIfRoot("delete"),TB(this._delegate)}_throwIfRoot(e){if(this._delegate._location.path==="")throw fR(e)}}class PR{constructor(e,t){this.app=e,this._delegate=t}get maxOperationRetryTime(){return this._delegate.maxOperationRetryTime}get maxUploadRetryTime(){return this._delegate.maxUploadRetryTime}ref(e){if(ww(e))throw Ti("ref() expected a child path but got a URL, use refFromURL instead.");return new Un(_w(this._delegate,e),this)}refFromURL(e){if(!ww(e))throw Ti("refFromURL() expected a full URL but got a child path, use ref() instead.");try{ut.makeFromUrl(e,this._delegate.host)}catch{throw Ti("refFromUrl() expected a valid full URL but got an invalid one.")}return new Un(_w(this._delegate,e),this)}setMaxUploadRetryTime(e){this._delegate.maxUploadRetryTime=e}setMaxOperationRetryTime(e){this._delegate.maxOperationRetryTime=e}useEmulator(e,t,r={}){AB(this._delegate,e,t,r)}}function ww(n){return/^[A-Za-z]+:\/\//.test(n)}const SB="@firebase/storage-compat",CB="0.4.0";const PB="storage-compat";function kB(n,{instanceIdentifier:e}){const t=n.getProvider("app-compat").getImmediate(),r=n.getProvider("storage").getImmediate({identifier:e});return new PR(t,r)}function NB(n){const e={TaskState:wt,TaskEvent:tB,StringFormat:jt,Storage:PR,Reference:Un};n.INTERNAL.registerComponent(new Ze(PB,kB,"PUBLIC").setServiceProps(e).setMultipleInstances(!0)),n.registerVersion(SB,CB)}NB(Kt);const kR={apiKey:"AIzaSyAv0bCe5KIuQx_sou8toBy5DG2PYaB_pBM",authDomain:"classroomproctor.firebaseapp.com",databaseURL:"https://classroomproctor-default-rtdb.firebaseio.com",projectId:"classroomproctor",storageBucket:"classroomproctor.firebasestorage.app",messagingSenderId:"600627073908",appId:"1:600627073908:web:935970f5849b28f6ad5221"};Kt.apps.length||Kt.initializeApp(kR);window.firebase=Kt;window.FIREBASE_CONFIG=kR;window.USING_FALLBACK_CONFIG=!1;
